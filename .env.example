# =============================================================================
# STM32 MCP Documentation Server - Environment Configuration
# =============================================================================
# Copy this file to .env and modify values as needed.
# All variables are prefixed with STM32_ to avoid conflicts.
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your settings
#   stm32-docs  # Start the server
# =============================================================================

# =============================================================================
# Server Mode Configuration
# =============================================================================
# Options: local, network, hybrid
# - local: stdio mode for local Claude Code connections
# - network: HTTP/SSE mode for Tailscale network access
# - hybrid: Both local and network modes (default)
STM32_SERVER_MODE=hybrid

# =============================================================================
# Network Configuration (for network/hybrid modes)
# =============================================================================
# Host to bind for network connections
# Use 0.0.0.0 to accept connections from any interface (required for Tailscale)
STM32_HOST=0.0.0.0

# Port for the HTTP/SSE server
STM32_PORT=8765

# Server identification
STM32_SERVER_NAME=stm32-docs
STM32_SERVER_VERSION=1.0.0
STM32_SERVER_DESCRIPTION=STM32 documentation search and retrieval via MCP

# =============================================================================
# Tailscale Configuration
# =============================================================================
# Tailscale hostname (optional, used for display purposes)
# STM32_TAILSCALE_HOSTNAME=stm32-docs-server

# Allowed Tailscale IPs (comma-separated, empty = allow all Tailscale IPs)
# STM32_ALLOWED_TAILSCALE_IPS=100.100.100.1,100.100.100.2

# CORS origins (comma-separated, * = allow all)
STM32_CORS_ORIGINS=*

# Optional API key for additional security
# STM32_API_KEY=your-secret-api-key

# =============================================================================
# Path Configuration
# =============================================================================
# These paths are auto-detected but can be overridden if needed
# STM32_PROJECT_ROOT=/path/to/project

# =============================================================================
# Document Chunking Configuration
# =============================================================================
# Target chunk size in tokens
STM32_CHUNK_SIZE=1000

# Overlap between consecutive chunks in tokens
STM32_CHUNK_OVERLAP=150

# Minimum chunk size in tokens (smaller chunks are merged)
STM32_MIN_CHUNK_SIZE=50

# Maximum chunk size in tokens (for oversized content)
STM32_MAX_CHUNK_SIZE=2000

# Preserve code blocks and tables when chunking
STM32_PRESERVE_CODE_BLOCKS=true
STM32_PRESERVE_TABLES=true

# =============================================================================
# Embedding Configuration
# =============================================================================
# Sentence transformer model for generating embeddings
# Options: all-MiniLM-L6-v2 (fast), all-MiniLM-L12-v2 (better), all-mpnet-base-v2 (best)
STM32_EMBEDDING_MODEL=all-MiniLM-L6-v2

# Batch size for embedding generation
STM32_EMBEDDING_BATCH_SIZE=32

# Device for embedding computation: cpu, cuda, mps, auto
STM32_EMBEDDING_DEVICE=cpu

# Normalize embedding vectors
STM32_NORMALIZE_EMBEDDINGS=true

# =============================================================================
# ChromaDB Configuration
# =============================================================================
# Collection name for storing document embeddings
STM32_COLLECTION_NAME=stm32_docs

# Distance metric: cosine, l2, ip (inner product)
STM32_CHROMA_DISTANCE_METRIC=cosine

# Disable ChromaDB telemetry
STM32_CHROMA_ANONYMIZED_TELEMETRY=false

# =============================================================================
# Search Configuration
# =============================================================================
# Default number of search results returned
STM32_DEFAULT_SEARCH_RESULTS=5

# Maximum number of search results allowed
STM32_MAX_SEARCH_RESULTS=20

# Minimum relevance score to include in results (0.0 = include all)
STM32_MIN_RELEVANCE_SCORE=0.3

# Apply reranking to improve result quality
STM32_RERANK_RESULTS=false

# =============================================================================
# Logging Configuration
# =============================================================================
# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
STM32_LOG_LEVEL=INFO

# Log message format
STM32_LOG_FORMAT=%(asctime)s | %(levelname)-8s | %(name)s | %(message)s

# Write logs to file in addition to console
STM32_LOG_TO_FILE=true

# Maximum log file size before rotation (10 MB default)
STM32_LOG_FILE_MAX_SIZE=10485760

# Number of backup log files to keep
STM32_LOG_FILE_BACKUP_COUNT=5

# =============================================================================
# Performance Configuration
# =============================================================================
# Cache embedding model in memory
STM32_CACHE_EMBEDDINGS=true

# Load embedding model on first use (lazy loading)
STM32_LAZY_LOAD_EMBEDDINGS=true

# Maximum concurrent connections for network mode
STM32_CONNECTION_POOL_SIZE=10

# Request timeout in seconds
STM32_REQUEST_TIMEOUT=30
