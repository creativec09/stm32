# Introduction to system memory boot mode on STM32 MCUs

# Introduction

This document applies to the products listed in Table 1, referred to as STM32 throughout the document.

It describes the supported peripherals and hardware requirements to consider when using the bootloader, stored in the internal boot ROM (system memory) of STM32 devices, and programmed during production.

Its main task is to download the application program to the internal flash memory through one of the available serial peripherals (such as USART, CAN, USB, I2C, I3C, SPI, FDCAN). A communication protocol is defined for each interface, with a compatible command set and sequence.

Table 1. Applicable products   

<table><tr><td>Type</td><td colspan="2">Part number or product series</td></tr><tr><td></td><td>STM32C0 series: STM32F0 series:</td><td>STM32C011xx, STM32C031xx, STM32C051xx, STM32C071xx, STM32C091xx, STM32C092xx STM32F03xxx, STM32F04xxx, STM32F05xxx, STM32F07xxx, STM32F09xxX</td></tr><tr><td></td><td>STM32F1 series STM32F2 series</td><td></td></tr><tr><td></td><td>STM32F3 series:</td><td>STM32F301xx, STM32F302xx, STM32F303xx, STM32F318xx, STM32F328xX, STM32F334xx, STM32F358xx, STM32F373xx, STM32F378xx, STM32F398xX</td></tr><tr><td></td><td>STM32F4 series:</td><td>STM32F401xx, STM32F405xx, STM32F407xx, STM32F410xx, STM32F411xx, STM32F412xx, STM32F413xx, STM32F415xx, STM32F417xx, STM32F423xx, STM32F427xx, STM32F429xx, STM32F437xx, STM32F439xx, STM32F446xx,</td></tr><tr><td></td><td>STM32F7 series:</td><td>STM32F469xx, STM32F479xx STM32F722xx, STM32F723xx, STM32F732xx, STM32F733xx, STM32F745xX, STM32F746xx, STM32F756xx, STM32F765xx, STM32F767xx, STM32F769xx,</td></tr><tr><td></td><td>STM32G0 series:</td><td>STM32F777xx, STM32F779xx STM32G030xx, STM32G031xx, STM32G041xx, STM32G07xxx, STM32G08xXX, STM32G0B0xx, STM32G0B1xx, STM32G0C1xx, STM32G050xx, STM32G051xx,</td></tr><tr><td></td><td>STM32G4 series:</td><td>STM32G061xx STM32G431xx, STM32G441xx, STM32G47xxx, STM32G48xxx, STM32G491xx,</td></tr><tr><td>Microcontrollers STM32L0 series STM32L1 series:</td><td>STM32H5 series:</td><td>STM32G4A1xx STM32H503xx, STM32H562xx, STM32H563xx, STM32H573xx, STM32H523xx,</td></tr><tr><td>STM32L4 series:</td><td>STM32H7 series:</td><td>STM32H533xx STM32H72xxx, STM32H73xxx, STM32H74xxx, STM32H75xxx, STM32H7A3xx,</td></tr><tr><td colspan="2">STM32L5 series: STM32U0 series: STM32U3 series: STM32U5 series: STM32WB series: STM32WBA series: STM32WBA50xx, STM32WBA52xx, STM32WBA54xx, STM32WBA55xx,</td><td>STM32H7B0xx, STM32H7B3xx, STM32H7R3xx, STM32H7R7xx, STM32H7S3xx, STM32H7S7xx</td></tr></table>

# Contents

General information . 26   
Related documents 26   
Glossary . . . . . 27

# General bootloader description . .. .. 32

4.1 Bootloader activation 32   
4.2 Bootloader identification 35   
4.3 Hardware connection requirements 44   
4.4 Bootloader memory management 46   
4.5 Bootloader UART baudrate detection 47   
4.6 Programming constraints 49   
4.7 ExitSecureMemory feature . . 50   
4.7.1 ExitSecureMemory v1.0 .50   
4.7.2 ExitSecureMemory v1.1 52   
4.8 IWDG usage . 53   
4.9 Bootloader models 53   
4.10 Boot constraints on BL 54

# STM32C011xx devices .... .. 57

5.1 Bootloader configuration 57   
5.2 Bootloader selection 58   
5.3 Bootloader version 58

# STM32C031xx devices . .. .. 59

6.1 Bootloader configuration 59   
6.2 Bootloader selection 60   
6.3 Bootloader version 60

# STM32C051xx devices . 61

7.1 Bootloader configuration 61   
7.2 Boot model 63   
7.3 Bootloader selection 64   
7.4 Bootloader version 65

# STM32C071xx devices .. .66

8.1 Bootloader configuration 66   
8.2 Bootloader selection 68   
8.3 Bootloader version 68

# STM32C091xx/92xx devices . . . .70

9.1 Bootloader configuration 70   
9.2 Boot model . 72   
9.3 Bootloader selection 73   
9.4 Bootloader version 74

# STM32F03xx4/6 devices . . . 75

10.1 Bootloader configuration 75   
10.2 Bootloader selection 76   
10.3 Bootloader version 76

# STM32F030xC devices .. 77

11.1 Bootloader configuration 77   
11.2 Bootloader selection 78   
11.3 Bootloader version 78

# STM32F05xxx and STM32F030x8 devices . . .. 79

12.1 Bootloader configuration 79   
12.2 Bootloader selection 80   
12.3 Bootloader version 80

# STM32F04xxx devices .81

13.1 Bootloader configuration 81   
13.2 Bootloader selection 83   
13.3 Bootloader version 84

# STM32F070x6 devices 85

14.1 Bootloader configuration 85   
14.2 Bootloader selection 87   
14.3 Bootloader version 88

# STM32F070xB devices . . . 89

15.1 Bootloader configuration 89   
15.2 Bootloader selection 91   
15.3 Bootloader version 92

# STM32F071xx/072xx devices . . . 93

16.1 Bootloader configuration 93   
16.2 Bootloader selection 95   
16.3 Bootloader version 95

# STM32F09xxx devices .97

17.1 Bootloader configuration 97   
17.2 Bootloader selection 98   
17.3 Bootloader version 98

18

# STM32F10xxx devices 99

18.1 Bootloader configuration 99   
18.2 Bootloader selection 100   
18.3 Bootloader version 100

# STM32F105xx/107xx devices . . .. 102

19.1 Bootloader configuration 102   
19.2 Bootloader selection 104   
19.3 Bootloader version 105 19.3.1 How to identify STM32F105xx/107xx bootloader versions 105 19.3.2 Bootloader unavailability on STM32F105xx/STM32F107xx devices with date code lower than 937 106 19.3.3 USART bootloader Get-Version command returns 0x20 instead of 0x22 106 19.3.4 PA9 excessive power consumption when USB cable is plugged in bootloader V2.0 107

# STM32F10xxx XL-density devices . . 108

20.1 Bootloader configuration 108   
20.2 Bootloader selection 109   
20.3 Bootloader version 109

# STM32F2xxxx devices 110

# 21.1 Bootloader V2.x .110

21.1.1 Bootloader configuration 110  
21.1.2 Bootloader selection 111  
21.1.3 Bootloader version 112

# 21.2 Bootloader V3.x .113

21.2.1 Bootloader configuration 113   
21.2.2 Bootloader selection 115   
21.2.3 Bootloader version 116

# STM32F301xx/302x4(6/8) devices .. 117

22.1 Bootloader configuration .117   
22.2 Bootloader selection 119   
22.3 Bootloader version 120

23

# STM32F302xB(C)/303xB(C) devices ... . 121

23.1 Bootloader configuration 121   
23.2 Bootloader selection 123   
23.3 Bootloader version 123

24

# STM32F302xD(E)/303xD(E) devices . . . . 124

24.1 Bootloader configuration 124   
24.2 Bootloader selection 126   
24.3 Bootloader version 127

# STM32F303x4(6/8)/334xx/328xx devices . . . 128

25.1 Bootloader configuration 128   
25.2 Bootloader selection 129   
25.3 Bootloader version 129

# STM32F318xx devices 130

26.1 Bootloader configuration 130

26.2 Bootloader selection . 131   
26.3 Bootloader version 132

27

# STM32F358xx devices 133

27.1 Bootloader configuration 133   
27.2 Bootloader selection 134   
27.3 Bootloader version 134

28

# STM32F373xx devices 135

28.1 Bootloader configuration 135   
28.2 Bootloader selection 137   
28.3 Bootloader version 137

29

# STM32F378xx devices 139

29.1 Bootloader configuration 139   
29.2 Bootloader selection 140   
29.3 Bootloader version 140

30

# STM32F398xx devices 141

30.1 Bootloader configuration 141   
30.2 Bootloader selection 142   
30.3 Bootloader version 143

31

# STM32F40xxx/41xxx devices . . . 144

# 31.1 Bootloader V3.x 144

31.1.1 Bootloader configuration 144   
31.1.2 Bootloader selection 146   
31.1.3 Bootloader version . 147

# 31.2 Bootloader V9.x 147

31.2.1 Bootloader configuration 147   
31.2.2 Bootloader selection 151   
31.2.3 Bootloader version . 152

# STM32F401xB(C) devices . . . 153

32.1 Bootloader configuration 153   
32.2 Bootloader selection . . 156

# 32.3 Bootloader version 157

33

# STM32F401xD(E) devices . . 158

33.1 Bootloader configuration 158   
33.2 Bootloader selection 161   
33.3 Bootloader version 162

34

# STM32F410xx devices 163

34.1 Bootloader configuration 163   
34.2 Bootloader selection. 166   
34.3 Bootloader version 167

35

# STM32F411xx devices . . 168

35.1 Bootloader configuration 168   
35.2 Bootloader selection 171   
35.3 Bootloader version 172

36

# STM32F412xx devices 173

36.1 Bootloader configuration 173   
36.2 Bootloader selection 177   
36.3 Bootloader version 178

37

# STM32F413xx/423xx devices . . 179

37.1 Bootloader configuration 179   
37.2 Bootloader selection 183   
37.3 Bootloader version 184

# STM32F42xxx/43xxx devices . .. 185

38.1 Bootloader V7.x 185

38.1.1 Bootloader configuration 185   
38.1.2 Bootloader selection 188   
38.1.3 Bootloader version .190

# 38.2 Bootloader V9.x 191

38.2.1 Bootloader configuration 191   
38.2.2 Bootloader selection 195   
38.2.3 Bootloader version 197

# STM32F446xx devices . 198

39.1 Bootloader configuration 198   
39.2 Bootloader selection 202   
39.3 Bootloader version 203

# STM32F469xx/479xx devices . . . . 204

40.1 Bootloader configuration 204   
40.2 Bootloader selection 208   
40.3 Bootloader version 210

# STM32F72xxx/73xxx devices . . . 211

41.1 Bootloader configuration .211   
41.2 Bootloader selection 215   
41.3 Bootloader version 216

# STM32F74xxx/75xxx devices . .. 217

42.1 Bootloader V7.x 217

42.1.1 Bootloader configuration 217   
42.1.2 Bootloader selection 220   
42.1.3 Bootloader version 220

# 42.2 Bootloader V9.x 221

42.2.1 Bootloader configuration 221   
42.2.2 Bootloader selection 225   
42.2.3 Bootloader version 226

# STM32F76xxx/77xxx devices . . . 227

43.1 Bootloader configuration 227   
43.2 Bootloader selection 231   
43.3 Bootloader version 233

# STM32G03xxx/STM32G04xxx devices . .. . . 234

44.1 Bootloader configuration 234   
44.2 Bootloader selection 235   
44.3 Bootloader version 236

# 5 STM32G07xxx/08xxx device bootloader . 237

45.1 Bootloader configuration 237   
45.2 Bootloader selection 240   
45.3 Bootloader version 240   
45.3.1 Compatibility break on boot sequence . .242

# STM32G0B0xx device bootloader .. 243

46.1 Bootloader configuration 243   
46.2 Bootloader selection 246   
46.3 Bootloader version 247

# STM32G0B1xx/0C1xx device bootloader 248

47.1 Bootloader configuration 248   
47.2 Bootloader selection 251   
47.3 Bootloader version 252

48

# STM32G05xxx/061xx devices . . . .. 253

48.1 Bootloader configuration 253   
48.2 Bootloader selection 255   
48.3 Bootloader version 255

# STM32G431xx/441xx devices . . . . 257

49.1 Bootloader configuration 257   
49.2 Bootloader selection 260   
49.3 Bootloader version 261

# STM32G47xxx/48xxx devices . . 262

50.1 Bootloader configuration 262   
50.2 Bootloader selection 265   
50.3 Bootloader version 266

# STM32G491xx/4A1xx devices 268

51.1 Bootloader configuration 268   
51.2 Bootloader selection 271   
51.3 Bootloader version 272

# STM32H503xx devices .. 273

52.1 Bootloader configuration 273   
52.2 Bootloader selection 277   
52.3 Bootloader version 278

# STM32H523xx/533xx devices . . . . 279

53.1 Bootloader configuration 279   
53.2 Bootloader selection 284   
53.3 Bootloader version 285

54

# STM32H562xx/563xx/573xx devices . .. . . 286

54.1 Bootloader configuration 286   
54.2 Bootloader selection 290   
54.3 Bootloader version 291

55

# STM32H72xxx/73xxx devices . . . 292

55.1 Bootloader configuration 292   
55.2 Bootloader selection 296   
55.3 Bootloader version 297

56

# STM32H74xxx/75xxx devices . . . . 298

56.1 Bootloader configuration 298   
56.2 Bootloader selection 302   
56.3 Bootloader version 303

# STM32H7A3xx/7B3xx/7B0xx devices . . . .. 306

57.1 Bootloader configuration 306   
57.2 Bootloader selection .311   
57.3 Bootloader version 312

# STM32H7Rxxx/7Sxxx devices .. 313

58.1 Bootloader configuration 313   
58.2 Bootloader selection 318   
58.3 Bootloader version 319   
58.4 Jump to bootloader . 319

# STM32L01xxx/02xxx devices . .. .. 320

59.1 Bootloader configuration 320   
59.2 Bootloader selection 322   
59.3 Bootloader version 323

# STM32L031xx/041xx devices . . . . 324

60.1 Bootloader configuration 324   
60.2 Bootloader selection 326   
60.3 Bootloader version 326

61

# STM32L05xxx/06xxx devices . . . .. 327

61.1 Bootloader configuration 327   
61.2 Bootloader selection 329   
61.3 Bootloader version 329

# STM32L07xxx/08xxx devices . . .. 330

62.1 Bootloader V4.x 330

62.1.1 Bootloader configuration 330   
62.1.2 Bootloader selection 332   
62.1.3 Bootloader version . 333

# 62.2 Bootloader V11.x 335

62.2.1 Bootloader configuration 335   
62.2.2 Bootloader selection 337   
62.2.3 Bootloader version .338

63

# STM32L1xxx6(8/B)A devices .. 339

63.1 Bootloader configuration 339   
63.2 Bootloader selection 340   
63.3 Bootloader version 340

# STM32L1xxx6(8/B) devices 341

64.1 Bootloader configuration 341   
64.2 Bootloader selection 342   
64.3 Bootloader version 342

# 65 STM32L1xxxC devices . 343

65.1 Bootloader configuration 343   
65.2 Bootloader selection 345   
65.3 Bootloader version 346

# STM32L1xxxD devices .. 347

66.1 Bootloader configuration 347   
66.2 Bootloader selection 349   
66.3 Bootloader version 350

# STM32L1xxxE devices ... 351

67.1 Bootloader configuration 351  
67.2 Bootloader selection 353  
67.3 Bootloader version 354

68

# STM32L412xx/422xx devices . .. .. 355

68.1 Bootloader configuration 355   
68.2 Bootloader selection 358   
68.3 Bootloader version 360

69

# STM32L43xxx/44xxx devices . . . .. 361

69.1 Bootloader configuration 361   
69.2 Bootloader selection 365   
69.3 Bootloader version 367

70

# STM32L45xxx/46xxx devices . . . . 369

70.1 Bootloader configuration 369   
70.2 Bootloader selection 373   
70.3 Bootloader version 375

# STM32L47xxx/48xxx devices . . . 376

# 71.1 Bootloader V10.x 376

71.1.1 Bootloader configuration .376   
71.1.2 Bootloader selection .379   
71.1.3 Bootloader version ..381

# 71.2 Bootloader V9.x 382

71.2.1 Bootloader configuration .382   
71.2.2 Bootloader selection .385   
71.2.3 Bootloader version ..387

# 2 STM32L496xx/4A6xx devices . . 388

72.1 Bootloader configuration 388   
72.2 Bootloader selection 392   
72.3 Bootloader version 394

# STM32L4P5xx/4Q5xx devices . . . 395

73.1 Bootloader configuration 395   
73.2 Bootloader selection 399   
73.3 Bootloader version 401

# STM32L4Rxxx/4Sxxx devices .. 402

74.1 Bootloader configuration 402   
74.2 Bootloader selection 406   
74.3 Bootloader version 408

# STM32L552xx/62xx devices . . . 409

75.1 Bootloader configuration 409   
75.2 Bootloader selection 413   
75.3 Bootloader version 414

# STM32WB10xx/15xx devices . . . . 415

76.1 Bootloader configuration 415   
76.2 Bootloader selection 417   
76.3 Bootloader version 418

# STM32WB30xx/35xx/50xx/55xx devices .. . 419

77.1 Bootloader configuration 419   
77.2 Bootloader selection 422   
77.3 Bootloader version 423

# STM32WBA5xxx devices .. . 424

78.1 Bootloader configuration 424

78.2 Bootloader selection . 426   
78.3 Bootloader version 427

# STM32WBA62xx/63xx/64xx/65xx devices . . . . . . 428

79.1 Bootloader configuration 428   
79.2 Bootloader selection 431   
79.3 Bootloader version 431

80

# STM32WB05xx devices . . . . 432

80.1 Bootloader configuration 432   
80.2 Bootloader selection 433   
80.3 Bootloader version 433

81

# STM32WB06xx/07xx devices . . . . . 434

81.1 Bootloader configuration 434   
81.2 Bootloader selection 435   
81.3 Bootloader version 435

82

# STM32WB09xx devices . . 436

82.1 Bootloader configuration 436   
82.2 Bootloader selection 437   
82.3 Bootloader version 437

83

# STM32WL3xxx devices . . 438

83.1 Bootloader configuration 438   
83.2 Bootloader selection 439   
83.3 Bootloader version 439

84

# STM32WLE5xx/55xx devices . . . . . 440

84.1 Bootloader configuration 440   
84.2 Bootloader selection 442   
84.3 Bootloader version 442

# STM32U031xx devices .. 443

85.1 Bootloader configuration 443

85.2 Bootloader selection . 446   
85.3 Bootloader version 447

86

# STM32U073xx/83xx devices . .. . . 448

86.1 Bootloader configuration 448   
86.2 Bootloader selection 451   
86.3 Bootloader version 452

# STM32U375xx/85xx devices . . . . . 453

87.1 Bootloader configuration 453   
87.2 SPI1 pinout on WLCSP68-G 456   
87.3 Boot model 456   
87.4 Bootloader selection 458   
87.5 Bootloader version 459

# STM32U535xx/545xx devices . ... .. 460

88.1 Bootloader configuration 460   
88.2 Bootloader selection 464   
88.3 Bootloader version 465

89

# STM32U575xx/85xx devices . . . 466

89.1 Bootloader configuration 466   
89.2 Bootloader selection 470   
89.3 Bootloader version 471

90

# STM32U595xx/99xx/A5xx/A9xx devices . ... . . 472

90.1 Bootloader configuration 472   
90.2 Bootloader selection 476   
90.3 Bootloader version 476

# STM32U5F7xx/F9xx/G7xx/G9xx devices . . . . . . 477

91.1 Bootloader configuration 477   
91.2 Bootloader selection 481   
91.3 Bootloader version 481

# Device-dependent bootloader parameters . . 482

Bootloader timings .. 489

93.1 Bootloader startup timing 489   
93.2 USART connection timing 492   
93.3 USB connection timing 495   
93.4 I2C connection timing 498   
93.5 SPI connection timing 501

# Appendix A Example of ExitSecureMemory v1.0 function . . . 502

Appendix B Example of ExitSecureMemory v1.1 function . . . 504

94 Revision history 507

# List of tables

Table 1. Applicable products .2   
Table 2. Bootloader activation patterns 32   
Table 3. Embedded bootloaders. 36   
Table 4. STM32 F2, F4, and F7 voltage range configuration using bootloader 47   
Table 5. Supported memory area by Write, Read, Erase, and Go commands. 47   
Table 6. Jitter software calculation on bootloader USART detection 48   
Table 7. Flash memory alignment constraints 49   
Table 8. ExitSecureMemory entry address. 53   
Table 9. BL and boot by product series 55   
Table 10. STM32C011xx configuration in system memory boot mode 57   
Table 11. STM32C011xx bootloader versions 58   
Table 12. STM32C031xx configuration in system memory boot mode 59   
Table 13. STM32C031xx bootloader versions . . 60   
Table 14. STM32C051xx configuration in system memory boot mode 61   
Table 15. STM32C051xx bootloader versions 65   
Table 16. STM32C071xx configuration in system memory boot mode 66   
Table 17. STM32C071xx bootloader versions. 69   
Table 18. STM32C091xx/92xx configuration in system memory boot mode 70   
Table 19. STM32C091xx/92xx bootloader versions . 74   
Table 20. STM32F03xx4/6 configuration in system memory boot mode 75   
Table 21. STM32F03xx4/6 bootloader versions. . 76   
Table 22. STM32F030xC configuration in system memory boot mode 77   
Table 23. STM32F030xC bootloader versions . 78   
Table 24. STM32F05xxx and STM32F030x8 devices configuration in system memory boot mode . 79   
Table 25. STM32F05xxx and STM32F030x8 devices bootloader versions 80   
Table 26. STM32F04xxx configuration in system memory boot mode. 81   
Table 27. STM32F04xxx bootloader versions . . 84   
Table 28. STM32F070x6 configuration in system memory boot mode. 85   
Table 29. STM32F070x6 bootloader versions 88   
Table 30. STM32F070xB configuration in system memory boot mode 89   
Table 31. STM32F070xB bootloader versions . . 92   
Table 32. STM32F071xx/072xx configuration in system memory boot mode 93   
Table 33. STM32F071xx/072xx bootloader versions 96   
Table 34. STM32F09xxx configuration in system memory boot mode. 97   
Table 35. STM32F09xxx bootloader versions 98   
Table 36. STM32F10xxx configuration in system memory boot mode . .99   
Table 37. STM32F10xxx bootloader versions 100   
Table 38. STM32F105xx/107xx configuration in system memory boot mode 102   
Table 39. STM32F105xx/107xx bootloader versions . . 105   
Table 40. STM32F10xxx XL-density configuration in system memory boot mode. 108   
Table 41. STM32F10xxx XL-density bootloader versions 109   
Table 42. STM32F2xxxx configuration in system memory boot mode . 110   
Table 43. STM32F2xxxx bootloader V2.x versions 112   
Table 44. STM32F2xxxx configuration in system memory boot mode . 113   
Table 45. STM32F2xxxx bootloader V3.x versions . . . 116   
Table 46. STM32F301xx/302x4(6/8) configuration in system memory boot mode. 117   
Table 47. STM32F301xx/302x4(6/8) bootloader versions 120   
Table 48. STM32F302xB(C)/303xB(C) configuration in system memory boot mode. 121   
Table 49. STM32F302xB(C)/303xB(C) bootloader versions 123   
Table 50. STM32F302xD(E)/303xD(E) configuration in system memory boot mode. 124   
Table 51. STM32F302xD(E)/303xD(E) bootloader versions 127   
Table 52. STM32F303x4(6/8)/334xx/328xx configuration in system memory boot mode 128   
Table 53. STM32F303x4(6/8)/334xx/328xx bootloader versions 129   
Table 54. STM32F318xx configuration in system memory boot mode. 130   
Table 55. STM32F318xx bootloader versions 132   
Table 56. STM32F358xx configuration in system memory boot mode. 133   
Table 57. STM32F358xx bootloader versions 134   
Table 58. STM32F373xx configuration in system memory boot mode. 135   
Table 59. STM32F373xx bootloader versions . . . . 138   
Table 60. STM32F378xx configuration in system memory boot mode. 139   
Table 61. STM32F378xx bootloader versions 140   
Table 62. STM32F398xx configuration in system memory boot mode. 141   
Table 63. STM32F398xx bootloader versions 143   
Table 64. STM32F40xxx/41xxx configuration in system memory boot mode. 144   
Table 65. STM32F40xxx/41xxx bootloader V3.x versions . 147   
Table 66. STM32F40xxx/41xxx configuration in system memory boot mode. 148   
Table 67. STM32F40xxx/41xxx bootloader V9.x versions . 152   
Table 68. STM32F401xB(C) configuration in system memory boot mode 153   
Table 69. STM32F401xB(C) bootloader versions ... 157   
Table 70. STM32F401xD(E) configuration in system memory boot mode . 158   
Table 71. STM32F401xD(E) bootloader versions. 162   
Table 72. STM32F410xx configuration in system memory boot mode. 163   
Table 73. STM32F410xx bootloader V11.x versions 167   
Table 74. STM32F411xx configuration in system memory boot mode. 168   
Table 75. STM32F411xx bootloader versions 172   
Table 76. STM32F412xx configuration in system memory boot mode. 173   
Table 77. STM32F412xx bootloader V9.x versions . 178   
Table 78. STM32F413xx/423xx configuration in system memory boot mode 179   
Table 79. STM32F413xx/423xx bootloader V9.x versions . . 184   
Table 80. STM32F42xxx/43xxx configuration in system memory boot mode. 185   
Table 81. STM32F42xxx/43xxx bootloader V7.x versions . . . . . . . 190   
Table 82. STM32F42xxx/43xxx configuration in system memory boot mode. 191   
Table 83. STM32F42xxx/43xxx bootloader V9.x versions . 197   
Table 84. STM32F446xx configuration in system memory boot mode. 198   
Table 85. STM32F446xx bootloader V9.x versions 203   
Table 86. STM32F469xx/479xx configuration in system memory boot mode 204   
Table 87. STM32F469xx/479xx bootloader V9.x versions . 210   
Table 88. STM32F72xxx/73xxx configuration in system memory boot mode. 211   
Table 89. STM32F72xxx/73xxx bootloader V9.x versions . 216   
Table 90. STM32F74xxx/75xxx configuration in system memory boot mode. 217   
Table 91. STM32F74xxx/75xxx bootloader V7.x versions . . 220   
Table 92. STM32F74xxx/75xxx configuration in system memory boot mode. . 221   
Table 93. STM32F74xxx/75xxx bootloader V9.x versions . . 226   
Table 94. STM32F76xxx/77xxx configuration in system memory boot mode. 227   
Table 95. STM32F76xxx/77xxx bootloader V9.x versions . 233   
Table 96. STM32G03xxx/G04xxx configuration in system memory boot mode . 234   
Table 97. STM32G03xxx/04xxx bootloader versions 236   
Table 98. STM32G07xxx/8xxx configuration in system memory boot mode 237   
Table 99. STM32G07xxx/08xxx bootloader versions . . 240   
Table 100. STM32G0B0xx configuration in system memory boot mode 243   
Table 101. STM32G0B0xx bootloader versions . 247   
Table 102. STM32G0B1xx/0C1xx configuration in system memory boot mode. 248   
Table 103. STM32G0B1xx/0C1xx bootloader versions 252   
Table 104. STM32G05xxx/061xx configuration in system memory boot mode 253   
Table 105. STM32G05xxx/061xx bootloader versions . . 256   
Table 106. STM32G431xx/441xx configuration in system memory boot mode 257   
Table 107. STM32G431xx/41xx bootloader version. . . . .. 261   
Table 108. STM32G47xxx/48xxx configuration in system memory boot mode 262   
Table 109. STM32G47xxx/48xxx bootloader version . . 266   
Table 110. STM32G491xx/4A1xx configuration in system memory boot mode 268   
Table 111. STM32G491xx/4A1xx bootloader version 272   
Table 112. STM32H503xx configuration in system memory boot mode 273   
Table 113. STM32H503xx special commands 276   
Table 114. STM32H503xx bootloader version . . 278   
Table 115. STM32H523xx/533xx configuration in system memory boot mode 279   
Table 116. STM32H523xx/533xx special commands. 283   
Table 117. STM32H523xx/533xx bootloader version . . . 285   
Table 118. STM32H562xx/563xx/573xx configuration in system memory boot mode 286   
Table 119. STM32H562xx/563xx/573xx special commands 289   
Table 120. STM32H562xx/563xx/573xx bootloader version 291   
Table 121. STM32H72xxx/73x configuration in system memory boot mode 292   
Table 122. STM32H72xxx/73xxx bootloader version . 297   
Table 123. STM32H74xxx/75xxx configuration in system memory boot mode 298   
Table 124. STM32H74xxx/75xxx bootloader version . 303   
Table 125. STM32H7A3xx/7B3xx/7B0xx configuration in system memory boot mode 306   
Table 126. STM32H7A3xx/7B3xx/7B0xx bootloader version . 312   
Table 127. STM32H7Rxxx/7Sxxx configuration in system memory boot mode. 313   
Table 128. STM32H7Rxxx/7Sxxx special commands 317   
Table 129. STM32H7Rxxx/7Sxxx bootloader version 319   
Table 130. STM32L01xxx/02xxx configuration in system memory boot mode. 320   
Table 131. STM32L01xxx/02xx bootloader versions 323   
Table 132. STM32L031xx/041xx configuration in system memory boot mode 324   
Table 133. STM32L031xx/041xx bootloader versions . . . 326   
Table 134. STM32L05xxx/06xxx configuration in system memory boot mode. 327   
Table 135. STM32L05xxx/06xxx bootloader versions 329   
Table 136. STM32L07xxx/08xxx configuration in system memory boot mode. 330   
Table 137. STM32L07xxx/08xxx bootloader versions 334   
Table 138. STM32L07xxx/08xxx configuration in system memory boot mode. 335   
Table 139. STM32L07xxx/08xxx bootloader V11.x versions 338   
Table 140. STM32L1xxx6(8/B)A configuration in system memory boot mode. 339   
Table 141. STM32L1xxx6(8/B)A bootloader versions 340   
Table 142. STM32L1xxx6(8/B) configuration in system memory boot mode . 341   
Table 143. STM32L1xxx6(8/B) bootloader versions. . 342   
Table 144. STM32L1xxxC configuration in system memory boot mode. 343   
Table 145. STM32L1xxxC bootloader versions . . . . . 346   
Table 146. STM32L1xxxD configuration in system memory boot mode. 347   
Table 147. STM32L1xxxD bootloader versions 350   
Table 148. STM32L1xxxE configuration in system memory boot mode. 351   
Table 149. STM32L1xxxE bootloader versions 354   
Table 150. STM32L412xx/422xx configuration in system memory boot mode 355   
Table 151. STM32L412xx/422xx bootloader versions . 360   
Table 152. STM32L43xxx/44xxx configuration in system memory boot mode. 361   
Table 153. STM32L43xxx/44xxx bootloader versions 367   
Table 154. STM32L45xxx/46xxx configuration in system memory boot mode. 369   
Table 155. STM32L45xxx/46xxx bootloader versions 375   
Table 156. STM32L47xxx/48xxx configuration in system memory boot mode. 376   
Table 157. STM32L47xxx/48xxx bootloader V10.x versions 381   
Table 158. STM32L47xxx/48xxx configuration in system memory boot mode. 382   
Table 159. STM32L47xxx/48xxx bootloader V9.x versions . . 387   
Table 160. STM32L496xx/4A6xx configuration in system memory boot mode 388   
Table 161. STM32L496xx/4A6xx bootloader version . . . . . 394   
Table 162. STM32L4P5xx/4Q5xx configuration in system memory boot mode . 395   
Table 163. STM32L4P5xx/4Q5xx bootloader versions 401   
Table 164. STM32L4Rxxx/4Sxxx configuration in system memory boot mode . 402   
Table 165. STM32L4Rxx/4Sxx bootloader versions. 408   
Table 166. STM32L552xx/62xx configuration in system memory boot mode 409   
Table 167. STM32L552xx/62xx special commands 412   
Table 168. STM32L552xx/62xx bootloader versions 414   
Table 169. STM32WB10xx/15xx configuration in system memory boot mode. 415   
Table 170. STM32WB10xx/15xx bootloader versions 418   
Table 171. STM32WB30xx/35xx/50xx/55xx configuration in system memory boot mode 419   
Table 172. STM32WB30xx/35xx/50xx/55xx bootloader versions. 423   
Table 173. STM32WBA5xxx configuration in system memory boot mode. 424   
Table 174. STM32WBA5xxx special commands . . 425   
Table 175. STM32WBA5xxx bootloader versions 427   
Table 176. STM32WBA62xx/63xx/64xx/65xx configuration in system memory boot mode . 428   
Table 177. STM32WBA62xx/63xx/64xx/65xx special commands 430   
Table 178. STM32WBA62xx/63xx/64xx/65xx bootloader versions 431   
Table 179. STM32WB05xx configuration in system memory boot mode. 432   
Table 180. STM32WB05xx bootloader versions. 433   
Table 181. STM32wB06xx/07xx configuration in system memory boot mode. 434   
Table 182. STM32WB06xx/07xx bootloader versions . . 435   
Table 183. STM32wB09xx configuration in system memory boot mode. 436   
Table 184. STM32WB09xx bootloader versions . . . . 437   
Table 185. STM32WL3xxx configuration in system memory boot mode 438   
Table 186. STM32WL3xxx bootloader versions . . 439   
Table 187. STM32WLE5xx/55xx configuration in system memory boot mode. 440   
Table 188. STM32WLE5xx/55xx bootloader versions 442   
Table 189. STM32U031xx configuration in system memory boot mode 443   
Table 190. STM32U031xx bootloader versions . 447   
Table 191. STM32U073xx/83xx configuration in system memory boot mode 448   
Table 192. STM32U073xx/83xx bootloader versions . . 452   
Table 193. STM32U375xx/85xx configuration in system memory boot mode 453   
Table 194. STM32U375xx/385xx special commands. 457   
Table 195. STM32U375xx/85xx bootloader versions . . 459   
Table 196. STM32U535xx/545xx configuration in system memory boot mode 460   
Table 197. STM32U535xx/545xx special commands. . 463   
Table 198. STM32U535xx/545xx bootloader versions . 465   
Table 199. STM32U575xx/85xx configuration in system memory boot mode 466   
Table 200. STM32U575xx/585xx special commands. 469   
Table 201. STM32U575xx/85xx bootloader versions . 471   
Table 202. STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode 472   
Table 203. STM32U595xx/99xx/A5xx/A9xx special commands. 475   
Table 204. STM32U595xx/99xx/A5xx/A9xx bootloader versions. 476   
Table 205. STM32U5F7xx/F9xx/G7xx/G9xx configuration in system memory boot mode. . 477   
Table 206. STM32U5F7xx/F9xx/G7xx/G9xx special commands 480   
Table 207. STM32U5F7xx/F9xx/G7xx/G9xx bootloader versions 481   
Table 208. Bootloader device-dependent parameters 482   
Table 209. Bootloader startup timings (ms) 489   
Table 210. USART bootloader minimum timings (ms) 493   
Table 211. USB bootloader minimum timings (ms) 496   
Table 212. I2C bootloader minimum timings (ms) 499   
Table 213. SPI bootloader minimum timings (ms) for STM32 devices. 501   
Table 214. Document revision history 507

# List of figures

Figure 1. Jre 1. USART connection . 44   
Figure 2. USB connection 44   
Figure 3. I2C connection 45   
Figure 4. SPI connection 45   
Figure 5. CAN connection 46   
Figure 6. ExitSecureMemory function usage 51   
Figure 7. Access to securable memory area from the bootloader 52   
Figure 8. Defining an MPU region . . . 52   
Figure 9. BL_V1 (left) and BL_V2 (right) models. 54   
Figure 10. Boot_V1 (left) and BootV2 (rht) 55   
Figure 11. Boot_V3_1 55   
Figure 12. Boot_V3_2 56   
Figure 13. Bootloader V5.x selection for STM32C011xx devices 58   
Figure 14. Bootloader V5.x selection for STM32C031xx devices 60   
Figure 15. Bootloader V11.0 selection for STM32C051xx devices 64   
Figure 16. Bootloader V13.1 selection for STM32C071xx devices 68   
Figure 17. Bootloader V18.1 selection for STM32C091xx/92xx devices 73   
Figure 18. Bootloader selection for STM32F03xx4/6 devices 76   
Figure 19. Bootloader selection for STM32F030xC. 78   
Figure 20. Bootloader selection for STM32F05xxx and STM32F030x8 devices. 80   
Figure 21. Bootloader selection for STM32F04xxx . 83   
Figure 22. Bootloader selection for STM32F070x6 87   
Figure 23. Bootloader selection for STM32F070xB. 91   
Figure 24. Bootloader selection for STM32F071xx/072xx . 95   
Figure 25. Bootloader selection for STM32F09xxx 98   
Figure 26. Bootloader selection for STM32F10xxx . 100   
Figure 27. Bootloader selection for STM32F105xx/107xx devices 104   
Figure 28. Bootloader selection for STM32F10xxx XL-density devices. 109   
Figure 29. Bootloader V2.x selection for STM32F2xxxx devices. 111   
Figure 30. Bootloader V3.x selection for STM32F2xxxx devices. 115   
Figure 31. Bootloader selection for STM32F301xx/302x4(6/8) 119   
Figure 32. Bootloader selection for STM32F302xB(C)/303xB(C) devices. 123   
Figure 33. Bootloader selection for STM32F302xD(E)/303xD(E) 126   
Figure 34. Bootloader selection for STM32F303x4(6/8)/334xx/328xx. 129   
Figure 35. Bootloader selection for STM32F318xx 131   
Figure 36. Bootloader selection for STM32F358xx devices 134   
Figure 37. Bootloader selection for STM32F373xx devices 137   
Figure 38. Bootloader selection for STM32F378xx devices 140   
Figure 39. Bootloader selection for STM32F398xx . 142   
Figure 40. Bootloader V3.x selection for STM32F40xxx/41xxx devices 146   
Figure 41. Bootloader V9.x selection for STM32F40xxx/41xxx . 151   
Figure 42. Bootloader selection for STM32F401xB(C) 156   
Figure 43. Bootloader selection for STM32F401xD(E) 161   
Figure 44. Bootloader V11.x selection for STM32F410xx . 166   
Figure 45. Bootloader selection for STM32F411xx . 171   
Figure 46. Bootloader V9.x selection for STM32F412xx . 177   
Figure 47. Bootloader V9.x selection for STM32F413xx/423xx. 183   
Figure 48. Dual bank boot implementation for STM32F42xxx/43xxx Bootloader V7.x 188   
Figure 49. Bootloader V7.x selection for STM32F42xxx/43xxx . 189   
Figure 50. Dual bank boot implementation for STM32F42xxx/43xxx bootloader V9.x 195   
Figure 51. Bootloader V9.x selection for STM32F42xxx/43xxx . 196   
Figure 52. Bootloader V9.x selection for STM32F446xx . 202   
Figure 53. Dual bank boot implementation for STM32F469xx/479xx Bootloader V9.x 208   
Figure 54. Bootloader V9.x selection for STM32F469xx/479xx. 209   
Figure 55. Bootloader V9.x selection for STM32F72xxx/73xxx . 215   
Figure 56. Bootloader V7.x selection for STM32F74xxx/75xxx . 220   
Figure 57. Bootloader V9.x selection for STM32F74xxx/75xxx . 225   
Figure 58. Dual bank boot implementation for STM32F76xxx/77xxx Bootloader V9.x 231   
Figure 59. Bootloader V9.x selection for STM32F76xxx/77xxx . . 232   
Figure 60. Bootloader V5.x selection for STM32G03xxx/G04xxx 235   
Figure 61. Bootloader V11.0 selection for STM32G07xxx/G08xxx 240   
Figure 62. Bootloader selection for STM32G0B0xx. 246   
Figure 63. Bootloader selection for STM32G0B1xx/0C1xx 251   
Figure 64. Bootloader selection for STM32G05xxx/061xx. 255   
Figure 65. Bootloader selection for STM32G431xx/441xx 260   
Figure 66. Bootloader selection for STM32G47xxx/48xxx. 265   
Fiigure 67. Dual bank boot implementation for STM32G47xxx/48xxx bootloader V13.x 266   
Figure 68. Bootloader selection for STM32G491xx/4A1xx 271   
Figure 69. Bootloader V14 selection for STM32H503xx . 277   
Figure 70. Bootloader V14 selection for STM32H523xx/533xx . 284   
Figure 71. Bootloader V14 selection for STM32H562xx/563xx/573xx. 290   
Figure 72. Bootloader V9.0 selection for STM32H72xxx/73xxx. 296   
Figure 73. Bootloader V9.x selection for STM32H74xxx/75xxx. 302   
Figure 74. Bootloader V9.x selection for STM32H7A3xx/7B3xx/7B0xx. 311   
Figure 75. Bootloader V14.x selection for STM32H7Rxxx/7Sxxx 318   
Figure 76. Bootloader selection for STM32L01xxx/02xxx 322   
Figure 77. Bootloader selection for STM32L031xx/041xx . 326   
Figure 78. Bootloader selection for STM32L05xxx/06xxx 329   
Figure 79. Dual bank boot implementation for STM32L07xxx/08xxx bootloader V4.x. 332   
Figure 80. Bootloader V4.x selection for STM32L07xxx/08xxx . 333   
Figure 81. Dual bank boot implementation for STM32L07xxx/08xxx bootloader V11.x. . 337   
Figure 82. Bootloader V11.x selection for STM32L07xxx/08xxx . 338   
Figure 83. Bootloader selection for STM32L1xxx6(8/B)A devices. 340   
Figure 84. Bootloader selection for STM32L1xxx6(8/B) devices. 342   
Figre 85. Bootloader selection for STM32L1xxxC devices 345   
Figure 86. Bootloader selection for STM32L1xxxD devices 349   
Figure 87. Bootloader selection for STM32L1xxxE devices 353   
Figure 88. Dual bank boot Implementation for STM32L412xx/422xx bootloader V9.x 358   
Figure 89. Bootloader V13.x selection for STM32L412xx/422xx. 359   
Figure 90. Dual bank boot Implementation for STM32L3x2xx/44xxx bootloader V9.x 365   
Figure 91. Bootloader V9.x selection for STM32L43xxx/44xxx . . 366   
Figure 92. Dual bank boot implementation for STM32L45xxx/46xxx bootloader V9.x. . 373   
Figure 93. Bootloader V9.x selection for STM32L45xxx/46xxx . . 374   
Figure 94. Dual bank boot implementation for STM32L47xxx/48xxx bootloader V10.x. 379   
Figure 95. Bootloader V10.x selection for STM32L47xxx/48xxx . 380   
Figure 96. Dual bank boot implementation for STM32L47xxx/48xxx bootloader V9.x. 385   
Figure 97. Bootloader V9.x selection for STM32L47xxx/48xxx 386   
Figure 98. Dual bank boot Implementation for STM32L496xx/4A6xx bootloader V9.x 392   
Figure 99. Bootloader V9.x selection for STM32L496xx/4A6xx. 393   
Figure 100.Dual bank boot implementation for STM32L4P5xx/4Q5x bootloader V9.x. 399   
Figure 101. Bootloader V9.x selection for STM32L4P5xx/4Q5xx 400   
Figure 102. Dual bank boot implementation for STM32L4Rxxx/STM32L4Sxxx bootloader V9.x . . . 406   
Figure 103. Bootloader V9.x selection for STM32L4Rxx/4Sxx 407   
Figure 104. Bootloader V9.x selection for STM32L552xx/62xx. 413   
Figure 105. Bootloader V11.x selection for STM32WB10xx/15xx . 417   
Figure 106. Bootloader V13.0 selection for STM32WB30xx/35xx/50xx/55xx 422   
Figure 107. Bootloader V11.x selection for STM32WBA5xxx 426   
Figure 108. Bootloader V13.2 selection for STM32WBA62xx/63xx/64xx/65xx 431   
Figure 109. Bootloader V2.x selection for STM32WB05xx 433   
Figure 110. Bootloader V4.x selection for STM32WB06xx/07xx. 435   
Figure 111. Bootloader V1.x selection for STM32WB09xx . 437   
Figure 112. Bootloader V12.x selection for STM32WL3xxx 439   
Figure 113. Bootloader V12.x selection for STM32WLE5xx/55xx 442   
Figure 114. Bootloader V11.x selection for STM32U031xx . 446   
Figure 115. Bootloader V13.x selection for STM32U073xx/83xx 451   
Figure 116. Bootloader V14.2 selection for STM32U375xx/85xx 458   
Figure 117. Bootloader V9.x selection for STM32U535xx/545xx 464   
Figure 118. Bootloader V9.x selection for STM32U575xx/85xx 470   
Figure 119. Bootloader V9.x selection for STM32U595xx/99xx/A5xx/A9xx. 476   
Figure 120. Bootloader V9.x selection for STM32U5F7xx/F9xx/G7xx/G9xx . 481   
Figure 121. Bootloader startup timing description . 489   
Figure 122. USART connection timing description 492   
Figure 123. USB connection timing description . 496   
Figure 124. I2C connection timing description. 498   
Figure 125. SPI connection timing description. 501

# 1 General information

Thisdocument applies t Arm®(a)-based devies.

# Related documents

For each supported product refer to the following documents, available on www.st.com:

• Datasheet or databrief • Reference manual • Application notes

AN3154: CAN protocol used in the STM32 bootloader AN3155: USART protocol used in the STM32 bootloader AN3156: USB DFU protocol used in the STM32 bootloader AN4221: I2C protocol used in the STM32 bootloader AN4286: SPI protocol used in the STM32 bootloader AN5405: FDCAN protocol used in the STM32 bootloader AN5927: I3C protocol used in the STM32 bootloader

# arm

# 3 Glossary

# CO series:

STM32C011xx indicates STM32C011xx devices STM32C031xx indicates STM32C031xx devices STM32C051xx indicates STM32C051xx devices STM32C071xx indicates STM32C071xx devices

STM32C091xx/92xx indicates STM32C091xx and STM32C092xx devices F0 series:

STM32F03xxx indicates STM32F030x4, STM32F030x6, STM32F038x6, STM32F030xC, STM32F031x4, and STM32F031x6 devices

STM32F04xxx indicates STM32F042x4 and STM32F042x6 devices

STM32F05xxx and STM32F030x8 devices indicates STM32F051x4, STM32F051x6,   
STM32F051x8, STM32F058x8, and STM32F030x8 devices   
STM32F07xxx indicates STM32F070x6, STM32F070xB, STM32F071xB,   
STM32F072x8, and STM32F072xB devices

STM32F09xxx indicates STM32F091xx and STM32F098xx devices

# F1 series:

STM32F10xxx indicates Low-density, Medium-density, High-density, Low-density value line, Medium-density value line, and High-density value line devices:

Low-density devices are STM32F101xx, STM32F102xx, and STM32F103xx microcontrollers, where the flash memory density ranges between 16 and 32 Kbytes.

Medium-density devices are STM32F101xx, STM32F102xx, and STM32F103xx microcontrollers, where the flash memory density ranges between 64 and 128 Kbytes.

High-density devices are STM32F101xx and STM32F103xx microcontrollers, where the flash memory density ranges between 256 and 512 Kbytes.

Low-density value line devices are STM32F100xx microcontrollers, where the flash memory density ranges between 16 and 32 Kbytes.

Medium-density value line devices are STM32F100xx microcontrollers, where the flash memory density ranges between 64 and 128 Kbytes.

High-density value line devices are STM32F100xx microcontrollers, where the flash memory density ranges between 256 and 512 Kbytes.

STM32F105xx/107xx indicates STM32F105xx and STM32F107xx devices

STM32F10xxx XL-density indicates STM32F101xx and STM32F103xx devices, where the flash memory density ranges between 768 Kbytes and 1 Mbyte.

# F2 series:

STM32F2xxxx indicates STM32F215xx, STM32F205xx, STM32F207xx, and SMT32F217xx devices

# F3 series:

STM32F301xx/302x4(6/8) indicates STM32F301x4, STM32F301x6, STM32F301x8, STM32F302x4, STM32F302x6, and STM32F302x8 devices

STM32F302xB(C)/303xB(C) indicates STM32F302xB, STM32F302xC, STM32F303xB and STM32F303xC devices

STM32F302xD(E)/303xD(E) indicates STM32F302xD, STM32F302xE, STM32F303xD, and STM32F303xE devices

STM32F303x4(6/8)/334xx/328xx indicates STM32F303x4, STM32F303x6, STM32F303x8, STM32F334x4, STM32F334x6, STM32F334x8, and STM32F328x8 devices

STM32F318xx indicates STM32F318x8 devices

STM32F358xx indicates STM32F358xC devices

STM32F373xx indicates STM32F373x8, STM32F373xB and STM32F373xC devices

STM32F378xx indicates STM32F378xC devices

STM32F398xx indicates STM32F398xE devices

# F4 series:

STM32F40xxx/41xxx indicates STM32F405xx, STM32F407xx, STM32F415xx, and SMT32F417xx devices

STM32F401xB(C) indicates STM32F401xB and STM32F401xC devices

STM32F401xD(E) indicates STM32F401xD and STM32F401xE devices

STM32F410xx indicates STM32F410x8 and STM32F410xB devices

STM32F411xx indicates STM32F411xD and STM32F411xE devices

STM32F412xx indicates STM32F412Cx, STM32F412Rx, STM32F412Vx and STM32F412Zx devices

STM32F413xx/423xx indicates STM32F413xG, STM32F413xH and STM32F423xH devices

STM32F42xxx/43xxx indicates STM32F427xx, STM32F429xx, STM32F437xx, and STM32F439xx devices

STM32F446xx indicates STM32F446xE and STM32F446xC devices

STM32F469xx/479xx indicates STM32F469xE, STM32F469xG, STM32F469xl, STM32F479xG, and STM32F479xl devices

# F7 series:

STM32F72xxx/73xxx indicates STM32F722xx, STM32F723xx, STM32F732xx, and STM32F733xx devices

STM32F74xxx/75xxx indicates STM32F745xx, STM32F746xx, and STM32F756xx devices

STM32F76xxx/77xxx indicates STM32F765xx, STM32F767xx, STM32F769xx, STM32F777xx, and STM32F779xx devices

# GO series:

STM32G03xxx/04xxx indicates STM32G03xxx, and STM32G04xxx devices   
STM32G07xxx/08xxx indicates STM32G07xxx, and STM32G08xxx devices   
STM32G0B0xx indicates STM32G0BOxx devices   
STM32G0B1xx/C1xx indicates STM32G0B1xx, and STM32G0C1xxx devices   
STM32G05xxx/061xx indicates STM32G050xx, STM32G051xx, and STM32G061xx   
devices

# G4 series:

STM32G431xx/441xx indicates STM32G431xx and STM32G441xx devices STM32G47xxx/48xxx indicates STM32G471xx, STM32G473xx, STM32G474xx, STM32G483xx, and STM32G484xx devices

STM32G491xx/A1xx indicates STM32G491xx and STM32G4A1xx devices

# H5 series:

STM32H503xx indicates STM32H503xx devices

STM32H562/63xx/73xx indicates STM32H562xx, STM32H563xx, and STM32H573xx devices

STM32H523xx/33xx indicates STM32H523xx and STM32H533xx devices

# H7 series:

STM32H72xxx/73xxx indicates STM32H72xxx and STM32H73xxx devices

STM32H74xxx/75xxx indicates STM32H74xxx and STM32H75xxx devices

STM32H7A3xx/7B3xx/7B0xx indicates STM32H7A3xx, STM32H7B3xx, andSTM32H7B0xx devices

STM32H7Rxxx/7Sxxx indicates STM32H7R3xx, STM32H7R7xx, STM32H7S3xx and STM32H7S7xx devices

# L0 series:

STM32L01xxx/02xxx indicates STM32L011xx and STM32L021xx devices

STM32L031xx/041xx indicates STM32L031xx and STM32L041xx devices

STM32L05xxx/06xxx indicates STM32L051xx, STM32L052xx, STM32L053xx, STM32L062xx, and STM32L063xx ultra-low power devices

STM32L07xxx/08xxx indicates STM32L071xx, STM32L072xx, STM32L073xx, STM32L081xx, STM32L082xx, and STM32L083xx devices

# L1 series:

STM32L1xxx6(8/B) indicates STM32L1xxV6T6, STM32L1xxV6H6, STM32L1xxR6T6, STM32L1xxR6H6, STM32L1xxC6T6, STM32L1xxC6H6, STM32L1xxV8T6, STM32L1xxV8H6, STM32L1xxR8T6, STM32L1xxR8H6, STM32L1xxC8T6, STM32L1xxC8H6, STM32L1xxVBT6, STM32L1xxVBH6, STM32L1xxRBT6, STM32L1xxRBH6, STM32L1xxCBT6, and STM32L1xxCBH6 ultra-low power devices

STM32L1xxx6(8/B)A indicates STM32L1xxV6T6-A, STM32L1xxV6H6-A, STM32L1xxR6T6-A, STM32L1xxR6H6-A, STM32L1xxC6T6-A, STM32L1xxC6H6-A, STM32L1xxV8T6-A, STM32L1xxV8H6-A, STM32L1xxR8T6-A, STM32L1xxR8H6-A, STM32L1xxC8T6-A, STM32L1xxC8H6-A, STM32L1xxVBT6-A, STM32L1xxVBH6-A, STM32L1xxRBT6-A, STM32L1xxRBH6-A, STM32L1xxCBT6-A, and STM32L1xxCBH6-A ultra-low power devices

STM32L1xxxC indicates STM32L1xxVCT6, STM32L1xxVCH6, STM32L1xxRCT6, STM32L1xxUCY6, STM32L1xxCCT6, and STM32L1xxCCU6 ultra-low power devices

STM32L1xxxD indicates STM32L1xxZDT6, STM32L1xxQDH6, STM32L1xxVDT6, STM32L1xxRDY6, STM32L1xxRDT6, STM32L1xxZCT6, STM32L1xxQCH6, STM32L1xxRCY6, STM32L1xxVCT6-A, and STM32L1xxRCT6-A ultra-low power devices

STM32L1xxxE indicates STM32L1xxZET6, STM32L1xxQEH6, STM32L1xxVET6, STM32L1xxVEY6, and STM32L1xxRET6 ultra-low power devices

# L4 series:

STM32L412xx/422xx indicates STM32L412xB, STM32L412x8, and STM32L422xB devices

STM32L43xxx/44xxx indicates STM32L431xx, STM32L432xx, STM32L433xx and STM32L442xx, and STM32L443xx devices

STM32L45xxx/46xxx indicates STM32L451xx, STM32L452xx, and STM32L462xx devices

STM32L47xxx/48xxx indicates STM32L471xx, STM32L475xx, STM32L476xx, and STM32L486xx devices

STM32L496xx/4A6xx indicates STM32L496xE, STM32L496xG, and STM32L4A6xG devices

STM32L4Rxxx/4Sxxx indicates STM32L4R5xx, STM32L4R7xx, STM32L4R9xx, STM32L4S5xx, STM32L4S7xx, and STM32L4S9xx devices

STM32L4P5xx/4Q5xx indicates STM32L4P5xx/STM32L4Q5xx devices

# L5 series:

STM32L552xx/62xx indicates STM32L552xx and STM32L562xx devices U0 series:

STM32U031xx indicates STM32U031xx devices

STM32U073xx/83xx indicates STM32U073xx and STM32U083xx devices U3 series:

STM32U375xx/85xx indicates STM32U375xx and STM32U385xx devices U5 series:

STM32U535xx/45xx indicates STM32U535xx and STM32U545xx devices

STM32U575xx/85xx indicates STM32U575xx and STM32U585xxdevices

STM32U595xx/99xx/A5xx/A9xx indicates STM32U595xx, STM32U599xx, STM32U5A5xx, and STM32U5A9xx devices

STM32U5F7xx/F9xx/G7xx/G9xx indicates STM32U5F7xx, STM32U5F9xx, STM32U5G7xx, and STM32U5G9xx devices

WB series: STM32WB10xx/15xx indicates STM32WB10xx and STM32WB15xx devices STM32WB30xx/35xx/50xx/55xx indicates STM32WB30xx, STM32WB35xx, STM32WB50xx, and STM32WB55xx devices

WBA series: STM32WBA5xxx indicates STM32WBA50xx, STM32WBA52xx, STM32WBA54xx, and STM32WBA55xx devices

STM32WBA62xx/63xx/64xx/65xx indicates STM32WBA54xx, STM32WBA55xx, STM32WBA64xx, and STM32WBA65xx devices

WBO series: STM32WB0xx indicates STM32WB05xx, STM32WB06xx, STM32WB07xx, and STM32WB09xx devices

WL series: STM32WL3xxx indicates STM32WL30xx, STM32WL31xx, and STM32WL33xx devices STM32WLE5xx/55xx indicates STM32WLE5xx and STM32WL55xx devices

# Note:

BL_USART_Loop refers to the USART bootloader execution loop.   
BL_CAN_Loop refers to the CAN bootloader execution loop.   
BL_FDCAN_Loop refers to the FDCAN execution loop.   
BL_I2C_Loop refers to the I2C bootloader execution loop.   
BL_I3C_Loop refers to the I3C bootloader execution loop.   
BL_SPI_Loop refers to the SPI bootloader execution loop.

# General bootloader description

# 4.1

# Bootloader activation

The bootloader is activated by applying one of the patterns described in Table 2.

If boot from Bank2 option is activated (for products supporting this feature), the bootloader executes Dual Boot mechanism as described in figures "Dual bank boot implementation for STM32xxxx" (example: Figure 48), otherwise bootloader selection protocol is executed as described in figures "Bootloader VY.x selection for STM32xxxx" (example: Figure 29), where STM32xxxx is the relative STM32 product.

When readout protection Level2 is activated, the MCU does not boot on system memory, and bootloader cannot be executed (unless jumping to it from flash user code, all commands are not accessible except Get, GetID, and GetVersion).

Table 2. Bootloader activation patterns   

<table><tr><td colspan="1" rowspan="1">Pattern</td><td colspan="1" rowspan="1">Condition</td></tr><tr><td colspan="1" rowspan="1">Pattern 1</td><td colspan="1" rowspan="1">Boot0(pin) = 1 and Boot1(pin) = 0</td></tr><tr><td colspan="1" rowspan="1">Pattern 2</td><td colspan="1" rowspan="1">Boot0(pin) = 1 and nBoot1(bit) = 1</td></tr><tr><td colspan="1" rowspan="3">Pattern 3</td><td colspan="1" rowspan="1">Boot0(pin) = 1, Boot1(pin) = 0 and BFB2(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, BFB2(bit) = 0 and both banks do not contain valid code</td></tr><tr><td colspan="1" rowspan="1">BootO(pin) = 1, Boot1(pin) = 0, BFB2(bit) = 0 and both banks do not contain valid code</td></tr><tr><td colspan="1" rowspan="3">Pattern 4</td><td colspan="1" rowspan="1">Boot0(pin) = 1, Boot1(pin) = 0 and BFB2(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, BFB2(bit) = 0 and both banks do not contain valid code</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 1, Boot1(pin) = 0 and BFB2(bit) = 0</td></tr><tr><td colspan="1" rowspan="3">Pattern 5</td><td colspan="1" rowspan="1">Boot0(pin) = 1, Boot1(pin) = 0 and BFB2(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, BFB2(bit) = 1 and both banks do not contain valid code</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 1, Boot1(pin) = 0 and BFB2 (bit) = 1</td></tr><tr><td colspan="1" rowspan="4">Pattern 6</td><td colspan="1" rowspan="1">Boot0(pin) = 1, nBoot1(bit) = 1 and nBoot0_SW(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">nBoot0(bit) = 0, nBoot1(bit) = 1 and nBoot0_SW(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, nBoot0_SW(bit) = 1 and main flash memory empty</td></tr><tr><td colspan="1" rowspan="1">nBoot0(bit) = 1, nBoot0_SW(bit)=0 and main flash memory empty</td></tr><tr><td colspan="1" rowspan="3">Pattern 7</td><td colspan="1" rowspan="1">Boot0(pin) = 1, nBoot1(bit) = 1 and BFB2(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, BFB2(bit) = 1 and both banks do not contain valid code</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 1, nBoot1(bit) = 1 and BFB2(bit) = 1</td></tr><tr><td colspan="1" rowspan="2">Pattern 8</td><td colspan="1" rowspan="1">Boot(pin) = 0 and BOOT_ADD0(optionbyte) = 0x0040</td></tr><tr><td colspan="1" rowspan="1">Boot(pin) = 1 and BOOT_ADD1(optionbyte) = 0x0040</td></tr><tr><td colspan="1" rowspan="6">Pattern 9</td><td colspan="1" rowspan="1">nDBANK(bit) = 1, Boot(pin) = 0 and BOOT_ADD0(optionbyte) = 0x0040</td></tr><tr><td colspan="1" rowspan="1">nDBANK(bit) = 1, Boot(pin) = 1 and BOOT_ADD1(optionbyte) = 0x0040</td></tr><tr><td colspan="1" rowspan="1">nDBANK(bit) = 0, nDBOOT(bit) = 1, Boot(pin) = 0 and BOOT_ADD0(optionbyte) = 0x0040</td></tr><tr><td colspan="1" rowspan="1">nDBANK(bit) = 0, nDBOOT(bit) = 1, Boot(pin) = 1 and BOOT_ADD1(optionbyte) = Ox0040</td></tr><tr><td colspan="1" rowspan="1">nDBANK(bit) = 0, nDBOOT(bit) = 0, BOOT_ADDx(optionbyte) out of memory range or in ICP memoryrange</td></tr><tr><td colspan="1" rowspan="1">nDBANK(bit) = 0, nDBOOT(bit) = 0, BOOT_ADDx(optionbyte) in flash memory range and both banksdo not contain valid code</td></tr><tr><td colspan="1" rowspan="2">Pattern 10</td><td colspan="1" rowspan="1">Boot(pin) = 0 and BOOT_ADD0(optionbyte) = 0x1FF0</td></tr><tr><td colspan="1" rowspan="1">Boot(pin) = 1 and BOOT_ADD1(optionbyte) = 0x1FF0</td></tr><tr><td colspan="1" rowspan="4">Pattern 11</td><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBoot1(bit) = 1, nBOOT0_SEL(bit) = 1 and nBootO(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBoot1(bit) = 1, Boot0(pin) = 1 and nBOOT0_SEL(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBOOT0_SEL(bit) = 1, nBootO(bit) = 1 and main flash empty</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, BootO(pin) = 0, nBOOT0_SEL(bit) = 0 and main flash empty</td></tr><tr><td colspan="1" rowspan="9">Pattern 12</td><td colspan="1" rowspan="1">TZEN = 1 = 0, BootO(pin) = 0, nSWBoot0(bit) = 1 and NSBOOTADD0 [24:0] = Address(1)</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1 = 0, BootO(pin) = 1, nSWBoot0(bit) = 1 and NSBOOTADD1 [24:0] = Address(1)</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1 = 0, nBoot0(bit) = 0, nSWBootO(bit) = 0 and NSBOOTADD1 [24:0] = Address(1)</td></tr><tr><td colspan="1" rowspan="1">TZEN = 0, nBoot0(bit) = 1, nSWBoot0(bit) = 0 and NSBOOTADD0 [24:0] = Address(1)</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1, Boot0(pin) = 0, nSWBoot0(bit) = 1 and SECBOOTADD0 [24:0] = Address(1) andRSSCMD = 0</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1, BootO(pin) = 1, nSWBootO(bit) = 1 and RSSCMD = 0, BOOT_LOCK = 0 or(BOOT_LOCK = 1 and SECBOOTADD0 [24:0] = Address()</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1, nBoot0(bit) = 1, nSWBoot0(bit) = 0 and SECBOOTADD0 [24:0] = Address(1) andRSSCMD = 0, BOOT_LOC= 0  (BOOT_LOCK = an SECBOOTADD [24:0] = Ad(</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1, nBootO(bit) = 0, nSWBootO(bit) = 0 and RSSCMD = 0, BOOT_LOCK = 0 orBOOT_LOCK = 1 and SECBOOTADD1 [24:0] = AddreSs(1)</td></tr><tr><td colspan="1" rowspan="1">TZEN = 1, RSSCMD = Ox1C0, BOOT_LOCK=0 or (BOOT_LOCK = 1 andSECBOOTADD0 [24:0] = Address()</td></tr><tr><td colspan="1" rowspan="4">Pattern 13</td><td colspan="1" rowspan="1">nBoot0(bit) = 0, nBoot1(bit) = 1 and nSWBoot0(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">Boot0(bit) = 1, nBoot1(bit) = 1, nSWBoot0(bit) = 0 and user flash empty</td></tr><tr><td colspan="1" rowspan="1">nBoot1(bit) = 1, nSWBoot0(bit) = 1 and Boot0(pin) = 1</td></tr><tr><td colspan="1" rowspan="1">nBoot1(bit) = 1, nSWBoot0(bit) = 1, Boot0(pin) = 0 and user flash empty</td></tr><tr><td colspan="1" rowspan="4">Pattern 14</td><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBoot1(bit) = 1, Boot0(pin) = 1 and nSWBoot0(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBoot1(bit) = 1, nBoot0(bit) = 0 and nSWBoot0(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, Boot0(pin) = 0, nSWBootO(bit) = 1, BFB2(bit) = 1 and both banks do notcontain valid code</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit) = 0, nBoot0(bit) = 1, nSWBoot0(bit) = 0, BFB2(bit) = 1 and both banks do notcontain valid code</td></tr><tr><td colspan="1" rowspan="2">Pattern 15</td><td colspan="1" rowspan="1">BOOT_LOCK(bit)=0, BootO(pin) = 1, nBoot1(bit) = 1 and nBoot0_SW(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">BOOT_LOCK(bit)=0, nBoot0O(bit) = 0, nBoot1(bit) = 1 and nBoot0_SW(bit) = 0</td></tr><tr><td colspan="1" rowspan="3">Pattern 16</td><td colspan="1" rowspan="1">Boot0(pin) = 1, nBoot1(bit) = 1 and nBoot0_SW(bit) = 1</td></tr><tr><td colspan="1" rowspan="1">nBoot0(bit) = 0, nBoot1(bit) = 1 and nBoot0_SW(bit) = 0</td></tr><tr><td colspan="1" rowspan="1">Boot0(pin) = 0, nBoot0_sW(bit) = 1 and main flash memory empty</td></tr><tr><td colspan="1" rowspan="2">Pattern 17</td><td colspan="1" rowspan="1">PRODUCT_STATE = Open and Boot0O(pin) = 1</td></tr><tr><td colspan="1" rowspan="1">PRODUCT_STATE = Provisioning</td></tr><tr><td colspan="1" rowspan="1">Pattern 18</td><td colspan="1" rowspan="1">Force PA10 high during HW reset</td></tr></table>

Device dependent: 0x17F200 for STM32L5, STM32U5, and STM32WBA6, Ox17F1E00 for STM32U3, Ox17F1000 for STM32WBA5.

Note:

nBootO_ SW means either nSWBoot0 or nBOOTo_SEL, depending upon the product.

Note:

BOOT_LOCK implementation is product dependent. See the reference manual for more details.

In addition to the patterns described above, the user can execute bootloader by performing a jump to system memory from user code. Before jumping to bootloader:

• Disable all peripheral clocks • Disable used PLL • Disable interrupts S Clear pending interrupts

In some products using interrupts (integrating USB, SPI, non auto baud rate USART), interrupts must be re-enabled before jumping to the Bootloader, as this is not done by the bootloader SW.

System memory boot mode can be exited by getting out from bootloader activation condition and generating hardware reset or using Go command to execute user code.

# Note:

When executing the Go command, the peripheral registers used by the bootloader are not initialized to their default reset values before jumping to the user application. They must be reconfigured in the user application if they are used. So, if the application uses the IWDG, the IWDG prescaler value must be adapted to meet requirements (since the prescaler was set to its maximum value). For some products, not all reset values are set. For more information, refer to the known limitations detailed for each product bootloader version.

# Note:

On devices with dual bank boot, to jump to system memory from user code the user must first remap the system memory bootloader at address Ox00000000 using SYSCFG register (except for STM32F7 series), then jump to bootloader. For the STM32F7 series, the user must disable nDBOOT and/or nDBANK features (in option bytes), then jump to bootloader. For STM32L0 series, the jump to system memory from user code is not possible.

# Note:

For STM32 devices embedding bootloader using the DFU/CAN interface in which the external clock source (HSE) is required for DFU/CAN operations, the detection of the HSE value is done dynamically by the bootloader firmware and is based on the internal oscillator clock (HSI, MSl). When (because of temperature variations or other conditions) the internal oscillator precision is altered above the tolerance band (1% around the theoretical value), the bootloader can calculate a wrong HSE frequency value. In this case, the bootloader DFU/CAN interfaces can malfunction, or not work at all.

# 4.2 Bootloader identification

Depending upon the device, the bootloader can support one or more embedded serial peripherals used to download the code to the internal flash memory. The bootloader identifier (ID) provides information about the supported serial peripherals.

For a given STM32 device, the bootloader is identified by means of the:

1. Bootloader (protocol) version: version of the serial peripheral (e.g. USART, CAN, USB) communication protocol used in the bootloader. This version can be retrieved using the bootloader Get Version command.

2. Bootloader identifier (ID): version of the STM32 device bootloader, coded on one byte in the 0xXY format, where:

X specifies the embedded serial peripheral(s) used by the device boo   
X = 1: one USART is used   
X = 2: two USARTs are used   
X = 3: USART, CAN, and DFU are used   
X = 4: USART and DFU are used   
X = 5: USART and I2C are used   
X = 6: 12C is used   
X = 7: USART, CAN, DFU, and I²C are used   
X = 8: I2C and SPI are used   
X = 9: USART, CAN (or FDCAN), DFU, I2C, and SPI are used   
X = 10: USART, I2C, and DFU are used   
X = 11: USART, I2C, and SPI are used   
X = 12: USART and SPI are used   
X = 13: USART, DFU, I2C, and SPI are used   
X = 14: USART, DFU, I2C, I3C, FDCAN, and SPI are uSed   
X = 15: USART, USB-DFU, I2C, and I3C are used   
X = 16: USART, USB-DFU, FDCAN, and SPI are uSed   
X = 17: USART, SPI, and FDCAN are used   
X = 18: USART, SPI, FDCAN, and I2C are used Y specifies the device bootloader version   
For example, if the bootloader ID is Ox10, this is the first version, which uses only one USART.   
The bootloader ID is programmed in the last byte address - 1 of the device system memory and can be read by using the "Read memory" command or by direct access to the system memory via JTAG/SWD.

Note:

The bootloader ID format is applied to all STM32 products, except the STM32F1xx devices. The bootloader version for the STM32F1xx applies only to the embedded device bootloader version and not to its supported protocols.

Table 3 provides identification information of the bootloaders embedded in STM32 devices.

Table 3. Embedded bootloaders   

<table><tr><td colspan="1" rowspan="2">20</td><td colspan="2" rowspan="2">Device</td><td colspan="1" rowspan="2">Supported serial peripherals</td><td colspan="2" rowspan="1">Bootloader ID</td><td colspan="1" rowspan="2">Bootloader(protocol)version</td></tr><tr><td colspan="1" rowspan="1">ID</td><td colspan="1" rowspan="1">Memorylocation</td></tr><tr><td colspan="1" rowspan="5">CO</td><td colspan="2" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="1">USART1I2C1</td><td colspan="1" rowspan="1">0x51</td><td colspan="1" rowspan="1">0x1FFF17FE</td><td colspan="1" rowspan="1">USART (V3.1)2(V1.1)</td></tr><tr><td colspan="2" rowspan="1">STM32C031xx</td><td colspan="1" rowspan="1">USART112C1</td><td colspan="1" rowspan="1">0x52</td><td colspan="1" rowspan="1">0x1FFF17FE</td><td colspan="1" rowspan="1">USART (V3.1)2(V1.1)</td></tr><tr><td colspan="2" rowspan="1">STM32C051xx</td><td colspan="1" rowspan="1">USART1/USART2201/2C2SPI1/SPI2</td><td colspan="1" rowspan="1">0xB0</td><td colspan="1" rowspan="1">0x1FFF2FFE</td><td colspan="1" rowspan="1">USART (V4.0)12C2(V2.0)SPPI (V2.0)</td></tr><tr><td colspan="2" rowspan="1">STM32C071xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C2SSPI1/SPI2USB DFU</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x1FFF67FE</td><td colspan="1" rowspan="1">USART (V3.1)21(V1.2)S P (V1.1)USB (V2.2)</td></tr><tr><td colspan="2" rowspan="1">STM32C091xx/92xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C11/I2C2SSP1/SPI2FDCAN1</td><td colspan="1" rowspan="1">0x121</td><td colspan="1" rowspan="1">0x1FFF3FFE</td><td colspan="1" rowspan="1">USART (V4.0)12C (V22.0)SP (V2.0)FDCAN (V2.2)</td></tr><tr><td colspan="1" rowspan="8">F0</td><td colspan="2" rowspan="1">STM32F05xxx/STM32F030x8</td><td colspan="1" rowspan="1">USART1/USART2</td><td colspan="1" rowspan="1">0x21</td><td colspan="1" rowspan="1">0x1FFFF7A6</td><td colspan="1" rowspan="1">USART (V3.1)</td></tr><tr><td colspan="2" rowspan="1">STM32F03xx4/6</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">0x10</td><td colspan="1" rowspan="1">0x1FFFF7A6</td><td colspan="1" rowspan="1">USART (V3.1)</td></tr><tr><td colspan="2" rowspan="1">STM32F030xC</td><td colspan="1" rowspan="1">USART112C1</td><td colspan="1" rowspan="1">0x52</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="1" rowspan="1">USART (V3.1)2(V1.0)</td></tr><tr><td colspan="2" rowspan="1">STM32F04xxx</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)12C1</td><td colspan="1" rowspan="1">0xA1</td><td colspan="1" rowspan="1">0x1FFFF6A6</td><td colspan="1" rowspan="1">USART (V3.1)DFU (V2.2)2 (V1.0)</td></tr><tr><td colspan="2" rowspan="1">STM32F071xx/072xx</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS) 12C1</td><td colspan="1" rowspan="1">0xA1</td><td colspan="1" rowspan="1">0x1FFFF6A6</td><td colspan="1" rowspan="1">USART (V3.1)DDFU (V2.2)2 (V1.0)</td></tr><tr><td colspan="2" rowspan="1">STM32F070x6</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)I2C1</td><td colspan="1" rowspan="1">0xA2</td><td colspan="1" rowspan="1">0x1FFFF6A6</td><td colspan="1" rowspan="1">USART (V3.1)DDF (V2.2)2 (V1.0)</td></tr><tr><td colspan="2" rowspan="1">STM32F070xB</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)I2C1</td><td colspan="1" rowspan="1">0xA3</td><td colspan="1" rowspan="1">0x1FFFF6A6</td><td colspan="1" rowspan="1">USART (V3.1)DDF (V2.2)2 (V1.0)</td></tr><tr><td colspan="2" rowspan="1">STM32F09xxx</td><td colspan="1" rowspan="1">USART1/USART2I2C1</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="1" rowspan="1">USART (V3.1)122 (V1.0)</td></tr><tr><td colspan="1" rowspan="7">F1</td><td colspan="1" rowspan="5">STM32F10xxx</td><td colspan="1" rowspan="1">Low-density</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">USART (V2.2)</td></tr><tr><td colspan="1" rowspan="1">Medium-density</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">USART (V2.2)</td></tr><tr><td colspan="1" rowspan="1">High-density</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">USART (V2.2)</td></tr><tr><td colspan="1" rowspan="1">Medium-densityvalue line</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">0x10</td><td colspan="1" rowspan="1">0x1FFFF7D6</td><td colspan="1" rowspan="1">USART (V2.2)</td></tr><tr><td colspan="1" rowspan="1">High-densityvalue line</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">0x10</td><td colspan="1" rowspan="1">0x1FFFF7D6</td><td colspan="1" rowspan="1">USART (V2.2)</td></tr><tr><td colspan="2" rowspan="1">STM32F105xx/107xx</td><td colspan="1" rowspan="1">USART1/USART2 (remapped)CAN2 (remapped)DFU (USB device)</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">USART((1)CAN (V2.0)DF(V2.2)</td></tr><tr><td colspan="2" rowspan="1">STM32F10xxx XL-density</td><td colspan="1" rowspan="1">USART1/USART2 (remapped)</td><td colspan="1" rowspan="1">0x21</td><td colspan="1" rowspan="1">0x1FFFF7D6</td><td colspan="1" rowspan="1">USART (V3.0)</td></tr><tr><td colspan="2" rowspan="2">20</td><td colspan="1" rowspan="2">Device</td><td colspan="1" rowspan="2">Supported serial peripherals</td><td colspan="2" rowspan="1">Bootloader ID</td><td colspan="1" rowspan="2">Bootloaderprtocol)version</td></tr><tr><td colspan="1" rowspan="1">ID</td><td colspan="2" rowspan="1">Memoryocation</td></tr><tr><td colspan="1" rowspan="2">F2</td><td colspan="1" rowspan="2">STM32F2xxXX</td><td colspan="1" rowspan="1">USART1/USART3</td><td colspan="1" rowspan="1">0x20</td><td colspan="1" rowspan="1">0x1FFF77DE</td><td colspan="2" rowspan="1">USART (V3.0)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x33</td><td colspan="1" rowspan="1">0x1FFF77DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DDF (V2.2)</td></tr><tr><td colspan="1" rowspan="9">F3</td><td colspan="1" rowspan="1">STM32F373xx</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x41</td><td colspan="1" rowspan="1">0x1FFFF7A6</td><td colspan="2" rowspan="1">USART (V3.1) DF (2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F378xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF7A6</td><td colspan="2" rowspan="1">USART (V3.1)2 (V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F302xB(C)/303xB(C)</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x41</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1)DF (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F358xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1) 2(V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F301xx/302x4(6/8)</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x40</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F318xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1//1I2C3</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1)2 (1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F302xD(E)/303xD(E)</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x40</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1)DF (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F303x4(6/8)/334xx/328xx</td><td colspan="1" rowspan="1">USART1/USART212C1</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1)2 (V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F398xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C3</td><td colspan="1" rowspan="1">0x50</td><td colspan="1" rowspan="1">0x1FFFF796</td><td colspan="2" rowspan="1">USART (V3.1) 2(V1.0)</td></tr><tr><td colspan="2" rowspan="2">20</td><td colspan="1" rowspan="2">Device</td><td colspan="1" rowspan="2">Supported serial peripherals</td><td colspan="2" rowspan="1">Bootloader ID</td><td colspan="1" rowspan="2">Bootloader(protocol)version</td></tr><tr><td colspan="1" rowspan="1">ID</td><td colspan="2" rowspan="1">Memorylocation</td></tr><tr><td colspan="1" rowspan="12">F4</td><td colspan="1" rowspan="2">STM32F40xxx/41xxx</td><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x31</td><td colspan="1" rowspan="1">0x1FFF77DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)I2C1/2C2/I2C3SPI1/SPI2</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x1FFF77DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)SPI(V1.1)I2C (V1.0)</td></tr><tr><td colspan="1" rowspan="2">STM32F42xxx/43xxx</td><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)I2C1</td><td colspan="1" rowspan="1">0x70</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0) DFU (V2.2)12C (V1.0)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)SPI1/SPI2/ SPI4I2C1/I2C2/I2C3</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)SPI(V1.1)I2C V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)SPI1/SPI2/ SPI3I2C1/I2C2/I2C3</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)DFU (V2.2)SPI(V1.1)12C (V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)SPI1/SPI2/SPI3I2C1/I2C2/I2C3</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)DFU (V2.2)SPI(V1.11)12C(V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32F410xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C2/I2C4SPI1/SPI2</td><td colspan="1" rowspan="1">0xB1</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)SPI1/SPI2/ SPI3I2C1/I2C2/I2C3</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)DFU (V2.2)SPI(V1.1)I2C (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">USART1/USART2USART3/CAN2DFU (USB device FS)SPI1/SPI3/SPI4I2C1/I2C2/I2C3/I2C4</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)SPI (V1.1)I2C (V1.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">USART1/USART2USART3/CAN2DFU (USB device FS)I2C1/i2C2/I2C3/I2C4SPI1/SPI3/SPI4</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)I2C (V1.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)SPI1/ SPI2/SPI4I2C1/I2C2/I2C3</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)SPI(V1.1)I2C (V1.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">USART1/USART3I2C1/I2C2/I2C3CAN2DFU (USB device FS)SPI1/SPI2/ SPI4</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FFF76DE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="4">F7</td><td colspan="1" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">USART1/USART3CAN1DFU (USB device FS)I2C1/2C2/I2C3SPI1/SPI2/SPI4</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FF0EDBE</td><td colspan="2" rowspan="1">USART (V3.1)CAN (V2.0)DFU (V2.2)I2C (V1.2)SPI (V1.2)</td></tr><tr><td colspan="1" rowspan="2">STM32F74xxx/75xxx</td><td colspan="1" rowspan="1">USART1/USART3I2C1//2C2/I2C3CAN2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x70</td><td colspan="1" rowspan="1">0x1FF0EDBE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CA (V2.0)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART3I2C1/2C2/I2C3CAN2DFU (USB device FS)SPI1/SPI2/SPI4</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FF0EDBE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)A (V2.0)DFU (V2.2)SP (V1.2)</td></tr><tr><td colspan="1" rowspan="1">STM32F76xxx/77xxx</td><td colspan="1" rowspan="1">USART1/USART3CAN2DFU (USB device FS)I2C1/2C2/I2C3SPI1/SPI2/SPI4</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x1FF0EDBE</td><td colspan="2" rowspan="1">USART (V3.1)CAN  (V2.0)D (V2.2)2(V1.2)SP (V1.2)</td></tr><tr><td colspan="1" rowspan="5">GO</td><td colspan="1" rowspan="1">STM32G07xxx/08xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2SPI1/SPI2</td><td colspan="1" rowspan="1">0xB4</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SSP (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32G03xxx/04xxx</td><td colspan="1" rowspan="1">USART1/USART2I2C1V2C2</td><td colspan="1" rowspan="1">0x54</td><td colspan="1" rowspan="1">0x1FFF1FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)</td></tr><tr><td colspan="1" rowspan="1">STM32G0B0xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x1FFF9FFE</td><td colspan="2" rowspan="1">USART (V3.1)122 (V1.2)SP(V1.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32G0B1xx/0C1xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2SPI1/SPI2DFU (USB device FS)FDCAN</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x1FFF9FFE</td><td colspan="2" rowspan="1">USART (V3.1)12 (V1.2)SPI(V1.1)DFU (V2.2)FDCAN (V1.0)</td></tr><tr><td colspan="1" rowspan="1">STM32G05xxx/061xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C2</td><td colspan="1" rowspan="1">0x51</td><td colspan="1" rowspan="1">0x1FFF1FFE</td><td colspan="2" rowspan="1">USART (V3.1)12C (V1.2)</td></tr><tr><td colspan="1" rowspan="3">G4</td><td colspan="1" rowspan="1">STM32G431xx/441xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C2/I2C3SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD4</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI(V1.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32G47xxx/48xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C2/I2C3/I2C4SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD5</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)12C (V1.2)SPI (V1.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32G491xx/4A1xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C2/I2C3SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD2</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)12C (V1.2)SP (V1.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="3">H5</td><td colspan="1" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C2I3C1SPI1/SPI2/SPI3USB DFUFDCAN1</td><td colspan="1" rowspan="1">0xE2</td><td colspan="1" rowspan="1">0x0BF8FFFE</td><td colspan="2" rowspan="1">USART (V4.0)I2C (V2.0)I3C 1.0)SPI (V2.0)USB (V3.0)FDCAN (V2.0)</td></tr><tr><td colspan="1" rowspan="1">STM32H562xx/63xx/73xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C3/2C4I3C1SPI1/SPI2/SPI3USB DFUFDCAN2</td><td colspan="1" rowspan="1">0xE4</td><td colspan="1" rowspan="1">0x0BF9FAFE</td><td colspan="2" rowspan="1">USART (V4.0)12C (V2.0))I3C (V1.0)SPI (V2.0)USB (V3.0)FDCAN (V2.0)</td></tr><tr><td colspan="1" rowspan="1">STM32H523xx/33xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/2C3I3C1SPI1/SPI2/SPI3USB DFUFDCAN2</td><td colspan="1" rowspan="1">0xE2</td><td colspan="1" rowspan="1">0x0BF8FFFE</td><td colspan="2" rowspan="1">USART (V4.0)12C (V2.0)I3C (V1.0)SPI (V2.0)USB (V3.0)FDCAN (V2.0)</td></tr><tr><td colspan="1" rowspan="5">H7</td><td colspan="1" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3DFU (USB device FS)SPI1/SPI2/SPI3/SPI4FDCAN1</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x1FF1E7FE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)DFU (V2.2)SPI (V1.1)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3DFU (USB device FS)SPI1/SPI2/SPI3/SPI4FDCAN1</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x1FF1E7FE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.1)DFU (V2.2)SPI (V1.1)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32H7A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3DFU (USB device FS)SPI1/SPI2/SPI3FDCAN1</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x1FF13FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)DFU (V2.2)SPI (V1.2)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="2">STM32H7Rxxx/7Sxxx</td><td colspan="1" rowspan="2">USART1/USART2/USART3UART4I2C1/I2C2/I2C3DFU (USB device FS)SPI1/SPI2/SPI3FDCAN2I3C1</td><td colspan="1" rowspan="1">0xE3(RevY)</td><td colspan="1" rowspan="2">0x1FF1FCFE</td><td colspan="2" rowspan="2">USART (V4.0)I2C (V2.0)DFU (V2.2)SPI (V2.0)FDCAN (V2.1)I3C (V1.0)</td></tr><tr><td colspan="2" rowspan="1">0xE5(Rev B)</td></tr><tr><td colspan="1" rowspan="5">LO</td><td colspan="1" rowspan="1">STM32L01xxx/02xxx</td><td colspan="1" rowspan="1">USART2SPI11</td><td colspan="1" rowspan="1">0xC3</td><td colspan="1" rowspan="1">0x1FF00FFE</td><td colspan="2" rowspan="1">USART (V3.1)SSP (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L031xx/041xx</td><td colspan="1" rowspan="1">USART2SPI1</td><td colspan="1" rowspan="1">0xC0</td><td colspan="1" rowspan="1">0x1FF00FFE</td><td colspan="2" rowspan="1">USART (V3.1)S P (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L05xxx/06xxx</td><td colspan="1" rowspan="1">USART1/USART2SPI1/ SPI2</td><td colspan="1" rowspan="1">0xC0</td><td colspan="1" rowspan="1">0x1FF0OFFE</td><td colspan="2" rowspan="1">USART (V3.1)S P (V1.1)</td></tr><tr><td colspan="1" rowspan="2">STM32L07xxx/08xxx</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x41</td><td colspan="1" rowspan="1">0x1FF01FFE</td><td colspan="2" rowspan="1">USART (V3.1)DF (V2.2)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART2SPI1/SPI2 21/I2C2</td><td colspan="1" rowspan="1">0xB2</td><td colspan="1" rowspan="1">0x1FF01FFE</td><td colspan="2" rowspan="1">USART (V3.1)S P (V1.1)I2C (V1.2)</td></tr><tr><td colspan="1" rowspan="5">L1</td><td colspan="1" rowspan="1">STM32L1xxx6(8/B)</td><td colspan="1" rowspan="1">USART1/USART2</td><td colspan="1" rowspan="1">0x20</td><td colspan="1" rowspan="1">0x1FF00FFE</td><td colspan="2" rowspan="1">USART (V3.0)</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxx6(8/B)A</td><td colspan="1" rowspan="1">USART1/USART2</td><td colspan="1" rowspan="1">0x20</td><td colspan="1" rowspan="1">0x1FF00FFE</td><td colspan="2" rowspan="1">USART (V3.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxC</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x40</td><td colspan="1" rowspan="1">0x1FF01FFE</td><td colspan="2" rowspan="1">USART (V3.1)DDF (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxD</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x45</td><td colspan="1" rowspan="1">0x1FF01FFE</td><td colspan="2" rowspan="1">USART (V3.1)DDDF (V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxE</td><td colspan="1" rowspan="1">USART1/USART2DFU (USB device FS)</td><td colspan="1" rowspan="1">0x40</td><td colspan="1" rowspan="1">0x1FF01FFE</td><td colspan="2" rowspan="1">USART (V3.1) DF (V2.2)</td></tr><tr><td colspan="2" rowspan="2">20</td><td colspan="1" rowspan="2">Device</td><td colspan="1" rowspan="2">Supported serial peripherals</td><td colspan="2" rowspan="1">Bootloader ID</td><td colspan="1" rowspan="2">Bootloaderprotocol)version</td></tr><tr><td colspan="1" rowspan="1">ID</td><td colspan="2" rowspan="1">Memorylocation</td></tr><tr><td colspan="1" rowspan="8">L4</td><td colspan="1" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3CAN1DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3CAN1DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPP (V1.1)</td></tr><tr><td colspan="1" rowspan="2">STM32L47xxx/48xxx</td><td colspan="1" rowspan="1">USART1/USART2/ USART3I2C1/I2C2/I2C3DFU (USB device FS)</td><td colspan="1" rowspan="1">0xA3</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="1">USART1/USART2/ USART3I2C/I2C2/I2C3SPI1/SPI2CAN1DFU (USB device FS)</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)CAN(V2.0)DFU(V2.2)</td></tr><tr><td colspan="1" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3CAN1DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L4Rxxx/STM32L4Sxxx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3CAN1DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0x95</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32L4P5xx/Q5xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3CAN1DFU (USB device FS)SPI1/SPI2</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)CAN (V2.0)DFU (V2.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">L5</td><td colspan="1" rowspan="1">STM32L552xx/562xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1//2C2/I2C3SPI1/SPI2/SPI3DFU (USB device FS)FDCAN1</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x0BF97FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)FDCAN (V1.0)</td></tr><tr><td colspan="1" rowspan="2">UO</td><td colspan="1" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3SPI1/SPI2</td><td colspan="1" rowspan="1">0xB0</td><td colspan="1" rowspan="1">0x1FFF37FE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32U073xx/83xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x1FFF67FE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)</td></tr><tr><td colspan="2" rowspan="2">20</td><td colspan="1" rowspan="2">Device</td><td colspan="1" rowspan="2">Supported serial peripherals</td><td colspan="2" rowspan="1">Bootloader ID</td><td colspan="1" rowspan="2">Bootloader(protocol)version</td></tr><tr><td colspan="1" rowspan="1">ID</td><td colspan="2" rowspan="1">Memorylocation</td></tr><tr><td colspan="1" rowspan="1">U3</td><td colspan="1" rowspan="1">STM32U375xx/385xx</td><td colspan="1" rowspan="1">USART1/USART3I2C1/I2C2/I2C3I3C1SPI1/SPI2/SPI3DFU (USB device FS)FDCAN1</td><td colspan="1" rowspan="1">0xE2</td><td colspan="1" rowspan="1">0x0BF98FFE</td><td colspan="2" rowspan="1">USART(V4.0)I2C (V2.0)I3C(V1.0)SPI (V2.0)DFU (V3.0)FDCAN (V2.2)</td></tr><tr><td colspan="1" rowspan="4">U5</td><td colspan="1" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">USART1/USART3I2C1/I2C2/I2C3SPI1/SPI2/SPI3DFU (USB device FS)FDCAN1</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x0BF99EFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32U575xx/STM32U585xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3SPI1/SPI2/SPI3DFU (USB device FS)FDCAN1</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x0BF99EFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32U595xx/599xx/STM32U5A5xx/5A9xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3SPI1/SPI2/SPI3DFU (USB device HS)FDCAN1</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x0BF99EFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32U5F7xx/5F9xx/STM32U5G7xx/5G9xx</td><td colspan="1" rowspan="1">USART1/USART2/USART3I2C1/I2C2/I2C3SPI1/SPI2/SPI3DFU (USB device HS)FDCAN</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x0BF99EFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)DFU (V2.2)FDCAN (V1.1)</td></tr><tr><td colspan="1" rowspan="2">WB</td><td colspan="1" rowspan="1">STM32WB10xx/15xx</td><td colspan="1" rowspan="1">USART1I2C1SPI1</td><td colspan="1" rowspan="1">0xB1</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32WB30xx/35xx/50xx/55xx</td><td colspan="1" rowspan="1">USART1I2C1/I2C3SPI1/SPI2DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD5</td><td colspan="1" rowspan="1">0x1FFF6FFE</td><td colspan="2" rowspan="1">USART (V3.2)I2C (V1.2)SP(V1.1)DFU (V2.2)</td></tr><tr><td colspan="1" rowspan="2">WBA</td><td colspan="1" rowspan="1">STM32WBA5xxx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C3SPI3</td><td colspan="1" rowspan="1">0xB0(revA),0xB1(revB)</td><td colspan="1" rowspan="1">0x0BF8FEFE</td><td colspan="2" rowspan="1">USART (V3.1)I2C (V1.2)SPI (V1.1)</td></tr><tr><td colspan="1" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">USART1/USART2I2C1/I2C3SPI2/SPI3DFU (USB device FS)</td><td colspan="1" rowspan="1">0xD2</td><td colspan="1" rowspan="1">0x0BF97EFE</td><td colspan="2" rowspan="1">USART (V4.0)I2C (V2.0)SPI (V2.0)DFU (V3.0)</td></tr><tr><td colspan="1" rowspan="3">WBO</td><td colspan="1" rowspan="1">STM32WB05xx</td><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="3">NA</td><td colspan="1" rowspan="3">NA</td><td colspan="2" rowspan="1">USART (V2.0)</td></tr><tr><td colspan="1" rowspan="1">STM32WB06xx/7xx</td><td colspan="2" rowspan="1">USART (V4.0)</td></tr><tr><td colspan="1" rowspan="1">STM32WB09xx</td><td colspan="2" rowspan="1">USART (V1.0)</td></tr><tr><td colspan="1" rowspan="2">WL</td><td colspan="1" rowspan="1">STM32WL3xxx</td><td colspan="1" rowspan="1">USART</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">NA</td><td colspan="2" rowspan="1">USART (V4.0)</td></tr><tr><td colspan="1" rowspan="1">STM32WL3xxx/E5xx/55xx</td><td colspan="1" rowspan="1">USART1/USART2SPI1/SPI2</td><td colspan="1" rowspan="1">0xC4</td><td colspan="1" rowspan="1">0x1FFF3EFE</td><td colspan="2" rowspan="1">USART (V3.1)SPI (V1.1)</td></tr></table>

refer to the "STM32F105xx and STM32F107xx revision Z" errata sheet available from www.st.com.

# 4.3 Hardware connection requirements

To use the USART bootloader, the host must be connected to the RX and TX pins of the desired USARTx interface via a serial cable.

![](images/a2782b0b3d300db8fe779c8c23c41145d9c87a5983166322b024a2f0792de4d2.jpg)  
Figure 1. USART connection

1. A pull-up resistor must be added, if they are not connected on host side.   
An RS232 transceiver must be connected to adapt the voltage level (3.3 to 12 V) between the STM32 device and the host.

Note:

Typically V is 3.3 V, and R is 100 KΩ. These values depend upon the application and the used hardware.

To use the DFU, connect the microcontroller USB interface to a USB host (such as a PC).

![](images/bf6c02f3ac7519eed4602ac24020dfacadfc752fb772789edc1585e49a0fb00b.jpg)

This additional circuit permits to connect a pull-up resistor to DP pin using VBus when needed. Refer to product section (table describing STM32 configuration in system memory boot mode) to know f an external pull-up resistor must be connected to DP pin.

Note:

V typically is 3.3 V. This value depends upon the application and the used hardware.

To use the I2C bootloader, connect the host (controller) and the desired I2Cx interface (target) together via the data (SDA) and clock (SCL) pins. A 1.8 KΩ pull-up resistor must be connected to both SDA and SCL lines.

![](images/247ff72c2e90e16f5045f20625a85f1dd6229a4aaa7a2568e2b966cc096ae075.jpg)

Note:

V is typically 3.3 V. This value depends upon the application and the used hardware.

To use the SPI bootloader, connect the host (master) and the desired SPIx interface (slave) together via the MOSI, MISO, SCK, and NSS pins. A pull-down resistor must be connected to the SCK line.

Figure 3. I2C connection   
Figure 4. SPI connection   

<table><tr><td colspan="3"></td><td rowspan="2">NSS</td></tr><tr><td rowspan="5">SPI host</td><td colspan="3">NSS</td></tr><tr><td colspan="2">MOSI</td><td rowspan="3">MOSI</td></tr><tr><td colspan="3">MISO MISO</td></tr><tr><td colspan="3">SCK SCK</td></tr><tr><td rowspan="3"></td><td colspan="3">GND</td></tr><tr><td colspan="3">GND</td></tr><tr><td colspan="3"></td></tr></table>

MS35039V2

Note:

The resistor is typically 10 KΩ, its value depends upon the application and the used hardware.

To use the CAN interface, the host must be connected to the RX and TX pins of the desired CANx interface via CAN transceiver and a serial cable. A 120 Ω resistor must be added as terminating resistor.

![](images/50a326ba0b4c441751a681b62e9d773cd855f46e7df1cca64dc79ee23d669c9d.jpg)  
Figure 5. CAN connection

Note:

When a bootloader firmware supports DFU, it is mandatory that no USB host is connected to the USB peripheral during the selection phase of the other interfaces. After selection phase, the user can plug a USB cable without impacting the selected bootloader execution, except for commands generating a system reset.

It is recommended to keep the RX pins of unused bootloader interfaces (USART_RX, SPI_MOSI, and CAN_RX, if present) at a known (low or high) level and keep the USB D+/Dlines, if present, on the same level (low/high) at the startup of the bootloader (detection phase). Leaving these pins floating during the detection phase can result in activation of unused interfaces.

# 4.4 Bootloader memory management

All write operations using bootloader commands must be word-aligned (the address must be a multiple of 4). The number of data to write must be a multiple of 4 as well (non-aligned half page write addresses are accepted).

Some products embed a bootloader with specific features:

On products that do not support mass erase operation, to perform this operation using   
the bootloader, two options are available: Erase all sectors one by one using the Erase command Set protection level to Level 1. Then, set it to Level 0 (using the Read protect and then the Read unprotect command). This operation results in a mass erase of the internal flash memory.   
Bootloader firmware of STM32 L1 and L0 series supports Data memory in addition to   
standard memories (internal flash, internal SRAM, option bytes and System memory).   
The start address and the size of this area depends on product, refer to the reference   
manual for more information. Data memory can be read and written but cannot be   
erased using the Erase command. When writing in a Data memory location, the   
bootloader firmware manages the erase operation of this location before any write. A   
write to Data memory must be word-aligned (address to be written must be a multiple   
of 4) and the number of data must also be a multiple of 4. To erase a Data memory   
location, write Os at this location.   
Bootloader firmware of the F2, F4, F7, and L4 series supports OTP memory in addition   
to standard memories (internal flash, internal SRAM, option bytes and System   
memory). The start address and the size of this area depends on product, refer to the   
reference manual for more information. OTP memory can be read and written but   
cannot be erased using Erase command. When writing in an OTP memory location,

make sure that the relative protection bit is not reset.

For STM32 F2, F4, and F7 series the internal flash memory write operation format depends on voltage range. By default write operations are allowed by one byte format (half-word, word, and double-word operations are not allowed). To increase the speed of write operation, the user must apply the adequate voltage range that allows write operation by half-word, word or double-word and update this configuration on the fly by the bootloader software through a virtual memory location. This memory location is not physical but can be read and written using usual bootloader read/write operations according to the protocol in use. This memory location contains four bytes, described in Table 4. It can be accessed by 1, 2, 3, or 4 bytes. However, reserved bytes must remain at their default values (OxFF), otherwise the request is NACK-ed.

Table 4. STM32 F2, F4, and F7 voltage range configuration using bootloader   

<table><tr><td rowspan=1 colspan=1>Address</td><td rowspan=1 colspan=1>Size</td><td rowspan=1 colspan=1>Description</td></tr><tr><td rowspan=1 colspan=1>0xFFFF0000</td><td rowspan=1 colspan=1>1 byte</td><td rowspan=1 colspan=1>This byte controls the current value of the voltage range.- 0x00: voltage range [1.8 V, 2.1 V]− 0x01: voltage range [2.1 V, 2.4 V]- 0x02: voltage range [2.4 V, 2.7 V]- 0x03: voltage range [2.7 V, 3.6 V]- 0x04: voltage range [2.7 V, 3.6 V] and double word write/eraseoperation is used. In this case it is mandatory to supply 9 Vthrough the VPP pin (refer to the product reference manual formore details about the double-word write procedure).— Others: all other values are not supported and are NACK-ed.</td></tr><tr><td rowspan=1 colspan=1>0xFFFF0001</td><td rowspan=1 colspan=1>1 byte</td><td rowspan=3 colspan=1>Reserved. OxFF is the default value, all other values are notsupported and are NACK-ed.</td></tr><tr><td rowspan=1 colspan=1>0xFFFF0002</td><td rowspan=1 colspan=1>1 byte</td></tr><tr><td rowspan=1 colspan=1>0xFFFF0003</td><td rowspan=1 colspan=1>1 byte</td></tr></table>

Table 5 lists the valid memory areas, depending upon the bootloader commands.

Table 5. Supported memory area by Write, Read, Erase, and Go commands   

<table><tr><td rowspan=1 colspan=1>Memory area</td><td rowspan=1 colspan=1>Write command</td><td rowspan=1 colspan=1>Read command</td><td rowspan=1 colspan=1>Erase command</td><td rowspan=1 colspan=1>Go command</td></tr><tr><td rowspan=1 colspan=1>Flash</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Not supported</td><td rowspan=1 colspan=1>Supported</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>Not supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Not supported</td><td rowspan=1 colspan=1>Not supported</td></tr><tr><td rowspan=1 colspan=1>Data memory</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Not supported</td><td rowspan=1 colspan=1>Not supported</td></tr><tr><td rowspan=1 colspan=1>OTP memory</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Supported</td><td rowspan=1 colspan=1>Not supported</td><td rowspan=1 colspan=1>Not supported</td></tr></table>

# 4.5 Bootloader UART baudrate detection

For the UART interface baudrate detection, there are two implemented mechanisms:

Software baudrate detection using internal HSI and timer (use GPIO as input, detect falling edge and rising edge as explained in AN3155). The devices using this mechanism are subject to software jitter (variable error of

baudrate calculation) that can reach up to ±5%. In this case, the host connecting to the STM32 bootloader UART interface must support a ±5% deviation in baudrate.

The software jitter value is variable and different at each retry, so it is possible to use multiple retry connections to overcome it. Connect and check for correct bootloader answer, if the answer is not correct, reset the device and retry connection until the correct answer is received. At this point, the rest of the communication is not impacted It is also possible to reduce the software jitter by reducing the baudrate (as an example use 56000 instead of 115200 bps).

Table 6 provides the maximum software jitter value for the 115200 bps baudrate. The lower the baudrate, the lower the software jitter.

Baudrate detection using UART auto-baudrate feature. Devices using this mechanism do not present any software jitter.

Table 6. Jitter software calculation on bootloader USART detection   

<table><tr><td colspan="1" rowspan="1">Series or product</td><td colspan="1" rowspan="1">Detection method</td><td colspan="1" rowspan="1">Maximum software jitter</td></tr><tr><td colspan="1" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="3">Auto-baudrate</td><td colspan="1" rowspan="3">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32C031xx</td></tr><tr><td colspan="1" rowspan="1">STM32C051xx USART1</td></tr><tr><td colspan="1" rowspan="1">STM32C051xx USART2</td><td colspan="1" rowspan="1">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32C071xx USART1</td><td colspan="1" rowspan="1">Auto-baudrate</td><td colspan="1" rowspan="1">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32C071xx USART2</td><td colspan="1" rowspan="1">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32C091xx/92xx USART1</td><td colspan="1" rowspan="1">Auto-baudrate</td><td colspan="1" rowspan="1">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32C091xx/92xx USART2/3</td><td colspan="1" rowspan="1">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32F0</td><td colspan="1" rowspan="6">Software baudrate detection</td><td colspan="1" rowspan="1">-1%</td></tr><tr><td colspan="1" rowspan="1">STM32F1</td><td colspan="1" rowspan="1">-3%</td></tr><tr><td colspan="1" rowspan="1">STM32F2</td><td colspan="1" rowspan="1">-5%</td></tr><tr><td colspan="1" rowspan="1">STM32F3</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32F4</td><td colspan="1" rowspan="1">-6%</td></tr><tr><td colspan="1" rowspan="1">STM32F7</td><td colspan="1" rowspan="1">-6%</td></tr><tr><td colspan="1" rowspan="1">STM32G05xxx/061xx USART1</td><td colspan="1" rowspan="1">Auto-baudrate</td><td colspan="1" rowspan="1">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32G05xxx/061xx USART2</td><td colspan="1" rowspan="2">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32G07/8x USART3STM32G03/4x USART2</td><td colspan="1" rowspan="1">-4%</td></tr><tr><td colspan="1" rowspan="1">STM32G07/8x USART1/USART2STM32G03/4x USART1</td><td colspan="1" rowspan="5">Auto-baudrate</td><td colspan="1" rowspan="5">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32G0B/Cxxx</td></tr><tr><td colspan="1" rowspan="1">STM32G4</td></tr><tr><td colspan="1" rowspan="1">STM32H5</td></tr><tr><td colspan="1" rowspan="1">STM32H7</td></tr><tr><td colspan="1" rowspan="1">STM32L0</td><td colspan="1" rowspan="3">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32L1</td><td colspan="1" rowspan="1">-3%</td></tr><tr><td colspan="1" rowspan="1">STM32L4</td><td colspan="1" rowspan="1">-5%</td></tr><tr><td colspan="1" rowspan="1">STM32L5</td><td colspan="1" rowspan="3">Auto-baudrate</td><td colspan="1" rowspan="3">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32U031xx USART1/2</td></tr><tr><td colspan="1" rowspan="1">STM32U073/83xx USART1/2</td></tr><tr><td colspan="1" rowspan="1">STM32U073/83xx USART3</td><td colspan="1" rowspan="1">Software baudrate detection</td><td colspan="1" rowspan="1">-2%</td></tr><tr><td colspan="1" rowspan="1">STM32U3</td><td colspan="1" rowspan="6">Auto-baudrate</td><td colspan="1" rowspan="6">Not applicable</td></tr><tr><td colspan="1" rowspan="1">STM32U5</td></tr><tr><td colspan="1" rowspan="1">STM32WB</td></tr><tr><td colspan="1" rowspan="1">STM32WBA</td></tr><tr><td colspan="1" rowspan="1">STM32WB0</td></tr><tr><td colspan="1" rowspan="1">STM32WL</td></tr></table>

# 4.6 Programming constraints

When using the bootloader interface to write in the flash memory, respect the alignment on the programmed address detailed in Table 7. If the address is not aligned, the operation fails, and all following program operations fail as well.

Table 7. Flash memory alignment constraints   

<table><tr><td colspan="1" rowspan="1">Series</td><td colspan="1" rowspan="1">Alignment</td></tr><tr><td colspan="1" rowspan="1">STM32C0</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F0</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F1</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F2</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F3</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F4</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32F7</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32G0</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32G4</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32H5</td><td colspan="1" rowspan="1">16 bytes</td></tr><tr><td colspan="1" rowspan="2">STM32H7</td><td colspan="1" rowspan="1">16 bytes (H7Rxx/H7Sxx devices)</td></tr><tr><td colspan="1" rowspan="1">8 bytes (all other devices)</td></tr><tr><td colspan="1" rowspan="1">STM32L0</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32L1</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32L4</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32L5</td><td colspan="1" rowspan="1">16 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32U0</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32U3</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32U5</td><td colspan="1" rowspan="1">16 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32WB</td><td colspan="1" rowspan="1">8 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32WBA</td><td colspan="1" rowspan="1">16 bytes</td></tr><tr><td colspan="1" rowspan="1">STM32WB0</td><td colspan="1" rowspan="1">4 bytes</td></tr><tr><td colspan="1" rowspan="2">STM32WL</td><td colspan="1" rowspan="1">4 bytes (STM32WL3xxx)</td></tr><tr><td colspan="1" rowspan="1">8 bytes (STM32WLE5xx/55xx)</td></tr></table>

Examples of alignment:

• 4 bytes: 0x0800 0014 is aligned and passes, 0x0800 0012 is not aligned and fails • 8 bytes: 0x0800 0010 is aligned and passes, 0x0800 0014 is not aligned and fails

Note:

On STM32F4 and STM32F7 it is possible to change the alignment constraint by writing in the device feature space.

# ExitSecureMemory feature

The securable memory area is used to isolate secure boot code/data, which handles sensitive information (secrets), from application code. The secure boot code access is controlled by HW (FLASH registers and option bytes, depending on the product). The code is executed once at boot, then locked by HW until the next reset.

The ExitSecureMemory is a software hosted on the system memory. When the user boot code jumps to it, it is possible to enable the hide protection area, and then jump to the application code. The size of the hide protection area (HDP) must be set by the user to the needed value before jumping to the ExitSecureMemory function.

# 4.7.1 ExitSecureMemory v1.0

As shown in Figure 6, two methods can be used.

1. Jump to the secure memory function without parameters: the application must be loaded just after the defined secure memory area (HDP and size).

Jump to the secure memory function using two parameters:

a) Magic number: 0x08192A3C is used to secure boot code/data in flash/Bank1 and jump in case of a single/dual bank product, Ox08192A3D is used to secure boot code/data and jump to application in Bank2 in case of a dual bank product   
b) User address = Application address: the application can be loaded to any desired address

![](images/63ea25054fcb2fcb6bf8431af7cc8beb65cf79ba4a6fafef8d87ae7f82e0ab71.jpg)  
Figure 6. ExitSecureMemory function usage   
Jump to the secure memory area without parameters

![](images/51dc5d7b3e9791e59db25714c3523d8bb733686614d9db70e3838b496931b1df.jpg)

Jump to the secure memory area with parameters (magic number and application address)

For more information regarding the option bytes configuration, see the reference manual.   
For examples of functions that can be used to call ExitSecureMemory, see Appendix A.   
For more details refer to Figure 7.

![](images/5409f63cc3345bc3c03b3aa618f88839c7f3740b2c96a57bd57dbf0d119496a8.jpg)  
Figure 7. Access to securable memory area from the bootloader

jump to.

# 4.7.2 ExitSecureMemory v1.1

Compared to the ExitSecureMemory v1.0, the user can define an MPU region. This is done using the CPU R3 register, before jumping to the software, that runs as shown in Figure 8.

![](images/8158496501afc629336a3a363b0300559616232d4c495bbd8ac6ffc611387ace.jpg)  
Figure 8. Defining an MPU region

Table 8. ExitSecureMemory entry address   

<table><tr><td rowspan=1 colspan=2>MCU</td><td rowspan=1 colspan=1>ExitSecureMemory address</td><td rowspan=1 colspan=1>Version address</td><td rowspan=1 colspan=1>Version</td></tr><tr><td rowspan=4 colspan=1>STM32G0</td><td rowspan=1 colspan=1>STM32G07xxx/08xxx</td><td rowspan=1 colspan=1>0x1FFF6800</td><td rowspan=9 colspan=1>Not available</td><td rowspan=9 colspan=1>V1.0</td></tr><tr><td rowspan=1 colspan=1>STM32G03xxx/04xxx</td><td rowspan=1 colspan=1>0x1FFF1E00</td></tr><tr><td rowspan=1 colspan=1>STM32G0Bxxx/0Cxxx</td><td rowspan=1 colspan=1>0x1FFF6800</td></tr><tr><td rowspan=1 colspan=1>STM32G05xxx/061xx</td><td rowspan=1 colspan=1>0x1FFF6800</td></tr><tr><td rowspan=3 colspan=1>STM32G4</td><td rowspan=1 colspan=1>STM32G47xxx/48xxx</td><td rowspan=1 colspan=1>0x1FFF6800</td></tr><tr><td rowspan=1 colspan=1>STM32G431xx/441xx</td><td rowspan=1 colspan=1>0x1FFF6800</td></tr><tr><td rowspan=1 colspan=1>STM32G491xx/4A1xx</td><td rowspan=1 colspan=1>0x1FFF6800</td></tr><tr><td rowspan=5 colspan=1>STM32C0</td><td rowspan=1 colspan=1>STM32C011xx</td><td rowspan=1 colspan=1>0x1FFF1600</td></tr><tr><td rowspan=1 colspan=1>STM32C031xx</td><td rowspan=1 colspan=1>0x1FFF1600</td></tr><tr><td rowspan=1 colspan=1>STM32C051xx</td><td rowspan=1 colspan=1>0x1FFF2E00</td><td rowspan=1 colspan=1>0x1FFF2F8C</td><td rowspan=3 colspan=1>V1.1 (0x11)</td></tr><tr><td rowspan=1 colspan=1>STM32C071xx</td><td rowspan=1 colspan=1>0x1FFF1600</td><td rowspan=1 colspan=1>0x1FFF618C</td></tr><tr><td rowspan=1 colspan=1>STM32C091xx/92xx</td><td rowspan=1 colspan=1>0x1FFF3E00</td><td rowspan=1 colspan=1>0x1FFF3F8C</td></tr><tr><td rowspan=2 colspan=1>STM32U0</td><td rowspan=1 colspan=1>STM32U031xx</td><td rowspan=1 colspan=1>0x1FFF3500</td><td rowspan=1 colspan=1>0x1FFF368C</td><td rowspan=2 colspan=1>V1.1 (0x11)</td></tr><tr><td rowspan=1 colspan=1>STM32U073xx/83xx</td><td rowspan=1 colspan=1>0x1FFF6000</td><td rowspan=1 colspan=1>0x1FFF618C</td></tr></table>

# 4.8 IWDG usage

The bootloader does not enable IWDG. It tries to update the prescaler value if the IWDG was enabled by HW (through option bytes) or by SW in case of an application that jumps to bootloader.

If the IWDG was not enabled before the boot on bootloader (using HW boot or by a jump from an application), the watchdog prescaler value update bit (PvU) is set to 1 when the bootloader tries to change the prescaler value.

This value does not change, it remains at Ox1 as the prescaler update never happens (IWDG is not enabled), even after the jump. When using the bootloader to jump to the application, and when there is the need to enable the IWDG, consider that the PVU bit in the IWDG_SR register is set to 1.

# 4.9 Bootloader models

To address the evolution of STM32 devices on security, the bootloader (BL) is now available on different models.

1. Legacy model - BL_V1 (see left side of Figure 9): The system memory is non secure and allocated to the bootloader. In some projects a SW (functionally independent from the bootloader) called ExitSecureMemory is implemented on the same zone as the BL.   
2. New BL model - BL_V2 (see right side of Figure 9) The system memory is split between secure and nonsecure areas. The secure area contains the System Flash Secure Package (SFSP), the nonsecure contains the BL.

![](images/ad054ee7625c979c724bca1b783cede24093125cb10707dbcaf055683b9e2505.jpg)  
Figure 9. BL_V1 (left) and BL_V2 (right) models

# 4.10 Boot constraints on BL

Boot depends upon the MCU (see Table 9), and adds new constraints to the BL.

Legacy products - Boot_V1 When correctly set, the boot is directly on the BL (left side of Figure 10) Products with security but no TrustZone isolation - Boot_V2 (right side of Figure 10) When correctly set and boot on the BL is possible, the boot starts on the SFSP, then it jumps to the bootloader. This adds a constraint to the boot timing.

Products with security using TrustZone isolation - Boot_V3

On this category there are two possibilities:

aBoot depending on TrustZone value - Boot_V3_1 (see Figure 11)

When TZEN is enabled, some constraints are added to the BL functionalities:

> Boot timing is different from the TZEN disabled use case   
> Before jumping to the BL, the SFSP maps all the needed resources by the BL to the nonsecure domain. A jump from the BL ("Go" command) to an application using other resources does not work.   
> Some secure option bytes are not be accessible as the bootloader is nonsecure. Some APIs are added on the SFSP to guarantee that the BL can modify them on open products states (Open, RDP L0).   
> Some parts of the SRAM are used by the SFSP and remain on Secure domain when jumping to the BL, so are not accessible by the customer through BL

Boot not depending on TrustZone value - Boot_V3_2 (see Figure 12) Boot goes through SFSP first, then jumps to the BL. In this model, some constraints are added to the BL functionalities on both TZEN states:

> Boot timing includes SFSP timing.   
V Before jumping to the BL, the SFSP map all the needed resources by the BL to the nonsecure domain. A jump from the BL ("Go" command) to an application using other resources does not work.   
> Some secure option bytes are not be accessible by the Bootloader as it is nonsecure. Some APIs are added on the SFSP to guarantee that the BL can modify them on open products states (Open).

V Some parts of the SRAM are used by the SFSP and remain on Secure domain when jumping to the BL, consequently they are not accessible by the customer through BL.

Table 9. BL and boot by product series   

<table><tr><td rowspan=1 colspan=1>Series</td><td rowspan=1 colspan=1>BL model</td><td rowspan=1 colspan=1>Boot</td></tr><tr><td rowspan=1 colspan=1>STM32H7</td><td rowspan=3 colspan=1>BL_V2</td><td rowspan=1 colspan=1>Boot_V2 (see Figure 10)</td></tr><tr><td rowspan=1 colspan=1>STM32L5, STM32U3, STM32U5, STM32WBA</td><td rowspan=1 colspan=1>Boot_V3_1 (see Figure 11)</td></tr><tr><td rowspan=1 colspan=1>STM32H5</td><td rowspan=1 colspan=1>Boot_V3_2 (see Figure 12)</td></tr><tr><td rowspan=1 colspan=1>Others</td><td rowspan=1 colspan=1>BL_V1</td><td rowspan=1 colspan=1>Boot_V1 (see Figure 10)</td></tr></table>

![](images/dd8f1b8c986426653c6c0f40e58ff9be7e09626d43f54fea667b1e15b670f5ca.jpg)  
Figure 10. Boot_V1 (left) and Boot_V2 (right)

![](images/9353fcc5e0fd05b3b022f46c1a186e251e77914b25f3e25da4953db87a53ff52.jpg)  
Figure 11. Boot_V3_1

![](images/987521a23b8453a5286d054030844e6deaebdd4e1ac05f555090c899bfab2aa9.jpg)  
Figure 12. Boot_V3_2

# 5 STM32C011xx devices

# 5.1 Bootloader configuration

The STM32C011xx bootloader is activated by applying Pattern 11 (see Table 2). Table 10 shows the hardware resources used by this bootloader.

Table 10. STM32c011xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHz (no PLL)</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>3.5 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox1FFF0000 containthe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset if the hardware IWDG option was previouslyenabled by the user.</td></tr><tr><td rowspan=1 colspan=1>Securable memoryarea</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The address to jump to for the securable memory areais 0x1FFF1600</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in inputpull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100100x (x = 0 for write andx = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain pull-up mode</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain pull-up mode</td></tr></table>

Note: On WLCSP12, SO8N, TSSOP20, and UFQFN20 packages USART1 PA9/PA10 IOs are remapped on PA11/PA12.

# 5.2 Bootloader selection

Figure 13 shows the bootloader selection mechanism.

![](images/6eaf39513b323fb3787e4e322f1ddf8bc80b27fa600b38ba7dbc17940b5fa28e.jpg)  
Figure 13. Bootloader V5.x selection for STM32C011xx devices

# 5.3 Bootloader version

Table 11 lists the STM32C011xx devices bootloader versions.

Table 11. STM32C011xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 6

# STM32C031xx devices

# 6.1 Bootloader configuration

The STM32C031xx bootloader is activated by applying Pattern 11 (see Table 2). Table 12 shows the hardware resources used by this bootloader.

Table 12. STM32c031xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHz (no PLL)</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>3.5 Kbytes, starting from address Ox20000000, areused by the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address 0x1FFF0000,contain the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset if the hardware IWDG option waspreviously enabled by the user.</td></tr><tr><td rowspan=1 colspan=1>Securable memoryarea</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The address to jump to for the securable memoryarea is 0x1FFF1600</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used ininput pull-up mode.PA12 pin: remapped to PA10, as this pin does is notavailable on TSOPP20 and UFQFPN28 packages.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.PA11 pin: remapped to PA9, as this pin does is notavailable on TSOPP20 and UFQFPN28 packages.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ONTarget 7-bit address: 0b1100011x (x = 0 for writeand x = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain no pullmode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pullmode.</td></tr></table>

# 6.2 Bootloader selection

Figure 14 shows the bootloader selection mechanism.

![](images/f5bb889d38fae93cef5f69a8fd8c2dd404c55e82f511e3d436d74d7d5506c37f.jpg)  
Figure 14. Bootloader V5.x selection for STM32C031xx devices

# 6.3 Bootloader version

Table 13 lists the STM32C031xx devices bootloader versions.

Table 13. STM32C031xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 7 STM32C051xx devices

# 7.1 Bootloader configuration

The STM32C051xx bootloader is activated by applying Pattern 11 (see Table 2). Table 14 shows the hardware resources used by this bootloader.

Table 14. STM32c051xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common toall</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz, derived directly fromthe HSI</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox2000 0000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox1FFF 0000, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset if thehardware IWDG option was previously enabled by the user.</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF 2E00</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART in reception mode.PA12 pin: as PA10 pin does not exist on WLCSP15,TSSOP20, and UFQFN28, PA12 is remapped to PA10.Used in alternate function with pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART in transmission mode.PA11 pin: as PA9 pin does not exist on WLCSP15,TSSOP20, and UFQFN28, PA11 is to PA9.Kept in reset configuration until Ox7F detected onUSART_RX.</td></tr><tr><td colspan="1" rowspan="4">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatefunction, pull-up mode</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX</td></tr><tr><td colspan="1" rowspan="1">EXTI line 11</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">Used for USART detection. Baudrate calculation is based onthis line interrupt.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1110110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1110110x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Target mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: target data Input line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: target data output line, used in alternate function,pull down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: target clock line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA pin: slave chip select pin used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: Slave data Input line, used in alternate function,pull down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: Slave data output line, used in alternate function,pull down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB13 pin: Slave clock line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in alternate function,pull down mode.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 7.2 Boot model

The bootloader follows boot model V2 (see Section 4.10), there are no specific constraints.

# 7.3 Bootloader selection

Figure 15 shows the bootloader selection mechanism.

![](images/d87ed2b9d5418bbd8c367a4ebd5487f3c5f010e3154cfe62cb8bd6158b2844c8.jpg)  
Figure 15. Bootloader V11.0 selection for STM32C051xx devices

# 7.4 Bootloader version

Table 15 lists the STM32C051xx devices bootloader versions.

Table 15. STM32C051xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V11.0</td><td>Initial bootloader version</td><td>Empty check flag cleared by error on the bootloader startup phase — Root cause: on the startup phase the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Caution: Avoid using reset on this case. if the system crashes, an option byte change or POR is needed to reboot.</td></tr></table>

# STM32C071xx devices

# 8.1 Bootloader configuration

The STM32C071xx bootloader is activated by applying Pattern 11 (see Table 2). Table 14 shows the hardware resources used by this bootloader.

Table 16. STM32c071xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Table To. G TMoz</td><td colspan="1" rowspan="1">oT Txx conng</td><td></td></tr><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common toall</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (no PLL)</td></tr><tr><td colspan="1" rowspan="1">HSI48 enabled</td><td colspan="1" rowspan="1">The clock recovery system (CRS) is enabled for the DFUbootloader so that USB can be clocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8.75 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset if thehardware IWDG option was previously enabled by the user.</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF1600</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin(1): USART1 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin(1: USART1 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Set as input untilUSART2 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1110001x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">P pin: clock line is used in open-drain pulup mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target modeAnalog filter ON Target 7-i des: b1000x  = 0fo writanx = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB0 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1"> ta  s enrai pul </td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Target mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">r  u u ul ull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MISO pin(2)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">   u umode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: target clock line, used in push-pull, pull down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">A pin: slave chip select pin used in push-pull, pull downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: Slave data Input line, used in push-pull, pull downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin(2)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin Slave data output lne, used in push-pull pulldown mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1"> pin Slave clock line, used in push-pull, pull downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_ NSS pin</td><td colspan="1" rowspan="1"> pin slave chip select pin used in push-pul pull downmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode. USB FS interruptvector is enabled and used for USB DFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required.</td></tr></table>

thC pucUSARo A/PA  ace he used for the USB.   
A SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 8.2 Bootloader selection

Figure 15 shows the bootloader selection mechanism.

![](images/831f2c6ed2b9ec6b942951f9078c14f49af927c88860fd3c091dd236611e4a35.jpg)  
Figure 16. Bootloader V13.1 selection for STM32C071xx devices

# 8.3 Bootloader version

Table 15 lists the STM32C071xx devices bootloader versions.

Table 17. STM32C071xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V13.1</td><td>Initial bootloader version byte change or POR is needed to reboot.</td><td>Empty check flag cleared by error on the startup phase - Root cause: during startup the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Avoid using reset on this case. if the system crashes, an option</td></tr></table>

# STM32C091xx/92xx devices

# 9.1 Bootloader configuration

The STM32C091xx/92xx bootloader is activated by applying Pattern 11 (see Table 2).   
Table 14 shows the hardware resources used by this bootloader.

Table 18. STM32C091xx/92xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common toall</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz, derived directly fromthe HSI</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox2000 0000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address 0x1FFF 0000, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset if thehardware IWDG option was previously enabled by the user.</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF 3E00</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART in reception mode.PA12 pin: as PA10 pin does not exist on TSSOP20,WLCSP24, and UFQFN28, PA12 is remapped to PA10.Used in alternate function with pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART in transmission mode.PA11 pin: as PA9 pin does not exist on TSSOP20,WLCSP24, and UFQFN28, PA11 is remapped to PA9.Kept in reset configuration until Ox7F detected onUSART_RX.</td></tr><tr><td colspan="1" rowspan="4">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatefunction, pull-up mode</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX</td></tr><tr><td colspan="1" rowspan="1">EXTI line 3</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">Used for USART detection. Baudrate calculation is based onthis line interrupt.</td></tr><tr><td colspan="1" rowspan="4">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the USART3 configuration is: 8- bits, evenparity and 1 Stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART in reception mode.Used in alternate function with pull-up mode</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART in transmission mode.Kept in reset configuration until Ox7F detected onUSART_RX</td></tr><tr><td colspan="1" rowspan="1">EXTI line 11</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">Used for USART detection. Baudrate calculation is based onthis line interrupt</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ONTa=  for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1"> ata  senra pullm</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode-Analog filter ON Target 7-bit address: 0b1110111x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Target mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: target data Input line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> ruulpull down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: target clock line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1"> pi slave chip select pin use i alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: Slave data Input line, used in alternate function,pull down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: Slave data output line, used in alternate function,pull down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB13 pin: Slave clock line, used in alternate function, pulldown mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in alternate function,pull down mode.</td></tr><tr><td colspan="1" rowspan="3">FDCAN1</td><td colspan="1" rowspan="1">FDCAN</td><td colspan="1" rowspan="1">Enabled(2)</td><td colspan="1" rowspan="1">Once initialized the FDCAN configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS Mode = FDCAN_MODE_NORMAL— AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">FDCAN in reception mode. Used in alternate function withpull up mode.- PB0 for WLCSP24, UFQFN28, UFQFN32, and LQFP32- PD0 for UFQFN48, LQFP48, UFBGA64, and LQFP644</td></tr><tr><td colspan="1" rowspan="1">FDCAN_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">FDCAN in transmission mode. Used in alternate functionwith pull up mode— PB1 for WLCSP24, UFQFN28, UFQFN32, and LQFP32- PD1 for UFQFN48, LQFP48, UFBGA64, and LQFP64</td></tr></table>

SPI CR2 register is set to 0x1, the MiSO line is set to 3.3 V. ny whable ge yo o pacvabl  ge .

# 9.2 Boot model

The bootloader follows boot model V2 (see Section 4.10), there are no specific constraints.

# 9.3 Bootloader selection

Figure 15 shows the bootloader selection mechanism.

![](images/a6a3438ec1d3f6447416608ed08cb29e6aa2fa91f0d2abf63ea4a1238b2eba9d.jpg)  
Figure 17. Bootloader V18.1 selection for STM32C091xx/92xx devices

# 9.4 Bootloader version

Table 15 lists the STM32C091xx/92xx devices bootloader versions.

Table 19. STM32C091xx/92xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V18.1</td><td>Initial bootloader version</td><td>Empty check flag cleared by error on the bootloader startup phase — Root cause: on the startup phase the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Caution: Avoid using reset on this case. if the system crashes, an option byte change or POR is needed to reboot.</td></tr></table>

# 10 STM32F03xx4/6 devices

# 10.1 Bootloader configuration

The STM32F03xx4/6 bootloader is activated by applying Pattern 2 (see Table 2). Table 20 shows the hardware resources used by this bootloader.

Table 20. STM32F03xx4/6 configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHz (using PLL clockedby HSI). 1 flash Wait State.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>3 Kbytes, starting from address Ox1FFFEC00 contain thebootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset if thehardware IWDG option was previously enabled by theuser.</td></tr><tr><td rowspan=3 colspan=1>USART1(on PA10/PA9)</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in input pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART1(on PA14/PA15)</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA15 pin: USART1 in reception mode. Used in input pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA14 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1s</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from thehost.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# Note:

After the STM32F03xx4/6 device has booted in bootloader mode, serial wire debug (SWD) communication is no longer possible until the system is reset. This is because the SWD uses the PA14 pin (SWCLK), already used by the bootloader (USART1_TX).

# 10.2 Bootloader selection

Figure 18 shows the bootloader selection mechanism.

![](images/b78c3baba0c06cbc4420e0a3daa675f410e750de2e92f649d622387c39071ae2.jpg)  
Figure 18. Bootloader selection for STM32F03xx4/6 devices

# 10.3 Bootloader version

Table 21 lists the STM32F03xx4/6 devices bootloader versions.

Table 21. STM32F03xx4/6 bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V1.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>For the USART interface, two consecutive NACKsinstead of one are sent when a Read Memory orWrite Memory command is sent and the RDP level isactive.</td></tr></table>

# 11 STM32F030xC devices

# 11.1 Bootloader configuration

The STM32F030xC bootloader is activated by applying Pattern 2 (see Table 2). Table 22 shows the hardware resources used by this bootloader.

Table 22. STM32F030xC configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 48 MHz with HSI 8 MHzas clock source.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address Ox1FFFD800, containthe bootloader firmware.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in inputpull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2(on PA2/PA3)</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>On nitialized, theconfiguration s  ven py,and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in input pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2(on PA14/PA15)</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA15 pin: USART2 in reception mode. Used in inputpull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA14 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ONTarget 7-bit address: 0b1000001x (x = 0 for write andx = 1 for read</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1> clock lne is used inopen-drain o pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pull mode.</td></tr></table>

#

After the devices have booted in bootloader mode using USART2, the serial wire debug (SWD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 11.2 Bootloader selection

Figure 19 shows the bootloader selection mechanism.

![](images/8a16ec94c806f677d7260e851a914d70301802d7aebb2f453ea8d7d171b1f00c.jpg)  
Figure 19.Bootloader selection for STM32F030xC

# 11.3 Bootloader version

Table 23 lists the STM32F030xC devices bootloader versions.

Table 23. STM32F030xC bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>PA13 is set in input pull-up mode even if not usedby the bootloader</td></tr></table>

# 12 STM32F05xxx and STM32F030x8 devices

# 12.1 Bootloader configuration

The STM32F05xxx and STM32F030x8 devices bootloader is activated by applying Pattern 2 (described in Table 2). Table 24 shows the hardware resources used by this bootloader.

Table 24. STM32F05xx and STM32F030x8 devices configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHz (usingPLL clocked by HSI).1 flash Wait State.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address Ox20000000,are used by the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>3 Kbytes, starting from address Ox1FFFEC00,contain the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to itsmaximum value. It is periodically refreshed toprevent watchdog reset if the hardware IWDGoption was previously enabled by the user.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Usedin alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configuration is 8bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA15 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA14 pin: USART2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baudrate from the host.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# Note:

After the STM32F05xxx and STM32F030x8 devices have booted in bootloader mode, the serial wire debug (SWD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_TX).

# 12.2 Bootloader selection

Figure 20 shows the bootloader selection mechanism.

# Figure 20. Bootloader selection for STM32F05xxx and STM32F030x8 devices

![](images/2b9c69917ba8bd1b056392fc0cf28204e4b928f51571ab5fe5d1a4ba0db51971.jpg)

# 12.3 Bootloader version

Table 25 lists the STM32F05xxx and STM32F030x8 devices bootloader versions.

Table 25. STM32F05xxx and STM32F030x8 devices bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V2.1</td><td>Initial bootloader version</td><td>At bootloader startup, the HSITRIM value is set to 0 (in HSITRIM bits on RCC_CR register) instead of default value (16), as a consequence a deviation is generated in crystal measurement. For better results, use the smallest supported crystal value (i.e. 4 MHz). - For the USART interface, two consecutive NACKs instead of 1 NACK are sent when a Read Memory or Write Memory command is sent and the RDP level is active. - PA13 is set in input pull-up mode even if not used by the Bootloader.</td></tr></table>

# 13 STM32F04xxx devices

# 13.1 Bootloader configuration

The STM32F04xxx bootloader is activated by applying Pattern 6 (described in Table 2).   
Table 26 shows the hardware resources used by this bootloader.

Table 26. STM32F04xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 48 MHz with HSI48 48 MHzas clock source.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The clock recovery system (CRS) is enabled for the DFU toallow USB to be clocked by HSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">13 Kbytes, starting from address 0x1FFFC400, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA14 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0111110x (x = 0 for write and x = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP lineNo external pull-up resistor is required. Used in alternatepush-pull, no pull mode.</td></tr></table>

Note:

After the devices have booted in bootloader mode using USART2, the serial wire debug (SWD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

Note:

Due to empty check mechanism present on these products, it is not possible to jump from user code to system bootloader. Such jump goes back to user flash memory space. If the first four bytes of user flash (at 0x0800 0000) are empty at the moment of jump (that is, erase first sector before jump or execute code from SRAM while flash is empty), the system bootloader is executed when jumped to. To jump to the bootloader one of the following three conditions must be fulfilled

- First four bytes of UserFlash = OxFFFFFFFF   
- Boot_SW = 0   
- PB8 or PF11 State = 1 PB8 for packages LQFP32 and lower (except QFN32) PF11 for packages QFN32 and higher (except LQFP32)

# 13.2 Bootloader selection

Figure 21 shows the bootloader selection mechanism.

![](images/a930a19173192675a1f7e0157a71874534c7fff4dcdebcf36b07c184b92c5f9d.jpg)  
Figure 21. Bootloader selection for STM32F04xxx

# 13.3 Bootloader version

Table 27. STM32F04xxx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V10.0</td><td>Initial bootloader version</td><td rowspan="3">- At bootloader startup, the HSITRIM value is set to 0 (in HSITRIM bits on RCC_CR register) instead of default value (16), as a consequence a deviation is generated in crystal measurement. For better results, use the smallest supported crystal value (4 MHz). PA13 is set in input pull-up mode even if not used by the bootloader. - USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. De-synchronization between USB controller and bootloader SW due to the controller</td></tr><tr><td>V10.1</td><td>Root causes: Add dynamic support of high speed transactions. Controller high speed inter-packet delay seems not sufficient USART/USB for the bootloader SW (based on interrupt routines) to serve all needed transactions interfaces on (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This Workarounds:</td></tr><tr><td>PA11/12 IOs for small packages</td><td>results in a communication fail, causing Write command to fail. Add USB HUB between host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay. On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 14 STM32F070x6 devices

# 14.1 Bootloader configuration

The STM32F070x6 bootloader is activated by applying Pattern 6 (described in Table 2).   
Table 28 shows the hardware resources used by this bootloader.

Table 28. STM32F070x6 configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>Common to all</td><td rowspan=3 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>At startup, the system clock frequency is configured to 48MHz using the HSI. If an external clock (HSE) is notpresent, the system is kept clocked from the HSI.</td></tr><tr><td rowspan=1 colspan=1>HSE enabled</td><td rowspan=1 colspan=1>The external clock can be used for all bootloader interfacesand must have one of the following values: 24, 18, 16, 12,86 4 MHz. The PLL is used to generate 48 MHz for USBand system clock.</td></tr><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The CSS interrupt is enabled for HSE. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>13 Kbytes, starting from address 0x1FFFC400, contain thebootloader firmware.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA15 pin: USART2 in reception mode</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA14 pin: USART2 in transmission mode</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address, Target mode- Analog filter ON- Target 7-bit address: 0b011110x x = 0 for write and x = 1for read</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain mode.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB FS configured in forced device mode. USB FSinterrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA11 pin: USB FS DM line</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>PA12 pin: USB FS DP line.No external pull-up resistor is required.</td></tr></table>

#

If HSI deviation exceeds 1% the bootloader might not function correctly.

Note:

After the STM32F070x6 devices have booted in bootloader mode using USART2, the serial wire debug (SwD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The bootloader has two cases of operation depending on the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 8, 6, or 4 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1, USART2, and I2C1 are functional and can be used to communicate with the bootloader device.   
If HSE is not present, the HSI is kept as default clock source and only USART1, USART2, and I2C1 are functional.

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# Note:

Due to empty check mechanism present on this product, it is not possible to jump from user code to system bootloader. Such jump results in a jump back to user flash space, but if the first four bytes of user flash (at Ox0800 0000) are empty at the moment of jump (i.e. erase first sector before jump or execute code from SRAM while flash is empty), then system bootloader is executed when jumped to.

# 14.2 Bootloader selection

Figure 22 shows the bootloader selection mechanism.

![](images/8b9fc0f6bdc6e5d175e985fd2f6b5cf962474a47e71c9c2bbcae76f66798c72a.jpg)  
Figure 22. Bootloader selection for STM32F070x6

# 14.3 Bootloader version

Table 29 lists the STM32F070x6 devices bootloader versions.

Table 29. STM32F070x6 bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V10.2</td><td>Initial bootloader version</td><td rowspan="2">— At bootloader startup, the HSITRIM value is set to 0 (in HSITRIM bits on RCC_CR register) instead of default value (16), as a consequence a deviation is generated in crystal measurement. For better results, use the smallest supported crystal value (4 MHz). - USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes:</td></tr><tr><td>V10.3</td><td>De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay Clock configuration seems not sufficient for the bootloader SW (based on interrupt routines) to fixed to HSI 8 MHz serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add USB HUB between host and the MCU. This relaxes transactions inter- packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay. On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 15 STM32F070xB devices

# 15.1 Bootloader configuration

The STM32F070xB bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 30 shows the hardware resources used by this bootloader.

Table 30. STM32F070xB configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">At startup, the system clock frequency is configured to 48MHz using the HSI. If an external clock (HSE) is notpresent, the system is kept clocked from the HSI.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock can be used for all bootloader interfacesand must have one of the following values: 24, 18, 16, 12,8,6, 4 MHz. The PLL is used to generate 48 MHz for USBand system clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The clock security system (CSS) interrupt is enabled forHSE. Any failure (or removal) of the external clockgenerates a system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address 0x1FFFC800, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input pullup mode</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA14 pin: USART2 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0111011x (x = 0 for write and x =1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode. USB FSinterrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB FS DM line used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB FS DP line used in alternate push-pull, nopull mode. No external pull-up resistor is required.</td></tr></table>

Note: If HSI deviation exceeds 1% the bootloader might not function correctly.

Note:

After the devices have booted in bootloader mode using USART2, the serial wire debug (SWD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The bootloader has two cases of operation depending on the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 8, 6, or 4 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1, USART2, and I2C1 are functional and can be used to communicate with the bootloader device.   
If HSE is not present, the HSI is kept as default clock source and only USART1, USART2, and I2C1 are functional.

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# 15.2 Bootloader selection

Figure 23 shows the bootloader selection mechanism.

![](images/f47bcdd754ba9cca6f624bcf5760ea28997d095521a247506bf2b47323b237b5.jpg)  
Figure 23.Bootloader selection for STM32F070xB

# 15.3 Bootloader version

Table 31 lists the STM32F070xB devices bootloader versions.

Table 31. STM32F070xB bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V10.2</td><td>Initial bootloader version</td><td rowspan="2">- At bootloader startup, the HSITRIM value is set to 0 (in HSITRIM bits on RCC_CR register) instead of default value (16), as a consequence a deviation is generated in crystal measurement. For better results, use the smallest supported crystal value (4 MHz). PA13 is set in alternate push-pull mode even if not used by the bootloader. USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes:</td></tr><tr><td>V10.3</td><td>Clock configuration fixed to HSI 8 MHz</td></tr></table>

# 16 STM32F071xx/072xx devices

# 16.1 Bootloader configuration

The STM32F071xx/072xx bootloader is activated by applying Pattern 2 (described in Table 2). Table 32 shows the hardware resources used by this bootloader.

Table 32. STM32F071xx/072xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 48 MHz with HSI48 48 MHzas clock source.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox1FFFC800, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: USART2 in reception mode. Used in input pull-upmode</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA14 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address, Target mode- Analog filter ON- Target 7-bit address: 0b0111011x (x = 0 for write and x = 1for ead)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 p:data lie is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP lineNo external pull-up resistor is required. Used in alternatepush-pull, no pull mode.</td></tr></table>

After the devices have booted in bootloader mode using USART2, the serial wire debug (SWD) communication is no more possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 16.2 Bootloader selection

Figure 24 shows the bootloader selection mechanism.

![](images/01163e99890d43c91cb49230ddc0ea87e492a461baf6eb9d4e61c8b8d15afda6.jpg)  
Figure 24. Bootloader selection for STM32F071xx/072xx

# 16.3 Bootloader version

Table 33 lists the STM32F071xx/072xx devices bootloader versions.

Table 33. STM32F071xx/072xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V10.1</td><td>Initial bootloader version</td><td>- At bootloader startup, the HSITRIM value is set to (0) (in HSITRIM bits on RCC_CR register) instead of default value (16), as a consequence a deviation is generated in crystal measurement. For better results, use the smallest supported crystal value (4 MHz). PA13 set in alternate push-pull, pull-up mode even if not used by bootloader. USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add USB HUB between host and the MCU. This relaxes transactions inter-packet</td></tr></table>

#

# STM32F09xxx devices

# 17.1 Bootloader configuration

The STM32F09xxx bootloader is activated by applying Pattern 6 (described in Table 2). Table 34 shows the hardware resources used by this bootloader.

Table 34. STM32F09xxx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Commonto all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 48 MHz with HSI48 48 MHz asclock source.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address Ox1FFFD800, contain thebootloader firmware.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in input pull-upmode</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=5 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=2 colspan=1>USART2_RX pin</td><td rowspan=2 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td rowspan=1 colspan=1>PA15 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td rowspan=2 colspan=1>USART2_TX pin</td><td rowspan=2 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>PA14 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from the hostfor USARTx.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode-Analog filter ONTarget 7-bit address: 0b1000001x (x = 0 for write and x = 1 frread</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pull mode.</td></tr></table>

#

After the devices have booted in bootloader mode using USART2, the serial wire debug (SWD) communication is no longer possible until the system is reset, because SWD uses PA14 pin (SWCLK), already used by the bootloader (USART2_RX).

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 17.2 Bootloader selection

![](images/bd02c3cf7c32e6dfa03aa417e826898f12cc4ba62f0b0d4d55494e9569ce5491.jpg)  
Figure 25. Bootloader selection for STM32F09xxx

# 17.3 Bootloader version

Table 35 lists the STM32F09xxx devices bootloader versions.

Table 35. STM32F09xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloaderversion</td><td rowspan=1 colspan=1>At bootloader startup, the HSITRIM value is set to 0 in HSITRIM bitson RCC_CR register instead of default value (16). As a consequence,a deviation is generated in crystal measurement. For better results,use the smallest supported crystal value (4 MHz).PA13 set in input pull-up mode even if not used by the bootloader.</td></tr></table>

# 18 STM32F10xxx devices

# 18.1 Bootloader configuration

The STM32F10xxx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 36 shows the hardware resources used by this bootloader.

Table 36. STM32F10xxx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHz using the PLL.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>512 byte starting from address Ox20000000, are usedby the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address Ox1FFFF000 containthe bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum valueand is periodically refreshed to prevent watchdog reset(if the hardware IWDG option was previously enabledby the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output push-pull</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate fromthe host.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 18.2 Bootloader selection

Figure 26 shows the bootloader selection mechanism.

![](images/9132ecc3ec4e3d032985eba72569a902a8f1e2c75fd26bd0e09c169fcce7c250.jpg)  
Figure 26. Bootloader selection for STM32F10xxx

# 18.3 Bootloader version

Table 37 lists the STM32F10xxx devices bootloader versions:

Table 37. STM32F10xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td></tr><tr><td rowspan=1 colspan=1>V2.0</td><td rowspan=1 colspan=1>Initial bootloader version</td></tr><tr><td rowspan=1 colspan=1>V2.1</td><td rowspan=1 colspan=1>— Updated Go Command to initialize the main stack pointer- Updated Go command to return NACK when jump address is in the Option bytearea or System memory area— Updated Get ID command to return the device ID on two bytes Update the bootloader version to V2.1</td></tr><tr><td rowspan=1 colspan=1>V2.2</td><td rowspan=1 colspan=1>-Updated Read Memory, Write Memory and Go commands to deny access witha NACK response to the first Ox200 bytes of RAM used by the bootloader Updated Readout Unprotect command to initialize the whole RAM content to0x0 before ROP disable operation</td></tr></table>

# Note:

The bootloader ID format is applied to all STM32 devices except the STM32F1xx devices. The bootloader version for the STM32F1xx applies only to the embedded device's bootloader version and not to its supported protocols.

# 19

# STM32F105xx/107xx devices

# 19.1 Bootloader configuration

The STM32F105xx/107xx bootloader is activated by applying Pattern 1 (described in Table 2). Table 38 shows the hardware resources used by this bootloader.

Table 38. STM32F105xx/107xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz using the PLL.This is used only for USARTx and during CAN2, USBdetection for CAN and DFUs (once CAN or DFU isselected, the clock source is derived from the externalcrystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock is mandatory only for DFU and CANbootloaders and it must provide one of the followingfrequencies: 8 MHz, 14.7456 MHz or 25 MHz.For CAN bootloader, the PLL is used only to generate48 MHz when 14.7456 MHz is used as HSE.For DFU, the PLL is used to generate a 48 MHz systemclock from all supported external clock frequencies.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs.Any failure (or removal) of the external clock willgenerate system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">18 Kbytes, starting from address Ox1FFFB000 containthe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum valueand is periodically refreshed to prevent watchdog reset(if the hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output push-pull</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in inputno pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits,even parity, and one stop bit. The USART2 uses itsremapped pins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 receive (remapped pin)</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output push-pull</td><td colspan="1" rowspan="1">PD5 pin: USART2 transmit (remapped pin)</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate fromthe host for USARTx bootloader.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the CAN2 configuration is baudrate 125kbps, 11-bit identifier.Note: CAN1 is clocked during the CAN bootloaderexecution because CAN1 manages the communicationbetween CAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 receives (remapped pin). Used inalternate push-pull, pul-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output push-pull</td><td colspan="1" rowspan="1">PB6 pin: CAN2 transmits (remapped pin). Used in inputno pull mode.</td></tr><tr><td colspan="1" rowspan="4">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_VBUS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA9: Power supply voltage line</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB_DM line</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB_DP line.No external pull-up resistor is required</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx bootloader. This internal clock is used also for DFU and CAN bootloaders, but only for the selection phase. An external clock (8, 14.7456, or 25 MHz) is required for DFU and CAN bootloader execution after the selection phase.

# 19.2 Bootloader selection

Figure 27 shows the bootloader selection mechanism.

![](images/cd29a62d3e54233b334e8617309a46f8eb9ee4e7a2c9c7ea3dde21b9da533a66.jpg)  
Figure 27. Bootloader selection for STM32F105xx/107xx devices

# 19.3 Bootloader version

Table 39 lists the STM32F105xx/107xx devices bootloader versions:

Table 39. STM32F105xx/107xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td></tr><tr><td rowspan=1 colspan=1>V1.0</td><td rowspan=1 colspan=1>Initial bootloader version</td></tr><tr><td rowspan=1 colspan=1>V2.0</td><td rowspan=1 colspan=1>Bootloader detection mechanism updated to fix the issue when GPlOs ofunused peripherals in this bootloader are connected to low level or left floatingduring the detection phase. For more details refer to Section 19.3.2.- Vector table set to Ox1FFFB000 instead of 0x00000000- Go command updated (for all bootloaders): USART1, USART2, CAN2,GPIOA, GPIOB, GPIOD and SysTick peripheral registers are set to theirdefault reset values- DFU: USB pending interrupt cleared before executing the Leave DFUcommand- DFU subprotocol version changed from V1.0 to V1.2- Bootloader version updated to V2.0</td></tr><tr><td rowspan=1 colspan=1>V2.1</td><td rowspan=1 colspan=1>- Fixed PA9 excessive consumption described in Section 19.3.4.- Get-Version command (defined in AN3155) corrected. It returns 0x22 insteadof Ox20 in bootloader V2.0. Refer to Section 19.3.3 for more details. Bootloader version updated to V2.1</td></tr><tr><td rowspan=1 colspan=1>V2.2</td><td rowspan=1 colspan=1> Fixed DFU option bytes descriptor (set to &#x27;e&#x27; instead of &#x27;g&#x27; because it isread/write and not erasable).— Fixed DFU polling timings for flash Read/Write/Erase operations. Robustness enhancements for DFU interface.— Updated bootloader version to V2.2.</td></tr></table>

Note:

The bootloader ID format is applied to all STM32 devices except the STM32F1xx products. The version for STM32F1xx applies only to the embedded device's bootloader version and not to its supported protocols.

# 19.3.1 How to identify STM32F105xx/107xx bootloader versions

Bootloader V1.0 is implemented on devices whose date code is lower than 937. Bootloader V2.0 and V2.1 are implemented on devices with a date code higher than or equal to 937. Bootloader V2.2 is implemented on devices with a date code higher than or equal to 227.

Refer to the datasheets to find the date code on the device marking)

There are two ways to distinguish between bootloader versions: When using the USART bootloader, the Get-Version command defined in AN3155 has been corrected in V2.1 version. It returns 0x22 instead of 0x20 as in bootloader V2.0. The values of the vector table at the beginning of the bootloader code are different. The user software (or via JTAG/SWD) reads 0x1FFFE945 at address 0x1FFFB004 for bootloader V2.0 0x1FFFE9A1 for bootloader V2.1, and Ox1FFFE9C1 for bootloader V2.2.

The DFU version can be read through the bcdDevice field of the DFU Device Descriptor:

V2.1 in bootloader V2.1 V2.2 in bootloader V2.2.

# 9.3.2 Bootloader unavailability on STM32F105xx/STM32F107xx devices with date code lower than 937

# Description

The bootloader cannot be used if the USART1_RX (PA10), USART2_RX (PD6, remapped), CAN2_Rx (PB5, remapped), OTG_FS_DM (PA11), and/or OTG_FS_DP (PA12) pin(s) are held low or left floating during the bootloader activation phase.

The bootloader cannot be connected through CAN2 (remapped), DFU (OTG FS in Device mode), USART1 or USART2 (remapped).

On 64-pin packages, the USART2_RX signal remapped PD6 pin is not available and it is internally grounded. In this case, the bootloader cannot be used at all.

# Workaround

For 64-pin packages   
None. The bootloader cannot be used.   
For 100-pin packages   
Depending on the used peripheral, the pins for the unused peripherals must be kept at a high level during the bootloader activation phase as described below: If USART1 is used to connect to the bootloader, PD6 and PB5 must be kept at a high level.   
If USART2 is used to connect to the bootloader, PA10, PB5, PA11, and PA12 must be kept at a high level.   
If CAN2 is used to connect to the bootloader, PA10, PD6, PA11, and PA12 must be kept at a high level.   
If DFU is used to connect to the bootloader, PA10, PB5, and PD6 must be kept at a high level.

Note:

This limitation applies only to STM32F105xx and STM32F107xx devices with a date code lower than 937. STM32F105xx and STM32F107xx devices with a date code higher or equal to 937 are not impacted. See STM32F105xx and STM32F107xx datasheets for where to find the date code on the device marking.

# 9.3.3 USART bootloader Get-Version command returns Ox20 instead of 0x22

# Description

In USART mode, the Get-Version command (defined in AN3155) returns Ox20 instead of 0x22. This limitation is present on bootloader versions V1.0 and V2.0, while it is fixed in bootloader version 2.1.

# Workaround

None.

# 19.3.4 PA9 excessive power consumption when USB cable is plugged in bootloader V2.0

# Description

When connecting a USB cable after booting from System-Memory mode, PA9 pin (connected to VBUs = 5 V) is also shared with USART TX pin, configured as alternate push-pull and forced to 0 since the USART peripheral is not yet clocked. As a consequence, a current higher than 25 mA is drained by PA9 l/O and may affect the l/O pad reliability.

This limitation is fixed in bootloader version 2.1 by configuring PA9 as alternate function push-pull when a correct Ox7F is received on RX pin and the USART is clocked. Otherwise, PA9 is configured as alternate input floating.

# Workaround

None.

#

# STM32F10xxx XL-density devices

# 20.1 Bootloader configuration

The STM32F10xxx XL-density bootloader is activated by applying Pattern 3 (described in Table 2). Table 40 shows the hardware resources used by this bootloader.

Table 40. STM32F10xxx XL-density configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 24 MHzusing the PLL.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address0x1FFFE000 contain the bootloaderfirmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to itsmaximum value and is periodicallyrefreshed to prevent watchdog reset (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode.Used in input pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output push-pull</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PD6 pin: USART2 receives (remappedpins). Used in input pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output push-pull</td><td rowspan=1 colspan=1>PD5 pin: USART2 transmits (remappedpins). Used in alternate push-pull, pull-upmode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baudrate from the host.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 20.2 Bootloader selection

![](images/1c9fd43c59aa3d826f112ad346be6c15fda8b7b47e57b4b7bbf4ad7fe8e54b00.jpg)  
Figure 28. Bootloader selection for STM32F10xxx XL-density devices

# 20.3 Bootloader version

Table 41. STM32F10xxx XL-density bootloader versions   

<table><tr><td>Version number</td><td>Description</td></tr><tr><td>V2.1</td><td>Initial bootloader version</td></tr></table>

Note:

The bootloader ID format is applied to all STM32 devices families except the STM32F1xx family. The bootloader version for the STM32F1xx applies only to the embedded device bootloader version and not to its supported protocols.

# 21 STM32F2xxxx devices

Two bootloader versions are available on STM32F2xxxx devices:

V2.x supporting USART1 and USART3   
This version is embedded in revisions A, Z, and B   
V3.x supporting USART1, USART3, CAN2, and DFU (USB FS device) This version is embedded in all other revisions (Y, X, W, 1, V, 2, 3, and 4)

# 21.1 Bootloader V2.x

# 21.1.1 Bootloader configuration

The STM32F2xxxx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 42 shows the hardware resources used by this bootloader.

Table 42. STM32F2xxxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox20000000.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value andis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed).The voltage range can be configured in run time usingbootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPC10/PC11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader code.

# 21.1.2 Bootloader selection

Figure 29 shows the bootloader selection mechanism.

![](images/811c96bbdc20cf2a9a5de298c33d1a736fb21bfbc56eb3f86f1ffe7f71647571.jpg)  
Figure 29. Bootloader V2.x selection for STM32F2xxxx devices

# 21.1.3 Bootloader version

Table 43 lists the STM32F2xxxx devices V2.x bootloader versions:

Table 43. STM32F2xxxx bootloader V2.x versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V2.0</td><td>Initial bootloader version</td><td>When a Read Memory command or Write Memory command is issued with an unsupported memory address and a correct address checksum (i.e. address Ox6000 0000), the command is aborted by the bootloader device, but the NACK (0x1F) is not sent to the host. As a result, the next two bytes (the number of bytes to be read/written and its checksum) are considered as a new command and its checksum. For the CAN interface, the Write Unprotect command is not functional. Use Write Memory command and write directly to the option bytes in order to disable the write protection.(1</td></tr></table>

e   at  " -toe e/wie is ot equal  valc co x00, x01x0, 0, 0x21, 0x31, 0x43, 0x44, 0x63, 0x73, 0x82 or 0x92), the limitation is not perceived from the host, as the command is NACK-ed anyway (as an unsupported new command).

# 21.2 Bootloader V3.x

# 21.2.1 Bootloader configuration

The STM32F2xxxx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 44 shows the hardware resources used by this bootloader.

Table 44. STM32F2xxxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Tabic 4. O T Mo2l 2</td><td colspan="1" rowspan="1">xxxx co1gc</td><td></td></tr><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz using the PLL.The HSI clock source is used at startup (interface detectionphase) and when USARTx interfaces are selected (onceCAN or DFU is selected, the clock source is derived fromthe external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the CAN or theDFU (USB FS device) interfaces are selected.The external clock must provide a frequency multiple of1 MHz and ranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address 0x1FF00000 contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to 1.62 V, 2.1 V. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed).The voltage range can be configured in run time usingbootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in pull-upmode</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in pull-upmode</td></tr><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPC10/PC11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the CAN2 configuration is: Baudrate125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in inpt no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# 21.2.2 Bootloader selection

Figure 30 shows the bootloader selection mechanism.

![](images/1e9a5b2bb26911c7e476e0f0e0659f262b8d698bd799d367b9b00aba3d5b92ff.jpg)  
Figure 30. Bootloader V3.x selection for STM32F2xxxx devices

MS35011V1

# 21.2.3 Bootloader version

Table 45 lists the STM32F2xxxx devices V3.x bootloader versions:

Table 45. STM32F2xxxx bootloader V3.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V3.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- When a Read Memory command or Write Memorycommand is issued with an unsupported memoryaddress and a correct address checksum (i.e. address0x6000 0000), the command is aborted by the bootloaderdevice, but the NACK (0x1F) is not sent to the host. As aresult, the next two bytes (which are the number of bytesto be read/written and its checksum) are considered as anew command and its checksum(1).Option bytes, OTP and Device Feature descriptors (inDFU interface) are set to &quot;g&quot; instead of &quot;e&quot; (not erasablememory areas).</td></tr><tr><td rowspan=1 colspan=1>V3.3</td><td rowspan=1 colspan=1>Fix V3.2 limitations. DFUinterface robustnessenhancement</td><td rowspan=1 colspan=1>- For the USART interface, two consecutive NACKs(instead of 1 NACK) are sent when a Read Memory orWrite Memory command is sent and the RDP level isactive.- For the CAN interface, the Write Unprotect command isnot functional. Use Write Memory command and writedirectly to the option bytes in order to disable the writeprotection.</td></tr></table>

e e ata- -to erea/wries oequal  a val c co (x00, 0x010, 0x11, 0x21, 0x31, 0x43, 0x44, 0x63, 0x73, 0x82 or 0x92), the limitation is not perceived from the host, as the command is NACK-ed anyway (as an unsupported new command).

# 22 STM32F301xx/302x4(6/8) devices

# 22.1 Bootloader configuration

The STM32F301xx/302x4(6/8) bootloader is activated by applying Pattern 2 (described in Table 2). Table 46 shows the hardware resources used by this bootloader.

Table 46. STM32F301xx/302x4(6/8) configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 48 MHz with HSI48 48 MHzas clock source.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="2" rowspan="1">The external clock can be used for all bootloader interfacesand must have one the following values:24,18,16,12,9,8,6,4,3 MHz.The PLL is used to generate the USB48 MHz clock and the48 MHz clock for the system clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="2" rowspan="1">The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="2" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="2" rowspan="1">8 Kbytes, starting from address 0x1FFFD800, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="2" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="2" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="2" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="2" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="2" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td rowspan="4">DFU</td><td>USB</td><td>Enabled</td><td>USB used in FS mode</td></tr><tr><td>USB_DM pin</td><td rowspan="3">Input/output</td><td>PA11: USB DM line. Used in alternate push-pull, no pull mode.</td></tr><tr><td>USB_DP pin</td><td>mode.</td><td>PA12: USB DP line. Used in alternate push-pull, no pull</td></tr><tr><td></td><td>USB_DP pin.</td><td>An external pull-up resistor 1.5 KΩ must be connected to</td></tr></table>

The bootloader has two cases of operation, depending upon the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 9, 8, 6, 4, or 3 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1 and USART2 are functional and can be used to communicate with the bootloader device.   
If HSE is not present, the HSI is kept as default clock source, and only USART1 and USART2 are functional.

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# 22.2 Bootloader selection

Figure 31 shows the bootloader selection mechanism.

![](images/2e2919f0043776807ff62e5beb3318f786624cab592c0c5a283b377d0074a327.jpg)  
Figure 31. Bootloader selection for STM32F301xx/302x4(6/8)

MS35027V1

# 22.3 Bootloader version

Table 47 lists the STM32F301xx/302x4(6/8) devices bootloader versions:

Table 47. STM32F301xx/302x4(6/8) bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.0</td><td>Initial bootloader version</td><td>- USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add USB HUB between host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay. On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 23 STM32F302xB(C)/303xB(C) devices

# 23.1 Bootloader configuration

The STM32F302xB(C)/303xB(C) bootloader is activated by applying Pattern 2 (described in Table 2). Table 48 shows the hardware resources used by this bootloader.

Table 48. STM32F302xB(C)/303xB(C) configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">At startup, the system clock frequency is configured to 48MHz using the HSI. If an external clock (HSE) is notpresent, the system is kept clocked from the HSI.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock can be used for all bootloaderinterfaces and must have one the following values: 24,18,16, 12, 9, 8, 6, 4, 3 MHz.The PLL is used to generate the USB 48 MHz clock andthe 48 MHz clock for the system clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox1FFFD800, containsthe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum valueand is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit. The USART2 uses its remappedpins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx bootloader.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pulmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode.An external pull-up resistor 1.5 KΩ must be connected toUSB_DP pin.</td></tr></table>

The bootloader has two cases of operation depending on the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 9, 8, 6, 4 or 3 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1 and USART2 are functional and can be used to communicate with the bootloader device.   
If HSE is not present, the HSI is kept as default clock source, and only USART1 and USART2 are functional.

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# 23.2 Bootloader selection

Figure 32 shows the bootloader selection mechanism.

![](images/01c8bc41a3beed872de41c531c2a47d00526f1b1d66c51eb5cd50887b9482467.jpg)  
Figure 32. Bootloader selection for STM32F302xB(C)/303xB(C) devices

# 23.3 Bootloader version

Table 49 lists the STM32F302xB(C)/303xB(C) devices bootloader versions.

Table 49. STM32F302xB(C)/303xB(C) bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V4.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# STM32F302xD(E)/303xD(E) devices

# 24.1 Bootloader configuration

The STM32F302xD(E)/303xD(E) bootloader is activated by applying Pattern 2 (described in Table 2). Table 50 shows the hardware resources used by this bootloader.

Table 50.STM32F302xD(E)/303xD(E) configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=6 colspan=1>Common to all</td><td rowspan=3 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 48 MHz with HSI48 48 MHzas clock source.</td></tr><tr><td rowspan=1 colspan=1>HSE enabled</td><td rowspan=1 colspan=1>The external clock can be used for all bootloaderinterfaces and must have one the following values: 24, 18,16, 12, 9, 8, 6, 4, 3 MHz.The PLL is used to generate the USB 48 MHz clock andthe 48 MHz clock for the system clock.</td></tr><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address 0x1FFFD800, contain thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB FS configured in forced device mode. USB FSinterrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA11 pin: USB FS DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>PA12 pin: USB FS DP line. Used in alternate push-pull, nopull mode. An external pull-up resistor 1.5 KΩ must beconnected to USB_DP pin.</td></tr></table>

The bootloader has two cases of operation depending on the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 9, 8, 6, 4 or 3 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1 and USART2 are functional and can be used to communicate with the bootloader device.   
If HSE is not present, the HSI is kept as default clock source, and only USART1 and USART2 are functional.

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# 24.2 Bootloader selection

![](images/2f54611142e0572595bad9de64e001691945c25d704434c480cf46e053b9f303.jpg)  
Figure 33. Bootloader selection for STM32F302xD(E)/303xD(E)

# 24.3 Bootloader version

Table 51. STM32F302xD(E)/303xD(E) bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.0</td><td>Initial bootloader version</td><td>- The USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add an USB HUB between the host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay.</td></tr></table>

# 25 STM32F303x4(6/8)/334xx/328xx devices

# 25.1 Bootloader configuration

The STM32F303x4(6/8)/334xx/328xx bootloader is activated by applying Pattern 2 (described in Table 2). Table 52 shows the hardware resources used by this bootloader.

Table 52. STM32F303x4(6/8)/334xx/328xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 60 MHz with HSI 8 MHzas clock source.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address 0x1FFFD800, containthe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bit address, Target mode,Analog filter ON Target 7-bit address: Ob0111111x (x = 0for write and x = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 25.2 Bootloader selection

Figure 34 shows the bootloader selection mechanism.

![](images/e34e7a6e08d779de89565288d453dd43345851f5e425cc7ba3c1f6c5a724cbf5.jpg)  
Figure 34. Bootloader selection for STM32F303x4(6/8)/334xx/328xx

# 25.3 Bootloader version

Table 53 lists the STM32F303x4(6/8)/334xx/328xx devices bootloader versions:

Table 53. STM32F303x4(6/8)/334xx/328xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 26 STM32F318xx devices

# 26.1 Bootloader configuration

The STM32F318xx bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 54 shows the hardware resources used by this bootloader.

Table 54. STM32F318xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz with HSI 8 MHz asclock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address 0x1FFFD800, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value,and periodically refreshed to prevent a reset (if the hardwareIWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b0111101x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain o pull mode.</td></tr><tr><td rowspan="4">I2C3</td><td>I2C3</td><td>Enabled</td><td>The I2C3 configuration is: - I2C speed: up to 400 kHz - 7-bit address - Target mode</td></tr><tr><td></td><td rowspan="2"></td><td colspan="1">- Analog filter ON - Target 7-bit address: 0b0111101x (x = 0 for write and x = 1 for read) and digital filter disabled.</td></tr><tr><td>I2C3_SCL pin</td><td colspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td></td><td rowspan="2">Input/output</td><td colspan="1"></td></tr><tr><td>I2C3_SDA pin</td><td colspan="1">PB5 pin: data line is used in open-drain no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 26.2 Bootloader selection

![](images/a940322af5bd50a74620f698965b8ada5b740499e233e6d918795a0b8aeda3ee.jpg)  
Figure 35. Bootloader selection for STM32F318xx

# 26.3 Bootloader version

Table 55. STM32F318xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 27 STM32F358xx devices

# 27.1 Bootloader configuration

The STM32F358xx bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 56 shows the hardware resources used by this bootloader.

Table 56. STM32F358xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>abie 5o. 6Tmozr 3oc</td><td rowspan=1 colspan=1>kx congard</td><td></td></tr><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 8 MHz using the HSI.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>5 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address Ox1FFFD800, containsthe bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum valueand is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled by theuser). Window feature is disabled.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit. The USART2 uses its remappedpins.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PD6 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PD5 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from thehost for USARTx bootloader.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: Ob0110111x (x = 0 for write andx = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 27.2 Bootloader selection

Figure 36 shows the bootloader selection mechanism.

![](images/71e87b4f4bc44a2e48d87e5d47123915076264c426480ffa36b2febe0069edea.jpg)  
Figure 36. Bootloader selection for STM32F358xx devices

# 27.3 Bootloader version

Table 57 lists the STM32F358xx devices bootloader versions.

Table 57. STM32F358xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>For USART1 and USART2 interfaces, the maximumbaudrate supported by the bootloader is 57600 baud.</td></tr></table>

# 28 STM32F373xx devices

# 28.1 Bootloader configuration

The STM32F373xx bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 58 shows the hardware resources used by this bootloader.

Table 58. STM32F373xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">At startup, the system clock frequency is configured to48 MHz using the HSI. If an external clock (HSE) is notpresent, the system is kept clocked from the HSI.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock can be used for all bootloader interfacesand must have one the following values: 24, 18, 16, 12, 9, 8,6, 4, 3 MHz.The PLL is used to generate the USB 48 MHz clock and the48 MHz clock for the system clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address 0x1FFFD800, contains thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value andis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit. The USART2 uses its remappedpins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx bootloader.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. An external pull-up resistor 1.5 KΩ must beconnected to USB_DP pin.</td></tr></table>

There are two operation modes, depending upon the presence of the external clock (HSE) at bootloader startup:

If HSE is present and has a value of 24, 18, 16, 12, 9, 8, 6, 4, or 3 MHz, the system clock is configured to 48 MHz with HSE as clock source. The DFU interface, USART1 and USART2 are functional and can be used to communicate with the bootloader. If HSE is not present, the HSI is kept as default clock source, and only USART1 and USART2 are functional.

Note:

The external clock (HSE) must be kept if it is connected at bootloader startup, because it is used as system clock source.

# 28.2 Bootloader selection

Figure 37 shows the bootloader selection mechanism.

![](images/4e139dcdef35c82d8502d52791c6a9d4b5e4a63810cf100e3b9751eeddb10ffd.jpg)  
Figure 37. Bootloader selection for STM32F373xx devices

# 28.3 Bootloader version

Table 59 lists the STM32F373xx devices bootloader versions.

Table 59. STM32F373xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.1</td><td>Initial bootloader version</td><td>- The USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add an USB HUB between the host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay. On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 29 STM32F378xx devices

# 29.1 Bootloader configuration

The STM32F378xx bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 60 shows the hardware resources used by this bootloader.

Table 60. STM32F378xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=4 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 8 MHz using the HSI.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>4 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>8 Kbytes, starting from address Ox1FFFD800, containsthe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum valueand is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled by theuser). Window feature is disabled.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8 bits, evenparity, and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configuration is 8 bits, evenparity, and one stop bit. The USART2 uses its remappedpins.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PD6 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PD5 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud rate from thehost for USARTx bootloader.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0110111x (x = 0 for write and x= 1 for read).</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drain no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC. No external quartz is required for the bootloader execution.

# 29.2 Bootloader selection

Figure 38 shows the bootloader selection mechanism.

![](images/cba8f302b3ab8d1a6453a886f1de2e2b6a8cc3279710a17dde25be5496698749.jpg)  
Figure 38. Bootloader selection for STM32F378xx devices

# 29.3 Bootloader version

Table 61 lists the STM32F378xx devices bootloader versions.

Table 61. STM32F378xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>For USART1 and USART2 interfaces, the maximumbaudrate supported by the bootloader is 57600 baud.</td></tr></table>

#

# STM32F398xx devices

# 30.1 Bootloader configuration

The STM32F398xx bootloader is activated by applying Pattern 2 (described in Table 2).   
Table 62 shows the hardware resources used by this bootloader.

Table 62.STM32F398xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz with HSI 8 MHz asclock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">7 Kbytes, starting from address Ox1FFFD800, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address Target mode- Analog filter ON Target 7-bit address: 0b1000000x (x = 0 for write and x =1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td rowspan="4">I2C3</td><td>I2C3</td><td>Enabled</td><td>The I2C3 configuration is: - I2C speed: up to 400 kHz - 7-bit address, Target mode Analog filter ON</td></tr><tr><td>I2C3_SCL pin</td><td></td><td colspan="1">Target 7-bit address: Ob1000000x (x = 0 for write and x = 1 for read). PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td>I2C3_SDA pin</td><td>Input/output</td><td colspan="1"></td></tr><tr><td></td><td></td><td colspan="1">PB5 pin: data line is used in open-drain no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# 30.2 Bootloader selection

Figure 39 shows the bootloader selection mechanism.

![](images/845cd4c2eb95c1489d9005fdf4d9533ad95cba64047d502a9a5a10feba823b96.jpg)  
Figure 39.Bootloader selection for STM32F398xx

# 30.3 Bootloader version

Table 63 lists the STM32F398xx devices bootloader versions.

Table 63. STM32F398xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# STM32F40xxx/41xxx devices

# 31.1 Bootloader V3.x

# 31.1.1 Bootloader configuration

The STM32F40xxx/41xxx bootloader is activated by applying Pattern 1 (described in Table 2). Table 64 shows the hardware resources used by this bootloader.

Table 64. STM32F40xxx/41xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz using the PLL.The HSI clock source is used at startup (interfacedetection phase) and when USARTx interfaces areselected (once CAN or DFU is selected, the clocksource is derived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the CAN orthe DFU (USB FS device) interfaces are selected.The external clock must provide a frequency multiple of1 MHz and ranging from 4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs.Any failure (or removal) of the external clock generatessystem reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF 0000 containthe bootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset (if the hardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this rangeinternal flash write operations are allowed only in byteformat (half-word, word, and double-word operationsare not allowed). The voltage range can be configuredin run time using bootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in inputno pull mode</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPC10/PC11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART3 configuration is 8 bits,even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the CAN2 configuration is: Baudrate125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloaderexecution because CAN1 manages the communicationbetween CAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once the HSE frequency is determined, the systemclock is configured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystals (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 31.1.2 Bootloader selection

Figure 40 shows the bootloader selection mechanism.

![](images/e4f345274690b150c490804f5725b685e313f01326ff668d990765361ed38050.jpg)  
Figure 40. Bootloader V3.x selection for STM32F40xxx/41xxx devices

MS35012V3

# 31.1.3 Bootloader version

Table 65 lists the STM32F40xxx/41xxx devices V3.x bootloader versions:

Table 65. STM32F40xxx/41xxx bootloader V3.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V3.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1> When a Read Memory command or Write Memory command is issuedwith an unsupported memory address and a correct address checksum(i.e. address Ox6000 0000), the command is aborted by the bootloaderdevice, but the NACK (0x1F) is not sent to the host. As a result, thenext two bytes (which are the number of bytes to be read/written andits checksum) are considered as a new command and its checksum(1) Option bytes, OTP and Device Feature descriptors (in DFU interface)are set to &quot;g&quot; instead of &quot;e&quot; (not erasable memory areas).After executing Go command (jump to user code) the bootloader resetsAHB1ENR value to Ox0000 0000 and thus CCM RAM, when present, isnot active (must be re-enabled by user code at startup)</td></tr><tr><td rowspan=1 colspan=1>V3.1</td><td rowspan=1 colspan=1> Fix V3.0 limitations- DFU interface robustnessenhancement</td><td rowspan=1 colspan=1>- For the USART interface, two consecutive NACKs (instead of 1 NACK)are sent when a Read Memory or Write Memory command is sent andthe RDP level is active.- For the CAN interface, the Write Unprotect command is not functional.Use Write Memory command and write directly to the option bytes inorder to disable the write protection.After executing Go command (jump to user code) the bootloader resetsAHB1ENR value to Ox0000 0000 and thus CCM RAM, when present, isnot active (must be re-enabled by user code at startup)</td></tr></table>

l 0000, 4x67, 89 he o pohehos he s anyway (as an unsupported new command).

# 31.2 Bootloader V9.x

# 31.2.1 Bootloader configuration

The STM32F40xxx/41xxx bootloader is activated by applying Pattern 1 (described in Table 2). Table 66 shows the hardware resources used by this bootloader.

# Note:

The bootloader version V9.0 is embedded only in STM32F405xx/415xx devices in WLCSP90 package.

Version V9.1 is populated in all packages of the product.

Table 66. STM32F40xxx/41xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz using the PLL.The HSI clock source is used at startup (interface detectionphase) and when USART or SPI or I2C interfaces areselected (once CAN or DFU is selected, the clock source isderived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the CAN or theDFU (USB FS device) interfaces are selected.The external clock must provide a frequency multiple of1 MHz and ranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed).The voltage range can be configured in run time usingbootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB1 pin USART3 in reception mode. Used in input pull-upmmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="3">USART3 (on0/PC1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate 125kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ONTarget 7-bit address: 0b0111010x (x = 0 for write and x = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0111010x (x = 0 for write and x = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0111010x (x = 0 for write and x = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz, Polarity: CPOL Iow, CPHA low,- NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> islave data outut le, usedin push-pull, pul-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz, Polarity: CPOL low, CPHA low,- NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI3 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI2 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI1 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI0 pin: slave chip select pin used in push-pul, pull-downmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDF</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 31.2.2 Bootloader selection

![](images/bdd32a62b432af07ad78ac64eb793cd30766a00bfe54925f3a803cef558e9422.jpg)  
Figure 41. Bootloader V9.x selection for STM32F40xxx/41xxx

# 31.2.3 Bootloader version

Table 67 lists the STM32F40xxx/41xxx devices V9.x bootloader versions.

Table 67. STM32F40xxx/41xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>This bootloader is an updatedversion of bootloader v3.1.This new version of bootloadersupports I2C1, I2C2, I2C3, SPI1and SPI2 interfaces.The RAM used by this bootloader isincreased from 8 to 12 Kb.The ID of this bootloader is 0x90.The connection time is increased.</td><td rowspan=1 colspan=1>- For the USART interface, two consecutive NACKs (instead of1 NACK) are sent when a Read Memory or Write Memorycommand is sent and the RDP level is active.- For the CAN interface, the Write Unprotect command is notfunctional. Use Write Memory command and write directly tothe option bytes in order to disable the write protection.After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000 and thusCCM RAM, when present, is not active (must be re-enabled byuser code at startup)</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>This bootloader is an updatedversion of bootloader v9.0 that willbe populated in all packages eventhe one embedding the V3.1bootloader version.It contains fixes of the knownlimitations of the V9.0</td><td rowspan=1 colspan=1>None</td></tr></table>

# 32 STM32F401xB(C) devices

# 32.1 Bootloader configuration

The STM32F401xB(C) bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 68 shows the hardware resources used by this bootloader.

Table 68. STM32F401xB(C) configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz using the PLL.The HSI clock source is used at startup (interface detectionphase) and when USART or SPI or I2C interface is selected(once DFU is selected, the clock source is derived from theexternal crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the DFU (USB FSdevice) interface is selected. The external clock mustprovide a frequency multiple of 1 MHz and ranging from 4 to26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed).The voltage range can be configured in run time usingbootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget mode Analog filter ONTaret7-i es: 0100x  = 0 orwre n = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1"> </td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address Target mode- Analog filter ON Target 7-bit dress: 0b0111010x (x = 0 fo write and x = 1for read).</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1"> data lne is used inopen-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ONfor read).</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PB4 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is: Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1"> pin slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave modeFull Duplex- 8-bit MSBSpeed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> avu  ulul-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is: Slave modeFull Duplex-8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC12 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin: slave data output lne, used in push-pull pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">C0 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull pull-downmode.</td></tr><tr><td colspan="1" rowspan="4">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock, multiple of 1 MHz (between 4 and 26 MHz), is required for CAN and DFU execution after the selection phase.

#

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 32.2 Bootloader selection

![](images/693a888fedc6e903f891d145653224c83d5c2428b4f37107710cf79a7749a072.jpg)  
Figure 42. Bootloader selection for STM32F401xB(C)

# 32.3 Bootloader version

Table 69. STM32F401xB(C) bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- After executing Go command (jump to user code)the bootloader resets AHB1ENR value to 0x00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code at startup)- The bootloader does not support the reset ofSPRMOD bit during RDP regression</td></tr></table>

# 33 STM32F401xD(E) devices

# 33.1 Bootloader configuration

The STM32F401xD(E) bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 70 shows the hardware resources used by this bootloader.

Table 70. STM32F401xD(E) configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz using the PLL.The HSI clock source is used at startup (interface detectionphase) and when USART or SPI or I2C interface isselected (once DFU is selected, the clock source isderived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the DFU (USBFS device) interface is selected.The external clock must provide a frequency multiple of1 MHz, ranging from 4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to 1.62 V, 2.1 V. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed).The voltage range can be configured in run time usingbootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ONTa00  = 0  x =1 ffor read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ONTa00 = 0  =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1"> ata i  usd  open-rai o pull moe.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b0111001x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock eis use noen-rain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1"> ata l s s  en-rai o pull moe</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1"> Input</td><td colspan="1" rowspan="1"> pslave data input e used in push-pul pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">A pin: slave data output lie, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1"> Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC12 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">P11 pin: slave data output line, used in push-pul, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="4">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx, and SPIx bootloaders. This internal clock is also used for DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 33.2 Bootloader selection

Figure 43 shows the bootloader selection mechanism.

![](images/0a5a04943f258aa4b073ffa64d1faaa9a08cb4d2724ac079dd5d67b37406d3e5.jpg)  
Figure 43. Bootloader selection for STM32F401xD(E)

MS35031V1

# 33.3 Bootloader version

Table 71 lists the STM32F401xD(E) devices bootloader version.

Table 71. STM32F401xD(E) bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code)the bootloader resets AHB1ENR value to 0x00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code at startup)</td></tr></table>

# 34 STM32F410xx devices

# 34.1 Bootloader configuration

The STM32F410xx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 72 shows the hardware resources used by this bootloader.

Table 72. STM32F410xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 60 MHz and for USART and I2C bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8V, 3.6V]. In this range: Flash wait states: 3.- System clock frequency 60 MHz.ART Accelerator enabled. Flash write operation by byte (refer to bootloader memorymanagement section for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1000111x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget modeAnalog filter ON- Target 7-bit address: 0b1000111x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1000111x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB15 pin: clock line is used in open-drain no pull mode forSTM32F410Cx/Rx devices.PB10 pin: clock line is used in open-drain no pull mode forSTM32F410Tx devices.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB14 pin: data line is used in open-drain no pull mode forSTM32F410Cx/Rx devices.PB3 pin: data line is used in open-drain no pull mode forSTM32F410Tx devices.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode for STM32F410Cx/Rx devices.PB5 pin: slave data input line, used in push-pull, pull-downmode for STM32F410Tx devices.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, pull-downmode for STM32F410Cx/Rx devices.PB4 pin: slave data output line, used in push-pull, pull-downmode for STM32F410Tx devices.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-up modefor STM32F410Cx/Rx devices.PA15 pin: slave chip select pin used in push-pull, pull-downmode for STM32F410Tx devices.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC3 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC2 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# 34.2 Bootloader selection

Figure 44 shows the bootloader selection mechanism.

![](images/36d9bc14c266452901999429679e0345427d0215665286f52adffd31125b3a69.jpg)  
Figure 44.Bootloader V11.x selection for STM32F410xx

# 34.3 Bootloader version

Table 73 lists the STM32F410xx devices bootloader V11.x versions.

Table 73. STM32F410xx bootloader V11.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V11.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active (mustbe re-enabled by user code at startup)</td></tr><tr><td rowspan=1 colspan=1>V11.1</td><td rowspan=1 colspan=1>Support I2C4 and SPI1 forSTM32F410Tx devices</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active (mustbe re-enabled by user code at startup)</td></tr></table>

# 35 STM32F411xx devices

# 35.1 Bootloader configuration

The STM32F411xx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 74 shows the hardware resources used by this bootloader.

Table 74. STM32F411xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common toall</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz using the PLL.The HSI clock source is used at startup (interface detectionphase) and when USART or SPI or I2C interface is selectedonce DFU is selected, the clock source is derived from theexternal crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the DFU (USB FSdevice) interface is selected.The external clock must provide a frequency multiple of 1 MHzand ranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU. Any failure (orremoval) of the external clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if the hard-ware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this range internalflash write operations are allowed only in byte format (half-word, word, and double-word operations are not allowed). Thevoltage range can be configured in run time using bootloadercommands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from the hostfor USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz- 7-bit addressTarget modeAnalog filter ONTar 7-b  0001  = 0o ran x =rread)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock ies se oen-rain o pull moe.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:-I2C speed: up to 400 kHz- 7-bit addressTarget mode-Analog filter ONread</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB3 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz-7-bit addressTarget mode-Analog filter ONTa-00 = 0 n =read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PB4 pin data lne is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode Full Duplex- 8-bit MSBSpeed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin: slave data output line, used in push-pull, pullownmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">P1 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="4">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Once theHSE frequency is determined, the system clock is configured to60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx I2Cx, and SPIx bootloaders. This internal clock is also used for DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for DFU execution after the selection phase.

Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 35.2 Bootloader selection

Figure 45 shows the bootloader selection mechanism.

![](images/0b0c093988fcf40f33587d93f577c1299366c7b76ac797138f2a8c86c16d1847.jpg)  
Figure 45. Bootloader selection for STM32F411xx

# 35.3 Bootloader version

The following table lists the STM32F411xx devices bootloader version.

Table 75. STM32F411xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active(must be re-enabled by user code at startup)</td></tr></table>

# 36 STM32F412xx devices

# 36.1 Bootloader configuration

The STM32F412xx bootloader is activated by applying Pattern 1 (described in Table 2).   
Table 76 shows the hardware resources used by this bootloader.

Table 76.STM32F412xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 60 MHz and for USART and I2C bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or the DFU (USB FSdevice) interfaces are selected. In this case the system clockis configured to 60 MHz with HSE as clock source. The HSEfrequency must be a multiple of 1 MHz, ranging from 4 to 26MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates a systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8V, 3.6V]. In this range: Flash wait states: 3.- System clock frequency 60 MHz.— ART Accelerator enabled.- Flash write operation by byte (refer to bootloader memorymanagement section for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input no pulmode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication between CAN2and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1000110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target modeAnalog filter ON Target 7-bit address: 0b1000110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1000110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PB4 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1000110x (x = 0 for write and x = 1for ead)</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB15 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">PB14 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex-8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC12 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC11 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pull, pull-upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> i slave data input leused n push-pull, pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1"> pin: slave clock lne, used in push-pull pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1"> pi slave chip select pin used in push-pul pull-umode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. OnceHSE frequency is determined, the system clock is configuredto 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 36.2 Bootloader selection

Figure 46 shows the bootloader selection mechanism.

![](images/f8716537cc4f8aafc33e4fb0c2667889f29a0d6afc54e5651c6fb158ed4c9de0.jpg)  
Figure 46.Bootloader V9.x selection for STM32F412xx

# 36.3 Bootloader version

The following table lists the STM32F412xx devices bootloader V9.x versions.

Table 77. STM32F412xx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code)the bootloader resets AHB1ENR value to 0x00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code atstartup)</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>Fix USART3 interface pinout</td><td rowspan=1 colspan=1>After executing Go command (jump to user code)the bootloader resets AHB1ENR value to 0x00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code atstartup)</td></tr></table>

# 37 STM32F413xx/423xx devices

# 37.1 Bootloader configuration

The STM32F413xx/423xx bootloader is activated by applying Pattern 1 (described in Table 2h). The following table shows the hardware resources used by this bootloader.

Table 78. STM32F413xx/423xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for systemclock configured to 60 MHz and for USART and I2Cbootloader operation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or the DFU (USB FSdevice) interfaces are selected. In this case the systemclock configured to 60 MHz with HSE as clock source.The HSE frequency must be multiple of 1 MHz andranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generatessystem reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">60 Kbytes, starting from address Ox1FF00000, containthe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8V, 3.6V]In this range: Flash wait states 4.- System clock frequency 60 MHz.- ART Accelerator enabled.Flash write operation by byte (refer to Bootloadermemory management for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB1 pin: USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate 125kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloaderexecution because CAN1 manages the communicationbetween CAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001011x (x = 0 for write and x =1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001011x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 400 kHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001011x (x = 0 for write and x =1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB4 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001011x (x = 0 for write and x =1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB15 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB14 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB, speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">A pin:slave data output line, used in push-pull, pul-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB, speed up to 8 MHz- Polarity: CPOL low, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC12 pin: slave data input line, used in push-pul, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">P1 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pul, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB, speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE4 pin: slave data input line, used in push-pull pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE1 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternate push-pull, nopull mode.No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN2 andD</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 37.2 Bootloader selection

Figure 47 shows the bootloader selection mechanism.

![](images/aa1e008a5732628098ef893f7e7d47dc82fc26f3828db8ed8c92b4ed102d7050.jpg)  
Figure 47.Bootloader V9.x selection for STM32F413xx/423xx

# 37.3 Bootloader version

The following table lists the STM32F413xx/423xx devices bootloader V9.x versions.

Table 79. STM32F413xx/423xx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active (mustbe re-enabled by user code at startup)</td></tr></table>

# 38

# STM32F42xxx/43xxx devices

# 38.1

# Bootloader V7.

# 38.1.1 Bootloader configuration

The STM32F42xxx/43xxx bootloader is activated by applying Pattern 5 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 80. STM32F42xxx/43xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz usingthe PLL.The HSI clock source is used at startup(interface detection phase) and when USARTor I2C interfaces are selected (once CAN orDFU is selected, the clock source is derivedfrom the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when theCAN or the DFU (USB FS device) interfacesare selected.The external clock must provide a frequencymultiple of 1 MHz and ranging from 4 MHz to26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN andDFUs. Any failure (or removal) of the externalclock /generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox20000000,are used by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value. It is periodically refreshed toprevent watchdog reset (if the hardware IWDGoption was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In thisrange internal flash write operations areallowed only in byte format (half-word, word,and double-word operations are not allowed).The voltage range can be configured in runtime using bootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8 bits,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used ininput no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Usedin input no pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PB10/PB11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8 bits,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PC10/PC11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8 bits,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baudrate from the host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is:Baudrate 125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2bootloader execution because CAN1 managesthe communication between CAN2 andSRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used inalternate push pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Usedin alternate push pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bit address, Slavemode, Analog filter ON Target 7-bit address:0b0111000x (x = 0 for write and x = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">ata lie is us  enraio pulmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced devicemode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate pushpull no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate pushpull no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 and DFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of theHSE. Once the HSE frequency is determined,the system clock is configured to 60 MHz usingPLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 38.1.2 Bootloader selection

Figure 48 and Figure 49 show the bootloader selection mechanism.

# Figure 48. Dual bank boot implementation for STM32F42xxx/43xxx Bootloader V7.x

![](images/99d0c7fc3bd326e2a331808749949a5c86b089ca42ff0ea7531bf08a4c9f4e70.jpg)

MS35021V1

CCM RAM is not considered valid as stack pointer address for the dual bank boot mechanism.

![](images/40e8cb24f4fb1161543eb44816e736f3bf029cec273cdea9320fb34960211136.jpg)  
Figure 49. Bootloader V7.x selection for STM32F42xxx/43xxx

# 38.1.3 Bootloader version

The following table lists the STM32F42xxx/43xxx devices bootloader V7.x versions.

Table 81. STM32F42xxx/43xxx bootloader V7.x versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V7.0</td><td>Initial bootloader version</td><td>For the CAN interface, the Write Unprotect command is not functional. Use Write Memory command and write directly to the option bytes to disable the write protection. For the USB DFU interface, in Dual Bank mode, the Erase operation is not functional for the second bank. Return to Single Bank mode, erase desired sector(s) and then reactivate the Dual Bank mode. After executing Go command (jump to user code) the bootloader resets AHB1ENR value to 0x0000 0000 and thus CCM RAM, when present, is not active (must be re-enabled by user code at startup).</td></tr></table>

# 38.2 Bootloader V9.x

# 38.2.1 Bootloader configuration

The STM32F42xxx/43xxx bootloader is activated by applying Pattern 5 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 82. STM32F42xxx/43xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz using the PLL.The HSI clock source is used at startup (interfacedetection phase) and when USART or SPI or I2Cinterfaces are selected (once CAN or DFU isselected, the clock source is derived from theexternal crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only when the CAN orthe DFU (USB FS device) interfaces are selected.The external clock must provide a frequency multipleof 1 MHz and ranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs.Any failure (or removal) of the external clockgenerates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address Ox1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset (if the hardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. In this rangeinternal flash write operations are allowed only in byteformat (half-word, word, and double-word operationsare not allowed). The voltage range can beconfigured in run time using bootloader commands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in inputno pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used ininput no pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PB10/PB11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PC10/PC11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloaderexecution because CAN1 manages thecommunication between CAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter O Target 7-bit address:0b0111000x (x = 0 for write and x = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ON Target 7-bit address:0b0111000x (x = 0 for write and x = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:IC speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ON Target 7-bit address:0b0111000x (x = 0 for write and x = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_ SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, -bit MSB, Speed up to 8MHz, Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  save data input e,used  push-pulpulldown mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> slav data output ie, usedin push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> svcc u mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">save hi lec u uululdown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to 8MHz, Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> sav ataut  pushpull udown mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> v cc u pul ullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> i slave chip select pin use n push-pull pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to 8MHz, Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE4 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pi slave data outut le used  push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin:slave clock lne, used in push-pull pulldown mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> av hi selc un ush-l ull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull nopull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 and DFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once the HSE frequency is determined, the systemclock is configured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 38.2.2 Bootloader selection

Figure 50 and Figure 51 show the bootloader selection mechanism.

# Figure 50. Dual bank boot implementation for STM32F42xxx/43xxx bootloader V9.x

![](images/c2ab66e8aa8fa88ee96dc5fe589a16ce2a3452de22c2490f2b6f4283319b0184.jpg)

MS35023V1

CCM RAM is not considered valid as stack pointer address for the dual bank boot mechanism.

![](images/188553f46cfe8211b2041bcab88224971ee126a2dd43eb24cd1af38d9b3458af.jpg)  
Figure 51. Bootloader V9.x selection for STM32F42xxx/43xxx

# 38.2.3 Bootloader version

Table 83 lists the STM32F42xxx/43xxx devices bootloader V9.x versions.

Table 83. STM32F42xxx/43xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>This bootloader is an updatedversion of bootloader v7.0.This new version of bootloadersupports I2C2, I2C3, SPI1, SPI2,and SPI4 interfaces.The RAM used by this bootloaderis increased from 8 Kb to 12 Kb.The ID of this bootloader is Ox90The connection time is increased.</td><td rowspan=1 colspan=1>For the USB DFU interface, in Dual Bank mode, theErase operation is not functional for the secondbank. Return to Single Bank mode, erase desiredsector(s) and then reactivate the Dual Bank mode.After executing Go command (jump to user code)the bootloader resets AHB1ENR value to 0x00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code at startup)</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>This bootloader is an updatedversion of bootloader v9.0. Thisnew version implements the newI2C No-stretch commands (I2Cprotocol v1.1) and the capability ofdisabling PcROP when RDP1 isenabled with ReadOutUnprotectcommand for all protocols(USB,USART, CAN, I2C and SPI). TheID of this bootloader is 0x91</td><td rowspan=1 colspan=1>For the CAN interface, the Write Unprotectcommand is not functional. Use Write Memorycommand and write directly to the option bytes inorder to disable the write protection.For the USB DFU interface, in Dual Bank mode, theErase operation is not functional for the secondbank. Return to Single Bank mode, erase desiredsector(s) and then reactivate the Dual Bank mode.After executing Go command (jump to user code)the bootloader resets AHB1ENR value to Ox00000000 and thus CCM RAM, when present, is notactive (must be re-enabled by user code at startup)</td></tr></table>

# 39 STM32F446xx devices

# 39.1 Bootloader configuration

The STM32F446xx bootloader is activated by applying Pattern 1 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 84.STM32F446xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clock sourcefor system clock configured to 60 MHz andfor USART, I2C and SPI bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or theDFU (USB FS device) interfaces areselected. In this case the system clockconfigured to 60 MHz with HSE as clocksource.The HSE frequency must be multiple of1 MHz and ranging from 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CANand DFUs. Any failure (or removal) of theexternal clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address0x1FFF0000, contain the bootloaderfirmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value. It is periodically refreshedto prevent watchdog reset (if the hardwareIWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.71 V, 3.6 V].In this range:- Flash wait states: 3.- System Clock 60 MHz.- Prefetch disabled.- Flash write operation by byte (refer tosection bootloader memory managementfor more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode.Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPC10/PC11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode.Used in input pull-up mode</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baudrate from the host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is:Baudrate 125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2bootloader execution because in CAN1manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bit address,Target mode, Analog filter ONTarget 7-bit address: Ob0111100x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_ SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz, 7-bit address,Target mode, Analog filter ONTarget 7-bit address: Ob0111100x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 400 kHz, 7-bit address,Target mode, Analog filter ONTarget 7-bit address: Ob0111100x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speedup to 8 MHz, Polarity: CPOL Iow, CPHAlow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speedup to 8 MHz, Polarity: CPOL Iow, CPHAlow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC7 pin: slave clock line, used in push-pullpull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speedup to 8 MHz, Polarity: CPOL Iow, CPHAlow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE14 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE11 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced devicemode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">CAN2 and DFUs</td><td colspan="1" rowspan="1">TIM17</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value ofthe HSE. Once the HSE frequency isdeterminated, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 39.2 Bootloader selection

Figure 52 shows the bootloader selection mechanism.

![](images/a042762510c18f06ad9e97c1466aab1ba0138139cf4fabc2a6d1cc33268ca27b.jpg)  
Figure 52.Bootloader V9.x selection for STM32F446xx

MSv36763V2

# 39.3 Bootloader version

The following table lists the STM32F446xx devices bootloader V9.x versions:

Table 85. STM32F446xx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active (mustbe re-enabled by user code at startup)</td></tr></table>

# 40

# STM32F469xx/479xx devices

# 40.1 Bootloader configuration

The STM32F469xx/479xx bootloader is activated by applying Pattern 5 (described in Table 2). Table 86 shows the hardware resources used by this bootloader.

Table 86. STM32F469xx/479xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHzusing the PLL.The HSI clock source is used at startup(interface detection phase) and whenUSART or SPI or I2C interfaces areselected (once CAN or DFU is selected,the clock source is derived from externalcrystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE clock source is used only whenthe CAN or the DFU (USB FS device)interfaces are selected.The external clock must provide afrequency multiple of 1 MHz and rangingfrom 4 MHz to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CANand DFUs. Any failure (or removal) of theexternal clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">29 Kbytes, starting from address0x1FFF0000, contain the bootloaderfirmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value. It is periodicallyrefreshed to prevent watchdog reset (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage range is set to [1.62 V, 2.1 V]. Inthis range internal flash write operationsare allowed only in byte format (half-word,word, and double-word operations are notallowed). The voltage range can beconfigured in run time using bootloadercommands.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode.Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/B1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPC10/C1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serialbaud rate from the host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is:Baudrate 125 kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2bootloader execution because CAN1manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB05 pin: CAN2 in reception mode. Usedin alternate push-pul, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ONTarget 7-bit address: 0b1000100x (x = 0for write and x = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drainno pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB pin:data line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz, 7-bit address,Target mode, Analog filter ON Target 7-bitaddress: 0b1000100x (x = 0 for write andx = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: clock line is used in open-drainno pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: data line is used in open-drain nopull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 400 kHz, 7-bit address,Target mode, Analog filter ON Target 7-bitaddress: 0b1000100x (x = 0 for write andx = 1 for read).</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drainno pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">C i: data line is use in open-drainpull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOL Iow,CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOL low,CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI3 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI2 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI1pin: slave clock line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PIO pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOL low,CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE14 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE11 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced devicemode. USB_OTG_FS interrupt vector isenabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternatepush-pull, no pull mode.No external pull-up resistor is required.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 48 MHz) is required for CAN and DFUs execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 40.2 Bootloader selection

Figure 53 and Figure 54 show the bootloader selection mechanism.

# Figure 53. Dual bank boot implementation for STM32F469xx/479xx Bootloader V9.x

![](images/98ad3fd67df58e6b90012b7c7f4ef08c130e0455d47aa76dd1352bd1f4f30db5.jpg)

MSv38429V1

![](images/22375af64473efbd417d413a89aaf0f96803f754b3a82a6eec560ad5062cde4c.jpg)  
Figure 54.Bootloader V9.x selection for STM32F469xx/479xx

MSv38430V2

# 40.3 Bootloader version

Table 87 lists the STM32F469xx/479xx devices V9.x bootloader versions:

Table 87. STM32F469xx/479xx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>After executing Go command (jump to user code) thebootloader resets AHB1ENR value to 0x0000 0000and thus CCM RAM, when present, is not active(must be re-enabled by user code at startup).</td></tr></table>

# 41 STM32F72xxx/73xxx devices

# 41.1 Bootloader configuration

The STM32F72xxx/73xxx bootloader is activated by applying Pattern 8 (described in Table 2). Table 88 shows the hardware resources used by this bootloader.

Table 88. STM32F72xxx/73xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clocksource for system clock configured to60 MHz and for USART and I2Cbootloader operation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CANor the DFU (USB FS device) interfacesare selected. In this case the systemclock configured to 60 MHz with HSEas clock source.The HSE frequency must be a multipleof 1 MHz. ranging from 4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for theCAN and DFUs. Any failure (orremoval) of the external clockgenerates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address0x20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">59 Kbytes, starting from address0x1FF00000, contain the bootloaderfirmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured toits maximum value. It is periodicallyrefreshed to prevent watchdog reset (ifthe hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8V, 3.6V]In this range:- Flash wait states: 3.- System clock frequency 60 MHz.- ART Accelerator enabled.- Flash write operation by byte (refer tobootloader memory managementsection for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmissionmode. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PB11/PB10)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmissionmode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(on PC11/PC10)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode.Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmissionmode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serialbaud rate from the host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1configuration is: Baudrate 125 kbps,11-bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: CAN1 in reception mode.Used in alternate push-pull, pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD1 pin: CAN1 in transmission mode.Used in alternate push-pull, pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 400 kHz, 7-bitaddress, Target mode, Analog filter ONTarget 7-bit address: 0b1001001x (x =0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drainno pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz, 7-bitaddress, Target mode, Analog filter ONTarget 7-bit address: 0b1001101x (x =0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF0 pin: data line is used in open-drainno pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 400 kHz, 7-bitaddress, Target mode, Analog filter ONTarget 7-bit address: 0b1001001x (x =0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOLlow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOLlow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI3 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI2 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI1 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PIO pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:Slave mode, Full Duplex, 8-bit MSB,Speed up to 8 MHz, Polarity: CPOLlow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE14 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, usedin push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used inpush-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE11 pin: slave chip select pin used inpush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forceddevice mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used inalternate push-pull, no pull mode.No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN1 and DFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine thevalue of the HSE. Once HSEfrequency is determined, the systemclock is configured to 60 MHz usingPLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 41.2 Bootloader selection

Figure 55 shows the bootloader selection mechanism.

![](images/cea2a25e57add2ba120ee09faa0c545cb5c6c44be75a3554fe9f2dc32a184a0c.jpg)  
Figure 55. Bootloader V9.x selection for STM32F72xxx/73xxx

# 41.3 Bootloader version

Table 89 lists the STM32F72xxx/73xxx devices bootloader V9.x versions.

Table 89. STM32F72xxx/73xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>At high UART baudrates (115200 bps) connectionmay fail due to software jitter leading to wrongbaudrate calculation.In that case bootloader may respond with a baudrateup to ± 5% different from host baudrate.Workaround: use baudrates lower than 57600 bps ifhost tolerance to baudrate error is lower than ± 5%</td></tr></table>

# 42 STM32F74xxx/75xxx devices

Two bootloader versions are available:

V7.x supporting USART1, USART3, CAN2, I2C1, I2C2, I2C3, and DFU (USB FS device). This version is embedded in STM32F74xxx/75xxx rev. A devices. V9.x supporting USART1, USART3, CAN2, I2C1, I2C2, I2C3, SPI1, SPI2, SPI4, and DFU (USB FS device). This version is embedded in STM32F74xxx/75xxx rev. Z and rev. 1 devices.

Note:

When readout protection Level2 is activated, STM32F74xxx/75xxx devices can boot also on system memory and all commands are not accessible except Get, GetID, and GetVersion.

# 42.1 Bootloader V7.x

# 42.1.1 Bootloader configuration

The STM32F74xxx/75xxx bootloader is activated by applying Pattern 8 (described in Table 2). Table 90 shows the hardware resources used by this bootloader.

Table 90. STM32F74xxx/75xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clock source for systemclock configured to 60 MHz and for USART and I2Cbootloader operation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or the DFU (USB FSdevice) interfaces are selected. In this case the systemclock configured to 60 MHz with HSE as clock source.The HSE frequency must be multiple of 1 MHz andranging from 4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">60 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8V, 3.6V]. In this range:- Flash wait states: 3.- System clock frequency 60 MHz.- ART Accelerator enabled.- Flash write operation by byte (refer to bootloadermemory management section for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Onc initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> USART Use pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB10/PB11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Onializd,he iguration bven paritone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">B1 pinUSART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3(onPC10/PC11</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1"> initialized, the configuration s 8bi even parity adone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">1 pin USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate 125kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz-t address, Target mode-Analog filter ON0=x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB pin: clock line is used in open-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 400 kHz-t address, Target mode-Analog filter ONTarget 7-bit address: Ob1000101x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">P pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode, Analog filter ON- Target 7-bit address: 0b1000101x (x = 0 for write and x= 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternate push-pull, nopull mode.No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 42.1.2 Bootloader selection

![](images/85b0b9ad2812f3f0ab717c387e61eccc21c1782cc9f1101244891daf573e64c3.jpg)  
Figure 56.Bootloader V7.x selection for STM32F74xxx/75xxx

# 42.1.3 Bootloader version

Table 91. STM32F74xxx/75xxx bootloader V7.x versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V7.0</td><td>Initial bootloader version</td><td>At high UART baudrates (115200 bps) connection may fail due to software jitter leading to wrong baudrate calculation. In that case bootloader may respond with a baudrate up to ± 5% different from host baudrate. Workaround: use baudrates lower than 57600 bps if host tolerance to baudrate error is lower than ± 5%</td></tr></table>

# 42.2 Bootloader V9.x

# 42.2.1 Bootloader configuration

The STM32F74xxx/75xxx bootloader is activated by applying Pattern 8 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 92. STM32F74xxx/75xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for systemclock configured to 60 MHz and for USART, I2C and SPIbootloader operation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or the DFU (USB FSdevice) interfaces are selected. In this case the systemclock configured to 60 MHz with HSE as clock source.The HSE frequency must be multiple of 1 MHz andranging from 4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interruptis enabled for the CAN and DFUbootloaders. Any failure (or removal) of theexternal clock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">60 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is 1.8 V, 3.6V. In this range:- Flash wait states: 3.- System clock frequency 60 MHz.- ART Accelerator enabled.- Flash write operation by byte (refer to bootloadermemory management section for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (on B0/PB1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (on10/PC1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN2 configuration is: Baudrate 125kbps, 11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication betweenCAN2 and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: CAN2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget mode- Analog filter ONTarget 7-bit address: 0b1000101x (x = 0 or write and x= 1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> ata  userai o pull e</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz-7-bit address- Target modeAnalog filter ON Target 7-bit address: 0b1000101x (x = 0 for write and = 1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1000101x (x = 0 for write and x= 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to 8 MHz,Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">avatu  usul ullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">1 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI0 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave modeFull Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE pin: slave data input line, used in push-pul, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE3 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE11 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternate push-pull, nopull mode. No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx, I2Cx I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 42.2.2 Bootloader selection

Figure 57 shows the bootloader selection mechanism.

![](images/1e08c844348e347d2abddbe6b34be1edffd66b12c6901ea1d179e3a8736f4617.jpg)  
Figure 57.Bootloader V9.x selection for STM32F74xxx/75xxx

# 42.2.3 Bootloader version

The following table lists the STM32F74xxx/75xxx bootloader V9.x versions:

Table 93. STM32F74xxx/75xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>At high UART baudrates (115200 bps)connection may fail due to software jitterleading to wrong baudrate calculation.In that case bootloader may respond with abaudrate up to ± 5% different from hostbaudrate.Workaround: use baudrates lower than57600 bps if host tolerance to baudrateerror is lower than ± 5%</td></tr></table>

# 43 STM32F76xxx/77xxx devices

# 43.1 Bootloader configuration

The STM32F76xxx/77xxx bootloader is activated by applying Pattern 9 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 94. STM32F76xxx/77xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Commonto all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 60 MHz and for USART and I2C bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">HSEenabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN or the DFU (USB FSdevice) interfaces are selected. In this case the system clockconfigured to 60 MHz with HSE as clock source.The HSE frequency must be a multiple of 1 MHz, ranging from4 to 26 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the CAN and DFUs. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">59 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The voltage range is [1.8 V, 3.6 V]In this range:- Flash wait states: 3.- System clock frequency 60 MHz.- ART Accelerator enabled.- Flash write operation by byte (refer to bootloader memorymanagement section for more information).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPB11/PB10)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB1 piUSART3 in reception mode.Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">USART3 (on 1/PC10)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">On intialized, the configuration is 8bi, eve parity, ad ostop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">1 piUSART3 in reception mode.Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from the hostfor USARTX.</td></tr><tr><td colspan="1" rowspan="3">CAN2</td><td colspan="1" rowspan="1">CAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Oncinitialized the CAN2 configuration is: Baudrate125 kps,11-bit identifier.Note: CAN1 is clocked during CAN2 bootloader executionbecause CAN1 manages the communication between CAN2and SRAM.</td></tr><tr><td colspan="1" rowspan="1">CAN2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pinCAN2 in reception mode. Used in alternate push-pull,pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: CAN2 in transmission mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:speed: up o 00 Hz, 7-bit adress, Target mode, Analogfiltter ONTart -i100001  = 0ore n  = read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:peed: up to400 z, 7-bit address, Target mode, Analogfilter ONTarget 7-bit address: 0b1001001x (x = 0 for write and x = 1 forread</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">P pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 400 kHz, 7-bit address, Target mode, Analogfilter ONTarget 7-bit adress: 0b1001001x (x = 0 for write and x = 1 frread)</td></tr><tr><td colspan="1" rowspan="1">I2C3_ SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to 8 MHz,Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pslave ata utut usei ush-pul pullownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI3 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI2 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  slave clock lne used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI0 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE4 pin: slave data input line, used in push-pul, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> savt utu u pushul pullownmode</td></tr><tr><td colspan="1" rowspan="1">SP4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE1 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB DP line. Used in alternate push-pull, no pullmode.No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="1">CAN2 andDFUs</td><td colspan="1" rowspan="1">TIM11</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. OnceHSE frequency is determined, the system clock is configured to60 MHz using PLL and HSE.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx and I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but only for the selection phase. An external clock multiple of 1 MHz (between 4 and 26 MHz) is required for CAN and DFU execution after the selection phase.

# Note:

Due to HSI deviation and since HSI is used to detect HSE value, use low rather than high frequency HSE crystal values (low frequency values are better detected due to larger error margin). For example, it is better to use 8 MHz instead of 25 MHz.

# 43.2 Bootloader selection

Figure 58 and Figure 59 show the bootloader selection mechanism.

![](images/cefaef71f4e0787291a8accecd0bcd47ba29716bc2818b45135df9847d99b50c.jpg)  
Figure 58. Dual bank boot implementation for STM32F76xxx/77xxx Bootloader V9.x

Only BOOT_ADD0 value is considered whatever the BOOT0 pin state, as described in Table 95.

.ITCM RAM is not considered valid as stack pointer address for the dual bank boot mechanism

![](images/20a1e056fab687b1bb1c885c3a15d0e9861bfd1eff9ddcc7c55621135faba4f0.jpg)  
Figure 59. Bootloader V9.x selection for STM32F76xxx/77xxx

# 43.3 Bootloader version

The following table lists the STM32F76xxx/77xxx devices bootloader V9.x versions.

Table 95. STM32F76xxx/77xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.3</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>When the flash memory is configured to the dualbank boot mode (nDBANK=nDBOOT=0),whatever the BOOT0 Pin state onlyBOOT_ADD0 value is considered (when BOOTOPin=1, BOOT_ADD0 value is considered not theBOOT_ADD1).Workaround: to manage dual bank boot withBOOT_ADD0 only, refer to AN4826 &quot;STM32F7series flash memory dual bank mode&quot;At high UART baudrates (115200 bps)connection may fail due to software jitter leadingto wrong baudrate calculation.In that case bootloader may respond with abaudrate up to ± 5% different from host baudrate.Workaround: use baudrates lower than57600 bps if host tolerance to baudrate error islower than ± 5%.Bank2 sector erase issue when using USBinterface. Erasing a sector from bank2 with index(i) leads to erase sector (i+4)</td></tr></table>

# STM32G03xxx/STM32G04xxx devices

# 44.1 Bootloader configuration

The STM32G03xxx/G04xxx bootloader is activated by applying Pattern 11 (described in Table 2). The following table shows the hardware resources used by this bootloader. Note that STM32G030x do not have BOOT_LOCK(bit), so consider that when using Pattern 11.

Table 96. STM32G03xxx/G04xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (using PLLclocked by HSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox1FFF0000</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memoryarea is 0x1FFF1D00</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx bootloader</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud ratefrom the host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: Ob1010110x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1010110x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-upmode.</td></tr></table>

Note:

On SO8, WLCSP18, TSSOP20, and UFQFN28 packages USART1 PA9/PA10 IOs are remapped on PA11/PA12.

# 44.2 Bootloader selection

Figure 60 shows the bootloader selection mechanism.

![](images/9c8ee8b77c93f56a437817c6ba22a43b2d4d11848304f601a1b6b3b3e5f4c0ac.jpg)  
Figure 60. Bootloader V5.x selection for STM32G03xxx/G04xxx

# 44.3 Bootloader version

Table 97 lists the STM32G03xxx/G04xxx devices bootloader versions.

Table 97. STM32G03xxx/04xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- Supports only 48- and 32-pin packages- Issue is seen for both packages, if PA3stays to low level, system is stuck in theUSART2 detection sequence and no otherinterface is detected.</td></tr><tr><td rowspan=1 colspan=1>V5.2</td><td rowspan=1 colspan=1>Add support to small packages8/20 and 28 pins</td><td rowspan=1 colspan=1>Issue is seen for all packages (except SO8,no PA3 pin), if PA3 stays to low level, systemis stuck in the USART2 detection sequenceand no other interface is detected.</td></tr><tr><td rowspan=1 colspan=1>V5.3</td><td rowspan=1 colspan=1>Fix V5.2 limitations</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V5.4</td><td rowspan=1 colspan=1>- Improve USART2 detectionmethod- Expose ENGI memory area- Enable interrupts by resettingPRIMASK</td><td rowspan=1 colspan=1>None</td></tr></table>

#

# STM32G07xxx/08xxx device bootloader

# 45.1 Bootloader configuration

The STM32G07xxx/G08xxx bootloader is activated by applying Pattern 11 (described in Table 2). Table 98 shows the hardware resources used by this bootloader.

When using Pattern 11, consider that STM32G070xx devices do not have BOOT_LOCK(bit).

Table 98. STM32G07xxx/8xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (using PLLclocked by HSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memoryarea is 0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address Target mode- Analog filter ON- Target 7-bit address: Ob1010001x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target modeAnalog filter ON Target 7-bit address: 0b1010001x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> pidata line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode.()</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull,pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,pull-down mode.()</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull,pull-down.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 45.2 Bootloader selection

Figure 61 shows the bootloader selection mechanism.

![](images/9d6264088a29ffbd57fa3508ec991fe6641ebab7d580fe7fcce0e5ee40191bff.jpg)  
Figure 61. Bootloader V11.0 selection for STM32G07xxx/G08xxx

# 45.3 Bootloader version

Table 99 lists the STM32G07xxx/8xxx devices bootloader versions.

Table 99. STM32G07xxx/08xxx bootloader versions   

<table><tr><td colspan="1" rowspan="1">Version number</td><td colspan="1" rowspan="1">Description</td><td colspan="1" rowspan="1">Known limitations</td></tr><tr><td colspan="1" rowspan="1">V11.0</td><td colspan="1" rowspan="1">Initial bootloader version</td><td colspan="1" rowspan="1">Not supporting packages smaller than LQFP64</td></tr><tr><td colspan="1" rowspan="1">V11.1</td><td colspan="1" rowspan="1">Supporting all packages</td><td colspan="1" rowspan="1">None</td></tr><tr><td colspan="1" rowspan="1">V11.2</td><td colspan="1" rowspan="1">Added securable memoryarea feature</td><td colspan="1" rowspan="1">Option byte launch missing when using USARTprotocolRCC register RCC_ICSCR is not set to its defaultvalue when Go command is used. HSITRIMvalue is set to a value different from default.RCC registers are not set to their default valuewhen Go command is used (HSITRIM is notcorrectly reset).Enabling SRAM parity check option byte causesbootloader crash if the SRAM is not initializedbefore enabling this feature.</td></tr><tr><td colspan="1" rowspan="2">V11.3</td><td colspan="1" rowspan="1">Fixed V11.2 limitations andadded SW enhancements</td><td colspan="1" rowspan="2">Empty check flag cleared by bootloader at bootCompatibility break on boot sequence versusolder versions(1)Erase sectors not working as expectedRoot cause: Wrong FLITF BUSY bit checkleading to not waiting for the erase operationtermination.Workaround: Erase only by one sector and wait40 ms for the erase termination before runningthe next operation.I2C stretches the line on the connection causingissues with some HW hostsRoot cause: USART3 detection method changedcompared to the V11.2: a loop is added when alow edge is detected on the RX pin as the BL SWstart baudrate calculations expecting it is thebegining of Ox7F byte. When the RX pin PC11 istied to GND (manually on 64-pin packages or byproduction on low pin count packages), theUSART3 detection loop is done on everyBootloader detection phase, causing a timeoutwait when another peripheral is needed.Behavior: When connection to I2C is requested(host sends I2C address to the bootloader), theI2C HW detects the request ,but the BL SW isblocked on the USART3 SW loop, causing theI2C line stretching. Some HW hosts that do notsupport the stretching fail connecting withbootloader.Workaround: on 64-pin packages, do not putPC11 pin to GND. There is no workaround onlow pin count packages, the only solution is touse a HW host supporting the clock stretching.</td></tr><tr><td colspan="1" rowspan="1"></td></tr><tr><td colspan="1" rowspan="1">V11.4</td><td colspan="1" rowspan="1">Fixed V11.3 limitations</td><td colspan="1" rowspan="1">None</td></tr></table>

# 45.3.1 Compatibility break on boot sequence

Some enhancements introduced in V11.3 break the compatibility with the boot sequence of versions V11.2 and V11.1.

The major change is the addition of initialization of hardware peripherals (for the exact list refer to Section 45. 1) used by the bootloader to their default values (as defined in RM0444).

The main impact is seen in two cases:

1. When jumping to the bootloader from user flash, the first operation is to reset the peripherals to their default values.

2Usage of the "Empty check" boot mode

Empty check flag is raised by HW on a POR or option byte change when the user flash is empty.   
This detection leads to boot on the bootloader.   
As per the new boot sequence, the bootloader clears this flag.   
Using a reset while the user flash is not yet programmed leads to a wrong boot on an empty user flash.

Avoid resets (except POR or option byte change) while the user flash is not programmed by the bootloader.

# 46 STM32G0B0xx device bootloader

# 46.1 Bootloader configuration

The STM32G0B0xx bootloader is activated by applying Pattern 11 (described in Table 2). The following table shows the hardware resources used by this bootloader. Note that STM32G0B0xx do not have BOOT_LOCK(bit), so consider that when using Pattern 11.

Table 100. STM32G0B0xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLLclocked by HSI). If an external clock (HSE) is notpresent, the system is kept clocked from the HSI</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock can be used for all bootloaderinterfaces and must have one of the following values[ 32, 16, 2, 8] MHz. The PLLis used to generate48 MHz for USB and system clock.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The bootloader firmware is shared on two banks:- 28 Kbytes, starting from address Ox1FFF0000 until0x1FFF6FFF- Part of the 28 KB (0x1FFF8000 - 0x1FFFEFFF)</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the exit securablememory area is 0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:ICspeed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: O0b1011101x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> pi clock line sused n open-drain pullupmode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:IC speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1011101x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> piclock lne is used n open-drain pullupmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> pdata lie s used in open-drain pull-mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSBSpeed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  slave data iput used  push-pullpull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> slavdata utut used  pushull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  slavcock  us puh-ulul-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave ch select pn se  push-pul pull-down mode.Note:This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL low, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull,pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull,pull-down.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="3">DFU(2)</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in Forced Device mode. USBFS interrupt vector is enabled and used for USBDFU communications.Note: VDDUSB IO must be connected to 3.3 V asUSB peripheral is used by the bootloader.'</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V. USB DFU is not available on LQFP32 package.

# 46.2 Bootloader selection

Figure 62 shows the bootloader selection mechanism.

![](images/0838f84e82f8d050baa24c1cb1a899d0d3fb69cb3850eb1f79c59ab285bc7c7f.jpg)  
Figure 62. Bootloader selection for STM32G0B0xx

# 46.3 Bootloader version

Table 101 lists the STM32G0B0xx devices bootloader versions.

Table 101. STM32G0B0xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V13.0</td><td>Initial bootloader version</td><td>Erase multiple sectors not working on Bank2 - Root cause: wrong BUSY bit check on Bank2 leads to generate FLITF error after one sector erase — Workaround: erase only by one sector when targeting Bank2 Empty check flag cleared by error on the bootloader startup phase - Root cause: on the startup phase the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Caution: Avoid using reset on this case. if the system crashes, an option byte change or POR is needed to reboot.</td></tr></table>

# STM32G0B1xx/0C1xx device bootloader

# 47.1 Bootloader configuration

The STM32G0B1xx/0C1xx bootloader is activated by applying Pattern 11 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 102. STM32G0B1xx/0C1xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLLclocked by HSI).</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clockedby HSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The bootloader firmware is shared on two banks:- 28 Kbytes, starting from address Ox1FFF0000 until0x1FFF6FFF- Part of the 28 KB (0x1FFF8000 - 0x1FFFEFFF)</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset (if the hardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory areais 0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON- Target 7-bit address: 0b1011101x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON Target 7-bit address: 0b1011101x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pul, pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pul, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pul, pulldown mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-down.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in Forced device mode. USB FSinterrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.'</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: FDCAN1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD1 pin: FDCAN1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 47.2 Bootloader selection

Figure 63 shows the bootloader selection mechanism.

![](images/4effa18811baeb4a91140d55c49cefecf6004663be9d20ee60b5fda44a406938.jpg)  
Figure 63. Bootloader selection for STM32G0B1xx/0C1xx

# 47.3 Bootloader version

Table 103 lists the STM32G0B1xx/0C1xx devices bootloader versions.

Table 103. STM32G0B1xx/0C1xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td rowspan="2">V9.2</td><td rowspan="2">Initial bootloader version</td><td>When jumping to an application, the Go command disables the debug access port by writing a wrong value on the FLASH_ACR register (bit DBG_SWEN). Erase multiple sectors not working on Bank2</td></tr><tr><td>- Root cause: wrong BUSY bit check on Bank2 leads to generate FLITF error after one sector erase - Workaround: erase only by one sector when targeting Bank2 Empty check flag cleared by error on the bootloader startup phase — Root cause: on the startup phase the bootloader SW performs a</td></tr></table>

# 48 STM32G05xxx/061xx devices

# 48.1 Bootloader configuration

The STM32G05xxx/061xx bootloader is activated by applying Pattern 11 (described in Table 2). The following table shows the hardware resources used by this bootloader. Note that STM32G050x do not have BOOT_LOCK(bit), so consider that when using Pattern 11.

Table 104. STM32G05xxx/061xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (using PLLclocked by HSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.PA12 pin: remapped to PA10, as it is not available onWLCSP20, TSOPP20, and UFQFPN28 packages.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.PA11 pin: remapped to PA9, as it is not available onWLCSP20, TSOPP20, and UFQFPN28 packages.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTxbootloader</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USART2s.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: Ob1100010x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100010x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr></table>

# 48.2 Bootloader selection

Figure 64 shows the bootloader selection mechanism.

![](images/51ce9809505fb8829de6c3d304f88d814a3e77ce22c89bf5742d5e3c6b918a0d.jpg)  
Figure 64. Bootloader selection for STM32G05xxx/061xx

# 48.3 Bootloader version

Table 105 lists the STM32G05xxx/061xx devices bootloader versions.

Table 105. STM32G05xxx/061xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V5.0</td><td rowspan=1 colspan=1>Initial bootloaderversion</td><td rowspan=1 colspan=1>USART2 SW jiter issue on detection phase</td></tr><tr><td rowspan=1 colspan=1>V5.1</td><td rowspan=1 colspan=1>Fix V5.0limitation</td><td rowspan=1 colspan=1>Non-stretch command not working as expected and stretching the line- Root cause: wrong BUSY check leads to not entering BUSY bytegeneration while waiting for the Non stretch command to completeBehavior: when running a non-stretch commands instead of receiving aBUSY byte (0x76) while command is running; the BL is stretching the lineand no data are sent to the host. This is noticed only on the non-stretcherase command, as it can take few ms, and can cause an issue if the hostdoes not support the line stretching.- Workaround: patch in RAM to use the correct check</td></tr></table>

# 49 STM32G431xx/441xx devices

# 49.1 Bootloader configuration

The STM32G431xx/441xx bootloader is activated by applying Pattern 15 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 106. STM32G431xx/441xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 72 MHz (using the PLLclocked by HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clockedby HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, containthe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to the exit securable memory area@0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1010100x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PC4 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PA8 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1010100x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PC8 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USBDFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode. Noexternal pull-up resistor is required</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 49.2 Bootloader selection

The following figure shows the bootloader selection mechanism.

![](images/5504865e3d8fe61a0a866c0a48f1eae30c6d3adcb99322f6ccd3061f67fb2b19.jpg)  
Figure 65. Bootloader selection for STM32G431xx/441xx

# 49.3 Bootloader version

Table 107. STM32G431xx/441xx bootloader version   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.3 (0xD3)</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>CCSRAM not supported-ENGl area not exposed</td></tr><tr><td rowspan=1 colspan=1>V13.4 (0xD4)</td><td rowspan=1 colspan=1>- Fix V13.3 limitations- Add CCSRAM support- Add ENGI support</td><td rowspan=1 colspan=1></td></tr></table>

# 50 STM32G47xxx/48xxx devices

# 50.1 Bootloader configuration

The STM32G47xxx/48xxx bootloader is activated by applying Pattern 14 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 108. STM32G47xxx/48xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 72 MHz (using thePLL clocked by HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to beclocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address 0x1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="2">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="2">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1"></td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to the exit securable memoryarea @0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1010011x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC4 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1010011x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> clock lie s used  open-drain pull-mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_ SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1010011x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">C6 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC7 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull no pull-up, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1"> Input</td><td colspan="1" rowspan="1"> av i l  ull ulldown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull,npull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, n pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull,pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used forUSB DFU communications.Note: VDDUSB IO must be connected to 3.3 V asUSB peripheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 50.2 Bootloader selection

The following figures show the bootloader selection mechanism.

![](images/a0758cc8ef45ff26403beac45dab689e0da9ce19e48681556fc277049f0045aa.jpg)  
Figure 66. Bootloader selection for STM32G47xxx/48xxx

![](images/12326b8952480709f6f38148ddb9a430e26d67b47026d0368fb1cbe6c6d84071.jpg)  
Figure 67. Dual bank boot implementation for STM32G47xxx/48xxx bootloader V13.x

# 50.3 Bootloader version

Table 109. STM32G47xxx/48xxx bootloader version   

<table><tr><td colspan="1" rowspan="1">Version number</td><td colspan="1" rowspan="1">Description</td><td colspan="1" rowspan="1">Known limitations</td></tr><tr><td colspan="1" rowspan="1">V13.3 (0xD3)</td><td colspan="1" rowspan="1">Initial bootloader version</td><td colspan="1" rowspan="1">Boot from bank2 is not working</td></tr><tr><td colspan="1" rowspan="1">V13.4 (0xD4)</td><td colspan="1" rowspan="1">Fix V13.3 limitations</td><td colspan="1" rowspan="1">CCSRAM/ENGI not supported</td></tr><tr><td colspan="1" rowspan="1">V13.5 (0xD5)</td><td colspan="1" rowspan="1">- Fix V13.4 limitations- Add CCSRAM/ENGI support</td><td colspan="1" rowspan="1">None</td></tr></table>

# 51 STM32G491xx/4A1xx devices

# 51.1 Bootloader configuration

The STM32G491xx/4A1xx bootloader is activated by applying Pattern 15 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 110. STM32G491xx/4A1xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 72 MHz (using thePLL clocked by HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to beclocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address 0x1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securable memoryarea</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to the exit securable memoryarea @0x1FFF6800</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1011111x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC4 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1011111x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC8 pin: clock line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain pull-upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull no pull-up, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pul, pulldown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull,npull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pullpull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, n pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull,pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used forUSB DFU communications.Note: VDDUSB IO must be connected to 3.3 V asUSB peripheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

CR2 register is set to Ox1, the MiSO line is set to 3.3 V.

# 51.2 Bootloader selection

![](images/7a366d5d7ae7bef59d21224da146732a86d80f9b8221bceb06fdc7932f2c24df.jpg)  
Figure 68. Bootloader selection for STM32G491xx/4A1xx

# 51.3 Bootloader version

Table 111. STM32G491xx/4A1xx bootloader version   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 52 STM32H503xx devices

# 52.1 Bootloader configuration

The STM32H503xx bootloader is activated by applying Pattern 17 (described in Table 2).   
Table 112 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_2 (see Section 4.10), so it inherits all its constraints.

Table 112. STM32H503xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 200 MHz (using PLLclocked by the HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to beclocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox24000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">35 Kbytes, starting from address Ox0BF87000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Set asinput until USART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA5 pin: USART2 in transmission mode. Set asinput until USART2 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART3 in reception mode. Used inalternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA4 pin: USART3 in transmission mode. Set asinput until USART3 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz, 7-bit address, Targetmode, Analog filter ON Target 7-bit address: 0b1100111x, x = 0 for writeand x = 1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB pin: clock line is used in open-drain. pull upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB4 pin: data line is used in open-drain, pull upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA8 pin: slave clock line, used in push-pul, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB1 pin: slave data input line, used in push-pull nopull mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB10 pin: slave clock line, used in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB2 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> avau u ushpul pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">P1 pin: slave data output line, used in push-pull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P10 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used forUSB DFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, nopull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used forUSB DFU communications.Note: VDDUSB IO must be connected to 3.3 V asUSB peripheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode. Noexternal pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s FrameFormat = FDCAN_FRAME_FD_BRS-Mode = FDCAN_MODE_NORMALAutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: FDCAN1 in reception mode. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB15 pin: FDCAN1 in transmission mode. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I3C</td><td colspan="1" rowspan="1">I3C</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">- Mode: target mode- Aval timing:0x4E- DMA Reg RX: disabled-DMA Req TX: disabledStatus FIFO: disabled- DMA Req status: disabled DMA Req control: disabled IBI: enabled- Additional data after IBI ack-ed: 1 byte- IBI configuration: Mandatory Data Byte (MDB)— All IT disabled except RXFNE (Receive FIFOInterrupt)The RXFNE interruption is disabled after SYNCbyte detection by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: I3C1 in transmission mode. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: I3C1 in transmission mode. Used inalternate push-pull, no pull mode.</td></tr></table>

Table 113. STM32H503xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN/I3C)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent(MSB first)</td><td rowspan=1 colspan=1>Numberof datareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number of statusdata received(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>Changeproductstate</td><td rowspan=1 colspan=1>0x01</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>Product statetargetedEx: Ox00000017</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Reset</td><td rowspan=1 colspan=1>0x02</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit   
Returned data and status are formatted on the USB native protocol

# 52.2 Bootloader selection

![](images/4044871497352dd8c17ff9a6d0e03e183ce076f33a26c630d1acd83e776d81f0.jpg)  
Figure 69. Bootloader V14 selection for STM32H503xx

# 52.3 Bootloader version

Table 114. STM32H503xx bootloader version   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V14.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>Bootloader crash when jumping to it with (HiDe ProtectionLevel = 3 + product state ≥ Provisioned)</td></tr><tr><td rowspan=1 colspan=1>V14.2</td><td rowspan=1 colspan=1>- Fix known limitations- Change BL system clockfrom 160 to 200 MHz</td><td rowspan=1 colspan=1>None</td></tr></table>

# 53 STM32H523xx/533xx devices

# 53.1 Bootloader configuration

The STM32H523xx/533xx bootloader is activated by applying Pattern 17 (described in Table 2). Table 115 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_2 (see Section 4.10), so it inherits allits constraints.

Table 115. STM32H523x/533xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 200 MHz (using PLLclocked by the HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to beclocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">35 Kbytes, starting from address Ox0BF97000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Set asinput until USART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Set asinput until USART2 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD9 pin: USART3 in reception mode. Used inalternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD8 pin: USART3 in transmission mode. Set asinput until USART3 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1101110x, x = 0 for writeand x = 1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB8 pin: clock line is used in open-drain. pull upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">B pin: data line is used in open-drain, pull upmode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1101110x, x = 0 for writeand x = 1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA pin: clock line is used in open-drain. pull upmode.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain, pull upmode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC1 pin: slave data input line, used in push-pull, nopull mode in all packages except LQFP48,UFQFN48, and WLCSP39.PB15 pin: Slave data Input line, used in push-pull,no pull mode in LQFP48, UFQFN48, and WLCSP39packages.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> slav data utut leusein pushpull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB10 pin: slave clock line, used in push-pul o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">P pin slave chip select pin used in push-pull, pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P2 pin: slave data input line, used in push-pull nopull mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC11 pin: slave data output line, used in push-pull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">0 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used forUSB DFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, nopull mode.- No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN2 configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s FrameFormat = FDCAN_FRAME_FD_BRS— Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: FDCAN2 in reception mode. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: FDCAN2 in transmission mode. Used inalternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I3C</td><td colspan="1" rowspan="1">I3C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">- Mode: target mode- Aval timing:0x4E- DMA Reg RX: disabled- DMA Req TX: disabled Status FIFO: disabled DMA Req status: disabled- DMA Req control: disabled- IBI: enabled- Additional data after IBl ack-ed: 1 byte- IBI configuration: Mandatory Data Byte (MDB)- All IT disabled except RXFNE (Receive FIFOInterrupt). The RXFNE interruption is disabledafter SYNC byte detection by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: I3C1 in transmission mode. Used inalternate push-pull, no pull mode in all packagesexcept LQFP48, UFQFN48, and WLCSP39.PB8 pin: I3C1 in transmission mode. Used inalternate push-pull, no pull mode in LQFP48,UFQFN48 and WLCSP39 packages..</td></tr><tr><td colspan="1" rowspan="1">I3C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: I3C1 in transmission mode. Used inalternate push-pull, no pull mode.</td></tr></table>

Table 116. STM32H523xx/533xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN/I3C)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent(MSB first)</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Statusdatareceived</td></tr><tr><td rowspan=1 colspan=1>Changeproduct state</td><td rowspan=1 colspan=1>0x01</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>Product statetargetedEx: 0x00000017</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Reset</td><td rowspan=1 colspan=1>0x02</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>DataprovisioningOnly when BLis on HDPL = 1</td><td rowspan=1 colspan=1>0x83</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>RAM addresswhere data toprovision iswritten</td><td rowspan=1 colspan=1>- 0x0 ifsuccess- 0x1 if fail</td><td rowspan=1 colspan=1>- NA ifsuccess- Error codeif fail</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit   
Returned data and status are formatted on the USB native protocol

# 53.2 Bootloader selection

Figure 70 shows the bootloader selection mechanism.

![](images/c9b6d61d57017f3311a3f7c82fb33d93bc95c43bef5ac6005e12f3a970c0f9a4.jpg)  
Figure 70. Bootloader V14 selection for STM32H523xx/533xx

# 53.3 Bootloader version

Table 117. STM32H523xx/533xx bootloader version   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V14.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- PKG_ID wrongly detected when PKG_ID &gt; 0xF I2C/I3C not working on BL as wrong pinout applied</td></tr><tr><td rowspan=1 colspan=1>V14.2</td><td rowspan=1 colspan=1>Fix known limitations</td><td rowspan=1 colspan=1>None</td></tr></table>

# 54 STM32H562xx/563xx/573xx devices

# 54.1 Bootloader configuration

The STM32H562xx/563xx/573xx bootloader is activated by applying Pattern 17 (described in Table 2). Table 118 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_2 (see Section 4.10), so it inherits all its constraints.

Table 118. STM32H562xx/563xx/573xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 200 MHz (using PLL clockedby the HSI)</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">35 Kbytes, starting from address Ox0BF97000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pul-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Set as input untilUSART2 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD9 pin: USART3 in reception mode. Used in alternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD8 pin: USART3 in transmission mode. Set as input untilUSART3 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100101x, x = 0 for write and x = 1fr read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">c ullu </td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> pin data line is used in open-drain, pull up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C4</td><td colspan="1" rowspan="1">I2C4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C4 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Targt 7-bit address: 0b1100101x, x = 0 or write and x = 1fr read</td></tr><tr><td colspan="1" rowspan="1">I2C4_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PD2 pin: clock line is used in open-drain. pull up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C4_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PD13 pin: data line is used in open-drain, pull up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A  slave data input ie, used in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pul no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC1 pin: slave data input line, used in push, pull no pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  sav data tut euse ushul  ulmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB10 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> av h el us uul  ulmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave data input line, used in push-pull o pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  slave data output e, used in push-pul o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">AUSB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">A USB DP line. Used in alternate push-pull no pullmode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN2 configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL AutoRetransmission =NABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: FDCAN2 in reception mode. Used in alternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB13 pin: FDCAN2 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I3C</td><td colspan="1" rowspan="1">I3C</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">- Mode: target mode- Aval timing:0x4E-DMA Reg RX: disabled-DMA Req TX: disabledStatus FIFO: disabledDMA Req status: disabled- DMA Req control: disabled- IBI: enabled- Additional data after IBI ack-ed: 1 byte- IBI configuration: Mandatory Data Byte (MDB)-All IT disabled except RXFNE (Receive FIFO Interrupt)The RXFNE interruption is disabled after SYNC bytedetection by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: I3C1 in transmission mode. Used in alternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: I3C1 in transmission mode. Used in alternate push-pull, no pull mode.</td></tr></table>

Table 119. STM32H562xx/563xx/573xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN/I3C)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent(MSB first)</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Statusdatareceived</td></tr><tr><td rowspan=1 colspan=1>Change productstate</td><td rowspan=1 colspan=1>0x01</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>Product statetargetedEx: 0x00000017</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Reset</td><td rowspan=1 colspan=1>0x02</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>DataprovisioningOnly when BL ison HDPL = 1</td><td rowspan=1 colspan=1>0x83</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>RAM addresswhere data toprovision iswritten</td><td rowspan=1 colspan=1>- 0x0 ifsuccess- 0x1 if fail</td><td rowspan=1 colspan=1>- NA ifsuccess-Error codeif fail</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit   
Returned data and status are formatted on the USB native protocol

# 54.2 Bootloader selection

Figure 71 shows the bootloader selection mechanism.

![](images/bc83ea36580f701b3674a6d79d366e81a1a0a427fd2d940e0ffa77c0e4bed03a.jpg)  
Figure 71. Bootloader V14 selection for STM32H562xx/563xx/573xx

# 54.3 Bootloader version

Table 120. STM32H562xx/563xx/573xx bootloader version   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V14.5</td><td rowspan=1 colspan=1>Fix known limitations (</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V14.4</td><td rowspan=1 colspan=1>- Fix known limitations- Change BL system clockfrom 160 to 200 MHz</td><td rowspan=1 colspan=1>EEPROM sector erase not working on 1 Mbyte devices.</td></tr><tr><td rowspan=1 colspan=1>V14.3</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>Bootloader crash when jumping to it with the following condition(TrustZoneenabled + HiDe Protection = 3 + Product state ≥ Provisioned)</td></tr></table>

Only on 1 Mbytes devices.

A standalone EraseEEPROM function is added on the system memory at address 0x0BF9 F500. When an erase sector is needed:

Write at RAM address Ox2000 4000 (LSB to MSB)

Byte0: number of sectors to erase (N)   
d) Byte1 to N (every byte contains the sector number, that is, 0 to 7 for Bank1, 8 to 15 for Bank2)   
e) Example: to erase sector 3, 4, and 13, write Ox0303040D at address Ox20004000.

2After the erase, go back to the bootloader.

3.To continue using the bootloader, a reconnect is needed.

# 55 STM32H72xxx/73xxx devices

# 55.1 Bootloader configuration

The STM32H72xxx/73xxx bootloader is activated by applying Pattern 10 (described in Table 2). Table 121 shows the hardware resources used by this bootloader.

Table 121. STM32H72xxx/73xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 66 MHz (using PLL clocked bythe HSI</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox24000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">128 Kbytes, starting from address Ox1FF00000 contain thebootloader firmware. The bootloader start address is0x1FF09800.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage is set to Voltage Range 3.Bootloader SW is writing to the PWR_CR3 register using 4bytes, locking this register. Only Power off/on unlocks it. Thisis fixed on the BL with Ox93 version.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode. Set as input until USART1 isdetected on the BL version Ox93.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode. Set as input until USART2 isdetected on the BL version 0x93.</td></tr><tr><td colspan="1" rowspan="3">USART3 (on0/PB1)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used in alternatepush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used in alternatepush-pull, pull-down mode. Set as input until USART3 isdetected on the BL version Ox93.</td></tr><tr><td colspan="1" rowspan="3">USART3 (onPD8/P9)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD9 pin: USART3 in reception mode. Used in alternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD8 pin: USART3 in transmission mode. Used in alternatepush-pull, pull-down mode. Set as input until USART3 isdetected on the BL version Ox93.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011100x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock lie is usd inopen-rain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1"> data ne s usein open-rain o pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011100x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock i sus in oen-rain o pull ode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1"> data le s use  open-rain o pull moe.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ONTa 0  = =1fo read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1"> ata le s se  en-rain o pull moe.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  slave data tu  usein ush-pull o pulmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave clock le use n push-pull o pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pi slave data iput eusd in push-pull o pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pi slave data outut le used in push-pul o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P10 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P4 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE pin: slave clock line, used in push-pull, pull-dpwn mode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE1 pin: slave chip select pin used in push-pull, pull-upmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN (onPH13/PH14)</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/sData bit rate 1000 kbit/sFrameFormat = FDCAN_FRAME_FD_BRSMode = FDCAN_MODE_NORMAL AutoRetransmission =ENABLETransmitPause = DISABLEProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PH14 pin: FDCAN1 in reception mode. Used in alternatepush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PH13 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">FDCAN (onPD1/PD0)</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/sData bit rate 1000 kbit/sFrameFormat = FDCAN_FRAME_FD_BRSMode = FDCAN_MODE_NORMAL AutoRetransmission =ENABLETransmitPause = DISABLEProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: FDCAN1 in reception mode. Used in alternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD1 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, pull-down mode.</td></tr></table>

# 55.2 Bootloader selection

Figure 72 shows the bootloader selection mechanism.

![](images/d1083edfda6a35f5c4ec8964c4d563b46a30fc88f868fc7a00dea9782a10148e.jpg)  
Figure 72. Bootloader V9.0 selection for STM32H72xxx/73xxx

# 55.3 Bootloader version

Table 122 lists the STM32H72xxx/73xxx devices bootloader versions.

Table 122. STM32H72xxx/73xxx bootloader version   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>TCM_AXI OB cannot be modified using all BL interfaces- String returned describing the memory size when usingUSB is wrong</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>Fix all issues of previousrelease</td><td rowspan=1 colspan=1>- Crash loop when booting on the BL, setting RDP toLevel1, doing a reset or power on/off and the USB cableis plugged.BL is not working in RDP Level1 whenTCM_AXI_SHARED option byte is not &quot;O&quot;. Value of thisOB must be set to &quot;O&quot; before going to RDP L1.- Bootloader SW is writing to the PWR_CR3 register using4 bytes, which is locking this register. Only Power off/onwill unlock it.</td></tr><tr><td rowspan=1 colspan=1>V9.3</td><td rowspan=1 colspan=1>- Fix all issues ofprevious release.— Modify USART TXfrom push pull mode inthe previous versionsto input.</td><td rowspan=1 colspan=1>None</td></tr></table>

# 56 STM32H74xxx/75xxx devices

# 56.1 Bootloader configuration

The STM32H74xxx/75xxx bootloader is activated by applying Pattern 10 (described in Table 2). Table 123 shows the hardware resources used by this bootloader.

Table 123. STM32H74xxx/75xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 64 MHz using the HSI.The HSI clock source is used at startup (interfacedetection phase) and when USART or SPI or I2Cinterface is selected.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to beclocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Clock used for the FDCAN is fixed to 20 MHz and isderived from PLLQ</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, and208 Kbytes (reduced to 20 Kbytes in V9.1 version)starting from address Ox24000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">122 Kbytes, starting from address Ox1FF00000contain the bootloader firmware. The bootloader startaddress is 0x1FF09800.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset (if the hardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage is set to Range 3. Bootloader software writesto the PWR_CR3 register using 4 bytes, which locksthis register. Only Power off/on unlocks it. This isfixed on the bootloader with Ox91 version.</td></tr><tr><td colspan="1" rowspan="3">USART1 (onPA9/PA10</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode. Set as input untilUSART1 is detected on the bootloader version 0x91.</td></tr><tr><td colspan="1" rowspan="3">USART1 (onPB14/PB15</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: USART1 in reception mode.Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: USART1 in transmission mode. Used inalternate function push pull pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, no pull mode. Used in alternatepush-pull, pll-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode. Set as input untilUSART3 is detected on the bootloader version 0x91.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Onc initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-up mode. Set as input untilUSART3 is detected on the bootloader version 0x91.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:-I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ONTarget 7-bit address: 0b1001110x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pullmode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:IC speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ONTarget 7-bit address: Ob1001110x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pullmode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is: I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ONTarget 7-bit address: Ob1001110x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pullmode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A7 pin: slave data input line, used in push-pull, npull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> in slave data outut ne, used i push-pullnpull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave cloc eus pushl  ullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  slave chip select pin used n push-pull, npull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> ulpull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PI2 pin: slave data output line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  save clock eusei pushul  ulmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> i slave chip select pin used in push-pull, npull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> avtau use uhulpull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">1 pin: slave data output line, used in push-pull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P0 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE14 pin: slave data input line, used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used in push-pull,no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE1 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USBDFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, nopull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMALAutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PH14 pin: FDCAN1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PH13 pin: FDCAN1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr></table>

Note:

To connect to the bootloader USART1 using PB14/PB15 pins, user must send two synchronization bytes. Baudrate is limited to 115200.

DFU mode does not support USBREGEN mode. If STM32 is powered by an 1.8 V source, it is not possible to use the BL DFU unless 3.3 V is provided

# 56.2 Bootloader selection

Figure 73 shows the bootloader selection mechanism.

![](images/38bbca0507f8de8032eab4446ecad1049bc0046ad75077856d824d510ec8dedb.jpg)  
Figure 73. Bootloader V9.x selection for STM32H74xxx/75xxx

# 56.3 Bootloader version

Table 124 lists the STM32H74xxx/75xxx devices bootloader versions.

Table 124. STM32H74xxx/75xxx bootloader version   

<table><tr><td colspan="1" rowspan="1">Versionnumber</td><td colspan="1" rowspan="1">Description</td><td colspan="1" rowspan="1">Known limitations</td></tr><tr><td colspan="1" rowspan="1">V13.2(0xD2)</td><td colspan="1" rowspan="1">Initial bootloader version</td><td colspan="1" rowspan="1">- Go command is not working- USART2 connection is not working- SPI1 connection is not working- Mass erase does not work correctly on I2C (onlyBank2 is erased in this command)</td></tr><tr><td colspan="1" rowspan="1">V13.3(0xD3)</td><td colspan="1" rowspan="1">- Switch USB clock input from HSE to HSI48with CRS- Fix known limitations on the V13.2</td><td colspan="1" rowspan="1">- Bank erase is not working on USART/SPI and I2C- DFU mass-erase not working</td></tr><tr><td colspan="1" rowspan="1">V9.0(0x90)</td><td colspan="1" rowspan="1">- Add support of FDCAN interface- Fix V13.3 limitations- V9.0 is the latest version in production andreplaces V13.2 and V13.3</td><td colspan="1" rowspan="1">- First ACK not received on Go command whenusing USART or SPI- On the FDCAN write memory, write of data withlength &gt; 63 bytes fails If PB15 is set to GND, user cannot connect to BLinterfaces. Only the USB is able to connect as ituses interrupt for detection. PB15 must not bepulled down if USART1 on PB14/PB15 is not usedJump issue on some application.Application stackpointer must be lower than (RAM end @ - 16 bytes)to guarantee it is working- Additional reset needed after power off/on toenable connection to the BL interfaces. As aworkaround user can add a pull up on PA11 pin.'Cannot program the "CM4_BOOT_ADDx" optionbyte using BL in dual core case- FDCAN Get version command is giving a badFDCAN protocol version (0x11). It must be 0 x10(V1.0)SRAM1/SRAM2/SRAM3 (0x30000000-0x30047FFF) and ITCM memories not accessibleby the BL- Number of supported commands is wrong (13instead of 11)</td></tr><tr><td colspan="1" rowspan="1">V9.1(0x91)</td><td colspan="1" rowspan="1">Fix V9.0 limitations- Fix the configuration of PWR control registerCR3. Bootloader is no more blocking thechange of PWR source- Adjust USB, I2C erase and program timingsand fix themFix FDCAN version from V1.0 to V1.1- Fix write issue when using FDCAN- Fix missing PCROP disable in RDP level1regressionUpdate option byte support to handle allpossible use cases</td><td colspan="1" rowspan="1">If PB15 is set to GND, user cannot connect to BLinterfacesSRAM1/SRAM2/SRAM3 (0x30000000 to0x30047FFF) and ITCM memories not accessible bythe BLJump issue on some applications. Application stackpointer must be lower than (RAM end address - 16bytes) to guarantee it is workingErase on bank2 not working as expected- Root cause: check bad busy value while erasing onbank2.Behavior: when erase on bank2 is requested, SWexits while the operation is ongoing. Sending a newcommand invoking the flash memory after theerase can hang the system.Workaround: worst case erase timing from theproduct datasheet can be added after the erasecommand to allow the FLITF to complete the erase.A safer method is to use a RAM patch for the erasecommand.Same data are output on the USART1_TX PB14when using USART1 on PA10/PA9.- Root cause: both USART1 TX pins PA9 and PB14configured as alternate push pull-up andPB15/PB14 pins not disabled when PA10/PA9 setused by the customer.Behavior: same data are output on USART1 TXpins PA9 and PB14.Caution: take care to what PB14 is connected onyour design to not damage it when using USART1on PA10/PA9.Same data are output on the USART1_TX PA9 whenusing USART1 on PB15/PB14.- Root cause: both USART1 TX pins PB14 and PA9configured as alternate push pull-up and PA10/PA9pins not disabled when PB15/PB14 set used by thecustomer.Behavior: same data are output on USART1 TXpins PA9 and PB14.Caution: take care to what PA9 is connected onyour design to not damage it when using USART1on PB15/14.</td></tr><tr><td colspan="1" rowspan="1">V9.2(0x92)</td><td colspan="1" rowspan="1">Fix V9.1 limitations:- Same data on PA9 when USART1 is used onPB15/PB14.- Same data on PB14 when USART1 is usedon PA10/PA9.- Erase on bank2 not working as expected.Enhancements:- Erase timeouts increased</td><td colspan="1" rowspan="1">- If PB15 is set to GND, user cannot connect to BLinterfaces.- SRAM1/SRAM2/SRAM3 (0x30000000 to0x30047FFF) and ITCM memories not accessibleby the BL.Jump issue on some applications. Application stackpointer must be lower than (RAM end address - 16bytes) to guarantee it is working.</td></tr></table>

# 57

# STM32H7A3xx/7B3xx/7B0xx devices

# 57.1 Bootloader configuration

The STM32H7A3xx/7B3xx/7B0xx bootloader is activated by applying Pattern 10 (described in Table 2). Table 125 shows the hardware resources used by this bootloader.

Table 125. STM32H7A3xx/7B3xx/7B0xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 64 MHz using the HSI.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clockedby HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Clock used for the FDCAN is fixed to 20 MHz and isderived from PLLQ</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address 0x24000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">128 Kbytes, starting from address 0x1FF00000 containthe bootloader firmware. The bootloader start addressis 0x1FF0A000</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to prevent watchdogreset (if the hardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Bootloader software writes to PWR_CR3 register usingfour bytes, which locks it, only Power off/on unlocks it.Fixed on the bootloader with Ox92 versions.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode. Set as input untilUSART1 is detected on the bootloader version Ox92.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode. Set as input untilUSART2 is detected on the bootloader version Ox92.</td></tr><tr><td colspan="1" rowspan="3">USART3 on(PB10/PB11)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB11 pin: USART3 in reception mode. Used inalternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB10 pin: USART3 in transmission mode. Used inalternate push-pull, pull-down mode. Set as input untilUSART3 is detected on the bootloader version 0x92.</td></tr><tr><td colspan="1" rowspan="3">USART3 on(PD8/PD9)</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD9 pin: USART3 in reception mode. Used in alternatepush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD8 pin: USART3 in transmission mode. Used inalternate push-pull, pull-down mode. Set as input untilUSART3 is detected on the bootloader version 0x92.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ON- Target 7-bit address: 0b10101111x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is: I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ONTarget 7-bit address: 0b10101111x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PF1 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PFO pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is: I2C speed: up to 400 kHz, 7-bit address, Targetmode, Analog filter ONTarget 7-bit address: 0b10101111x (x = 0 for writeand x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex-8-bit MSBSpeed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, nopull-up no pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, nopull-up no pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A pn: slave clock line, used in push-pull o pul-up,no pull-up no pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> p: slave chip select pin used i push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSBSpeed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> p slave data input lne, used in push-pul o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">v  ulpull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> savcc u pul  ulmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PI0 pin: slave chip select pin used in push-pul, no pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC12 pin: slave data input line, used in push-pull, nopull mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> save at uu  usin ush-pulpull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC10 pin: slave clock line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI4</td><td colspan="1" rowspan="1">SPI4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI4 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI4_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE14 pin: slave data input line, used in push-pull, nopull up, no pull down mode</td></tr><tr><td colspan="1" rowspan="1">SPI4_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PE13 pin: slave data output line, used in push-pull, nopull up, no pull down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE12 pin: slave clock line, used in push-pull, no pull up,no pull down mode.</td></tr><tr><td colspan="1" rowspan="1">SPI4_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PE11 pin: slave chip select pin used in push-pull, nopull up, no pull down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USBDFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="3">FDCAN on(PH13/PH14)</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/sData bit rate 1000 kbit/sFrameFormat = FDCAN_FRAME_FD_BRSMode = FDCAN_MODE_NORMALAutoRetransmission = ENABLETransmitPause = DISABLEProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PH14 pin: FDCAN1 in reception mode. Used inalternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PH13 pin: FDCAN1 in transmission mode. Used inalternate push-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">FDCAN on(PD1/PD0)</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/sData bit rate 1000 kbit/sFrameFormat = FDCAN_FRAME_FD_BRSMode = FDCAN_MODE_NORMALAutoRetransmission = ENABLETransmitPause = DISABLEProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: FDCAN1 in reception mode. Used in alternatepush-pull, pull-down mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD1 pin: FDCAN1 in transmission mode. Used inalternate push-pull, pull-down mode.</td></tr></table>

# 57.2 Bootloader selection

Figure 73 shows the bootloader selection mechanism.

![](images/2e57cfb4b4d48b274c0bd6c51cf3285494746f3826893eac258d16267c804aeb.jpg)  
Figure 74. Bootloader V9.x selection for STM32H7A3xx/7B3xx/7B0xx

# 57.3 Bootloader version

Table 126 lists the STM32H7A3xx/7B3xx/7B0xx devices bootloader versions.

Table 126. STM32H7A3xx/7B3xx/7B0xx bootloader version  

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>String returned describing the flash memory size whenusing USB is wrong (expected value 256 x 8 KB, butreturns 256 x 2 KB)OTP memory is not supported by the bootloader</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>Fixes all issues of previousrelease.</td><td rowspan=1 colspan=1>Crash loop when booting on the bootloader, settingRDP to Level1, doing a reset or power on/off and theUSB cable is plugged.Bootloader software is writing to the PWR_CR3register using four bytes, which is locking this register.Only Power off/on unlocks it</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>- Fix all issues of previousrelease- Modify USART TX frompush pull mode in theprevious versions to input.</td><td rowspan=1 colspan=1>None</td></tr></table>

# 58 STM32H7Rxxx/7Sxxx devices

# 58.1 Bootloader configuration

The STM32H7Rxxx/7S7xxx bootloader is activated by applying Pattern 17 (described in Table 2). Table 127 shows the hardware resources used by this bootloader.

Table 127. STM32H7Rxxx/7Sxxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 380 MHz using the PLLclocked by HSI</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN.</td></tr><tr><td colspan="1" rowspan="1">HSI48 enabled</td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox24020000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">32 Kbytes, starting from address 0x1FF18000 contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode. Set as input until USART1 isdetected on the bootloader version 0x91.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Oncinitialized, the configuration is 8bit, even parity, adone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, no pull mode. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, no pull mode. Set as input until USART3 isdetected on the bootloader version 0x91.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD9 pin: USART3 in reception mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD8 pin: USART3 in transmission mode. Set as input untilUSART3.</td></tr><tr><td colspan="1" rowspan="3">UART4</td><td colspan="1" rowspan="1">UART4</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">UART4_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: UART4 in reception mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">UART4_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD1 pin: UART4 in transmission mode. Set as input untilUART4 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C1(1)</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100001x (x = 0 for write and x =1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB8 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100001x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100001x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA8 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC9 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1"> n slave chip selct pn usein push-pulo pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> p slave data output ine, used in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1"> pi: slave chip select pin used in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pi slave data input line, usd in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: slave data output line, used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1"> pi: slave clock ine, used in push-pull, o pull mode.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1"> p slave chip select pin use in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PM12: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PM11: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/sFrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL— AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Rx pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: FDCAN2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN2_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB1 pin: FDCAN2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I3C1(1)</td><td colspan="1" rowspan="1">I3C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">- Mode: target mode- Aval timing:0x4EDMA Reg RX: disabledDMA Req TX: disabledStatus FIFO: disabledDMA Req status: disabledDMA Req control: disabled- IBI: Enabled- Additional data after IBI ACK-ed: 1 byte- IBI configuration: Mandatory Data Byte (MDB) All IT disabled except RXFNE (Receive FIFO Interrupt).The RXFNE interruption is disabled after SYNC bytedetection by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB8 pin: I3C1 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I3C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: I3C1 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr></table>

Cnd I3Cusvy  he an us ht yFLASHBW2R2CNIC.

Table 128. STM32H7Rxxx/7Sxxx special commands   

<table><tr><td rowspan=1 colspan=4>Special commands supported (USART/I2C/SPI/FDCAN/USB/I3C)Based on Go/Read commands on virtual addresses</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Command</td><td rowspan=1 colspan=1>Virtual address</td><td rowspan=1 colspan=1>Data received</td></tr><tr><td rowspan=1 colspan=1>Get Security State</td><td rowspan=2 colspan=1>Read</td><td rowspan=1 colspan=1>0xFF010001</td><td rowspan=2 colspan=1>4 bytes security status</td></tr><tr><td rowspan=1 colspan=1>Get product state</td><td rowspan=1 colspan=1>0xFF010002</td></tr><tr><td rowspan=1 colspan=1>Data Provisioning</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>0xFF83xxxx (xxxx indicates LSB address of thewrapper on the SRAM: 0x2404xxxx)</td><td rowspan=3 colspan=1>N/A</td></tr><tr><td rowspan=1 colspan=1>Change Product State</td><td rowspan=2 colspan=1>Go</td><td rowspan=1 colspan=1>0xFF0100xx (xx indicates new product state value:17 for provisioning, 72 for closed, and 5C for locked)</td></tr><tr><td rowspan=1 colspan=1>Change Secure OB</td><td rowspan=1 colspan=1>0xFF02xxxx (xxxx indicates LSB address of thewrapper on the SRAM: 0x2404xxxx)(1)</td></tr></table>

1. According to data written at address Ox2404xxxx, you can select option byte: 0 secure option byte i-Rot Select 1: secure option byte Writeprotection 2: secure option byte writeunprotect 3: secure option byte HDP.

(0x2404xxxx + 0x00000004).

Example: HDP options bytes: write at 0x24040000 the value 0x00000003 write at 0x24040004 the value 0x00EE0011 (EE: HDPend, 11:HDPstart) go at OxFF020000.

# 58.2 Bootloader selection

Figure 73 shows the bootloader selection mechanism.

![](images/6cc59e6b0fe8e9fb1b55576f8ad77a9a0691f25eef5141cba89787d968521827.jpg)  
Figure 75. Bootloader V14.x selection for STM32H7Rxxx/7Sxxx

# 58.3 Bootloader version

Table 129 lists the STM32H7Rxxx/7Sxxx devices bootloader versions.

Table 129. STM32H7Rxxx/7Sxxx bootloader version   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V14.3</td><td rowspan=1 colspan=1>Initial bootloader version, used only for RevY</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V14.4</td><td rowspan=1 colspan=1>Bootloader compatible with RevB</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V14.5</td><td rowspan=1 colspan=1>Change on security descriptor located on Ox1FF1FD00(256 bytes) to be aligned with latest SFSP release.</td><td rowspan=1 colspan=1>None</td></tr></table>

# 58.4 Jump to bootloader

If a user application jumping to the bootloader has the protection clock bits (xSPICKP or FMCCkP) enabled, the bootloader will be stuck/crash on the clock configuration.

The following fields cannot be modified when FMCCKP bit from RCC_CKPROT register is set to 1: PLL1ON, PLL2ON, PLL1QEN, PLL2REN, HSEON, HSION, CSION, FMCEN, FMCLPEN, and FMCRST.

The following fields cannot be modified when xSPICKP bit from RCC_CKPROTR register is set to 1: PLL2ON, PLL2SEN, PLL2TEN, HSEON, HSION, CSION, XSPIxEN, XSPIxLPEN, and XSPIxRST..

Refer to the section describing clock protection on RM0477.

At the startup; the bootloader deinitialises all the peripherals (including the clock), then reconfigures the clock based on PLL1 from HSl. In this case the bootloader is not be able to switch correctly to the needed default clock (crash or hang may be seen, depending on the application clock configuration)

Ensure that the protection clock bits (xSPICKP or FMCCKP) are disabled before jumping to the BL.

# 59 STM32L01xxx/02xxx devices

# 59.1 Bootloader configuration

The STM32L01xxx/02xxx bootloader is activated by applying Pattern 6 (described in Table 2). Table 130 shows the hardware resources used by this bootloader.

Table 130. STM32L01xxx/02xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 32 MHz with HSI 16MHz as clock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">2 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox1FF00000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART2 (onPA9/PA10</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART2 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART2 in transmission mode. Used ininput pull-up</td></tr><tr><td colspan="1" rowspan="3">USART2 (onPA2/PA3</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode.Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud ratefrom the host for USARTx.</td></tr><tr><td colspan="1" rowspan="5">SPI1 (for all devicepackages exceptTSSOP14)</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to 8MHz, Polarity: CPOL Iow, CPHA low, NSShardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pul, pulldown mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="5">SPI1 (only fordevices onTSSOP14 package)</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to8 MHz, Polarity: CPOL Iow, CPHA low, NSShardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA14 pin: slave data output line, used in push-pull,pull-down mode.Note: This IO is also used as SWCLK for debuginterface, as a consequence debugger cannotconnect to the device in "on-the-fly" mode when thebootloader is running.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pul, pull-down mode.Note: NSS pin synchronization is required onbootloader with SPI1 interface for devices onTSSOP14 package.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# Note:

Due to empty check mechanism present on this product, it is not possible to jump from user code to system bootloader. Such jump results in a jump back to user flash memory space. But if the first 4 bytes of user flash memory (at 0x0800 0000) are empty at the moment of the jump (i.e. erase first sector before jump or execute code from SRAM while flash is empty), then system bootloader is executed when jumped to.

# 59.2 Bootloader selection

The Table 76 shows the bootloader selection mechanism.

![](images/a75ed7d3aa225ba92f5fb2199501f553b645c0108f22b46741a4f03da5e1be00.jpg)  
Figure 76. Bootloader selection for STM32L01xxx/02xxx

MSv38476V1

# 59.3 Bootloader version

The following table lists the STM32L01xxx/02xxx devices bootloader versions.

Table 131. STM32L01xxx/02xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V12.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>Bootloader not functional with SPl1 interface for deviceson TSSOP14 package.</td></tr><tr><td rowspan=1 colspan=1>V12.3</td><td rowspan=1 colspan=1>Adds support of SPI interfacefor devices in TSSOP14package.</td><td rowspan=1 colspan=1>For the SPI1 interface for devices in TSSOP14, a fallingedge on NSS pin is required before staringcommunication, to properly synchronize the SPI interface.If the NSS pin is grounded (all time from device reset) theSPI communication is not synchronized and bootloaderdoes not work properly with the SPI interface.</td></tr></table>

#

# STM32L031xx/041xx devices

# 60.1 Bootloader configuration

The STM32L031xx/041xx bootloader is activated by applying Pattern 2 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 132. STM32L031xx/041xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 32 MHz with HSI 16MHz as clock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox1FF00000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART2 (onPA9/PA10</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART2 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART2 in transmission mode. Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2 (onPA2/PA3</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode.Used ininput pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud ratefrom the host for USARTx.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode, Full Duplex, 8-bit MSB, Speed up to8 MHz, Polarity: CPOL Iow, CPHA low, NSShardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

The bootloader Read/Write commands do not support SRAM space for this product.

# 60.2 Bootloader selection

Figure 77 shows the bootloader selection mechanism.

![](images/2158456c4a3bd61f89b0fb918ab44db03e55be2ee4cc4ef1e79102b38fe53d38.jpg)  
Figure 77. Bootloader selection for STM32L031xx/041xx

# 60.3 Bootloader version

Table 133 lists the STM32L031xx/041xx devices bootloader versions.

Table 133. STM32L031xx/041xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V12.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 61

# STM32L05xxx/06xxx devices

# 61.1 Bootloader configuration

The STM32L05xxx/06xxx bootloader is activated by applying Pattern 1 (described in Table 2). Table 134 shows the hardware resources used by this bootloader.

Table 134. STM32L05xxx/06xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 32 MHz with HSI 16 MHz asclock source.</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">Voltage range is set to Voltage Range 1.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# 61.2 Bootloader selection

Figure 78 shows the bootloader selection mechanism.

![](images/4b050442ea7861ebe209954f6c0bab2918d3476dcec2571f9266a46c8d57451e.jpg)  
Figure 78. Bootloader selection for STM32L05xxx/06xxx

# 61.3 Bootloader version

Table 135 lists the STM32L05xxx/06xxx devices bootloader versions:

Table 135. STM32L05xxx/06xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V12.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>PA13 set in alternate push-pull, pull-up mode and PA14set in alternate pull-up pull-down mode even if not used.</td></tr></table>

# 62 STM32L07xxx/08xxx devices

Two bootloader versions are available on STM32L07xxx/08xxx devices:

V4.x supporting USART1, USART2 USART2, and DFU (USB FS device). This version is embedded in STM32L072xx/73xx and STM32L082xx/83xx devices. V11.x supporting USART1, USART2, I2C1, I2C2, SPI1 and SPI2. This version is embedded in other STM32L071xx/081xx devices.

# 62.1 Bootloader V4.x

# 62.1.1 Bootloader configuration

The STM32L07xxx/08xxx bootloader is activated by applying Pattern 2 or Pattern 7 when dual bank boot feature is available (described in Table 2). Table 136 shows the hardware resources used by this bootloader.

Table 136. STM32L07xxx/08xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 32 MHz with HSI 16 MHz asclock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address Ox20000000, are used by thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode. USB FS interruptvector is enabled and used for USB DFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB FS DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB FS DP line. Used in alternate push-pull, nopull mode. No external pull-up resistor is required.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# 62.1.2 Bootloader selection

Figure 79 and Figure 80 show the bootloader selection mechanism.

# Figure 79. Dual bank boot implementation for STM32L07xxx/08xxx bootloader V4.x

![](images/0f6a4e3d5108b7b21021af09c14de27cefe59dd38fa43e9bfe69ac32e5d15144.jpg)

![](images/f1eaf85497ca04c87d8a1b090d65580859481aca7a642cdc7c59df31be5190be.jpg)  
Figure 80. Bootloader V4.x selection for STM32L07xxx/08xxx

MSv38442V1

# 62.1.3 Bootloader version

Table 137 lists the STM32L07xxx/08xxx devices bootloader versions.

Table 137. STM32L07xxx/08xxx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.0</td><td>Initial bootloader version</td><td>PA4, PA5, PA6 and PA7 IOs are configured in pull-down mode despite not used by bootloader - PA4, PA5, PA6 and PA7 IOs are configured in pull-down mode despite not</td></tr><tr><td>V4.1</td><td>This new version implements the Dual Bank Boot feature.</td><td>used by bootloader The USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add an USB HUB between the host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet delay. On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 62.2 Bootloader V11.x

# 62.2.1 Bootloader configuration

The STM32L07xxx/08xxx bootloader is activated by applying Pattern 2 or Pattern 7 when dual bank boot feature is available (see in Table 2). Table 138 shows the hardware resources used by this bootloader.

Table 138. STM32L07xxx/08xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 32 MHz with HSI 16 MHz asclock source.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox1FF00000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz, 7-bit address, Target mode,Analog filter ON- Target 7-bit address: Ob1000010x- (x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: I2C1 clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: I2C1 data line is used in open-drain no pull mode.</td></tr><tr><td rowspan="3">I2C2</td><td>I2C2</td><td>Enabled</td><td>The I2C2 configuration is: I2C speed: up to 400 kHz, 7-bit address, Target mode, Analog filter ON Target 7-bit address: 0b1000010x</td></tr><tr><td>I2C2_SCL pin</td><td>Input/output</td><td colspan="1">(x = 0 for write and x = 1 for read) PB10 pin: I2C2 clock line is used in open-drain no pull mode.</td></tr><tr><td>I2C2_SDA pin</td><td>Input/output</td><td colspan="1">PB11 pin: I2C2 data line is used in open-drain no pull mode.</td></tr><tr><td rowspan="7">SPI1 SPI2</td><td>SPI1</td><td>Enabled</td><td>The SPI1 configuration is: - Slave mode - Full Duplex - 8-bit MSB</td></tr><tr><td>SPI1_ MOSI pin</td><td>Input</td><td colspan="1">-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware. PA7 pin: slave data input line, used in push-pull, pull-down</td></tr><tr><td>SPI1_ MISO pin</td><td>Output</td><td colspan="1">mode PA pin: slave data output line, used in push-pull, pull-down</td></tr><tr><td>SPI1_SCK pin</td><td>Input</td><td colspan="1">mode PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td>SPI1_NSS pin</td><td>Input</td><td colspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode. Note: This IO can be tied to GND if the SPI master does not</td></tr><tr><td>SPI2</td><td>Enabled</td><td colspan="1">use it. The SPI2 configuration is: - Slave mode - Full Duplex - 8-bit MSB</td></tr><tr><td>SPI2_ MOSI pin</td><td>Input</td><td colspan="1">- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware. PB15 pin: slave data input line, used in push-pull pull-down</td></tr><tr><td>SPI2_ MISO pin</td><td></td><td colspan="1">mode PB4 pin: slave data output line, used in push-pull, pull-down</td></tr><tr><td>SPI2_SCK pin</td><td>Output Input</td><td colspan="1">mode PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td></td><td></td><td colspan="1">PB2 pin: slave chip select pin used in push-pull, pull-down mode.</td></tr><tr><td>SPI2_NSS pin</td><td>Input</td><td colspan="1">Note: This IO can be tied to GND if the SPI master does not use it.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for all bootloader interfaces. No external quartz is required for bootloader operations.

# 62.2.2 Bootloader selection

Figure 81 and Figure 82 show the bootloader selection mechanism.

![](images/2143a9a1efd454dc20978d1a147dd65fa98b4a7af6bc929f27f60d331b3f3923.jpg)  
Figure 81. Dual bank boot implementation for STM32L07xxx/08xxx bootloader V11.x

![](images/4a788fa6a5f6205ec18414f9e9acbe991158d70b74611a1c912abd06ca80792d.jpg)  
Figure 82. Bootloader V11.x selection for STM32L07xxx/08xxx

MSv38443V2

# 62.2.3 Bootloader version

Table 139 lists the STM32L07xxx/08xxx devices bootloader versions:

Table 139. STM32L07xxx/08xxx bootloader V11.x versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V11.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V11.2</td><td rowspan=1 colspan=1>This new version implements the Dual Bank Boot feature.</td><td rowspan=1 colspan=1>None</td></tr></table>

# 63 STM32L1xxx6(8/B)A devices

# 63.1 Bootloader configuration

The STM32L1xxx6(8/B)A bootloader is activated by applying Pattern 1 (described in Table 2). Table 140 shows the hardware resources used by this bootloader.

Table 140. STM32L1xxx6(8/B)A configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address Ox20000000, areused by the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>4 Kbytes, starting from address 0x1FF00000contain the bootloader firmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximumvalue and is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td rowspan=1 colspan=1>Power</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>Voltage is set to Voltage Range 1.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configuration is 8bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configuration is 8bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PD6 pin: USART2 in reception mode. Used inalternate push-pull, pul-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PD5 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baud ratefrom the host.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC, no external . No external quartz is required for the bootloader execution.

# 63.2 Bootloader selection

The figure below shows the bootloader selection mechanism.

# Figure 83. Bootloader selection for STM32L1xx6(8/B)A devices

![](images/2c41306edb311ffd06b74bbaea505f302cd6f9327560d2696e67e2fceb4ac830.jpg)

# 63.3 Bootloader version

The following table lists the STM32L1xxx6(8/B)A devices bootloader versions:

Table 141. STM32L1xxx6(8/B)A bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V2.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>When a Read Memory or Write Memory command isissued with an unsupported memory address and acorrect address checksum (i.e. address Ox6000 0000),the command is aborted by the bootloader device, but theNACK (0x1F) is not sent to the host. As a result, the nexttwo bytes ( the number of bytes to be read/written and itschecksum) are considered as a new command and itschecksum.(1)</td></tr></table>

squal al o perceived from the host, as the command is NACK-ed anyway (as an unsupported new command).

# 64 STM32L1xxx6(8/B) devices

# 64.1 Bootloader configuration

The STM32L1xxx6(8/B) bootloader is activated by applying Pattern 1 (described in Table 2).   
The following table shows the hardware resources used by this bootloader.

Table 142. STM32L1xxx6(8/B) configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>2 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware.</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>4 Kbytes, starting from address0x1FF00000 contain the bootloaderfirmware.</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to itsmaximum value and is periodicallyrefreshed to prevent watchdog reset (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td rowspan=1 colspan=1>Power</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>Voltage is set to Voltage Range 1.</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART1 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the USART2 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PD6 pin: USART2 in reception mode. Usedin alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PD5 pin: USART2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USARTx</td><td rowspan=1 colspan=1>SysTick timer</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Used to automatically detect the serial baudrate from the host.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC, no external . No external quartz is required for the bootloader execution.

# 64.2 Bootloader selection

The figure below shows the bootloader selection mechanism.

![](images/a62f06f56079d2cf4104104533f47496533048e58f56e87da5eafcb6ee7a774f.jpg)  
Figure 84. Bootloader selection for STM32L1xxx6(8/B) devices

# 64.3 Bootloader version

The following table lists the STM32L1xxx6(8/B) devices bootloader versions:

Table 143. STM32L1xxx6(8/B) bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V2.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1> When a Read Memory or Write Memory command isissued with an unsupported memory address and acorrect address checksum (i.e. address Ox6000 0000),the command is aborted by the bootloader device, butthe NACK (0x1F) is not sent to the host. As a result, thenext two bytes (the number of bytes to be read/writtenand its checksum) are considered as a new commandand its checksum.(1)- PA13/14/15 is configured in alternate push-pull (PA14in pull-down) even if not used.</td></tr></table>

qual al perceived from the host, as the command is NACK-ed anyway (as an unsupported new command).

# 65 STM32L1xxxC devices

# 65.1 Bootloader configuration

The STM32L1xxxC bootloader is activated by applying Pattern 1 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 144. STM32L1xxxC configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 16 MHzusing the HSl. This is used only forUSARTx and during USB detection for DFU(once the DFU is selected, the clock sourceis derived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock is mandatory only for theDFU and must be in the following range:[24, 16, 12, 8, 6, 4, 3, 2] MHz.The PLL is used to generate the USB48 MHz clock and the 32 MHz clock for thesystem clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU.Any failure (or removal) of the externalclock generates a system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address0x1FF00000 contains the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value and is periodicallyrefreshed to prevent watchdog resets (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage is set to Voltage Range 1.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configurationis 8 bits, even parity and 1 stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configurationis 8 bits, even parity and 1 stop bit. TheUSART2 uses its remapped pins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Usedin alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baudrate from the host for the USARTxbootloader.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pullmode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for the USARTx bootloader. This internal clock is also used the for DFU, but only for the selection phase. An external clock in the range of [24, 16, 12, 8, 6, 4, 3, 2] MHz is required for the execution of the DFU after the selection phase.

# 65.2 Bootloader selection

The figure below shows the bootloader selection mechanism.

![](images/3b8024a0149e357d48ee7d6c51bc3d971ecba8a381b22f025e7bd096d795f06d.jpg)  
Figure 85. Bootloader selection for STM32L1xxxC devices

# 65.3 Bootloader version

Table 145 lists the STM32L1xxxC devices bootloader versions.

Table 145. STM32L1xxxC bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.0</td><td>Initial bootloader version</td><td>- For the USART interface, two consecutive instead of one NACKs are sent when a Read Memory or Write Memory command is sent and the RDP level is active. - PA13/14/15 configured in alternate push-pull, pull (PA14 in pull-down) even if not used. - The USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add an USB HUB between the host and the MCU. This relaxes transactions</td></tr></table>

# 66 STM32L1xxxD devices

# 66.1 Bootloader configuration

The STM32L1xxxD bootloader is activated by applying Pattern 4 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 146. STM32L1xxxD configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 16 MHzusing the HSI. This is used only forUSARTx and during USB detection for DFU(once the DFU is selected, the clock sourceis derived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock is mandatory only forDFU and it must be in the following range:[24, 16, 12, 8, 6, 4, 3, 2] MHz.The PLL is used to generate the USB48 MHz clock and the 32 MHz clock for thesystem clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU.Any failure (or removal) of the externalclock generates a system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address0x1FF00000 contain the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value and is periodicallyrefreshed to prevent watchdog reset (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage is set to voltage range 1.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configurationis 8 bits, even parity, and one stop bit. TheUSART2 uses its remapped pins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Usedin alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baudrate from the host for USARTx bootloader.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pull mode.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx bootloader. This internal clock is used also for DFU, but only for the selection phase. An external clock in the range of [24, 16, 12, 8, 6, 4, 3, 2] MHz is required for DFU execution after the selection phase.

# 66.2 Bootloader selection

The figure below shows the bootloader selection mechanism.

![](images/810b9326a3ce7bcf1560c178b4f85a2001bea24e7bd456f4beb2dc33136a74c7.jpg)  
Figure 86. Bootloader selection for STM32L1xxxD devices

# 66.3 Bootloader version

The following table lists the STM32L1xxxD devices bootloader versions:

Table 147. STM32L1xxxD bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V4.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- In the bootloader code the PA13 (JTMS/SWDIO) I/O output speed isconfigured to 400 kHz, as a consequence some debugger cannotconnect to the device in Serial Wire mode when the bootloader isrunning.- When the DFU is selected, the RTC is reset and thus all RTCinformation (such as calendar, alarm) are lost including backupregisters.Note: When the USART bootloader is selected there is no change onthe RTC configuration (including backup registers).</td></tr><tr><td rowspan=1 colspan=1>V4.2</td><td rowspan=1 colspan=1>Fix V4.1 limitations (availableon Rev.Z devices only)</td><td rowspan=1 colspan=1>Stack overflow by 8 bytes when jumping to Bank1/Bank2 if BFB2 = 0or when Read Protection level is set to 2.Workaround: the user code must force in the startup file the top ofstack address before to jump to the main program. This can be donein the &quot;Reset_Handler&quot; routine.- When the Stack of the user code is placed outside the SRAM (at0x2000 C000) the bootloader cannot jump to that user code,considered invalid. This can happen with compilers that put the stackat a non-physical address at the top of the SRAM (at 0x2000 C000).Workaround: place manually the stack at a physical address.</td></tr><tr><td rowspan=1 colspan=1>V4.5</td><td rowspan=1 colspan=1>Fix V4.2 limitations.DFU interface robustnessenhancements (available onRev.Y devices only).</td><td rowspan=1 colspan=1>-For the USART interface, two consecutive NACKs (instead of one)are sent when a Read Memory or Write Memory command is sentand the RDP level is active.The USB bootloader fails on some machines using a high speedcontroller. The bootloader is detected. but then data transaction fails.Root causes:De-synchronization between USB controller and bootloader SW dueto the controller high speed transactions. Controller high speed inter-packet delay seems not sufficient for the bootloader SW (based oninterrupt routines) to serve all needed transactions (the delay neededby the BL is nearly 25 µs). Some servicing IT are missed. This resultsin a communication fail, causing Write command to fail.Workarounds:Add an USB HUB between the host and the MCU. This relaxestransactions inter-packet delay, and allows the BL SW to performcorrectly the task. Use USB controller/host that increase inter-packetdelay.On new designs, use DFU SW that fix the issue in user flash memory.</td></tr></table>

# 67

# STM32L1xxxE devices

# 67.1 Bootloader configuration

The STM32L1xxxE bootloader is activated by applying Pattern 4 (described in Table 2). The following table shows the hardware resources used by this bootloader.

Table 148. STM32L1xxxE configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="7">Common to all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 16 MHzusing the HSI. This is used only forUSARTx and during USB detection for DFU(once the DFU is selected, the clock sourceis derived from the external crystal).</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The external clock is mandatory only forDFU and it must be in the following range:[24, 16, 12, 8, 6, 4, 3, 2] MHz.The PLL is used to generate the USB48 MHz clock and the 32 MHz clock for thesystem clock.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled for the DFU.Any failure (or removal) of the externalclock generates system reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">4 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address0x1FF00000 contains the bootloaderfirmware.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to itsmaximum value and is periodicallyrefreshed to prevent watchdog reset (if thehardware IWDG option was previouslyenabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">Voltage is set to Voltage Range 1.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART1 configurationis 8 bits, even parity, and one stop bit.</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the USART2 configurationis 8 bits, even parity, and one stop bit. TheUSART2 uses its remapped pins.</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD6 pin: USART2 in reception mode. Usedin alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD5 pin: USART2 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baudrate from the host for USARTx bootloader.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB used in FS mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line.</td></tr></table>

The system clock is derived from the embedded internal high-speed RC for USARTx bootloader. This internal clock is used also for DFU, but only for the selection phase. An external clock in the range of [24, 16, 12, 8, 6, 4, 3, 2] MHz is required for DFU execution after the selection phase.

# 67.2 Bootloader selection

The figure below shows the bootloader selection mechanism.

![](images/9551174b2b3c3a737b002a3a4b92541c86d93de182c5f6121c07dd5b78905360.jpg)  
Figure 87. Bootloader selection for STM32L1xxxE devices

# 67.3 Bootloader version

Table 149 lists the STM32L1xxxE devices bootloader versions:

Table 149. STM32L1xxxE bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V4.0</td><td>Initial bootloader version</td><td>-For the USART interface, two consecutive NACKs (instead of 1 NACK) are sent when a Read Memory or Write Memory command is sent and the RDP level is active. PA13/14/15 configured in alternate push-pull, pull (PA14 in pull-down) even if not used. The USB bootloader fails on some machines using a high speed controller. The bootloader is detected. but then data transaction fails. Root causes: De-synchronization between USB controller and bootloader SW due to the controller high speed transactions. Controller high speed inter- packet delay seems not sufficient for the bootloader SW (based on interrupt routines) to serve all needed transactions (the delay needed by the BL is nearly 25 µs). Some servicing IT are missed. This results in a communication fail, causing Write command to fail. Workarounds: Add an USB HUB between the host and the MCU. This relaxes transactions inter-packet delay, and allows the BL SW to perform correctly the task. Use USB controller/host that increase inter-packet</td></tr></table>

# 68 STM32L412xx/422xx devices

# 68.1 Bootloader configuration

The STM32L412xx/422xx bootloader is activated by applying Pattern 16 (described in Table 2). Table 150 shows the hardware resources used by this bootloader.

Table 150. STM32L412xx/422xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clock source for systemclock configured to 72 MHz and for USART, I2C, SPI andUSB bootloader operation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clockedby HSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, containthe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate withbootloader if the voltage scaling range 2 is selected.Bootloader firmware does not configure voltage scalingrange value in PWR_CR1 register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">ntalizheguratin v y,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in inputno pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pullup mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in inputpull-up mode</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:IC speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: Ob1010010x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: Ob1010010x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">P piclock lne is used inopen-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: Ob1010010x(x = 0 for write and x = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slav datau  ushulul-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> stu  usulul-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">savcoc us pus-ulpullownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin:slave chip select pin used in push-pull, pu-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, pull-down mode.(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USBDFU communications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode.No external pull-up resistor is required</td></tr></table>

CR2 register is set to 0x1, the MiSO line will be set to 3.3 V.

Note:

If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be corrupted due to voltage issue. For more details, refer to product's datasheet and errata sheet.

# 68.2 Bootloader selection

The following figures show the bootloader selection mechanism.

# Figure 88. Dual bank boot Implementation for STM32L412xx/422xx bootloader V9.x

![](images/289214177a707480689270cb9d6eb716a33f7d86f7ae17f9967d394a54ab3a55.jpg)

MS35021V1

![](images/ab774024fdc6037e7cf197b484af810baabaf0b8be90b2a07481c0423ef0ab3e.jpg)  
Figure 89.Bootloader V13.x selection for STM32L412xx/422xx

# 68.3 Bootloader version

Table 151 lists the STM32L412xx/422xx devices bootloader version.

Table 151. STM32L412xx/422xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- On connection phase, USART responds with twoACK bytes (0x79) instead of one.- PcROP option bytes cannot be written asBootloader uses Byte access while PcROP mustbe accessed using half-word access.Workaround: load a code snippet in SRAM usingBootloader interface, then jump to it, and that codewrites PcROP value.</td></tr></table>

# 69

# STM32L43xxx/44xxx devices

# 69.1 Bootloader configuration

The bootloader V9.1 version is updated to fix known limitations relative to USB-DFU interface, and is implemented on devices with version information ID equal to Ox10 (refer to Table 153 for more details).

The STM32L43xxx/44xxx bootloader is activated by applying Pattern 16 (described in Table 2). Table 152 shows the hardware resources used by this bootloader.

Table 152. STM32L43xxx/44xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="8">Common to all</td><td colspan="1" rowspan="4">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for systemclock configured to 60 MHz and for USART, I2C, SPIand USB bootloader operation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clockedby HSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN interface isselected. The HSE must have one of the followingvalues [24,20,18,16,12,9,8,6,4] MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when HSE is enabled. Anyfailure (or removal) of the external clock generatessystem reset</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are usedby the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, containthe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value.It is periodically refreshed to prevent watchdog reset (ifthe hardware IWDG option was previously enabled bythe user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate withbootloader if the voltage scaling range 2 is selected.Bootloader firmware does not configure voltage scalingrange value in PWR_CR1 register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in inputno pull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity,and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate fromthe host for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is: I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON- Target 7-bit address: 0b1001000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is: I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is: I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ONTarget 7-bit address: 0b1001000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_ SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> save a ut  pusu ul-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> sav atu u pusululdown mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pul, pull-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave chi select  used  push-pullull-down mode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="4">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is:Baudrate 125 kbps, 11 -bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">TIM16</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE.Once the HSE frequency is determined, the systemclock is configured to 60 MHz using PLL and HSE.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USBDFU communications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode.No external pull-up resistor is required</td></tr></table>

Note:

If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be corrupted due to voltage issue. For more details, refer to product's datasheet and errata sheet.

SPI Tx (MISO) is handled by DMA. On the bootloader start-up after SPI initialization, as soon as the bit DMATx enable on SPI CR2 register is set to Ox1, the MISO line is set to 3.3 V.

# 69.2 Bootloader selection

The following figures show the bootloader selection mechanism.

![](images/1fd3d35fbc2d83691d8e26838dfa2c6660c986594913a5446cb9e4b6d25db9ad.jpg)  
Figure 90. Dual bank boot Implementation for STM32L3x2xx/44xxx bootloader V9.x

MS35021V1

![](images/25d41c5106d8f9f4fffa9c37ad96de7fe1d5022e8e554cdee619038ffdba754c.jpg)  
Figure 91. Bootloader V9.x selection for STM32L43xxx/44xxx

# 69.3 Bootloader version

Table 153 lists the STM32L43xxx/44xxx devices bootloader versions.

Table 153. STM32L43xxx/44xxx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V9.1</td><td>Initial bootloader version</td><td>Check the Version Information ID of your STM32L43xxx/44xxx device, which can be read at 0x1FFF6FF2 address. Version Information ID equal to OxFF: For memory write operations using DFU interface: If the buffer size is larger than 256 bytes and not multiple of 8 bytes, the write memory operation result is corrupted. Workaround: if the file size is larger than 256 bytes, add byte padding to align it on 8-bytes multiple size. - For the USB-DFU interface, the CRS (clock recovery system) is not correctly configured and this may lead to random USB communication errors (depending on temperature and voltage). In most case communication error will manifest by a "Stall" response to setup packets. - On the Go command, system bootloader de-init clears the RTCAPBEN bit in the RCC_APB1ENR register Workaround: manually call _HAL_RCC_RTC_CLK_ENABLE() in the software which sets the RTCAPBEN bit. Version Information ID equal to 0x10: None - PcROP option bytes cannot be written as Bootloader uses Byte access while PcROP must be accessed using half-word access.</td></tr><tr><td>V9.1 (continued)</td><td></td><td>SPI write operation fail Limitation: a. During bootloader SPI write flash memory operation, some random 64-bits (2 double-words) may be left blank at OxFF. Root cause: a. Bootloader uses 64-bits cast write operation which is interrupted by SPI DMA and it leads to double access on same flash memory address and the 64-bits are not written. Workarounds: a. WA1: add a delay between sending write command and its ACK request. Its duration must be the duration of the 256-Bytes flash memory write time.</td></tr><tr><td rowspan="3"></td><td>Initial bootloader version (continued)</td><td>b. WA2: read back after write and in case of error start write again. c. WA3: Patch in RAM to write in flash memory that implements write memory without 64-bits cast. WA1 and WA3 are more efficient than WA2 in terms of total programming time. How critical is the limitation: a. The limitation leads to a modification in customer SPI host</td></tr><tr><td></td><td colspan="1">software by adding 3-4 ms delay to each write operation. b. The delay is not waste because it is anyway the flash memory write period of time that host has to wait anyway (so instead of waiting by sending ACK requests, host will wait by delay). c. Limitation has been seen only on SPI and cannot impact USART/I2C/CAN</td></tr><tr><td></td><td colspan="1">- If the RTC is used by application prior to booting (through a system reset) on system bootloader, it is possible that CAN interface does not work correctly (cannot establish connection) unless a power cycle is performed or RTC is reset by application before booting on System Bootloader</td></tr></table>

# 0

# STM32L45xxx/46xxx devices

# 70.1 Bootloader configuration

The STM32L45xxx/46xxx bootloader is activated by applying Pattern 16 (described in Table 2). Table 154 shows the hardware resources used by this bootloader.

Table 154. STM32L45xx/46xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="8">Common to all</td><td colspan="1" rowspan="4">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 72 MHz and for USART, I2C, SPI and USBbootloader operation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI48 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz.The HSE is used only when the CAN interface is selected.The HSE must have one of the following values[24,20,18,16,12,9,8,6,4] MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when HSE is enabled. Anyfailure (or removal) of the external clock generates systemreset</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifthe voltage scaling range 2 is selected. Bootloader firmwaredoes not configure voltage scaling range value inPWR_CR1 register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON Target 7-bit address: 0b1001010x (x = 0 for write and x =1 ffor read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON Target 7-bit address: 0b1001010x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is: I2C speed: up to 1 MHz, 7-bit address, Target mode,Analog filter ON Target 7-bit address: 0b1001010x (x = 0 for write and x =1 for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pi: slave data input ne, used in push-pul pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is: Slave mode- Full Duplex- 8-bit MSBSpeed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> i slave dataoutut le,used n push-pull, pu-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P pin slave clock lne, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pi slave chip select pin used in push-pull, pull-ownmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="4">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is:Baudrate 125 kbps, 11 -bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">TIM16</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr><tr><td rowspan="4">DFU</td><td>USB</td><td>Enabled</td><td>USB FS configured in forced device mode. USB FS interrupt vector is enabled and used for USB DFU communications. Note: VDDUSB IO must be connected to 3.3 V as USB</td></tr><tr><td>USB_DM pin</td><td></td><td colspan="1">peripheral is used by the bootloader. PA11: USB DM line. Used in alternate push-pull, no pull</td></tr><tr><td>USB_DP pin</td><td>Input/output</td><td colspan="1">mode. PA12: USB DP line. Used in alternate push-pull, no pull mode.</td></tr><tr><td></td><td></td><td colspan="1">No external pull-up resistor is required</td></tr></table>

Note: If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be corrupted due to voltage issue. For more details, refer to product's datasheet and errata sheet.

# 70.2 Bootloader selection

The following figures show the bootloader selection mechanism.

# Figure 92. Dual bank boot implementation for STM32L45xxx/46xxx bootloader V9.x

![](images/26e9bf2852cc62aa20dc1dea9b84b06c75706ae2f434fab249614500df0efa0d.jpg)

MS35021V1

![](images/0ed6004b9a2416637b81b655bc07490d179e69509ec5f298b61f8126866c3136.jpg)  
Figure 93.Bootloader V9.x selection for STM32L45xxx/46xxx

# 70.3 Bootloader version

Table 155 lists the STM32L45xxx/46xxx devices bootloader versions.

Table 155. STM32L45xxx/46xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=5>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=15 colspan=1>V9.2</td><td rowspan=1 colspan=5></td><td rowspan=15 colspan=1>- PcROP option bytes cannot be written asBootloader uses Byte access while PcROPmust be accessed using half-word access.Workaround: load a code snippet in SRAMusing Bootloader interface then jump to it, andthat code writes the PcROP value.-SPI write operation fail limitation:a. During Bootloader SPI write flash memoryoperation, some random 64-bits (2 double-words) may be left blank at OxFF.Root cause:a. Bootloader uses 64-bits cast write operationwhich is interrupted by SPI DMA and it leads todouble access on same flash memory addressand the 64-bits are not writtenWorkarounds:a. WA1: add a delay between sending writecommand and its ACK request. Its durationmust be the duration of the 256-Bytes flashmemory write time.b. WA2: read back after write and in case oferror start write again.c. WA3: Patch in RAM to write in flash memorythat implements write memory without 64-bitscast. WA1 and WA3 are more efficient thanWA2 in terms of total programming timeHow critical is the limitation:a. The limitation leads to a modification incustomer SPI host software by adding 3-4 msdelay to each write operation.b. The delay is not waste because it is anywaythe flash memory write period of time that hosthas to wait anyway (so instead of waiting bysending ACK requests, host will wait by delay).c. Limitation has been seen only on SPI andcannot impact USART/I2C/CAN.</td></tr><tr><td rowspan=1 colspan=5>Initial bootloader version</td></tr><tr><td rowspan=1 colspan=2></td><td rowspan=1 colspan=3></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=1 colspan=2></td><td rowspan=1 colspan=3></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=1 colspan=5></td></tr><tr><td rowspan=2 colspan=1></td><td></td><td rowspan=2 colspan=3></td><td rowspan=2 colspan=1>a. The</td></tr><tr><td></td><td rowspan=1 colspan=1></td></tr><tr><td rowspan=1 colspan=2></td><td></td><td rowspan=1 colspan=2></td><td rowspan=1 colspan=1>customer</td></tr><tr><td rowspan=1 colspan=3></td><td rowspan=2 colspan=3></td></tr><tr><td></td><td></td><td rowspan=1 colspan=1></td></tr></table>

# 71 STM32L47xxx/48xxx devices

Two bootloader versions are available:

V10.x supporting USART, I2C and DFU (USB FS device).   
This version is embedded in STM32L47xxx/48xxx rev. 2 and rev. 3 devices.   
V9.x supporting USART, I2C, SPI, CAN and DFU (USB FS device).   
This version is embedded in STM32L47xxx/48xxx rev. 4 devices.

# 71.1 Bootloader V10.x

# 71.1.1 Bootloader configuration

The STM32L47xxx/48xxx bootloader is activated by applying Pattern 7 (described in Table 2). Table 156 shows the hardware resources used by this bootloader.

Table 156. STM32L47xxx/48xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="9">Common to all</td><td colspan="1" rowspan="5">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 24 MHz and for USART and I2C bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the USB interface is selected andthe LSE is not present. The HSE must have one of thefollowing values: 24, 20, 18, 16, 12,9, 8, 6, and 4 MHz.</td></tr><tr><td colspan="1" rowspan="1">LSE enabled</td><td colspan="1" rowspan="1">The LSE is used to trim the MSI which is configured to 48MHz as USB clock source. The LSE must be equal to32.768 kHz. If the LSE is not detected, the HSE is usedinstead if USB is connected.</td></tr><tr><td colspan="1" rowspan="1">MSI enabled</td><td colspan="1" rowspan="1">The MSI is configured to 48 MHz and is used as USB clocksource. The MSI is used only if LSE is detected, otherwise,HSE is used if USB is connected.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when LSE or HSE is enabled.Any failure (or removal) of the external clock generatessystem reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifthe voltage scaling range 2 is selected. Bootloader firmwaredoes not configure voltage scaling range value in PWR_CR1register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: USART1 in transmission mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">alizheguraton   ve pariy stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: USART2 in transmission mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onesop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC1 pin: USART3 in reception mode. Used i input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from the hostfor USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1000011x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">  data line is used in open-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1000011x (x = 0 for write and x = 1forread)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target modeAnalog filter ON- Target 7-bit address is 0b1000011x (x = 0 for write and x = 1fo read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="4">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB OTG FS configured in forced device mode</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pull mode.No external pull-up resistor is required</td></tr><tr><td colspan="1" rowspan="1">TIM17</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 24 MHz using PLL and HSE.</td></tr></table>

For USARTx and I2Cx bootloaders no external clock is required.

USB bootloader (DFU) requires either an LSE (low-speed external clock) or a HSE (highspeed external clock):

If the LSE is present regardless of the HSE presence, the MSI is configured and trimmed by the LSE to provide an accurate clock equal to 48 MHz, which is the clock source of the USB. The system clock is kept clocked to 24 MHz by the HSI. If the HSE is present, the system clock and USB clock are configured, respectively, to 24 MHz and 48 MHz with HSE as clock source.

# 71.1.2 Bootloader selection

Figure 94 and Figure 95 show the bootloader selection mechanism.

# Figure 94. Dual bank boot implementation for STM32L47xxx/48xxx bootloader V10.x

![](images/3793e0eb9cb3106df1306f993698ecb02e9fdeaa6b69660f51de0a5f5428fba3.jpg)

![](images/3b8964e2532f2a25908f7a1ec55ae9a3a17b0260b77a654e1721066cff5093bf.jpg)  
Figure 95.Bootloader V10.x selection for STM32L47xxx/48xxx

# 71.1.3 Bootloader version

Table 157 lists the STM32L47xxx/48xxx devices bootloader V10.x versions:

Table 157. STM32L47xxx/48xxx bootloader V10.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V10.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>For memory write operations using DFU interface: Ifthe buffer size is larger than 256 bytes and notmultiple of 8 bytes, the write memory operation resultis corrupted.Workaround: if the file size is larger than 256 bytes,add byte padding to align it on 8-bytes multiple size.Write in SRAM is corrupted.</td></tr><tr><td rowspan=1 colspan=1>V10.2</td><td rowspan=1 colspan=1>Fix write in SRAM issue</td><td rowspan=1 colspan=1>For memory write operations using DFU interface: Ifthe buffer size is larger than 256 bytes and notmultiple of 8 bytes, the write memory operation resultis corrupted.Workaround: if the file size is larger than 256 bytes,add byte padding to align it on 8-bytes multiple size.</td></tr><tr><td rowspan=1 colspan=1>V10.3</td><td rowspan=1 colspan=1>Add support of MSI as USB clocksource (MSI is trimmed by LSE).Update dual bank boot feature tosupport the case when user stackis mapped in SRAM2.</td><td rowspan=1 colspan=1> For memory write operations using DFU interface: Ifthe buffer size is larger than 256 bytes and notmultiple of 8 bytes, the write memory operationresult is corrupted.Workaround: if the file size is larger than 256 bytes,add byte padding to align it on 8-bytes multiple size.PcROP option bytes cannot be written asBootloader uses Byte access while PcROP must beaccessed using half-word access.Workaround: load a code snippet in SRAM using thebootloader interface, then jump to it, and that codewrites the PcROP value.</td></tr></table>

# 71.2 Bootloader V9.x

# 71.2.1 Bootloader configuration

The STM32L47xxx/48xxx bootloader is activated by applying Pattern 7 (described in Table 2). Table 158 shows the hardware resources used by this bootloader.

Table 158. STM32L47xxx/48xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="9">Common to all</td><td colspan="1" rowspan="5">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 72 MHz and for USART and I2C bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the USB interface is selectedand the LSE is not present. The HSE must have one of thefollowing values: 24, 20, 18, 16, 12, 8, 6, 4 MHz.System is clocked at 72 MHz if USB is used or 60 MHz ifCAN is used.</td></tr><tr><td colspan="1" rowspan="1">LSE enabled</td><td colspan="1" rowspan="1">The LSE is used to trim the MSI which is configured to 48MHz as USB clock source. The LSE must be equal to32.768 kHz. If the LSE is not detected, the HSE is usedinstead if USB is connected.</td></tr><tr><td colspan="1" rowspan="1">MSI enabled</td><td colspan="1" rowspan="1">The MSI is configured to 48 MHz and is used as USB clocksource. The MSI is used only if LSE is detected, otherwise,HSE is used if USB is connected.</td></tr><tr><td colspan="1" rowspan="1">CSS</td><td colspan="1" rowspan="1">The CSS interrupt is enabled when LSE or HSE is enabled.Any failure (or removal) of the external clock generatessystem reset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">13 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifthe voltage scaling range 2 is selected. Bootloaderfirmware does not configure voltage scaling range value inPWR_CR1 register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is8-bt, even parity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is even parity, and one sto bt</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: Ob1000011x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock lne is used in open-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1000011x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB1 pin: data lne is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget mode-Analog filter ONTarget 7-bit address: Ob1000011x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-down mode(1)</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1"> slave clock ne sed  push-pull, pulownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  sav attu u push-pulull-down mode(1)</td></tr><tr><td colspan="1" rowspan="1">SPI2_ SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB3 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="3">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is: Baudrate 125kbps, 11-bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode. USB FSinterrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11 pin: USB FS DM line. Used in alternate push-pull, nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12 pin: USB FS DP line. Used in alternate push-pull, nopull mode. No external pull-up resistor is required.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

If the HSE is present, the system clock and USB clock are configured, respectively, to 72 and 48 MHz with PLL (clocked by HSE) as a clock source.

# Note:

If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be corrupted due to voltage issue. For more details, refer to product's datasheet and errata sheet.

# 71.2.2 Bootloader selection

Figure 96 and Figure 97 show the bootloader selection mechanism.

# Figure 96. Dual bank boot implementation for STM32L47xxx/48xxx bootloader V9.x

![](images/40c8428ab5c6f6e02e64df7a5d625f95e692c34e577b5b1ca94a4c76b2b53524.jpg)

![](images/aa1f91aa9264dd6b63998c022b20390eac04ba93119f5a504302d12adcafe5e9.jpg)  
Figure 97.Bootloader V9.x selection for STM32L47xxx/48xxx

MSv38404V1

# 71.2.3 Bootloader version

Table 159 lists the STM32L47xxx/48xxx devices bootloader V9.x versions:

Table 159. STM32L47xxx/48xxx bootloader V9.x versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>For memory write operations using DFU interface: If thebuffer size is larger than 256 bytes and not multiple of 8bytes, the write memory operation result is corrupted.Workaround: if the file size is larger than 256 bytes, addbyte padding to align it on 8-bytes multiple size.Write in SRAM is corrupted</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>Deprecated version (not used)</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>Fix write in SRAM issue</td><td rowspan=1 colspan=1>For memory write operations using DFU interface: If thebuffer size is larger than 256 bytes and not multiple of 8bytes, the write memory operation result is corrupted.Workaround: if the file size is larger than 256 bytes, addbyte padding to align it on 8-bytes multiple size.PcROP option bytes cannot be written as the bootloaderuses byte access while PcROP must be accessed usinghalf-word access.Workaround: load a code snippet in SRAM usingBootloader interface then jump to it, and that codewrites the PcROP value.During bootloader SPI write flash memory operation,some random 64 bits (2 double-words) may be left blankat OxFF.Root cause: the bootloader uses 64-bit cast writeoperation, interrupted by SPI DMA. This leads to doubleaccess on same flash memory address, and the 64 bitsare not written.Workarounds: WA1: add a delay between sending write commandand its ACK request. Its duration must be the durationof the 256-byte flash memory write time.WA2: read back after write, and, in case of error, startwrite again.WA3: patch in RAM to write in flash memory thatimplements write without 64-bit cast.WA1 and WA3 are more efficient than WA2 in terms oftotal programming time.The limitation leads to a modification in customer SPIhost software by adding 3-4 ms delay to each writeoperation. This time is not lost, because it is anyway theflash memory write time, the host must wait anyway (soinstead of waiting by sending ACK requests, host waitsby delay).Limitation has been seen only on SPl and cannot impactUSART/I2C/CAN/USB.</td></tr></table>

# 72 STM32L496xx/4A6xx devices

# 72.1 Bootloader configuration

The STM32L496xx/4A6xx bootloader is activated by applying Pattern 6 (described in Table 2). Table 160 shows the hardware resources used by this bootloader.

Table 160. STM32L496xx/4A6xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="8">Common to all</td><td colspan="1" rowspan="4">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clock source for system clockconfigured to 72 MHz and for USART, I2C and SPI bootloaderoperation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN interface is selected.The HSE must have one of the following values:24,20,18,16,12,9,8,6,4 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when HSE is enabled. Anyfailure (or removal) of the external clock generates systemreset</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifvoltage scaling range 2 is selected. Bootloader firmware doesnot configure voltage scaling range value in PWR_CR1register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit adress: 0b1001100x (x = 0for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1001100x (x = 0 for write and x = 1fo read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1001100x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clock lie is used in open-drain o pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> p slave data input e, used in push-pul pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pslave data input ie, usedin push-pul pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin: slave data output line, used in push-pul pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="4">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is:Baudrate 125kbps, 11 -bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">TIM16</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr><tr><td rowspan="4">DFU</td><td>USB</td><td>Enabled</td><td>USB OTG FS configured in forced device mode. USB OTG FS interrupt vector is enabled and used for USB DFU communications. Note: VDDUSB IO must be connected to 3.3 V as USB</td></tr><tr><td>USB_DM pin</td><td></td><td colspan="1">peripheral is used by the bootloader. PA11: USB DM line. Used in alternate push-pull, no pull</td></tr><tr><td>USB_DP pin</td><td>Input/output</td><td colspan="1">mode. PA12: USB DP line. Used in alternate push-pull, no pull</td></tr><tr><td></td><td></td><td colspan="1">mode. No external pull-up resistor is required</td></tr></table>

If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be corrupted due to voltage issue. For more details, refer to product's datasheet and errata sheet.

# 72.2 Bootloader selection

The figures below show the bootloader selection mechanism.

# Figure 98. Dual bank boot Implementation for STM32L496xx/4A6xx bootloader V9.x

![](images/dad8e3d6bd0fa194b78210e5fade4268c2651766f5c425f3d6443f43676e4582.jpg)

MS35021V1

![](images/1748f5bdd84005de48c950eeae66d8752ebdb899c9d86a29c5f60aa28f94914e.jpg)  
Figure 99.Bootloader V9.x selection for STM32L496xx/4A6xx

# 72.3 Bootloader version

Table 161 lists the STM32L496xx/4A6xx devices bootloader versions.

Table 161. STM32L496xx/4A6xx bootloader version   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V9.3</td><td>Initial bootloader version</td><td>The Bank Erase command is aborted by the bootloader device, and the NACK (0x1F) is sent to the host. Workaround: Perform Bank erase operation through page erase using the Erase command (0x44). SPI write operation fail Limitation: a. During Bootloader SPI write flash memory operation, some random 64-bits (2 double-words) may be left blank at OxFF. Root cause: a. Bootloader uses 64-bits cast write operation which is interrupted by SPI DMA and it leads to double access on same flash memory address and the 64-bits are not written Workarounds: a. WA1: add a delay between sending write command and its ACK request. Its duration must be the duration of the 256-Bytes flash memory write time. b. WA2: read back after write and in case of error start write again. c. WA3: Patch in RAM to write in flash memory that implements write memory without 64-bits cast. WA1 and WA3 are more efficient than WA2 in terms of total programming time How critical is the limitation: a. The limitation leads to a modification in customer SPI host software by adding 3-4 ms delay to each write operation. b. The delay is not waste because it is anyway the flash memory write period of time that host has to wait anyway (so instead of waiting by sending ACK requests, host will wait by delay). c. Limitation has been seen only on SPl and cannot impact USART/I2C/CAN. PcROP option bytes cannot be written as Bootloader uses Byte access while PcROP must be accessed using half-word access. Workaround: load a code snippet in SRAM using Bootloader interface then jump to it, and that code writes the PcROP value.</td></tr></table>

# 73 STM32L4P5xx/4Q5xx devices

# 73.1 Bootloader configuration

The STM32L4P5xx/4Q5xx bootloader is activated by applying Pattern 7 (described in Table 2). Table 164 shows the hardware resources used by this bootloader.

Table 162. STM32L4P5xx/4Q5xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="8">Common to all</td><td colspan="1" rowspan="4">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSI is used at startup as clock source for system clockconfigured to 60 MHz and for USART, I2C, SPI and USBbootloader operation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN interface is selected.The HSE must have one of the following values 24, 20, 18,16, 12, 9, 8, 6, 4 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when HSE is enabled. Anyfailure (or removal) of the external clock generates systemreset</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifthe voltage scaling range 2 is selected. Bootloader firmwaredoes not configure voltage scaling range value in PWR_CR1register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011011x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1011011x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011011x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">A pin: slave data input lie, used in push-pull, pul-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> slave data utut usei push-pul pullownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pul, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pul, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> v  u ulwmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr><tr><td colspan="1" rowspan="3">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is:Baudrate 125 kbps, 11 -bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate push-pull, no pullmode. No external pull-up resistor is required</td></tr></table>

# 73.2 Bootloader selection

Figure 102 and Figure 103 show the bootloader selection mechanisms.

![](images/0adb087c202e4da97108d1cdb797f74d881cb7548576c83dae0bd2b516c3abc8.jpg)  
Figure 100. Dual bank boot implementation for STM32L4P5xx/4Q5xx bootloader V9.x

![](images/5e6a9b2dcad198c294c162cb22f928bf45988e97763f82e8afae75702474ec67.jpg)  
Figure 101.Bootloader V9.x selection for STM32L4P5xx/4Q5xx

# 73.3 Bootloader version

Table 163 lists the STM32L4P5xx/4Q5xx devices bootloader versions.

Table 163. STM32L4P5xx/4Q5xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version on cut1.0 samples</td><td rowspan=1 colspan=1>- PcROP option bytes cannot be written asbootloader uses byte access while PcROP mustbe accessed using half-word access.Workaround: load a code snippet in SRAM usingbootloader interface then jump to it, and that codewrites PcROP value.</td></tr></table>

# 74 STM32L4Rxxx/4Sxxx devices

# 74.1 Bootloader configuration

The STM32L4Rxx/4Sxx bootloader is activated by applying Pattern 6 (described in Table 2).   
Table 164 shows the hardware resources used by this bootloader.

Table 164. STM32L4Rxxx/4Sxxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="8">Common to all</td><td colspan="1" rowspan="4">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The HSl is used at startup as clock source for system clockconfigured to 60 MHz and for USART, I2C, SPI and USBbootloader operation.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked byHSI 48 MHz.</td></tr><tr><td colspan="1" rowspan="1">HSE enabled</td><td colspan="1" rowspan="1">The HSE is used only when the CAN interface is selected.The HSE must have one of the following values: 24, 20, 18,16, 12, 9, 8, 6, 4 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The CSS interrupt is enabled when HSE is enabled. Anyfailure (or removal) of the external clock generates systemreset.</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">12 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28672 bytes starting from address Ox1FFF0000, containthe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. Itis periodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by theuser).</td></tr><tr><td colspan="1" rowspan="1">Power</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The DFU cannot be used to communicate with bootloader ifthe voltage scaling range 2 is selected. Bootloaderfirmware does not configure voltage scaling range value inPWR_CR1 register.</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in input no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in input nopull mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in input pull-upmode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in input pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in inputpull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USARTx</td><td colspan="1" rowspan="1">SysTick timer</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Used to automatically detect the serial baud rate from thehost for USARTx.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1010000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1010000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: Ob1010000x (x = 0 for write andx = 1 for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode-Full Duplex-8-bit MSBSpeed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  save ata iput  used push-pull, pullownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> savtu u pusulullowmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex8-bit MSB-Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: slave data output line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master doesnot use it.</td></tr><tr><td colspan="1" rowspan="4">CAN1</td><td colspan="1" rowspan="1">CAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the CAN1 configuration is:Baudrate 125 kbps, 11 -bit identifier.</td></tr><tr><td colspan="1" rowspan="1">CAN1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: CAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">CAN1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: CAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">TIM16</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">This timer is used to determine the value of the HSE. Oncethe HSE frequency is determined, the system clock isconfigured to 60 MHz using PLL and HSE.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP lineNo external pull-up resistor is required</td></tr></table>

# 74.2 Bootloader selection

Figure 102 and Figure 103 show the bootloader selection mechanisms.

# Figure 102. Dual bank boot implementation for STM32L4Rxxx/STM32L4Sxxx bootloader V9.x

![](images/5efcbfbcdbc524c3c5bdbcb087b110eaa09a27d5d7a0d969298dab474ad05da9.jpg)

![](images/ec988beccfa1b0a416bb0ad2489da0602109687be82c0bd7dc39d302c0aac706.jpg)  
Figure 103.Bootloader V9.x selection for STM32L4Rxx/4Sxx

MS49689V1

# 74.3 Bootloader version

Table 165 lists the STM32L4Rxx/4Sxx devices bootloader versions.

Table 165. STM32L4Rxx/4Sxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version on cut 1.0 samples</td><td rowspan=1 colspan=1>None</td></tr></table>

# 75 STM32L552xx/62xx devices

# 75.1 Bootloader configuration

The STM32L552xx/62xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 166 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits allits constraints.

Table 166. STM32L552xx/62xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Commonto all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLL clocked byHI).</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">CRS is enabled for the DFU to allow USB to be clocked by HSI48 MHz.</td></tr><tr><td colspan="1" rowspan="1">-</td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">32 Kbytes, starting from address Ox0BF90000.</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if the hardwareIWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address Target mode Analog filter ONa -0x =   x =read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> coc   s enra pullme.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1"> at usea pul </td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Taret 7-bit address: 0b0101100x (x = 0 for write and x = 1 forread)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b0101100x (x = 0 for write and x = 1 forread</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">coc  era pul </td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">  n pul </td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-down mode.Note: This IO can be tied to GND if the SPI master does not useit.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> v  u ulmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: slave data output line, used in push-pull, pulldownmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does not useit.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: slave data input line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PG10 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PG9 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">P pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does not useit.</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the FDCAN1 configuration is:-Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLE- TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input/</td><td colspan="1" rowspan="1">PB9 pin: FDCAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB8 pin: FDCAN1 in transmission mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.Note: VDDUSB IO must be connected to 3.3 V as USBperipheral is used by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

Table 167. STM32L552xx/62xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Datasent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZone disableMust be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression from RDPL1 to RDP 0.5Must be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame byte per byte. No need to add number of data to be   
transmitted   
Returned data and status are formatted on the USB native protocol

# 75.2 Bootloader selection

Figure 104 shows the bootloader selection mechanism.

![](images/8821e4bf93cf875f2a09962a6a6d63d948714fd465d18ccf60dec4b3b08ab735.jpg)  
Figure 104. Bootloader V9.x selection for STM32L552xx/62xx

# 75.3 Bootloader version

Table 168 lists the STM32L552xx/62xx devices bootloader versions.

Table 168. STM32L552xx/62xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.0</td><td rowspan=1 colspan=1>Initial bootloader version oncut1.0 samples</td><td rowspan=1 colspan=1>- USART3 not working- SPI3 not working- OB launch not working on USB-DFU- No read/write SRAM2 in all protocols- Read Secure Option bytes only implemented onUSART/I2C- Regression from TZEN = 1 to TZEN = 0 is doneautomatically on RDP regression</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Release supported only in cut2.0- Fix all issues on previousreleaseAdd FDCAN supportNew command added forTZEN disable-Support of sales type 256 KB</td><td rowspan=1 colspan=1>Unable to set TZEN to 1 option byte using allinterfaces of the BLNo workarounds available-Cannot set RDP level 0.5 nor option bytes inRDP level 0.5 using BL interfacesNo workarounds availableMultiple reset seen when enabling HW IWDGoption byte in TZEN = 1No workarounds availableUnable to set secure option bytes setting whenTZEN = 1 and RDP level is 0No workarounds available- Go command on USB is not working- FDCAN erase not working as page numberendianness is not aligned with the protocol(device waits for LSB first but host sends MSBfirst)-WA - Send data MSB first to the BL</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>- Fix all known limitations ofprevious release- Add enable BOOT_LOCK BLcommand- Add support of RDP L1 to 0.5regression</td><td rowspan=1 colspan=1>- Option byte programming is not workingproperly when using FDCAN interface. Thismakes the change of the Option byte noteffective until a power off/power on.- FDCAN erase not working as page numberendianness is not aligned with the protocol(device waits for LSB first but host sends MSBfirst)- WA - Send data MSB first to the BL</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>Fix all known limitations ofprevious release- Version for silicon revision Z</td><td rowspan=1 colspan=1>FDCAN Readout unprotect command does notsend the command ID to the host</td></tr></table>

# 76 STM32WB10xx/15xx devices

# 76.1 Bootloader configuration

The STM32WB10xx/15xx bootloader is activated by applying Pattern 6 (described in Table 2). Table 171 shows the hardware resources used by this bootloader.

Table 169. STM32wB10xx/15xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">MSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 64 MHz (using PLL clocked byMSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address 0x1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1001111x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain no pull mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, pull-downmode.Note: This IO can be tied to GND if the SPI master does notuse it.</td></tr></table>

# 76.2 Bootloader selection

Figure 105 shows the bootloader selection mechanism.

![](images/5bf0ccfcc68462fb45dd301bd3fd4b22d8120ada354bcea8cc55925bf2ffed18.jpg)  
Figure 105. Bootloader V11.x selection for STM32WB10xx/15xx

# 76.3 Bootloader version

Table 170. STM32WB10xx/15xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V11.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- I2C Write Protect command (0x73) performs a ReadUnprotect instead of disabling write protection.- Workaround: Use No-Stretch Write Unprotectcommand (0x74) that is performing correctly thewrite unprotect operation</td></tr></table>

#

# STM32WB30xx/35xx/50xx/55xx devices

# 77.1 Bootloader configuration

The STM32WB30xx/35xx/50xx/55xx bootloader is activated by applying Pattern 16 (described in Table 2). Table 171 shows the hardware resources used by this bootloader.

Table 171. STM32wB30xx/35xx/50xx/55xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>Common to all</td><td rowspan=2 colspan=1>RCC</td><td rowspan=1 colspan=1>MSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 64 MHz(using PLL clocked by MSI).</td></tr><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>CRS is enabled for the DFU to allow USBto be clocked by HSI 48 MHz.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>20 Kbytes, starting from address0x20000000, are used by the bootloaderfirmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>28 Kbytes, starting from address0x1FFF0000, contain the bootloaderfirmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to itsmaximum value. It is periodicallyrefreshed to prevent watchdog reset (ifthe hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit,even parity, and one stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode.Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address Target modeAnalog filter ON- Target 7-bit address: Ob1001111x (x = 0for write and x = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drainno pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB7 pin: data line is used in open-drainno pull mode.</td></tr></table>

Table 171. STM32WB30xx/35xx/50xx/55xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>I2C3</td><td rowspan=1 colspan=1>I2C3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON- Target 7-bit address: Ob1001111x (x = 0for write and x = 1 for read)</td></tr><tr><td rowspan=1 colspan=1>I2C3_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PCO pin: clock line is used in open-drainno pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C3_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PC1 pin: data line is used in open-drainno pull mode.</td></tr><tr><td rowspan=5 colspan=1>SPI1</td><td rowspan=1 colspan=1>SPI1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSShardware.</td></tr><tr><td rowspan=1 colspan=1>SPI1_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA7 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA6 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA4 pin: slave chip select pin used inpush-pull, pull-down mode.Note: This IO can be tied to GND if theSPI master does not use it.</td></tr></table>

Table 171. STM32WB30xx/35xx/50xx/55xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>SPI2</td><td rowspan=1 colspan=1>SPI2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSShardware.</td></tr><tr><td rowspan=1 colspan=1>SPI2_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB15 pin: slave data input line, used inpush-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI2_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PB14 pin: slave data output line, used inpush-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI2_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td rowspan=1 colspan=1>SPI2_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB12 pin: slave chip select pin used inpush-pull, pull-down mode.Note: This IO can be tied to GND if theSPI master does not use it.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB FS configured in forced devicemode.USB FS interrupt vector is enabled andused for USB DFU communications.Note: VDDUSB IO must be connected to3.3 V as USB peripheral is used by thebootloader.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA11: USB DM line. Used in input no pullmode.</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>PA12: USB DP line. Used in input no pullmode.No external pull-up resistor is required</td></tr></table>

# 77.2 Bootloader selection

Figure 106 shows the bootloader selection mechanism.

![](images/598b255df035d5ef4a28b75aa8d761a52d85b503d972eeb6c4e7bf598c044539.jpg)  
Figure 106. Bootloader V13.0 selection for STM32WB30xx/35xx/50xx/55xx

# 77.3 Bootloader version

Table 172. STM32WB30xx/35xx/50xx/55xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V13.5</td><td>Initial bootloader version</td><td>Readout Unprotect Command is not working properly as at the end of the command an NVIC_SystemReset is done instead of a flash option bytes reload. This makes the change of the RDP level not effective until a power off/on. I2C Write Protect command (0x73) performs a Read Unprotect instead of disabling write protection. Workaround: Uses No-Stretch Write Unprotect command (0x74) that is performing correctly the write unprotect operation</td></tr></table>

Note:

Instability when performing multiple resets during operations ongoing causing Overrun or FrameError errors on USART Bootloader and not recoverable unless Hardware Reset is performed. Fixed by workaround in FUS V1.0.1 and V1.0.2.

# 78 STM32WBA5xxx devices

# 78.1 Bootloader configuration

The STM32WBA5xxx bootloader is activated by applying Pattern12 (described in Table 2).   
Table 173 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits all its constraints.

Table 173. STM32WBA5xxx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLL clocked byHSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">6 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">28 Kbytes, starting from address Ox0BF88000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA8 pin: USART1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB12 pin: USART1 in transmission mode. Not set untilUSART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA11 pin: USART2 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA12 pin: USART2 in transmission mode. Not set untilUSART2 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1100110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB2 pin: clock line is used in open-drain pull up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB1 pin: data line is used in open-drain pull up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address Target mode Analog filter ON Target 7-bit address: 0b1100110x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA6 pin: clock line is used in open-drain pull up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PA7 pin: data line is used in open-drain pull up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB8 pin: slave data input line, used in push-pull, no pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA0 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">PA5 pin: slave chip select pin used in push-pull, no pull mode.</td></tr></table>

Table 174. STM32WBA5xxx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Statusdatareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZone disableMust be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression from RDPL1 to RDP 0.5Must be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock write protectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>OxYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

0xYY can have three values (0: WRP area, 1: WRP1A, 2: WRP2A)

# 78.2 Bootloader selection

![](images/e243dcf0c8ef8e5108eb1f0d4eee8fd00fb01001290dc9a38a0929129a43c537.jpg)  
Figure 107.Bootloader V11.x selection for STM32WBA5xxx

# 78.3 Bootloader version

Table 175. STM32WBA5xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V11.0</td><td rowspan=1 colspan=1>Initial bootloader version for Rev A samples</td><td rowspan=1 colspan=1>None</td></tr><tr><td rowspan=1 colspan=1>V11.1</td><td rowspan=1 colspan=1>Initial bootloader version for Rev B samples</td><td rowspan=1 colspan=1>None</td></tr></table>

# STM32WBA62xx/63xx/64xx/65xx devices

# 79.1 Bootloader configuration

The STM32WBA62xx/63xx/64xx/65xx bootloader is activated by applying Pattern12 (described in Table 2). Table 176 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits all its constraints.

Table 176. STM32WBA62xx/63xx/64xx/65xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>Common toall</td><td rowspan=2 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 60 MHz (using HSI throughPLL1 source).</td></tr><tr><td rowspan=1 colspan=1>HSE enabled</td><td rowspan=1 colspan=1>Enabled only when USB cable detected.HSE must be 32 MHz to have the USB working.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>12 Kbytes, starting from address Ox2000 0000 are used bythe bootloader firmwaree</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>64 Kbytes, starting from address Ox0BF9 0000, contain thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA8 pin: USART1 in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PB12 pin: USART1 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX.</td></tr><tr><td rowspan=3 colspan=1>USART3</td><td rowspan=1 colspan=1>USART3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=1 colspan=1>USART3_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA11 pin: USART3 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART3_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA12 pin: USART2 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX.</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1101111x (x = 0 for write and x = 1for read</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB2 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>PB1 pin: data line is used in open-drain no pull mode.</td></tr></table>

Table 176. STM32WBA62xx/63xx/64xx/65xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>I2C3</td><td rowspan=1 colspan=1>I2C3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C3 configuration is:I2C speed: up to 400 kHz- 7-bit addressTarget mode Analog filter ONTart 7- des 11011x  = 0o rite and x = 1for read)</td></tr><tr><td rowspan=1 colspan=1>I2C3_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA6 pin: clock line is used in open-drain no pull mode.</td></tr><tr><td rowspan=1 colspan=1>I2C3_SDA pin</td><td rowspan=1 colspan=1>PA7 pn data line is used in open-drain no pull mode.</td></tr><tr><td rowspan=5 colspan=1>SPI2</td><td rowspan=1 colspan=1>SPI2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI2 configuration is:Slave modeFull Duplex-8-bit MSBSpeed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI2_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB4 pin: Slave data Input line, used in alternate function withno pull.</td></tr><tr><td rowspan=1 colspan=1>SPI2_MISO pin(1)</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>no pull.</td></tr><tr><td rowspan=1 colspan=1>SPI2_SCK pin</td><td rowspan=2 colspan=1>Input</td><td rowspan=1 colspan=1>PA pin: Slave clock line, used in alternate function with nopull.</td></tr><tr><td rowspan=1 colspan=1>SPI2_ NSS pin</td><td rowspan=1 colspan=1> avhslc  salteanc wno pull.</td></tr><tr><td rowspan=5 colspan=1>SPI3</td><td rowspan=1 colspan=1>SPI3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI3 configuration is:Slave mode- Full Duplex- 8-bit MSB Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI3_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB8 pin: Slave data Input line, used in alternate function withpull down.</td></tr><tr><td rowspan=1 colspan=1>SPI3_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1> no pull.</td></tr><tr><td rowspan=1 colspan=1>SPI3_ SCK pin</td><td rowspan=2 colspan=1>Input</td><td rowspan=1 colspan=1>PA pin: Slave clock line, used in alternate function with nopull.</td></tr><tr><td rowspan=1 colspan=1>SPI3_ NSS pin</td><td rowspan=1 colspan=1>PA5 pin: slave chip select pin used in alternate function withno pull.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB configured in device mode. USB interrupt vector isenabled and used for DFU communications.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PD7: USB DM line. Used in alternate function, no pull mode.</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>PD6: USB DP line. Used in alternate function, no pull mode.No external pull-up resistor is required.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

Table 177. STM32WBA62xx/63xx/64xx/65xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Statusdatareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZone disableMust be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression from RDPL1 to RDP 0.5Must be run whenTZEN = 1 and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock write protectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

0xYY can have three values (0: WRP area, 1: WRP1A, 2: WRP2A)

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
• Sub-Opcode is treated in a single byte and not in two bytes   
C Data are sent on USB frame byte per byte. No need to add the number of data to be transmitted Returned data and status are formatted on the USB native protocol

# 79.2 Bootloader selection

![](images/15949da73706be216898f06e0bcf666b3314ffdb8e22e940487b8566aa440014.jpg)  
Figure 108.Bootloader V13.2 selection for STM32WBA62xx/63xx/64xx/65xx

# 79.3 Bootloader version

Table 178. STM32WBA62xx/63xx/64xx/65xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V13.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 80

# STM32WB05xx devices

# 80.1 Bootloader configuration

The STM32WB05xx bootloader is activated by applying Pattern 18 (described in Table 2).   
Table 179 shows the hardware resources used by this bootloader.

Table 179. STM32wB05xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz using HSI</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>The last 3 Kbytes of the last bank</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox10000000,contain the bootloader firmware</td></tr><tr><td rowspan=3 colspan=1>USART</td><td rowspan=1 colspan=1>USART</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, no parity</td></tr><tr><td rowspan=1 colspan=1>USART_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB0 pin: USART in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA1 pin: USART in transmission mode. Not set untilUSART is detected.</td></tr></table>

# 80.2 Bootloader selection

Figure 109 shows the bootloader selection mechanism.

![](images/1af10ef33243ec6cdc7c18a77e5ed97174eab05680d3e84dac3b357f75c51763.jpg)  
Figure 109. Bootloader V2.x selection for STM32wB05xx

# 80.3 Bootloader version

Table 180. STM32WB05xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V2.0</td><td rowspan=1 colspan=1>Final bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 31 STM32WB06xx/07xx devices

# 81.1 Bootloader configuration

The STM32WB06xx/07xx bootloader is activated by applying Pattern 18 (described in Table 2). Table 181 shows the hardware resources used by this bootloader.

Table 181. STM32wB06xx/07xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz using HSI</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>The last 3 Kbytes of the last bank</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox10000000,contain the bootloader firmware</td></tr><tr><td rowspan=3 colspan=1>USART</td><td rowspan=1 colspan=1>USART</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, no parity</td></tr><tr><td rowspan=1 colspan=1>USART_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA8 pin: USART in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART in transmission mode. Not set untilUSART is detected.</td></tr></table>

# 81.2 Bootloader selection

Figure 110 shows the bootloader selection mechanism.

![](images/58bd5aa0cbfd59ca86b38405a1265be5de970e1fc3ae93c0a4a9b844c9e3e0c2.jpg)  
Figure 110. Bootloader V4.x selection for STM32WB06xx/07xx

# 81.3 Bootloader version

Table 182. STM32WB06xx/07xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V4.0</td><td rowspan=1 colspan=1>Final bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 82 STM32WB09xx devices

# 82.1 Bootloader configuration

The STM32WB09xx bootloader is activated by applying Pattern 18 (described in Table 2).   
Table 183 shows the hardware resources used by this bootloader.

Table 183. STM32wB09xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz using HSI</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>The last 3 Kbytes of the last bank</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox10000000,contain the bootloader firmware</td></tr><tr><td rowspan=3 colspan=1>USART</td><td rowspan=1 colspan=1>USART</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, no parity</td></tr><tr><td rowspan=1 colspan=1>USART_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB0 pin: USART in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA1 pin: USART in transmission mode. Not set untilUSART is detected.</td></tr></table>

# 82.2 Bootloader selection

Figure 113 shows the bootloader selection mechanism.

![](images/417fc093380bdd25ad215a3236d812103fc112f0dd81b83fd08e4f34cf850d3a.jpg)  
Figure 111. Bootloader V1.x selection for STM32wB09xx

# 82.3 Bootloader version

Table 184. STM32WB09xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V1.0</td><td rowspan=1 colspan=1>Final bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 83 STM32WL3xxx devices

# 83.1 Bootloader configuration

The STM32WL3xxx bootloader is activated by applying Pattern 18 (described in Table 2).   
Table 185 shows the hardware resources used by this bootloader.

Table 185. STM32WL3xxx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>Common to all</td><td rowspan=1 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 16 MHz using HSI</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>The last 3 Kbytes of the last bank</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1>-</td><td rowspan=1 colspan=1>6 Kbytes, starting from address Ox10000000,contain the bootloader firmware</td></tr><tr><td rowspan=3 colspan=1>USART</td><td rowspan=1 colspan=1>USART</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Onc initialized, the configuration is 8-bit, o party</td></tr><tr><td rowspan=1 colspan=1>USART_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>For QFN48 package: UART Rx = PA15For QFN32 package: UART Rx = PB14</td></tr><tr><td rowspan=1 colspan=1>USART_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>UART Tx = PA1</td></tr></table>

# 83.2 Bootloader selection

Figure 112 shows the bootloader selection mechanism.

![](images/283e12b8c284563cb4bdc73831e1fe4033d6a66bd844a3b941734c20143d0e41.jpg)  
Figure 112. Bootloader V12.x selection for STM32WL3xxx

# 83.3 Bootloader version

Table 186. STM32WL3xxx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V4.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>None</td></tr></table>

# 84 STM32WLE5xx/55xx devices

# 84.1 Bootloader configuration

The STM32WLE5xx/55xx bootloader is activated by applying Pattern 13 (described in Table 2). Table 187 shows the hardware resources used by this bootloader.

Table 187. STM32WLE5xx/55xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 48 MHz (using PLLclocked by HSI).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8 Kbytes, starting from address Ox20000000, areused by the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address 0x1FFF0000,contain the bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximumvalue. It is periodically refreshed to preventwatchdog reset (if the hardware IWDG option waspreviously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, evenparity, and one stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used inalternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull,pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in push-pull,pull-down mode.Note: This IO can be tied to GND if the SPI masterdoes not use it.</td></tr></table>

# 84.2 Bootloader selection

Figure 113 shows the bootloader selection mechanism.

![](images/d39eeabf7614eb949b35de337c7de83fd954e9fc5ee6458e9eda91c328b85a2d.jpg)  
Figure 113. Bootloader V12.x selection for STM32WLE5xx/55xx

MSv38476V2

# 84.3 Bootloader version

Table 188. STM32WLE5xx/55xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V12.2</td><td rowspan=1 colspan=1>Initial bootloader version on rev. Z samples</td><td rowspan=1 colspan=1>BL cannot write/read the following option bytes:- FLASH_SFR (Offset - 0x80)- FLASH_SRRVR (Offset - 0x84)</td></tr><tr><td rowspan=1 colspan=1>V12.3</td><td rowspan=1 colspan=1>Final bootloader version on rev. Z samples</td><td rowspan=1 colspan=1>BL cannot write/read the following option bytes:- FLASH_SFR (Offset - 0x80)- FLASH_SRRVR (Offset - 0x84)</td></tr><tr><td rowspan=1 colspan=1>V12.4</td><td rowspan=1 colspan=1>Final bootloader version on rev. Y samples</td><td rowspan=1 colspan=1>BL cannot write/read the following option bytes:- FLASH_SFR (Offset - 0x80)- FLASH_SRRVR (Offset - 0x84)</td></tr></table>

# 85 STM32U031xx devices

# 85.1 Bootloader configuration

The STM32U031xx bootloader is activated by applying Pattern 11 (described in Table 2).   
Table 189 shows the hardware resources used by this bootloader.

Table 189. STM32u031xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="4">Common to all</td><td colspan="1" rowspan="1">RCC</td><td colspan="1" rowspan="1">HSI16enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (using PLL clocked byHS116).</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">5 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">14 Kbytes, starting from address Ox1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF3500</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART in reception mode. Used in alternatefunction input, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX. PA11 isremapped to PA9 on the TSSOP20 package.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART in reception mode. Used in alternate functioninput, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="4">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART in reception mode. Used in alternatefunction input, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="1">EXTI line 11</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">Used on detection on USART and its IT for baudratecalculation</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget modeAnalog filter ONTar 7-bi 01011  = 0fo rite and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB pin:clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1"> ul</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is: I2C speed: up to 400 Hz- 7-bit addressTarget mode- Analog filter ONTar 7-i ess: 1101011  = 0 o writ n  = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1"> ata   s inenai pll</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit addressTarget mode Analog filter ON nfor read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB3 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1"> data lie s used in open-drain pull-p mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:Slave mode- Full Duplex8-bit MSBSpeed up to 8 MHz Polarity: CPOL Iow, CPHA Iow, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pi slave data input le, used in alternate function, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">A pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA pin slave clock line, used in alternate function, pull-downmode. PA1 pin is used instead of PA5 on TSSOP20 package.Used on push-pull, pull-up mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in alternate function, pull-down mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in alternate function, nopull mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB3 pin: slave clock line, used in alternate function, no pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB2 pin: slave chip select pin used in alternate function, nopull mode.</td></tr></table>

SPI CR2 register is set to 1, the MISO line is set to 3.3 V.

# 85.2 Bootloader selection

Figure 114 shows the bootloader selection mechanism.

![](images/e23e2164486420870aef46683915a72c69fba85be933f70a97c33e6fc40769d6.jpg)  
Figure 114. Bootloader V11.x selection for STM32U031xx

# 85.3 Bootloader version

Table 190. STM32U031xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V11.1</td><td>Initial bootloader version</td><td>Empty check flag cleared by error on the bootloader startup phase Root cause: on the startup phase the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Caution: Avoid using reset on this case. if the system crashes, an option byte change or POR is needed to reboot.</td></tr></table>

# 86 STM32U073xx/83xx devices

# 86.1 Bootloader configuration

The STM32U073xx/83xx bootloader is activated by applying Pattern 11 (described in Table 2). Table 191 shows the hardware resources used by this bootloader.

Table 191. STM32U073xx/83xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="5">Common to all</td><td colspan="1" rowspan="2">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 24 MHz (using PLL clockedby HSI).</td></tr><tr><td colspan="1" rowspan="1">HSI48 enabled</td><td colspan="1" rowspan="1">The clock recovery system (CRS) is enabled for the DFUbootloader to allow USB to be clocked by HSI48 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">8.5 Kbytes, starting from address Ox2000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">26 Kbytes, starting from address 1FFF0000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="1">Securablememory area</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The address to jump to for the securable memory area is0x1FFF6000</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="4">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART in transmission mode. Kept in resetconfiguration until Ox7F is detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="1">EXTI line 11</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">Used on detection on USART and its IT for baudratecalculation</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address Target mode- Analog filter ONTas = 0  n=1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">PB7 pin: data lne is used in open-drain pullup mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 400 kHz- 7-bit address Target mode- Analog filter ONa =  for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1101010x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1"> clocs s e pull</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">PB pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> ulpull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pin slave data output lie,used in push pul pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_ SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in alternate function, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">vl ldown mode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI configuration is:- Slave mode-Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in alternate function,pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_ MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="2">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in alternate function, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">PB12 pin: slave chip select pin used in alternate function,pull-down mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB configured in device mode. USB interrupt vector isenabled and used for USB DFU communications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in additional function mode,behaving as input until communication starts.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in additional function mode,behaving as input until communication starts.</td></tr></table>

SPI CR2 register is set to 1, the MISO line is set to 3.3 V.

# 86.2 Bootloader selection

Figure 115 shows the bootloader selection mechanism.

![](images/041537b647e1ce492a520755a5fda9b19f47b0af37a7b80a6024c2ec3752ebbd.jpg)  
Figure 115. Bootloader V13.x selection for STM32U073xx/83xx

# 86.3 Bootloader version

Table 192. STM32U073xx/83xx bootloader versions   

<table><tr><td>Version number</td><td>Description</td><td>Known limitations</td></tr><tr><td>V13.0</td><td>Initial bootloader version</td><td>Empty check flag cleared by error on the bootloader startup phase - Root cause: on the startup phase the bootloader SW performs a system deinitialization, leading to write the default value on the FLASH_ACR register, which overrides the Empty check bit with 0 Behavior: when Empty check boot mode is used and the flash memory is empty, the MCU boots on the bootloader but the flag is cleared by the SW. If a reset is triggered, the system tries to boot on the empty flash memory, and crashes. Caution: Avoid using reset on this case. if the system crashes, an option byte change or POR is needed to reboot.</td></tr></table>

# B7 STM32U375xx/85xx devices

# 87.1 Bootloader configuration

The STM32U375xx/85xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 193 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits allits constraints.

Table 193. STM32U375xx/85xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Commonto all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">MSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 48 MHz (using MSIS source,that is, MSI divided by 2)).</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">48 MHz derived from the MSIK (MSI divided by 2) is used forFDCAN</td></tr><tr><td colspan="1" rowspan="1">HSI48</td><td colspan="1" rowspan="1">CRS is enabled for the DFU so that USB can be clocked byHSI 48 MHz</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">40 Kbytes, starting from address 0xBF8 F000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Kept in resetconfiguration until Ox7F detected on USART_RX.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 400 kHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1101100x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ONTaret 7-bi des: 101010x  = 0for rie n  = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">CO pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: Slave data Input line, used in alternate function withpull down. On release v14.2, PG4 pin is used instead of PA7on WLCSP68-G package. Used on alternate function with pulldown.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: Slave data output line used in alternate function withpull down. On release v14.2, PG3 pin is used instead of PA6on WLCSP68-G package. Used on alternate function with pulldown.</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: Slave clock line, used in alternate function with pulldown. On release v14.2, PG2 pin is used instead of PA5 onWLCSP68-G package. Used on alternate function with pulldown.</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in alternate function withpull down. On release v14.2, PG5 pin is used instead of PA4on WLCSP68-G package. Used on alternate function with pulldown.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD4 pin: Slave data Input line, used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PD3 pin: Slave data output line used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">  Slaveclock leuse inaltenate unction with pulldown.</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PD0 pin: slave chip select pin used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB5 pin: Slave data Input line, used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin(1)</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB4 pin: Slave data output line used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pi Slave clock line used in alternate function with pulldown.</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA15 pin: slave chip select pin used in alternate function withpull down.</td></tr><tr><td colspan="1" rowspan="3">FDCAN1</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the configuration is:-Connection bit rate 600 kbit/s- Data bit rate 2400 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL- AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input/</td><td colspan="1" rowspan="1">PB8 pin: FDCAN1 in reception mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: FDCAN1 in transmission mode. Used in alternatefunction, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB configured in device mode.USB interrupt vector is enabled and used for DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in alternate function with no pullmode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in alternate function with no pullmode. No external pull-up resistor is required.</td></tr><tr><td colspan="1" rowspan="3">I3C1</td><td colspan="1" rowspan="1">I3C</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Mode: target modeAval timing:0x4EDMA Reg RX: disabledDMA Req TX: disabledStatus FIFO: disabledDMA Req status: disabledDMA Req control: disabledIBI: enabledAdditional data after IBI ack-ed: 1 byteIBI configuration: Mandatory Data Byte (MDB)All IT disabled except RXFNE (Receive FIFOInterrupt)The RXFNE interruption is disabled after SYNC bytedetection by the bootloader.</td></tr><tr><td colspan="1" rowspan="1">I3C_SCL pin</td><td colspan="1" rowspan="1">Input/Output</td><td colspan="1" rowspan="1">PB13 pin: clock line is used in open-drain pull up mode.</td></tr><tr><td colspan="1" rowspan="1">I3C_SDA pin</td><td colspan="1" rowspan="1">Input/Output</td><td colspan="1" rowspan="1">PA1 pin: clock line is used in open-drain pull up mode.</td></tr></table>

SPI CR2 register is set to 0x1, the MISO line is set to 3.3 V.

# 87.2 SPI1 pinout on WLCSP68-G

The SPI1 pinout on the WLCSP68-G package is different from all the other packages: it uses pins PG5/PG2/PG3/PG4 instead of pins PA4/PA5/PA6/PA7. This makes it possible to use an independent voltage for the SPI1 pins through VDDIO2, to provide them a voltage different from the global MCU voltage (3.3 V).

When using 1.2 V for these pins, the HSLV feature must be enabled on PortG. To protect this feature, which can damage the pins in case of bad usage, some SW option bytes are reserved. Bits 22 and 23 from Flash OPTR registers must be written to 0b11 while enabling IOHSLV feature (refer to RM0487 for OPTR register description).

# 87.3 Boot model

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits allits constraints.

Table 194. STM32U375xx/385xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatusdatareceived(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZonedisableMust be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression fromRDP L1 to RDP0.5Must be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock writeprotectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

0xYY can have four values (0: WRP area, 1: WRP1A, 2: WRP2A, 3: WRP1B, 4: WRP2B)

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame byte per byte. No need to add number of data to be   
transmitted   
Returned data and status are formatted on the USB native protocol

# 87.4 Bootloader selection

![](images/b2bdec8e2aabd2ca5f6a206c9cdbea0191c3124f1042587dc2ea5402a1e19dc2.jpg)  
Figure 116. Bootloader V14.2 selection for STM32U375xx/85xx

# 87.5 Bootloader version

Table 195. STM32U375xx/85xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Versionnumber</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V14.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>Erasing multiple flash memory pages at the sametime is not working, only the first page is erased FDCAN: cannot erase more than 32 flash memorysectors on the same time</td></tr><tr><td rowspan=1 colspan=1>V14.2</td><td rowspan=1 colspan=1>- Correct known limitations- Switch SPI1 support on PortG when usingWLCSP68-G package instead of PortA- Add SW OB support to Enable HSLV forPortG SPI1 pins</td><td rowspan=1 colspan=1>- FDCAN: cannot erase more than 32 flash memorysectors on the same time</td></tr></table>

# STM32U535xx/545xx devices

# 88.1 Bootloader configuration

The STM32U535xx/545xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 196 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits allits constraints.

Table 196. STM32u535xx/545xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Commonto all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLL clocked byHSI).</td></tr><tr><td colspan="1" rowspan="1">HSI48 enabled</td><td colspan="1" rowspan="1">CRS is enabled for the DFU so that USB can be clocked byHSI 48 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">64 Kbytes, starting from address Ox0BF90000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON- Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PCO pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA7 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA6 pin: slave data output line, used in push-pull, no pulmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA4 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave modeFull Duplex8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> i slave data input lie,used in push-pull, o pulmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pul o pullmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> save atu  pushull  ulmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">  aveata u use pushpul  ulmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PG pin: slave data output line, used in push-pull no pulmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pi slave chip select pin used in push-pull, o pullmode.</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLETransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input/</td><td colspan="1" rowspan="1">PB8 pin: FDCAN1 in reception mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td colspan="1" rowspan="3">DFU</td><td colspan="1" rowspan="1">USB</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">USB FS configured in forced device mode.USB FS interrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td colspan="1" rowspan="1">USB_DM pin</td><td colspan="1" rowspan="2">Input/output</td><td colspan="1" rowspan="1">PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td colspan="1" rowspan="1">USB_DP pin</td><td colspan="1" rowspan="1">PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

Table 197. STM32U535xx/545xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatusdatareceived(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZonedisableMust be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression fromRDP L1 to RDP0.5Must be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock writeprotectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

0xYY can have four values (0: WRP area, 1: WRP1A, 2: WRP2A, 3: WRP1B, 4: WRP2B)

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame byte per byte. No need to add number of data to be   
transmitted   
Returned data and status are formatted on the USB native protocol

# 88.2 Bootloader selection

Figure 117 shows the bootloader selection mechanism.

![](images/742f9ade36dde65007a58a8aa3aec2af89a553ee41b68fbaabff7b4b221c2f48.jpg)  
Figure 117. Bootloader V9.x selection for STM32U535xx/545xx

# 88.3 Bootloader version

Table 198. STM32U535xx/545xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.1</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>FDCAN Readout unprotect command does notsend the command ID to the host</td></tr></table>

# STM32U575xx/85xx devices

# 89.1 Bootloader configuration

The STM32U575xx/85xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 199 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits allits constraints.

Table 199. STM32U575xx/85xx configuration in system memory boot mode   

<table><tr><td colspan="1" rowspan="1">Bootloader</td><td colspan="1" rowspan="1">Feature/Peripheral</td><td colspan="1" rowspan="1">State</td><td colspan="1" rowspan="1">Comment</td></tr><tr><td colspan="1" rowspan="6">Commonto all</td><td colspan="1" rowspan="3">RCC</td><td colspan="1" rowspan="1">HSI enabled</td><td colspan="1" rowspan="1">The system clock frequency is 60 MHz (using PLL clocked byHSI).</td></tr><tr><td colspan="1" rowspan="1">HSI48 enabled</td><td colspan="1" rowspan="1">CRS is enabled for the DFU so that USB can be clocked byHSI 48 MHz.</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td colspan="1" rowspan="1">System memory</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">64 Kbytes, starting from address Ox0BF90000, contain thebootloader firmware</td></tr><tr><td colspan="1" rowspan="1">IWDG</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td colspan="1" rowspan="3">USART1</td><td colspan="1" rowspan="1">USART1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART1_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART1_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA9 pin: USART1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART2</td><td colspan="1" rowspan="1">USART2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART2_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART2_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA2 pin: USART2 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">USART3</td><td colspan="1" rowspan="1">USART3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td colspan="1" rowspan="1">USART3_RX pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PC11 pin: USART3 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">USART3_TX pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PC10 pin: USART3 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C1</td><td colspan="1" rowspan="1">I2C1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C1_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1"> clock sus nera pu .</td></tr><tr><td colspan="1" rowspan="1">I2C1_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB7 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C2</td><td colspan="1" rowspan="1">I2C2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read)</td></tr><tr><td colspan="1" rowspan="1">I2C2_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB0 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C2_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="3">I2C3</td><td colspan="1" rowspan="1">I2C3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target modeAnalog filter ON Target 7-bit address: 0b1011010x (x = 0 for write and x = 1for read</td></tr><tr><td colspan="1" rowspan="1">I2C3_SCL pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">C pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">I2C3_SDA pin</td><td colspan="1" rowspan="1">Input/output</td><td colspan="1" rowspan="1">PC1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td colspan="1" rowspan="5">SPI1</td><td colspan="1" rowspan="1">SPI1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz- Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI1_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave at ut use pushl puownmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PA pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI1_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PA5 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI1_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> slave hi select p use  push-pul pullownmode.</td></tr><tr><td colspan="1" rowspan="5">SPI2</td><td colspan="1" rowspan="1">SPI2</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB-Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI2_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB15 pin: slave data input line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB14 pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI2_SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PB13 pin: slave clock line, used in push-pull, pull-down mode</td></tr><tr><td colspan="1" rowspan="1">SPI2_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pin: slave chip select pin used in push-pul pull-ownmode.</td></tr><tr><td colspan="1" rowspan="5">SPI3</td><td colspan="1" rowspan="1">SPI3</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHz Polarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td colspan="1" rowspan="1">SPI3_MOSI pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> i slave datainput leusd n push-pull, pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_MISO pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1"> pi slave data input line,used in push-pull pull-ownmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_ SCK pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1">PG pin: slave data output line, used in push-pull, pull-downmode</td></tr><tr><td colspan="1" rowspan="1">SPI3_NSS pin</td><td colspan="1" rowspan="1">Input</td><td colspan="1" rowspan="1"> pinslave chip select pin used in push-pull, pull-downmode.</td></tr><tr><td colspan="1" rowspan="3">FDCAN</td><td colspan="1" rowspan="1">FDCAN1</td><td colspan="1" rowspan="1">Enabled</td><td colspan="1" rowspan="1">Once initialized the configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Rx pin</td><td colspan="1" rowspan="1">Input/</td><td colspan="1" rowspan="1">PB8 pin: FDCAN1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td colspan="1" rowspan="1">FDCAN1_Tx pin</td><td colspan="1" rowspan="1">Output</td><td colspan="1" rowspan="1">PB9 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan="4">DFU</td><td>USB</td><td>Enabled</td><td>USB FS configured in forced device mode. USB FS interrupt vector is enabled and used for USB DFU communications. Note: VDDUSB IO must be connected to 3.3 V as USB</td></tr><tr><td>USB_DM pin</td><td></td><td colspan="1">peripheral is used by the bootloader. PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td>USB_DP pin</td><td>Input/output</td><td colspan="1">PA12: USB DP line. Used in input no pull mode.</td></tr><tr><td></td><td></td><td colspan="1">No external pull-up resistor is required</td></tr></table>

Table 200. STM32U575xx/585xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatusdatareceived(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZonedisableMust be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression fromRDP L1 to RDP0.5Must be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock writeprotectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

10xYY can have four values (0: WRP area, 1: WRP1A, 2: WRP2A, 3: WRP1B, 4: WRP2I

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly √ Sub-Opcode is treated in a single byte, not on two bytes Data are sent on USB frame byte per byte. No need to add number of data to be transmitted Returned data and status are formatted on the USB native protocol

# 89.2 Bootloader selection

![](images/42ff27e49a562f8fdb952d7d7bf823aff9f387bb21e4e9ded3845352146027c4.jpg)  
Figure 118. Bootloader V9.x selection for STM32U575xx/85xx

# 89.3 Bootloader version

Table 201. STM32U575xx/85xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>- FDCAN Readout unprotect command doesnot send the command ID to the host- Not possible to change RDP level and secureoption bytes at the same time</td></tr><tr><td rowspan=1 colspan=1>V9.3</td><td rowspan=1 colspan=1>- Fix known limitations- Add support for writing OEM1 and OEM2keys separately from other option bytes- Add support for reading FLASH NSSRregister, to allow user check if OEM keyshave been changed or not using thebootloader</td><td rowspan=1 colspan=1>- FDCAN Readout unprotect command doesnot send the command ID to the host</td></tr></table>

# 90

# STM32U595xx/99xx/A5xx/A9xx devices

# 90.1 Bootloader configuration

The STM32U595xx/99xx/A5xx/A9xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 202 shows the hardware resources used by this bootloader.

The bootloader follows boot model V3_1 (see Section 4.10), so it inherits all its constraints.

Table 202. STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=6 colspan=1>Commonto all</td><td rowspan=3 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 60 MHz (using PLL clocked byHSI).</td></tr><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td rowspan=1 colspan=1>HSE enabled</td><td rowspan=1 colspan=1>When USB cable is detected, SW tries to detect if a quartz isplugged in the board to configure the USBPHY clock.Supported quartz: 8, 12, 16, 20, 24, 26, and 32 MHzIf no quartz is detected a system reset is triggered.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>16 Kbytes, starting from address Ox20000000, are used by thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>64 Kbytes, starting from address Ox0BF90000, contain thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Onc initialized, the configuration is 8-bit, even parity, and onesop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td rowspan=3 colspan=1>USART3</td><td rowspan=1 colspan=1>USART3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized the configuration is 8-bit, even parity, and onestop bit</td></tr><tr><td rowspan=1 colspan=1>USART3_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PC11 pin: USART3 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART3_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PC10 pin: USART3 in transmission mode. Set as input untilUSART1 is detected.</td></tr></table>

Table 202. STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ONTare 7-i 1000x  = 0ore   = for read).</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1> data lieis used inopen-drain pull-p mode.</td></tr><tr><td rowspan=3 colspan=1>I2C2</td><td rowspan=1 colspan=1>I2C2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ON Target 7-bit address: 0b1100000x (x = 0 for write and x = 1for read).</td></tr><tr><td rowspan=1 colspan=1>I2C2_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB pin clock line is used in open-drain pullup mode.</td></tr><tr><td rowspan=1 colspan=1>I2C2_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB11 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=3 colspan=1>I2C3</td><td rowspan=1 colspan=1>I2C3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode Analog filter ON Target 7-bit address: 0b1100000x (x = 0 for write and x = 1for read).</td></tr><tr><td rowspan=1 colspan=1>I2C3_SCL pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>C pin: clock line is used in open-drain pullup mode.</td></tr><tr><td rowspan=1 colspan=1>I2C3_SDA pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PC1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=5 colspan=1>SPI1</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI1 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI1_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>A pslave data input e, used in push-pull, o pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>A pin: slave data output ne, used in push-pull, o pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI1_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA5 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA4 pin: slave chip select pin used in push-pull, no pull mode.</td></tr></table>

Table 202. STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>SPI2</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI2_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB5 pin: slave data input line, used in push-pull, o pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI2_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>B4 pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI2_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB13 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI2_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB12 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td rowspan=5 colspan=1>SPI3</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI3_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB5 pin: slave data input line, used in push-pull, no pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI3_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>G10 pin: slave data input line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI3_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1> pin: slave data output lne, used in push-pul no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI3_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PG12 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB HS configured in forced device mode.USB HS interrupt vector is enabled and used for USB DFUcommunications.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

Table 202. STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>FDCAN</td><td rowspan=1 colspan=1>FDCAN1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized the configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s- FrameFormat = FDCAN_FRAME_FD_BRS- Mode = FDCAN_MODE_NORMAL— AutoRetransmission = ENABLE TransmitPause = DISABLE- ProtocolException = ENABLE</td></tr><tr><td rowspan=1 colspan=1>FDCAN1_Rx pin</td><td rowspan=1 colspan=1>Input/</td><td rowspan=1 colspan=1>PB8 pin: FDCAN1 in reception mode. Used in alternate push-pull, no pull mode.</td></tr><tr><td rowspan=1 colspan=1>FDCAN1_Tx pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PB9 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr></table>

Table 203. STM32U595xx/99xx/A5xx/A9xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Number ofdatareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Status datareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZone disableMust be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression fromRDP L1 to RDP 0.5Must be run whenTZEN = 1 andRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock writeprotectionMust be run whenRDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

10xYY can have four values (0: WRP area, 1: WRP1A, 2: WRP2A, 3: WRP1B, 4: WRP2B)

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly − Sub-Opcode is treated in a single byte and not two bytes Data are sent on USB frame byte per byte. No need to add number of data to be transmitted Returned data and status are formatted on the USB native protocol

# 90.2 Bootloader selection

Figure 119 shows the bootloader selection mechanism.

![](images/a5d12c6413c71e1518706a7fd1c63ab43d396b1aa8751dfef540baa9e60e12a4.jpg)  
Figure 119. Bootloader V9.x selection for STM32U595xx/99xx/A5xx/A9xx

# 90.3 Bootloader version

Table 204. STM32U595xx/99xx/A5xx/A9xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.2</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>FDCAN Readout unprotect command does not sendthe command ID to the host</td></tr></table>

# STM32U5F7xx/F9xx/G7xx/G9xx devices

# 91.1 Bootloader configuration

The STM32U5F7xx/F9xx/G7xx/G9xx bootloader is activated by applying Pattern 12 (described in Table 2). Table 205 shows the hardware resources used by this bootloader.

Table 205. STM32U5F7xx/F9xx/G7xx/G9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=6 colspan=1>Common to all</td><td rowspan=3 colspan=1>RCC</td><td rowspan=1 colspan=1>HSI enabled</td><td rowspan=1 colspan=1>The system clock frequency is 60 MHz (using PLL clockedby HSI).</td></tr><tr><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>20 MHz derived from the PLLQ is used for FDCAN</td></tr><tr><td rowspan=1 colspan=1>HSE enabled</td><td rowspan=1 colspan=1>When USB cable is detected, SW tries to detect if a quartz isplugged in the board to configure the USBPHY clock.Supported quartz: 8, 12, 16, 20, 24, 26, and 32 MHzIf no quartz is detected, a system reset is triggered.</td></tr><tr><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>16 Kbytes, starting from address Ox20000000, are used bythe bootloader firmware</td></tr><tr><td rowspan=1 colspan=1>System memory</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>64 Kbytes, starting from address Ox0BF90000, contain thebootloader firmware</td></tr><tr><td rowspan=1 colspan=1>IWDG</td><td rowspan=1 colspan=1></td><td rowspan=1 colspan=1>The IWDG prescaler is configured to its maximum value. It isperiodically refreshed to prevent watchdog reset (if thehardware IWDG option was previously enabled by the user).</td></tr><tr><td rowspan=3 colspan=1>USART1</td><td rowspan=1 colspan=1>USART1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART1_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA10 pin: USART1 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART1_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA9 pin: USART1 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td rowspan=3 colspan=1>USART2</td><td rowspan=1 colspan=1>USART2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized, the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART2_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA3 pin: USART2 in reception mode. Used in alternate push-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART2_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA2 pin: USART2 in transmission mode. Set as input untilUSART1 is detected.</td></tr><tr><td rowspan=3 colspan=1>USART3</td><td rowspan=1 colspan=1>USART3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized the configuration is 8-bit, even parity, andone stop bit</td></tr><tr><td rowspan=1 colspan=1>USART3_RX pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PC11 pin: USART3 in reception mode. Used in alternatepush-pull, pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>USART3_TX pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PC10 pin: USART3 in transmission mode. Set as input untilUSART1 is detected.</td></tr></table>

Table 205. STM32U5F7xx/F9xx/G7xx/G9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>I2C1</td><td rowspan=1 colspan=1>I2C1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C1 configuration is:- I2C speed: up to 1 MHz- 7-bit address- Target mode- Analog filter ONTart 7-bit address: 0b1101001x x = 0 fo write and x = 1for read).</td></tr><tr><td rowspan=1 colspan=1>I2C1_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB6 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>I2C1_SDA pin</td><td rowspan=1 colspan=1> at usena pul </td></tr><tr><td rowspan=3 colspan=1>I2C2</td><td rowspan=1 colspan=1>I2C2</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C2 configuration is:- I2C speed: up to 1 MHz- 7-bit addressTarget mode Analog filter ONTa 0 =1for read).</td></tr><tr><td rowspan=1 colspan=1>I2C2_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PB10 pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>I2C2_SDA pin</td><td rowspan=1 colspan=1> pidata eis use  open-drain pull-p moe.</td></tr><tr><td rowspan=3 colspan=1>I2C3</td><td rowspan=1 colspan=1>I2C3</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The I2C3 configuration is:- I2C speed: up to 1 MHz- 7-bit address Target modeAnalog filter ONTaret7-i des: 110001x  = 0 or write an  = 1forread).</td></tr><tr><td rowspan=1 colspan=1>I2C3_SCL pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1> pin: clock line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=1 colspan=1>I2C3_SDA pin</td><td rowspan=1 colspan=1>PC1 pin: data line is used in open-drain pull-up mode.</td></tr><tr><td rowspan=5 colspan=1>SPI1</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI1 configuration is:- Slave mode- Full Duplex8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI1_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA7 pin: slave data input line, used in push-pul no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI1_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PA6 pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI1_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PA5 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI1_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>A pin: slave chip select pin used in push-pull, no pullmode.</td></tr></table>

Table 205. STM32U5F7xx/F9xx/G7xx/G9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=5 colspan=1>SPI2</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI2 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI2_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB15 pin: slave data input line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI2_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>B4 pin: slave data output line, used in push-pul no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI2_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB13 pin: slave clock line, used in push-pull, no pull mode</td></tr><tr><td rowspan=1 colspan=1>SPI2_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB2 pin: slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td rowspan=5 colspan=1>SPI3</td><td rowspan=1 colspan=1>SPI</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>The SPI3 configuration is:- Slave mode- Full Duplex- 8-bit MSB- Speed up to 8 MHzPolarity: CPOL Iow, CPHA low, NSS hardware.</td></tr><tr><td rowspan=1 colspan=1>SPI3_MOSI pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PB5 pin: slave data input line, used in push-pull no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI3_MISO pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PG0 pin: slave data input line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI3_SCK pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1>PG pin: slave data output line, used in push-pull, no pullmode</td></tr><tr><td rowspan=1 colspan=1>SPI3_NSS pin</td><td rowspan=1 colspan=1>Input</td><td rowspan=1 colspan=1> pin slave chip select pin used in push-pull, no pullmode.</td></tr><tr><td rowspan=3 colspan=1>DFU</td><td rowspan=1 colspan=1>USB</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>USB HS configured in forced device mode. USB HS interruptvector is enabled and used for USB DFU communications.</td></tr><tr><td rowspan=1 colspan=1>USB_DM pin</td><td rowspan=2 colspan=1>Input/output</td><td rowspan=1 colspan=1>PA11: USB DM line. Used in input no pull mode.</td></tr><tr><td rowspan=1 colspan=1>USB_DP pin</td><td rowspan=1 colspan=1>PA12: USB DP line. Used in input no pull mode.No external pull-up resistor is required</td></tr></table>

Table 205. STM32U5F7xx/F9xx/G7xx/G9xx configuration in system memory boot mode   

<table><tr><td rowspan=1 colspan=1>Bootloader</td><td rowspan=1 colspan=1>Feature/Peripheral</td><td rowspan=1 colspan=1>State</td><td rowspan=1 colspan=1>Comment</td></tr><tr><td rowspan=3 colspan=1>FDCAN</td><td rowspan=1 colspan=1>FDCAN1</td><td rowspan=1 colspan=1>Enabled</td><td rowspan=1 colspan=1>Once initialized the configuration is:- Connection bit rate 250 kbit/s- Data bit rate 1000 kbit/s FrameFormat = FDCAN_FRAME_FD_BRS Mode = FDCAN_MODE_NORMAL AutoRetransmission = ENABLE TransmitPause = DISABLE ProtocolException = ENABLE</td></tr><tr><td rowspan=1 colspan=1>FDCAN1_Rx pin</td><td rowspan=1 colspan=1>Input/</td><td rowspan=1 colspan=1>PB8 pin: FDCAN1 in reception mode. Used in alternatepush-pull, no pull mode.</td></tr><tr><td rowspan=1 colspan=1>FDCAN1_Tx pin</td><td rowspan=1 colspan=1>Output</td><td rowspan=1 colspan=1>PB9 pin: FDCAN1 in transmission mode. Used in alternatepush-pull, no pull mode.</td></tr></table>

Table 206. STM32U5F7xx/F9xx/G7xx/G9xx special commands   

<table><tr><td rowspan=1 colspan=8>Special commands supported (USART/I2C/SPI/FDCAN)Opcode - 0x50</td></tr><tr><td rowspan=1 colspan=1>Function</td><td rowspan=1 colspan=1>Sub-Opcode(2 bytes)</td><td rowspan=1 colspan=1>Number ofdata sent(2 bytes)</td><td rowspan=1 colspan=1>Data sent</td><td rowspan=1 colspan=1>Numberof datareceived</td><td rowspan=1 colspan=1>Datareceived</td><td rowspan=1 colspan=1>Number ofstatus datareceived(2 bytes)</td><td rowspan=1 colspan=1>Statusdatareceived</td></tr><tr><td rowspan=1 colspan=1>TrustZone disableMust be run when TZEN = 1and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Regression from RDP L1 toRDP 0.5Must be run when TZEN = 1and RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr><tr><td rowspan=1 colspan=1>Unlock write protectionMust be run when RDP = 1</td><td rowspan=1 colspan=1>0x82</td><td rowspan=1 colspan=1>0x4</td><td rowspan=1 colspan=1>0xYY02(1)</td><td rowspan=1 colspan=1>0x0</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1</td><td rowspan=1 colspan=1>0x0</td></tr></table>

0xYY can have four values (0: WRP area, 1: WRP1A, 2: WRP2A, 3: WRP1B, 4: WRP2B)

Note:

USB special commands are slightly different from the other protocols as per the USB protocol specificities:

No Opcode is used, Sub-Opcode is used directly   
Sub-Opcode is treated in a single byte and not two bytes   
Data are sent on USB frame byte per byte. No need to add number of data to be   
transmitted   
Returned data and status are formatted on the USB native protocol

# 91.2 Bootloader selection

Figure 119 shows the bootloader selection mechanism.

![](images/c49bb858f6a102133513f540af4bcccc83de25f4a94af5349302393edbbd0a24.jpg)  
Figure 120. Bootloader V9.x selection for STM32U5F7xx/F9xx/G7xx/G9xx

# 91.3 Bootloader version

Table 207. STM32U5F7xx/F9xx/G7xx/G9xx bootloader versions   

<table><tr><td rowspan=1 colspan=1>Version number</td><td rowspan=1 colspan=1>Description</td><td rowspan=1 colspan=1>Known limitations</td></tr><tr><td rowspan=1 colspan=1>V9.0</td><td rowspan=1 colspan=1>Initial bootloader version</td><td rowspan=1 colspan=1>FDCAN Readout unprotect command does not sendthe command ID to the host</td></tr></table>

# 92 Device-dependent bootloader parameters

The bootloader protocol command set and sequences for each serial peripheral are the same for all STM32 devices. Some parameters depend on device and bootloader version:

PID (Product ID)   
Valid RAM addresses (RAM area used during bootloader execution is not accessible) accepted by the bootloader when the Read Memory, Go and Write Memory commands are requested.   
System memory area.

Table 208 shows the values of these parameters for each STM32 device.

Table 208. Bootloader device-dependent parameters   

<table><tr><td rowspan=1 colspan=1>STM32series</td><td rowspan=1 colspan=1>Device</td><td rowspan=1 colspan=1>PID</td><td rowspan=1 colspan=1>BL ID</td><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>Systemmemory</td></tr><tr><td rowspan=5 colspan=1>CO</td><td rowspan=1 colspan=1>STM32C011xx</td><td rowspan=1 colspan=1>0x443</td><td rowspan=1 colspan=1>0x51</td><td rowspan=1 colspan=1>0x20000000 -0x20002FFF</td><td rowspan=2 colspan=1>0x1FFF0000 -0x1FFF17FF</td></tr><tr><td rowspan=1 colspan=1>STM32C031xx</td><td rowspan=1 colspan=1>0x453</td><td rowspan=1 colspan=1>0x52</td><td rowspan=1 colspan=1>0x20002000 -0x200017FF</td></tr><tr><td rowspan=1 colspan=1>STM32C051xx</td><td rowspan=1 colspan=1>0x44C</td><td rowspan=1 colspan=1>0xB0</td><td rowspan=1 colspan=1>0x20001400 -0x20002FFF</td><td rowspan=1 colspan=1>0x1FFF0000 -0x1FFF2FFF</td></tr><tr><td rowspan=1 colspan=1>STM32C071xx</td><td rowspan=1 colspan=1>0x493</td><td rowspan=1 colspan=1>0xD1</td><td rowspan=1 colspan=1>0x20002300 -0x20005FFF</td><td rowspan=1 colspan=1>0x1FFF0000 -0x1FFF6FFF</td></tr><tr><td rowspan=1 colspan=1>STM32C091xx/92xx</td><td rowspan=1 colspan=1>0x44D</td><td rowspan=1 colspan=1>0x121</td><td rowspan=1 colspan=1>0x20002400 -0x200077FF</td><td rowspan=1 colspan=1>0x1FFF0000 -0x1FFF3FFF</td></tr><tr><td rowspan=8 colspan=1>F0</td><td rowspan=1 colspan=1>STM32F05xxx and STM32F030x8</td><td rowspan=1 colspan=1>0x440</td><td rowspan=1 colspan=1>0x21</td><td rowspan=1 colspan=1>0x20000800 -0x20001FFF</td><td rowspan=2 colspan=1>0x1FFFEC00-0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F03xx4/6</td><td rowspan=1 colspan=1>0x444</td><td rowspan=1 colspan=1>0x10</td><td rowspan=1 colspan=1>0x20000800 -0x20000FFF</td></tr><tr><td rowspan=1 colspan=1>STM32F030xC</td><td rowspan=1 colspan=1>0x442</td><td rowspan=1 colspan=1>0x52</td><td rowspan=1 colspan=1>0x20001800 -0x20007FFF</td><td rowspan=1 colspan=1>0x1FFFD800 -0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F04xxx</td><td rowspan=1 colspan=1>0x445</td><td rowspan=1 colspan=1>0xA1</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1FFFC400-0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F070x6</td><td rowspan=1 colspan=1>0x445</td><td rowspan=1 colspan=1>0xA2</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1FFFC400 -0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F070xB</td><td rowspan=1 colspan=1>0x448</td><td rowspan=1 colspan=1>0xA2</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1FFFC800-0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F071xx/072xx</td><td rowspan=1 colspan=1>0x448</td><td rowspan=1 colspan=1>0xA1</td><td rowspan=1 colspan=1>0x20001800 -0x20003FFF</td><td rowspan=1 colspan=1>0x1FFFC800-0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>STM32F09xxx</td><td rowspan=1 colspan=1>0x442</td><td rowspan=1 colspan=1>0x50</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x1FFFD800 -0x1FFFF7FF</td></tr></table>

Table 208. Bootloader device-dependent parameters (continued)   

<table><tr><td rowspan=1 colspan=1>STM32series</td><td rowspan=1 colspan=2>Device</td><td rowspan=1 colspan=1>PID</td><td rowspan=1 colspan=1>BL ID</td><td rowspan=1 colspan=1>RAM</td><td rowspan=1 colspan=1>Systemmemory</td></tr><tr><td rowspan=7 colspan=1>F1</td><td rowspan=5 colspan=1>STM32F10xxx</td><td rowspan=1 colspan=1>Low-density</td><td rowspan=1 colspan=1>0x412</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x20000200 -0x200027FF</td><td rowspan=5 colspan=1>0x1FFFF000 -0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=1>Medium-density</td><td rowspan=1 colspan=1>0x410</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x20000200 -0x20004FFF</td></tr><tr><td rowspan=1 colspan=1>High-density</td><td rowspan=1 colspan=1>0x414</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x20000200 -0x2000FFFF</td></tr><tr><td rowspan=1 colspan=1>Medium-density value line</td><td rowspan=1 colspan=1>0x420</td><td rowspan=1 colspan=1>0x10</td><td rowspan=1 colspan=1>0x20000200 -0x20001FFF</td></tr><tr><td rowspan=1 colspan=1>High-density value line</td><td rowspan=1 colspan=1>0x428</td><td rowspan=1 colspan=1>0x10</td><td rowspan=1 colspan=1>Ox20000200 -0x20007FFF</td></tr><tr><td rowspan=1 colspan=2>STM32F105xx/107xx</td><td rowspan=1 colspan=1>0x418</td><td rowspan=1 colspan=1>NA</td><td rowspan=1 colspan=1>0x20001000 -0x2000FFFF</td><td rowspan=1 colspan=1>0x1FFFB000-0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=2>STM32F10xxx XL-density</td><td rowspan=1 colspan=1>0x430</td><td rowspan=1 colspan=1>0x21</td><td rowspan=1 colspan=1>0x20000800 -0x20017FFF</td><td rowspan=1 colspan=1>0x1FFFE000 -0x1FFFF7FF</td></tr><tr><td rowspan=2 colspan=1>F2</td><td rowspan=2 colspan=2>STM32F2xxXx</td><td rowspan=2 colspan=1>0x411</td><td rowspan=1 colspan=1>0x20</td><td rowspan=2 colspan=1>0x20002000 -0x20001FF</td><td rowspan=2 colspan=1>0x1FFF0000 -0x1FFF77FF</td></tr><tr><td rowspan=1 colspan=1>0x33</td></tr><tr><td rowspan=9 colspan=1>F3</td><td rowspan=1 colspan=2>STM32F373xx</td><td rowspan=2 colspan=1>0x432</td><td rowspan=1 colspan=1>0x41</td><td rowspan=1 colspan=1>0x20001400 -0x20007FFF</td><td rowspan=9 colspan=1>0x1FFFD800 -0x1FFFF7FF</td></tr><tr><td rowspan=1 colspan=2>STM32F378xx</td><td rowspan=1 colspan=1>0x50</td><td rowspan=1 colspan=1>0x20001000 -0x20007FFF</td></tr><tr><td rowspan=1 colspan=2>STM32F302xB(C)/303xB(C)</td><td rowspan=2 colspan=1>0x422</td><td rowspan=1 colspan=1>0x41</td><td rowspan=2 colspan=1>0x20001400 -0x20009FFF</td></tr><tr><td rowspan=1 colspan=2>STM32F358xx</td><td rowspan=1 colspan=1>0x50</td></tr><tr><td rowspan=1 colspan=2>STM32F301xx/302x4(6/8)</td><td rowspan=2 colspan=1>0x439</td><td rowspan=1 colspan=1>0x40</td><td rowspan=2 colspan=1>0x20001800 -0x20003FFF</td></tr><tr><td rowspan=1 colspan=2>STM32F318xx</td><td rowspan=1 colspan=1>0x50</td></tr><tr><td rowspan=1 colspan=2>STM32F303x4(6/8)/334xx/328xx</td><td rowspan=1 colspan=1>0x438</td><td rowspan=1 colspan=1>0x50</td><td rowspan=1 colspan=1>0x20001800 -0x20002FFF</td></tr><tr><td rowspan=1 colspan=2>STM32F302xD(E)/303xD(E)</td><td rowspan=1 colspan=1>0x446</td><td rowspan=1 colspan=1>0x40</td><td rowspan=1 colspan=1>0x20001800 -0x2000FFFF</td></tr><tr><td rowspan=1 colspan=2>STM32F398xx</td><td rowspan=1 colspan=1>0x446</td><td rowspan=1 colspan=1>0x50</td><td rowspan=1 colspan=1>0x20001800 -0x2000FFFF</td></tr></table>

Table 208. Bootloader device-dependent parameters (continued)   

<table><tr><td colspan="1" rowspan="1">STM32series</td><td colspan="1" rowspan="1">Device</td><td colspan="1" rowspan="1">PID</td><td colspan="1" rowspan="1">BL ID</td><td colspan="1" rowspan="1">RAM</td><td colspan="1" rowspan="1">Systemmemory</td></tr><tr><td colspan="1" rowspan="12">F4</td><td colspan="1" rowspan="2">STM32F40xxx/41xxx</td><td colspan="1" rowspan="2">0x413</td><td colspan="1" rowspan="1">0x31</td><td colspan="1" rowspan="1">0x20002000 -0x2001FFFF</td><td colspan="1" rowspan="12">0x1FFF0000 -0x1FFF77FF</td></tr><tr><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x20003000 -0x2001FFFF</td></tr><tr><td colspan="1" rowspan="2">STM32F42xxx/43xxx</td><td colspan="1" rowspan="2">0x419</td><td colspan="1" rowspan="1">0x70</td><td colspan="1" rowspan="2">0x20003000 -0x2002FFFF</td></tr><tr><td colspan="1" rowspan="1">0x91</td></tr><tr><td colspan="1" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">0x423</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x20003000 -0x2000FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">0x433</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x20003000 -0x20017FFF</td></tr><tr><td colspan="1" rowspan="1">STM32F410xx</td><td colspan="1" rowspan="1">0x458</td><td colspan="1" rowspan="1">0xB1</td><td colspan="1" rowspan="1">0x20003000 -0x20007FFF</td></tr><tr><td colspan="1" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">0x431</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x20003000 -0x2001FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">0x441</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20003000 -0x2003FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">0x421</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20003000 -0x2001FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">0x434</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20003000 -0x2005FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">0x463</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20003000 -0x2004FFFF</td></tr><tr><td colspan="1" rowspan="4">F7</td><td colspan="1" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">0x452</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20004000 -0x2003FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF0EDBF</td></tr><tr><td colspan="1" rowspan="2">STM32F74xxx/75xxx</td><td colspan="1" rowspan="2">0x449</td><td colspan="1" rowspan="1">0x70</td><td colspan="1" rowspan="1">0x20004000 -0x2004FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF0EDBF</td></tr><tr><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x200040000x2004FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF0EDBF</td></tr><tr><td colspan="1" rowspan="1">STM32F76xxx/77xxx</td><td colspan="1" rowspan="1">0x451</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x20004000 -0x2007FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF0EDBF</td></tr><tr><td colspan="1" rowspan="5">GO</td><td colspan="1" rowspan="1">STM32G03xxx/04xxx</td><td colspan="1" rowspan="1">0x466</td><td colspan="1" rowspan="1">0x54</td><td colspan="1" rowspan="1">0x20001000 -0x20001FFF</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF1FFF</td></tr><tr><td colspan="1" rowspan="1">STM32G05xxx/061xx</td><td colspan="1" rowspan="1">0x456</td><td colspan="1" rowspan="1">0x51</td><td colspan="1" rowspan="1">0x20001000 -0x20002000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF1FFF</td></tr><tr><td colspan="1" rowspan="1">STM32G07xxx/08xxx</td><td colspan="1" rowspan="1">0x460</td><td colspan="1" rowspan="1">0xB4</td><td colspan="1" rowspan="1">0x20002700 -0x20009000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">STM32G0B0xx</td><td colspan="1" rowspan="1">0x467</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x20004000 -0x20020000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF6FFF0x1FFF8000 -0x1FFFEFFF</td></tr><tr><td colspan="1" rowspan="1">STM32G0B1xx/0C1xx</td><td colspan="1" rowspan="1">0x467</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004000 -0x20020000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF6FFF0x1FFF8000 -0x1FFFEFFF</td></tr><tr><td colspan="1" rowspan="3">G4</td><td colspan="1" rowspan="1">STM32G431xx/441xx</td><td colspan="1" rowspan="1">0x468</td><td colspan="1" rowspan="1">0xD4</td><td colspan="1" rowspan="1">0x20004000 0x20005800</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF7000</td></tr><tr><td colspan="1" rowspan="1">STM32G47xxx/48xxx</td><td colspan="1" rowspan="1">0x469</td><td colspan="1" rowspan="1">0xD5</td><td colspan="1" rowspan="1">0x20004000 -0x20018000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF7000</td></tr><tr><td colspan="1" rowspan="1">STM32G491xx/A1xx</td><td colspan="1" rowspan="1">0x479</td><td colspan="1" rowspan="1">0xD2</td><td colspan="1" rowspan="1">0x20004000 -0x2001C000</td><td colspan="1" rowspan="1">0x1FFF0000 -0x1FFF7000</td></tr><tr><td colspan="1" rowspan="3">H5</td><td colspan="1" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">0x474</td><td colspan="1" rowspan="1">0xE1</td><td colspan="1" rowspan="1">0x20004000 -0x20007FFF</td><td colspan="1" rowspan="1">0x0BF87000 -0x0BF8FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32H562xx/563xx/573xx</td><td colspan="1" rowspan="1">0x484</td><td colspan="1" rowspan="1">0xE3</td><td colspan="1" rowspan="1">0x20000000 -0x2009FFFF</td><td colspan="1" rowspan="1">Ox0BF97000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32H523xx/533xx</td><td colspan="1" rowspan="1">0x478</td><td colspan="1" rowspan="1">0xE2</td><td colspan="1" rowspan="1">0x20004000 -0x20043FFF</td><td colspan="1" rowspan="1">0x0BF97000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="4">H7</td><td colspan="1" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">0x483</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x20004100 -0x2001FFFF0x24004000 -0x2404FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF1E7FF</td></tr><tr><td colspan="1" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">0x450</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004100 -0x2001FFFF0x24005000 -0x2407FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF1E7FF</td></tr><tr><td colspan="1" rowspan="1">STM32H7A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">0x480</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004100 -0x2001FFFF0x24034000 -0x2407FFFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF13FFF</td></tr><tr><td colspan="1" rowspan="1">STM32H7Rxxx/7Sxxx</td><td colspan="1" rowspan="1">0x485</td><td colspan="1" rowspan="1">0xE3</td><td colspan="1" rowspan="1">0x24000000 -0x2401FFFF0x24024000 -0x24071FFF0x20000000 -0x2002FFFFOx00000000 -0x0002F(1)</td><td colspan="1" rowspan="1">0x1FF18000 -0x1FF1FFFF</td></tr><tr><td colspan="1" rowspan="5">LO</td><td colspan="1" rowspan="1">STM32L01xxx/02xxx</td><td colspan="1" rowspan="1">0x457</td><td colspan="1" rowspan="1">0xC3</td><td colspan="1" rowspan="1">NA</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF00FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L031xx/041xx</td><td colspan="1" rowspan="1">0x425</td><td colspan="1" rowspan="1">0xC0</td><td colspan="1" rowspan="1">0x20001000 -0x20001FFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF00FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L05xxx/06xxx</td><td colspan="1" rowspan="1">0x417</td><td colspan="1" rowspan="1">0xC0</td><td colspan="1" rowspan="1">0x20001000 -0x20001FFF</td><td colspan="1" rowspan="1">0x1FF00000 -0x1FF00FFF</td></tr><tr><td colspan="1" rowspan="2">STM32L07xxx/08xxx</td><td colspan="1" rowspan="2">0x447</td><td colspan="1" rowspan="1">0x41</td><td colspan="1" rowspan="1">0x20001000 -0x20004FFF</td><td colspan="1" rowspan="2">0x1FF00000 -0x1FF01FFF</td></tr><tr><td colspan="1" rowspan="1">0xB2</td><td colspan="1" rowspan="1">0x20001400 -0x20004FFF</td></tr><tr><td colspan="1" rowspan="5">L1</td><td colspan="1" rowspan="1">STM32L1xxx6(8/B)</td><td colspan="1" rowspan="1">0x416</td><td colspan="1" rowspan="1">0x20</td><td colspan="1" rowspan="1">0x20000800 -0x20003FFF</td><td colspan="1" rowspan="5">0x1FF00000 -0x1FF01FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxx6(8/B)A</td><td colspan="1" rowspan="1">0x429</td><td colspan="1" rowspan="1">0x20</td><td colspan="1" rowspan="2">0x20001000 -0x20007FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxC</td><td colspan="1" rowspan="1">0x427</td><td colspan="1" rowspan="1">0x40</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxD</td><td colspan="1" rowspan="1">0x436</td><td colspan="1" rowspan="1">0x45</td><td colspan="1" rowspan="1">0x20001000 -0x2000BFFF</td></tr><tr><td colspan="1" rowspan="1">STM32L1xxxE</td><td colspan="1" rowspan="1">0x437</td><td colspan="1" rowspan="1">0x40</td><td colspan="1" rowspan="1">0x20001000 -0x20013FFF</td></tr><tr><td colspan="1" rowspan="8">L4</td><td colspan="1" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">0x464</td><td colspan="1" rowspan="1">0xD1</td><td colspan="1" rowspan="1">0x20002100 -0x20008000</td><td colspan="1" rowspan="1">Ox1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">0x435</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x20003100 -0x2000BFFF</td><td colspan="1" rowspan="1">0x1FFF 00000x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">0x462</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20003100 -0x2001FFFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="2">STM32L47xxx/48xxx</td><td colspan="1" rowspan="2">0x415</td><td colspan="1" rowspan="1">0xA3</td><td colspan="1" rowspan="1">0x20003000 -0x20017FFF</td><td colspan="1" rowspan="2">0x1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20003100 -0x20017FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">0x461</td><td colspan="1" rowspan="1">0x93</td><td colspan="1" rowspan="1">0x20003100 -0x2003FFFF</td><td colspan="1" rowspan="1">Ox1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L4Rxx/4Sxx</td><td colspan="1" rowspan="1">0x470</td><td colspan="1" rowspan="1">0x95</td><td colspan="1" rowspan="1">0x20003200 -0x2009FFFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">STM32L4P5xx/Q5xx</td><td colspan="1" rowspan="1">0x471</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20004000 -0x2004FFFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF6FFF</td></tr><tr><td colspan="1" rowspan="1">L5</td><td colspan="1" rowspan="1">STM32L552xx/562xx</td><td colspan="1" rowspan="1">0x472</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004000 -0x2003FFFF</td><td colspan="1" rowspan="1">Ox0BF9 0000 -0x0BF9 7FFF</td></tr><tr><td colspan="1" rowspan="2">UO</td><td colspan="1" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">0x459</td><td colspan="1" rowspan="1">0xB0</td><td colspan="1" rowspan="1">0x20001500 -0x20002FFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF 37FF</td></tr><tr><td colspan="1" rowspan="1">STM32U073xx/83xx</td><td colspan="1" rowspan="1">0x489</td><td colspan="1" rowspan="1">0xD0</td><td colspan="1" rowspan="1">0x20002170 -0x20009FFF</td><td colspan="1" rowspan="1">0x1FFF 0000-0x1FFF 67FF</td></tr><tr><td colspan="1" rowspan="1">U3</td><td colspan="1" rowspan="1">STM32U375xx/ STM32U385xx</td><td colspan="1" rowspan="1">0x454</td><td colspan="1" rowspan="1">0xE2</td><td colspan="1" rowspan="1">0x20004000 -003FF</td><td colspan="1" rowspan="1">0x0BF8 F0000x0BF9 FF</td></tr><tr><td colspan="1" rowspan="4">U5</td><td colspan="1" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">0x455</td><td colspan="1" rowspan="1">0x91</td><td colspan="1" rowspan="1">0x20004000 -0x2023FFFF</td><td colspan="1" rowspan="1">0x0BF90000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32U575xx/ STM32U585xx</td><td colspan="1" rowspan="1">0x482</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004000 -0x200BFFFF</td><td colspan="1" rowspan="1">Ox0BF90000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32U595xx/599xx/5A9xx</td><td colspan="1" rowspan="1">0x481</td><td colspan="1" rowspan="1">0x92</td><td colspan="1" rowspan="1">0x20004000 -0x2026FFFF</td><td colspan="1" rowspan="1">Ox0BF90000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="1">STM32U5F7xx/5F9xx/5G7xx/5G9xx</td><td colspan="1" rowspan="1">0x476</td><td colspan="1" rowspan="1">0x90</td><td colspan="1" rowspan="1">0x20004000 -0x202EFFFF</td><td colspan="1" rowspan="1">0x0BF90000 -0x0BF9FFFF</td></tr><tr><td colspan="1" rowspan="2">WB</td><td colspan="1" rowspan="1">STM32WB10xx/15xx</td><td colspan="1" rowspan="1">0x494</td><td colspan="1" rowspan="1">0xB1</td><td colspan="1" rowspan="1">0x20005000-0x20040000</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF7000</td></tr><tr><td colspan="1" rowspan="1">STM32WB30xx/35xx/50xx/WB55xx</td><td colspan="1" rowspan="1">0x495</td><td colspan="1" rowspan="1">0xD5</td><td colspan="1" rowspan="1">0x20004000-0x2000BFFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF7000</td></tr><tr><td colspan="1" rowspan="1">WBA</td><td colspan="1" rowspan="1">STM32WBA5xxx</td><td colspan="1" rowspan="1">0x492</td><td colspan="1" rowspan="1">0xB0 (rev A)OxB1 (rev B)</td><td colspan="1" rowspan="1">0x2000 1800 -0x2000 1FFF</td><td colspan="1" rowspan="1">0x0BF8 80000x0BF8 FFFF</td></tr><tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">0x4B0</td><td colspan="1" rowspan="1">0xD2</td><td colspan="1" rowspan="1">0x2000 3000 -0x2007 FFFF</td><td colspan="1" rowspan="1">0x0BF9 0000 -0x0BF9 FFFF</td></tr><tr><td colspan="1" rowspan="1">WL</td><td colspan="1" rowspan="1">STM32WLE5xx/WL55xx</td><td colspan="1" rowspan="1">0x497</td><td colspan="1" rowspan="1">0xC4</td><td colspan="1" rowspan="1">0x2000 2000 -0x2000 FFFF</td><td colspan="1" rowspan="1">0x1FFF 0000 -0x1FFF3FFF</td></tr></table>

ial eal

# 93 Bootloader timings

This section details the timings of the bootloader firmware to use for correct synchronization between the host and the STM32 device.

Two types of timings are described, namely STM32 device bootloader resources initialization duration, and communication interface selection duration.

After these timings the bootloader is ready to receive and execute host commands.

# 93.1 Bootloader startup timing

After bootloader reset, the host must wait until the STM32 bootloader is ready to start detection phase with a specific interface communication. This time corresponds to bootloader startup timing, during which resources used by bootloader are initialized.

![](images/f945fc1212aaf9e006f3393887d75efb03b75a3c595958a4e36667e84c1584c6.jpg)  
Figure 121. Bootloader startup timing description

Depending on the bootloader model, the startup timing calculation differs from one product to another (see Section 4.10 for more details). The following table details only the startup timings.

Table 209. Bootloader startup timings (ms)   

<table><tr><td colspan="3" rowspan="1">Device</td><td colspan="1" rowspan="1">Minimum startup</td><td colspan="1" rowspan="1">HSE timeout</td></tr><tr><td colspan="3" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="1">2.1</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32C031xx</td><td colspan="1" rowspan="1">2.1</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32C051xx</td><td colspan="1" rowspan="1">2.262</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32C071xx</td><td colspan="1" rowspan="1">2.358</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32C091xx/92xx</td><td colspan="1" rowspan="1">1.527</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F03xx4/6</td><td colspan="1" rowspan="1">1.612</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F05xxx and STM32F030x8 devices</td><td colspan="1" rowspan="1">1.612</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">Device</td><td colspan="1" rowspan="1">Minimum startup</td><td colspan="1" rowspan="1">HSE timeout</td></tr><tr><td colspan="3" rowspan="1">STM32F04xxx</td><td colspan="1" rowspan="1">0.058</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F071xx/072xx</td><td colspan="1" rowspan="1">0.058</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32F070x6</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">3</td><td colspan="2" rowspan="2">200</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="2" rowspan="1">230</td></tr><tr><td colspan="1" rowspan="2">STM32F070xB</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">6</td><td colspan="2" rowspan="2">200</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="2" rowspan="1">230</td></tr><tr><td colspan="3" rowspan="1">STM32F09xxx</td><td colspan="1" rowspan="1">2</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F030xC</td><td colspan="1" rowspan="1">2</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F10xxx</td><td colspan="1" rowspan="1">1.227</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32F105xx/107xx</td><td colspan="1" rowspan="1">PA9 pin low</td><td colspan="1" rowspan="1">1.396</td><td colspan="2" rowspan="2">NA</td></tr><tr><td colspan="1" rowspan="1">PA9 pin high</td><td colspan="2" rowspan="1">524.376</td></tr><tr><td colspan="1" rowspan="1">STM32F10xxx XL-density</td><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1">1.227</td><td colspan="2" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32F2xxXx</td><td colspan="1" rowspan="1">V2.X</td><td colspan="1" rowspan="1">134</td><td colspan="2" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="1">V3.x</td><td colspan="1" rowspan="1">84.59</td><td colspan="2" rowspan="1">0.790</td></tr><tr><td colspan="1" rowspan="2">STM32F301xx/302x4(6/8)</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">45</td><td colspan="2" rowspan="2">560.5</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="2" rowspan="1">560.8</td></tr><tr><td colspan="1" rowspan="2">STM32F302xB(C)/303xB(C)</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">43.4</td><td colspan="2" rowspan="2">2.236</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="2" rowspan="1">2.36</td></tr><tr><td colspan="1" rowspan="2">STM32F302xD(E)/303xD</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">7.53</td><td colspan="2" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="1" rowspan="1">146.71</td><td colspan="2" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F303x4(6/8)/334xx/328xx</td><td colspan="1" rowspan="1">0.155</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F318xx</td><td colspan="1" rowspan="1">0.182</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F358xx</td><td colspan="1" rowspan="1">1.542</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32F373xx</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="1">43.4</td><td colspan="2" rowspan="2">2.236</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td><td colspan="2" rowspan="1">2.36</td></tr><tr><td colspan="3" rowspan="1">STM32F378xx</td><td colspan="1" rowspan="1">1.542</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F398xx</td><td colspan="1" rowspan="1">1.72</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32F40xxx/41xxx</td><td colspan="1" rowspan="1">V3.x</td><td colspan="1" rowspan="1">84.59</td><td colspan="2" rowspan="1">0.790</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">74</td><td colspan="2" rowspan="1">96</td></tr><tr><td colspan="3" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">74.5</td><td colspan="1" rowspan="1">85</td></tr><tr><td colspan="3" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">74.5</td><td colspan="1" rowspan="1">85</td></tr><tr><td colspan="3" rowspan="1">STM32F410xx</td><td colspan="1" rowspan="1">0.614</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">74.5</td><td colspan="1" rowspan="1">85</td></tr><tr><td colspan="3" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">0.614</td><td colspan="1" rowspan="1">180</td></tr><tr><td colspan="3" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">0.642</td><td colspan="1" rowspan="1">165</td></tr><tr><td colspan="3" rowspan="1">Device</td><td colspan="1" rowspan="1">Minimum startup</td><td colspan="1" rowspan="1">HSE timeout</td></tr><tr><td colspan="2" rowspan="2">STM32F429xx/439xx</td><td colspan="1" rowspan="1">V7.X</td><td colspan="1" rowspan="1">82</td><td colspan="1" rowspan="1">97</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">74</td><td colspan="1" rowspan="1">97</td></tr><tr><td colspan="3" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">73.61</td><td colspan="1" rowspan="1">96</td></tr><tr><td colspan="3" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">73.68</td><td colspan="1" rowspan="1">230</td></tr><tr><td colspan="3" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">17.93</td><td colspan="1" rowspan="1">50</td></tr><tr><td colspan="3" rowspan="1">STM32F74xxx/75xxx</td><td colspan="1" rowspan="1">16.63</td><td colspan="1" rowspan="1">50</td></tr><tr><td colspan="3" rowspan="1">STM32G03xxx/04xxx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32G07xxx/08xxx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32G0Bxxx/Cxxx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32G05xxx/061xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32G4xxXx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">1.5</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32H523xx/33xx</td><td colspan="1" rowspan="1">2.7</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32H562xx/63xx/73xx</td><td colspan="1" rowspan="1">1.8</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">53.975</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">53.975</td><td colspan="1" rowspan="1">2</td></tr><tr><td colspan="3" rowspan="1">STM32H7A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">545</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L01xxx/02xxx</td><td colspan="1" rowspan="1">0.63</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L031xx/041xx</td><td colspan="1" rowspan="1">0.62</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L05xxx/06xxx</td><td colspan="1" rowspan="1">0.22</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="2">STM32L07xxx/08xxx</td><td colspan="2" rowspan="1">V4.x</td><td colspan="1" rowspan="1">0.61</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">V11.x</td><td colspan="1" rowspan="1">0.71</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L1xxx6(8/B)A</td><td colspan="1" rowspan="1">0.542</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L1xxx6(8/B)</td><td colspan="1" rowspan="1">0.542</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L1xxxC</td><td colspan="1" rowspan="1">0.708</td><td colspan="1" rowspan="1">80</td></tr><tr><td colspan="3" rowspan="1">STM32L1xxxD</td><td colspan="1" rowspan="1">0.708</td><td colspan="1" rowspan="1">80</td></tr><tr><td colspan="3" rowspan="1">STM32L1xxxE</td><td colspan="1" rowspan="1">0.708</td><td colspan="1" rowspan="1">200</td></tr><tr><td colspan="3" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">0.86</td><td colspan="1" rowspan="1">100</td></tr><tr><td colspan="3" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">0.86</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="1" rowspan="4">STM32L47xxx/48xxx</td><td colspan="1" rowspan="2">V10.x</td><td colspan="1" rowspan="1">LSE connected</td><td colspan="1" rowspan="1">55</td><td colspan="1" rowspan="2">100</td></tr><tr><td colspan="1" rowspan="1">LSE not connected</td><td colspan="1" rowspan="1">2560</td></tr><tr><td colspan="1" rowspan="2">v9.x</td><td colspan="1" rowspan="1">LSE connected</td><td colspan="1" rowspan="1">55.40</td><td colspan="1" rowspan="2">100</td></tr><tr><td colspan="1" rowspan="1">LSE not connected</td><td colspan="1" rowspan="1">2560.5</td></tr><tr><td colspan="3" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">0.86</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">76.93</td><td colspan="1" rowspan="1">100</td></tr><tr><td colspan="3" rowspan="1">Device</td><td colspan="1" rowspan="1">Minimum startup</td><td colspan="1" rowspan="1">HSE timeout</td></tr><tr><td colspan="3" rowspan="1">STM32L4P5xx /Q5xx</td><td colspan="1" rowspan="1">9.891</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L4Rxx/4Sxx</td><td colspan="1" rowspan="1">10.12</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32L552xx/562xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">4.534</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U073xx/ STM32U083xx</td><td colspan="1" rowspan="1">5.626</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U375xx/385xx</td><td colspan="1" rowspan="1">4.418</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U575xx/85xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U595xx/599xx/5A5xx/5A9xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32U5F7xx/5F9xx/5G7xx/5G9xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32WB10xx/15xx/30xx/35xx/50xx/55xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32WBA52xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">2,73</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="3" rowspan="1">STM32WLE5xx/WL55xx</td><td colspan="1" rowspan="1">0.390</td><td colspan="1" rowspan="1">NA</td></tr></table>

# 93.2 USART connection timing

USART connection timing is the time that the host must wait for between sending the synchronization data (0x7F) and receiving the first acknowledge response (0x79).

![](images/bad5b73983edd1ac51032d3bcc8bd42ee90668931e6f534626ded6bdb8e0a27f.jpg)

Receiving haracters ifferent from Ox7 or e litches) causes bootlader start communicationsi edge of the last bit to deduce the baudrate value

Bootloader does not realign the calculated baudrate to standard baudrate values i00,600100).

# Note:

The PA9 pin (USB_VBUS) on STM32F105xx/107xx devices is used to detect the USB host connection. The initialization of USB peripheral is performed only if PA9 is high at detection phase, which means that a host is connected to the port and delivering 5 V on the USB bus. When PA9 level is high at detection phase, more time is required to initialize and shutdown the USB peripheral. To minimize bootloader detection time when PA9 pin is not used, keep PA9 low during USART detection phase, from the moment the device is reset, until a device ACK is sent.

Table 210. USART bootloader minimum timings (ms)   

<table><tr><td colspan="2" rowspan="1">Device</td><td colspan="1" rowspan="1">One USARTbyte sending</td><td colspan="1" rowspan="1">USARTconfiguration</td><td colspan="1" rowspan="1">USARTconnection</td></tr><tr><td colspan="2" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="1">0.138</td><td colspan="1" rowspan="1">0.043</td><td colspan="1" rowspan="1">0.182</td></tr><tr><td colspan="2" rowspan="1">STM32C031xx</td><td colspan="1" rowspan="1">0.112</td><td colspan="1" rowspan="1">0.028</td><td colspan="1" rowspan="1">0.168</td></tr><tr><td colspan="2" rowspan="1">STM32C051xx</td><td colspan="1" rowspan="1">0.1</td><td colspan="1" rowspan="1">0.033</td><td colspan="1" rowspan="1">0.23</td></tr><tr><td colspan="2" rowspan="1">STM32C071xx</td><td colspan="1" rowspan="1">0.1</td><td colspan="1" rowspan="1">0.104</td><td colspan="1" rowspan="1">0.182</td></tr><tr><td colspan="2" rowspan="1">STM32C091xx/92xx</td><td colspan="1" rowspan="1">0.1</td><td colspan="1" rowspan="1">0.102</td><td colspan="1" rowspan="1">0.383</td></tr><tr><td colspan="2" rowspan="1">STM32F03xx4/6</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.0064</td><td colspan="1" rowspan="1">0.16265</td></tr><tr><td colspan="2" rowspan="1">STM32F05xxx and STM32F030x8 devices</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.0095</td><td colspan="1" rowspan="1">0.16575</td></tr><tr><td colspan="2" rowspan="1">STM32F04xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.007</td><td colspan="1" rowspan="1">0.16325</td></tr><tr><td colspan="2" rowspan="1">STM32F071xx/072xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.007</td><td colspan="1" rowspan="1">0.16325</td></tr><tr><td colspan="2" rowspan="1">STM32F070x6</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.014</td><td colspan="1" rowspan="1">0.17</td></tr><tr><td colspan="2" rowspan="1">STM32F070xB</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.08</td><td colspan="1" rowspan="1">0.23</td></tr><tr><td colspan="2" rowspan="1">STM32F09xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.07</td><td colspan="1" rowspan="1">0.22</td></tr><tr><td colspan="2" rowspan="1">STM32F030xC</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.07</td><td colspan="1" rowspan="1">0.22</td></tr><tr><td colspan="2" rowspan="1">STM32F10xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.15825</td></tr><tr><td colspan="1" rowspan="2">STM32F105xx/107xx</td><td colspan="1" rowspan="1">PA9 pin low</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="1">0.007</td><td colspan="1" rowspan="1">0.16325</td></tr><tr><td colspan="1" rowspan="1">PA9 pin High</td><td colspan="1" rowspan="1">105</td><td colspan="1" rowspan="1">105.15625</td></tr><tr><td colspan="2" rowspan="1">STM32F10xxx XL-density</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.006</td><td colspan="1" rowspan="1">0.16225</td></tr><tr><td colspan="1" rowspan="2">STM32F2xxXx</td><td colspan="1" rowspan="1">V2.x</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="2">0.009</td><td colspan="1" rowspan="2">0.16525</td></tr><tr><td colspan="1" rowspan="1">V3.x</td></tr><tr><td colspan="1" rowspan="2">STM32F301xx/302x4(6/8)</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="2">0.002</td><td colspan="1" rowspan="2">0.15825</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td></tr><tr><td colspan="1" rowspan="2">STM32F302xB(C)/303xB(C)</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="2">0.002</td><td colspan="1" rowspan="2">0.15825</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td></tr><tr><td colspan="2" rowspan="1">STM32F302xD(E)/303xD</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.15885</td></tr><tr><td colspan="2" rowspan="1">STM32F303x4(6/8)/334xx/328xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.15825</td></tr><tr><td colspan="2" rowspan="1">STM32F318xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.15825</td></tr><tr><td colspan="2" rowspan="1">STM32F358xx</td><td colspan="1" rowspan="1">0.15625</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">0.3135</td></tr><tr><td colspan="1" rowspan="2">STM32F373xx</td><td colspan="1" rowspan="1">HSE connected</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="2">0.002</td><td colspan="1" rowspan="2">0.15825</td></tr><tr><td colspan="1" rowspan="1">HSE not connected</td></tr><tr><td colspan="2" rowspan="1">STM32F378xx</td><td colspan="1" rowspan="1">0.15625</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">0.3135</td></tr><tr><td colspan="2" rowspan="1">STM32F398xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.15885</td></tr><tr><td colspan="1" rowspan="2">STM32F40xxx/41xxx</td><td colspan="1" rowspan="1">V3.x</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="1">0.009</td><td colspan="1" rowspan="1">0.16525</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">0.0035</td><td colspan="1" rowspan="1">0.15975</td></tr><tr><td colspan="2" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.00326</td><td colspan="1" rowspan="1">0.15951</td></tr><tr><td colspan="2" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.00326</td><td colspan="1" rowspan="1">0.15951</td></tr><tr><td colspan="2" rowspan="1">STM32F410xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.158</td></tr><tr><td colspan="2" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.00326</td><td colspan="1" rowspan="1">0.15951</td></tr><tr><td colspan="2" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.158</td></tr><tr><td colspan="2" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.002</td><td colspan="1" rowspan="1">0.158</td></tr><tr><td colspan="1" rowspan="2">STM32F429xx/439xx</td><td colspan="1" rowspan="1">V7.Xx</td><td colspan="1" rowspan="2">0.078125</td><td colspan="1" rowspan="1">0.007</td><td colspan="1" rowspan="1">0.16325</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">0.00326</td><td colspan="1" rowspan="1">0.15951</td></tr><tr><td colspan="2" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.004</td><td colspan="1" rowspan="1">0.16</td></tr><tr><td colspan="2" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.070</td><td colspan="1" rowspan="1">0.22</td></tr><tr><td colspan="2" rowspan="1">STM32F74xxx/75xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.065</td><td colspan="1" rowspan="1">0.22</td></tr><tr><td colspan="2" rowspan="1">STM32G03xxx/04xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.01</td><td colspan="1" rowspan="1">0.11</td></tr><tr><td colspan="2" rowspan="1">STM32G07xxx/08xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.01</td><td colspan="1" rowspan="1">0.11</td></tr><tr><td colspan="2" rowspan="1">STM32G0Bxxx/Cxxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.01</td><td colspan="1" rowspan="1">0.11</td></tr><tr><td colspan="2" rowspan="1">STM32G05xxx/061xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.01</td><td colspan="1" rowspan="1">0.11</td></tr><tr><td colspan="2" rowspan="1">STM32G4xxxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">0.048</td><td colspan="1" rowspan="1">0.05</td><td colspan="1" rowspan="1">0.101</td></tr><tr><td colspan="2" rowspan="1">STM32H562xx/63xx/73xx</td><td colspan="1" rowspan="1">0.047</td><td colspan="1" rowspan="1">0.06</td><td colspan="1" rowspan="1">0.100</td></tr><tr><td colspan="2" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.072</td><td colspan="1" rowspan="1">0.22825</td></tr><tr><td colspan="2" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.072</td><td colspan="1" rowspan="1">0.22825</td></tr><tr><td colspan="2" rowspan="1">STM32H7A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.072</td><td colspan="1" rowspan="1">0.22825</td></tr><tr><td colspan="2" rowspan="1">STM32L01xxx/02xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.016</td><td colspan="1" rowspan="1">0.17</td></tr><tr><td colspan="2" rowspan="1">STM32L031xx/041xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.018</td><td colspan="1" rowspan="1">0.174</td></tr><tr><td colspan="2" rowspan="1">STM32L05xxx/06xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.018</td><td colspan="1" rowspan="1">0.17425</td></tr><tr><td colspan="1" rowspan="2">STM32L07xxx/08xxx</td><td colspan="1" rowspan="1">V4.x</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.017</td><td colspan="1" rowspan="1">0.173</td></tr><tr><td colspan="1" rowspan="1">V11.x</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.017</td><td colspan="1" rowspan="1">0.158</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxx6(8/B)A</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.008</td><td colspan="1" rowspan="1">0.16425</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxx6(8/B)</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.008</td><td colspan="1" rowspan="1">0.16425</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxxC</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.008</td><td colspan="1" rowspan="1">0.16425</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxxD</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.008</td><td colspan="1" rowspan="1">0.16425</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxxE</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.008</td><td colspan="1" rowspan="1">0.16425</td></tr><tr><td colspan="2" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.005</td><td colspan="1" rowspan="1">0.2</td></tr><tr><td colspan="2" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.07</td><td colspan="1" rowspan="1">0.22</td></tr><tr><td colspan="1" rowspan="2">STM32L47xxx/48xxx</td><td colspan="1" rowspan="1">V10.x</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32L4Rxx/4Sxx</td><td colspan="1" rowspan="1">0.0062</td><td colspan="1" rowspan="1">0.0235</td><td colspan="1" rowspan="1">0.0307</td></tr><tr><td colspan="2" rowspan="1">STM32L4P5xx/4Q5xx</td><td colspan="1" rowspan="1">0.0062</td><td colspan="1" rowspan="1">0.0235</td><td colspan="1" rowspan="1">0.0307</td></tr><tr><td colspan="2" rowspan="1">STM32L552xx/562xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.01</td><td colspan="1" rowspan="1">0.11</td></tr><tr><td colspan="2" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">0.012</td><td colspan="1" rowspan="1">0.050</td><td colspan="1" rowspan="1">0.062</td></tr><tr><td colspan="2" rowspan="1">STM32U073xx/STM32U083xx</td><td colspan="1" rowspan="1">0.014</td><td colspan="1" rowspan="1">0.049</td><td colspan="1" rowspan="1">0.077</td></tr><tr><td colspan="2" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">0.012</td><td colspan="1" rowspan="1">0.050</td><td colspan="1" rowspan="1">0.062</td></tr><tr><td colspan="2" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32U575xx/85xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32U595xx/599xx/5A5xx/5A9xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32U5F7xx/5F9xx/5G7xx/5G9xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32WB10xx/15xx/30xx/35xx/50xx/55xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.159</td></tr><tr><td colspan="2" rowspan="1">STM32WBA52xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">0.102</td><td colspan="1" rowspan="1">0.004</td><td colspan="1" rowspan="1">0,106</td></tr><tr><td colspan="2" rowspan="1">STM32WLE5xx/WL55xx</td><td colspan="1" rowspan="1">0.078125</td><td colspan="1" rowspan="1">0.001</td><td colspan="1" rowspan="1">0.110</td></tr></table>

# 93.3 USB connection timing

This is the time that the host must wait for between plugging the USB cable and establishing a correct connection with the device. It includes enumeration and DFU components configuration. The USB connection depends upon the host.

![](images/c5171146681c51c49788d008ede85d9f10bc6969d1b8b59bd0f775213b39aad1.jpg)  
Figure 123. USB connection timing description

MSv35042V1

Note:

For STM32F105xx/107xx devices, if the external HSE crystal frequency is different from 25 MHz (14.7456 or 8 MHz), the device performs several unsuccessful enumerations (with connect/disconnect sequences) before establishing a correct connection with the host. This is due to the HSE detection mechanism based on Start Of Frame (SOF) detection.

Table 211. USB bootloader minimum timings (ms)   

<table><tr><td colspan="2" rowspan="1">Device</td><td colspan="1" rowspan="1">USB connection</td></tr><tr><td colspan="2" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32C031xx</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32C051xx</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32C071xx</td><td colspan="1" rowspan="1">552</td></tr><tr><td colspan="2" rowspan="1">STM32C091xx/92xx</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32F04xxx</td><td colspan="1" rowspan="1">350</td></tr><tr><td colspan="2" rowspan="1">STM32F070x6</td><td colspan="1" rowspan="1">TBD</td></tr><tr><td colspan="2" rowspan="1">STM32F070xB</td><td colspan="1" rowspan="1">320</td></tr><tr><td colspan="1" rowspan="3">STM32F105xx/107xx</td><td colspan="1" rowspan="1">HSE = 25 MHz</td><td colspan="1" rowspan="1">460</td></tr><tr><td colspan="1" rowspan="1">HSE = 14.7465 MHz</td><td colspan="1" rowspan="1">4500</td></tr><tr><td colspan="1" rowspan="1">HSE = 8 MHz</td><td colspan="1" rowspan="1">13700</td></tr><tr><td colspan="2" rowspan="1">STM32F2xxxx</td><td colspan="1" rowspan="1">270</td></tr><tr><td colspan="2" rowspan="1">STM32F301xx/302x4(6/8)</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32F302xB(C)/303xB(C)</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32F302xD(E)/303xD</td><td colspan="1" rowspan="1">100</td></tr><tr><td colspan="2" rowspan="1">STM32F373xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="1" rowspan="2">STM32F40xxx/41xxx</td><td colspan="1" rowspan="1">V3.x</td><td colspan="1" rowspan="1">270</td></tr><tr><td colspan="1" rowspan="1">V9.x</td><td colspan="1" rowspan="1">250</td></tr><tr><td colspan="2" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">250</td></tr><tr><td colspan="2" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">250</td></tr><tr><td colspan="2" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">250</td></tr><tr><td colspan="2" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">380</td></tr><tr><td colspan="2" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">350</td></tr><tr><td colspan="1" rowspan="2">STM32F429xx/439xx</td><td colspan="1" rowspan="1">V7.x</td><td colspan="1" rowspan="2">250</td></tr><tr><td colspan="1" rowspan="1">v9.x</td></tr><tr><td colspan="2" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">200</td></tr><tr><td colspan="2" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">270</td></tr><tr><td colspan="2" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">320</td></tr><tr><td colspan="2" rowspan="1">STM32F74xxx/75xxx</td><td colspan="1" rowspan="1">230</td></tr><tr><td colspan="2" rowspan="1">STM32G0B1xx/C1xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32G4xxx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">251</td></tr><tr><td colspan="2" rowspan="1">STM32H562xx/63xx/73xx</td><td colspan="1" rowspan="1">245</td></tr><tr><td colspan="2" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">53.9764</td></tr><tr><td colspan="2" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">53.9764</td></tr><tr><td colspan="2" rowspan="1">STM327A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">53.9764</td></tr><tr><td colspan="2" rowspan="1">STM32L07xxx/08xxx</td><td colspan="1" rowspan="1">140</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxxC</td><td colspan="1" rowspan="1">849</td></tr><tr><td colspan="2" rowspan="1">STM32L1xxxD</td><td colspan="1" rowspan="1">849</td></tr><tr><td colspan="2" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">820</td></tr><tr><td colspan="2" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">820</td></tr><tr><td colspan="2" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">330</td></tr><tr><td colspan="1" rowspan="2">STM32L47xxx/48xxx</td><td colspan="1" rowspan="1">V10.x</td><td colspan="1" rowspan="2">300</td></tr><tr><td colspan="1" rowspan="1">V9.x</td></tr><tr><td colspan="2" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">430</td></tr><tr><td colspan="2" rowspan="1">STM32L4P5xx/4Q5xx</td><td colspan="1" rowspan="1">322</td></tr><tr><td colspan="2" rowspan="1">STM32L4Rxx/4Sxx</td><td colspan="1" rowspan="1">322</td></tr><tr><td colspan="2" rowspan="1">STM32L552xx/L562xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">NA</td></tr><tr><td colspan="2" rowspan="1">STM32U073xx/ STM32U083xx</td><td colspan="1" rowspan="1">241</td></tr><tr><td colspan="2" rowspan="1">STM32U375xx/385xx</td><td colspan="1" rowspan="1">210</td></tr><tr><td colspan="2" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32U575xx/85xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">Device</td><td colspan="1" rowspan="1">USB connection</td></tr><tr><td colspan="2" rowspan="1">STM32U595xx/599xx/5A5xx/5A9xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32U5F7xx/5F9xx/5G7xx/5G9xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32WB30xx/35xx/50xx/55xx</td><td colspan="1" rowspan="1">300</td></tr><tr><td colspan="2" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">69</td></tr></table>

# 93.4 I2C connection timing

I2C connection timing is the time that the host must wait for between sending I2C device address and sending command code. This timing includes I2C line stretching duration.

![](images/5e1d157c5a3a8c9d0839b66cc29f6c331a361df3f9bcf7c88bf76fc39d789a54.jpg)  
Figure 124. I2C connection timing description

Note:

For I2C communication, a timeout mechanism is implemented and must be respected to execute bootloader commands correctly. This timeout is implemented between two I2C frames in the same command (example: for Write memory command, a timeout is inserted between command sending frame and address memory sending frame). The same timeout period is inserted between two successive data receptions or transmissions in the same I2C frame. If the timeout period elapses, a system reset is generated to avoid bootloader crash.

In Erase memory and Read-out unprotect commands, consider the duration of the operation when implementing the host side. After sending the code of pages to erase, the host must wait until the bootloader device performs page erasing to complete the remaining steps of erase command.

Table 212. I2C bootloader minimum timings (ms)   

<table><tr><td colspan="2" rowspan="1">Device</td><td colspan="1" rowspan="1">Start condition+ one l2C bytesending</td><td colspan="1" rowspan="1">I2C linestretching</td><td colspan="1" rowspan="1">I2C connection</td><td colspan="1" rowspan="1">I2C timeout</td></tr><tr><td colspan="2" rowspan="1">STM32C011xx</td><td colspan="1" rowspan="1">0.254</td><td colspan="1" rowspan="1">0.004</td><td colspan="1" rowspan="1">0.060</td><td colspan="1" rowspan="1">2000</td></tr><tr><td colspan="2" rowspan="1">STM32C031xx</td><td colspan="1" rowspan="1">0.028</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.031</td><td colspan="1" rowspan="1">2000</td></tr><tr><td colspan="2" rowspan="1">STM32C051xx</td><td colspan="1" rowspan="1">0.031</td><td colspan="1" rowspan="1">0.019</td><td colspan="1" rowspan="1">0.050</td><td colspan="1" rowspan="1">2200</td></tr><tr><td colspan="2" rowspan="1">STM32C071xx</td><td colspan="1" rowspan="1">0.028</td><td colspan="1" rowspan="1">0.017</td><td colspan="1" rowspan="1">0.046</td><td colspan="1" rowspan="1">2000</td></tr><tr><td colspan="2" rowspan="1">STM32C091xx/92xx</td><td colspan="1" rowspan="1">0.031</td><td colspan="1" rowspan="1">0.018</td><td colspan="1" rowspan="1">0.049</td><td colspan="1" rowspan="1">2000</td></tr><tr><td colspan="2" rowspan="1">STM32F030xC</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0250</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F04xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0250</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F070x6</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F070xB</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F071xx/072xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0250</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F09xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0025</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F303x4(6/8)/334xx/328xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0027</td><td colspan="1" rowspan="1">0.0252</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F318xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0027</td><td colspan="1" rowspan="1">0.0252</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F358xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0055</td><td colspan="1" rowspan="1">0.0280</td><td colspan="1" rowspan="1">10</td></tr><tr><td colspan="2" rowspan="1">STM32F378xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0055</td><td colspan="1" rowspan="1">0.0280</td><td colspan="1" rowspan="1">10</td></tr><tr><td colspan="2" rowspan="1">STM32F398xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1500</td></tr><tr><td colspan="2" rowspan="1">STM32F40xxx/41xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0022</td><td colspan="1" rowspan="1">0.0247</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F401xB(C)</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0022</td><td colspan="1" rowspan="1">0.0247</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F401xD(E)</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0022</td><td colspan="1" rowspan="1">0.0247</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F410xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F411xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0022</td><td colspan="1" rowspan="1">0.0247</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F412xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F413xx/423xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="1" rowspan="2">STM32F42xxx/43xxx</td><td colspan="1" rowspan="1">V7.x</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0033</td><td colspan="1" rowspan="1">0.0258</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0022</td><td colspan="1" rowspan="1">0.0247</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F446xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F469xx/479xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F72xxx/73xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32F74xxx/75xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">500</td></tr><tr><td colspan="2" rowspan="1">STM32G03xxx/04xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32G07xxx/08xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32G0Bxx/Cxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32G05xxx/061xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">Device</td><td colspan="1" rowspan="1">Start condition+ one I2C bytesending</td><td colspan="1" rowspan="1">I2C linestretching</td><td colspan="1" rowspan="1">I2C connection</td><td colspan="1" rowspan="1">I2C timeout</td></tr><tr><td colspan="2" rowspan="1">STM32G4xxxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32H503xx</td><td colspan="1" rowspan="1">0.038</td><td colspan="1" rowspan="1">0.03</td><td colspan="1" rowspan="1">0.041</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32H562xx/63xx/73xx</td><td colspan="1" rowspan="1">0.039</td><td colspan="1" rowspan="1">0.02</td><td colspan="1" rowspan="1">0.041</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32H72xxx/73xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.05</td><td colspan="1" rowspan="1">0.0745</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32H74xxx/75xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.05</td><td colspan="1" rowspan="1">0.0725</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32H7A3xx/7B3xx/7B0xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.05</td><td colspan="1" rowspan="1">0.0745</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L07xxx/08xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L412xx/422xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L43xxx/44xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L45xxx/46xxx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="1" rowspan="2">STM32L47xx/48xxx</td><td colspan="1" rowspan="1">V10.x</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="1" rowspan="1">v9.x</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L496xx/4A6xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L4P5xx/4Q5xx</td><td colspan="1" rowspan="1">0.0109</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0642</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L4Rxx/4Sxx</td><td colspan="1" rowspan="1">0.0109</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0642</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32L552xx/L562xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U031xx</td><td colspan="1" rowspan="1">0.035</td><td colspan="1" rowspan="1">0.019</td><td colspan="1" rowspan="1">0.106</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U073xx/ STM32U083xx</td><td colspan="1" rowspan="1">0.016</td><td colspan="1" rowspan="1">0.019</td><td colspan="1" rowspan="1">0.024</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U375xx/385xx</td><td colspan="1" rowspan="1">0.021</td><td colspan="1" rowspan="1">0.018</td><td colspan="1" rowspan="1">0.092</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U535xx/545xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U575xx/85xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U595xx/599xx/5A5xx/5A9xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32U5F7xx/5F9xx/5G7xx/5G9xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32WB10xx/15xx/30xx/35xx/50xx/55xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32WBA52xx</td><td colspan="1" rowspan="1">0.0225</td><td colspan="1" rowspan="1">0.0020</td><td colspan="1" rowspan="1">0.0245</td><td colspan="1" rowspan="1">1000</td></tr><tr><td colspan="2" rowspan="1">STM32WBA62xx/63xx/64xx/65xx</td><td colspan="1" rowspan="1">0.003</td><td colspan="1" rowspan="1">0.019</td><td colspan="1" rowspan="1">0.539</td><td colspan="1" rowspan="1">1000</td></tr></table>

# 93.5 SPI connection timing

SPI connection timing is the time that the host must wait for between sending the synchronization data (0xA5) and receiving the first acknowledge response (0x79).

![](images/acee482fbbed51a4ec9ed3f6c70607e1f1ef92ca3dce95c2b3eb679a2e11e22b.jpg)  
Figure 125. SPI connection timing description

Table 213. SPI bootloader minimum timings (ms) for STM32 devices   

<table><tr><td rowspan=1 colspan=1>Device</td><td rowspan=1 colspan=1>One SPI byte sending</td><td rowspan=1 colspan=1>Delay between two bytes</td><td rowspan=1 colspan=1>SPI connection</td></tr><tr><td rowspan=1 colspan=1>All products</td><td rowspan=1 colspan=1>0.001</td><td rowspan=1 colspan=1>0.008</td><td rowspan=1 colspan=1>0.01</td></tr></table>

# Appendix A Example of ExitSecureMemory v1.0 function

/\*\*   
\*\*\*\*\*\*   
\*\*\*\*   
\* @file main.c   
\*\*\*\*\*\*\*\*   
\*\*\*\*   
\*/   
/\* Includes   
---\*/   
#include "main.h"   
/\* Private function prototypes ---\*/   
static void ConfigClock(void);   
void JUMP_WITHOUT_PARAM(uint32_t jump_address);   
void JUMP_WITH_PARAM(uint32_t jump_address, uint32_t magic, uint32_t   
applicationVectorAddress);   
/\* Private functions   
---\*/   
/\*\*   
\* @brief Main program   
\* @param None   
\* @retval None   
\*/   
int main(void)   
{ ConfigClock(); uint32_t application_address = 0x08000800; uint32_t exit_secure_memory_address = Ox1FFF1E00; uint32_t magic_number = Ox08192A3C; uint32_t exit_with_magic_number = 0x0; if (exit_with_magic_number) { JUMP_WITH_PARAM(exit_secure_memory_address, magic_number,   
application_address); } else {

JUMP_WITHOUT_PARAM(exit_secure_memory_address); } } /\*\* \* @brief ConfigClock \* @param None \* @retval None \*/ static void ConfigClock(void) { /\* Will be developped as per the template of the needed project \*/ } /\*\* \* @brief JUMP_WITHOUT_PARAM \* @param jump_address \* @retval None \*/ void JUMP_WITHOUT_PARAM(uint32_t jump_address) { asm ("LDR R1, [RO]"); // jump_address asm ("LDR R2, [R0,#4]"); asm ("MOV SP, R1"); asm ("BX R2"); }

/\*\*

\* @brief JUMP_WITH_PARAM   
\* @param jump_address, magic, applicationVectorAddress   
\* @retval None   
\*/   
void JUMP_WITH_PARAM(uint32_t jump_address, uint32_t magic, uint32_t   
applicationVectorAddress))   
{ asm ("MOV R3, RO"); // jump_address asm ("LDR RO, [R3]"); asm ("MOV SP, RO"); asm ("LDR R0, [R3,#4]"); asm ("BX RO");   
}

# Appendix B Example of ExitSecureMemory v1.1 function

else { Jump_Without_Param(exit_sticky_address, Ox0, Ox0, mpu_region_number); } } /\*\* \* @brief Configure system clocks. \* @retval None. \*/ static void ConfigClock(void) { /\* Will be developped as per the template of the needed project \*/ } /\*\*

\* @brief Jump to secure exit memory without magic number and user address.

\* @param exit_secure_address Address of exit secure memor \* @param dummyl Not used.   
\* @param dummy2 Not used.   
\* @param mpu_region_number MPU region to enable.   
\* @retval None.   
\*/   
static void Jump_Without_Param(uint32_t exit_secure_address, uint32_t   
dummyl, uint32_t dummy2, uint8_t mpu_region_number)   
{ /\*\* \* R0 = exit_secure_address --> Exit secure memory stack pointer \* R1 = dummy1 --> Dummy data \* R2 = dummy2 --> Dummy data \* R3 = mpu_region_number --> MPU region number \* \* NOTE: Assume R1 and R2 registers are useless so can be moified, but R3   
is used for MPU region number and must not be changed \*/ asm ("LDR R1, [RO]"); // Load stack pointer (content of address   
pointed by R0) in R1 asm ("LDR R2, [R0,#4]"); // Load jump address (content of address pointed   
by R4 + 4) in R2 asm ("MOV SP, R1"); // Change stack pointer register with value from   
R1 asm ("BX R2"); // Jump to address pointed by R2   
} \* @brief Jump to secure exit memory with parameters.   
\* @param exit_secure_address Address of exit secure memory.   
\* @param magic Magic number value.   
\* @param application_address Application address.   
\* @param mpu_region_number MPU region to enable.   
\* @retval None

\*/

static void Jump_With_Param(uint32_t exit_secure_address, uint32_t magic, uint32_t application_address, uint8_t mpu_region_number)

{ /\*\* \* R0 = exit_secure_address --> Exit secure memory stack pointer \* R1 = magic --> Magic number \* R2 = application_address --> User application start address \* R3 = mpu_region_number --> MPU region number \* \* NOTE: R1, R2 and R3 registers must not be changed in below code \*/ asm ("MOV R4, RO"); // Backup RO in R4 asm ("LDR RO, [R4]"); // Load stack pointer (content of address   
pointed by R4) in RO asm ("MOV SP, RO"); // Change stack pointer register with value from   
RO asm ("LDR R0, [R4,#4]"); // Load jump address (content of address pointed   
by R4 + 4) in RO asm ("BX RO"); // Jump to address pointed by RO

# 94 Revision history

Table 214. Document revision history   

<table><tr><td colspan="1" rowspan="1">Date</td><td colspan="1" rowspan="1">Revision</td><td colspan="1" rowspan="1">Changes</td></tr><tr><td colspan="1" rowspan="1">21-Feb-2019</td><td colspan="1" rowspan="1">36</td><td colspan="1" rowspan="1">Updated Table 1: Applicable products, Section 3: Glossary, Table 3: Embeddedbootloaders, Table 208: Bootloader device-dependent parameters, Table 209:Bootloader startup timings (ms), Table 210: USART bootloader minimum timings (ms),Table 211: USB bootloader minimum timings (ms), Table 212: I2C bootloader minimumtimings (ms).Added Section 77: STM32WB30xx/35xx/50xx/55xx devices</td></tr><tr><td colspan="1" rowspan="1">06-May-2019</td><td colspan="1" rowspan="1">37</td><td colspan="1" rowspan="1">Updated Table 1: Applicable products, Section 3: Glossary, Table 208: Bootloaderdevice-dependent parameters, Table 209: Bootloader startup timings (ms), Table 210:USART bootloader minimum timings (ms), Table 211: USB bootloader minimumtimings (ms), Table 212: I2C bootloader minimum timings (ms).Added Section 49: STM32G431xx/441xx devices, Section 50: STM32G47xxx/48xxxdevices.</td></tr><tr><td colspan="1" rowspan="1">08-Jul-2019</td><td colspan="1" rowspan="1">38</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 78: STM32F413xx/423xx configuration in systemmemory boot mode, Table 123: STM32H74xxx/75xxx configuration in systemmemory boot mode, Table 124: STM32H74xxx/75xxx bootloader version, Table 132:STM32L031xx/041xx configuration in system memory boot mode, Table 153:STM32L43xxx/44xxx bootloader versions, Table 154: STM32L45xxx/46xxxconfiguration in system memory boot mode, Table 161: STM32L496xx/4A6xxbootloader version, Table 172: STM32WB30xx/35xx/50xx/55xx bootloader versions,Table 208: Bootloader device-dependent parameters, Table 209: Bootloader startuptimings (ms), Table 210: USART bootloader minimum timings (ms), Table 211: USBbootloader minimum timings (ms), Table 212: I2C bootloader minimum timings (ms)Section 3: Glossary, Section 4.1: Bootloader activation, Section 44.1: Bootloaderconfiguration, Section 49.1: Bootloader configurationFigure 73: Bootloader V9.x selection for STM32H74xxx/75xxx, Figure 102: Dualbank boot implementation for STM32L4Rxxx/STM32L4Sxxx bootloader V9.xAdded Note: in Section 4.2, Note: in Section 18.3, Note: in Section 56.1, Note: inSection 59.1, Section 44: STM32G03xxx/STM32G04xxx devices</td></tr><tr><td colspan="1" rowspan="1">16-Sep-2019</td><td colspan="1" rowspan="1">39</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 97: STM32G03xxx/04xx bootloader versions,Table 151: STM32L412xx/422xx bootloader versions, Table 153:STM32L43xxx/44xxx bootloader versions, Table 155: STM32L45xxx/46xxxbootloader versions, Table 157: STM32L47xxx/48xxx bootloader V10.x versions,Table 159: STM32L47xxx/48xxx bootloader V9.x versions, Table 161:STM32L496xx/4A6xx bootloader version, Table 163: STM32L4P5xx/4Q5xxbootloader versions, Table 208: Bootloader device-dependent parameters,Table 209: Bootloader startup timings (ms), Table 210: USART bootloader minimumtimings (ms), Table 211: USB bootloader minimum timings (ms), Table 212: I2Cbootloader minimum timings (ms)Section 3: Glossary, Section 4.2: Bootloader identificationAdded Figure 67: Dual bank boot implementation for STM32G47xxx/48xxx bootloaderV13.x, Section 75: STM32L552xx/62xx devices, note in Section 77.3: Bootloaderversion</td></tr><tr><td colspan="1" rowspan="1">03-Oct-2019</td><td colspan="1" rowspan="1">40</td><td colspan="1" rowspan="1">Updated Table 3: Embedded bootloaders, Table 168: STM32L552xx/62xx bootloaderversions, Table 172: STM32WB30xx/35xx/50xx/55xx bootloader versions</td></tr><tr><td colspan="1" rowspan="1">25-Oct-2019</td><td colspan="1" rowspan="1">41</td><td colspan="1" rowspan="1">Updated:Table 89: STM32F72xxx/73xxx bootloader V9.x versions, Table 91:STM32F74xxx/75xxx bootloader V7.x versions, Table 93: STM32F74xxx/75xxxbootloader V9.x versions, Table 95: STM32F76xxx/77xxx bootloader V9.x versions,Table 96: STM32G03xxx/G04xxx configuration in system memory boot mode,Table 124: STM32H74xxx/75xxx bootloader version, Table 163:STM32L4P5xx/4Q5xx bootloader versions, Table 166: STM32L552xx/62xxconfiguration in system memory boot mode, Table 209: Bootloader startup timings(ms), Table 210: USART bootloader minimum timings (ms), Table 212: I2Cbootloader minimum timings (ms)Section 21: STM32F2xxxx devices</td></tr><tr><td colspan="1" rowspan="1">05-Dec-2019</td><td colspan="1" rowspan="1">42</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 208: Bootloader device-dependent parameters,Table 209: Bootloader startup timings (ms), Table 210: USART bootloader minimumtimings (ms), Table 211: USB bootloader minimum timings (ms), Table 212: I2Cbootloader minimum timings (ms)Section 3: GlossaryAdded: Section 57: STM32H7A3xx/7B3xx/7B0xx devices, Section 73:STM32L4P5xx/4Q5xx devices, Section 84: STM32WLE5xx/55xx devices</td></tr><tr><td colspan="1" rowspan="1">04-Jun-2020</td><td colspan="1" rowspan="1">43</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 106: STM32G431xx/441xx configuration in systemmemory boot mode, Table 108: STM32G47xxx/48xxx configuration in systemmemory boot mode, Table 109: STM32G47xxx/48xxx bootloader version, Table 124:STM32H74xxx/75xxx bootloader version, Table 126: STM32H7A3xx/7B3xx/7B0xxbootloader version, Table 163: STM32L4P5xx/4Q5xx bootloader versions, Table 166:STM32L552xx/62xx configuration in system memory boot mode, Table 168:STM32L552xx/62xx bootloader versions, Table 171: STM32WB30xx/35xx/50xx/55xxconfiguration in system memory boot mode, Table 208: Bootloader device-dependentparametersSection 3: Glossary, Section 42: STM32F74xxx/75xxx devices, Section 44.1:Bootloader configuration, Section 45.1: Bootloader configuration, Section 49.1:Bootloader configuration, Section 50.1: Bootloader configuration, Section 56.1:Bootloader configurationAdded:Section 4.5: Bootloader UART baudrate detection, Section 4.6: Programmingconstraints, Section 4.7: ExitSecureMemory featureNote: in: Section 31.1.1: Bootloader configuration, Section 31.2.1: Bootloaderconfiguration, Section 32.1: Bootloader configuration, Section 33.1: Bootloaderconfiguration, Section 35.1: Bootloader configuration, Section 36.1: Bootloaderconfiguration, Section 37.1: Bootloader configuration, Section 38.1.1: Bootloaderconfiguration, Section 38.2.1: Bootloader configurationSection 39.1: Bootloaderconfiguration, Section 40.1: Bootloader configuration, Section 41.1: Bootloaderconfiguration, Section 42.1.1: Bootloader configuration, Section 42.2.1: Bootloaderconfiguration, Section 43.1: Bootloader configurationFigure 90: Dual bank boot Implementation for STM32L3x2xx/44xxx bootloader V9.x,Figure 92: Dual bank boot implementation for STM32L45xxx/46xxx bootloader V9.x,Figure 98: Dual bank boot Implementation for STM32L496xx/4A6xx bootloader V9.xAppendix A: Example of ExitSecureMemory v1.0 functionDeleted Figure 48. Access to securable memory area from the bootloader forSTM32G03xxx/G04xxx, Figure 50. Access to securable memory area from thebootloader for STM32G07xxx/G08xxx, Figure 52. Access to securable memory area,Figure 54. Access to securable memory area</td></tr><tr><td colspan="1" rowspan="1">29-Jul-2020</td><td colspan="1" rowspan="1">44</td><td colspan="1" rowspan="1">Introduced STM32H72xxx/73xxx devices, hence added Section 55:STM32H72xxx/73xxx devices and its subsections.Updated Section 3: Glossary, note in Section 44.1: Bootloader configuration andSection 77.1: Bootloader configuration.Updated Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 8: ExitSecureMemory entry address, Table 108:STM32G47xxx/48xxx configuration in system memory boot mode, Table 126:STM32H7A3xx/7B3xx/7B0xx bootloader version, Table 144: STM32L1xxxCconfiguration in system memory boot mode, Table 146: STM32L1xxxD configuration insystem memory boot mode, Table 148: STM32L1xxxE configuration in system memoryboot mode, Table 166: STM32L552xx/62xx configuration in system memory bootmode, Table 208: Bootloader device-dependent parameters, Table 209: Bootloaderstartup timings (ms), Table 210: USART bootloader minimum timings (ms), Table 211:USB bootloader minimum timings (ms) and Table 212: I2C bootloader minimum timings(ms).Updated Figure 73: Bootloader V9.x selection for STM32H74xxx/75xxx.Minor text edits across the whole document.</td></tr><tr><td>06-Nov-2020</td><td>45</td><td>Introduced STM32WB30xx, STM32WB35xx, STM32WI55xx in Table 1: Applicable products, Table 3: Embedded bootloaders and in Section 3: Glossary Updated: Table 72: STM32F410xx configuration in system memory boot mode, Table 78: STM32F413xx/423xx configuration in system memory boot mode, Table 84: STM32F446xx configuration in system memory boot mode, Table 86: STM32F469xx/479xx configuration in system memory boot mode, Table 88: STM32F72xxx/73xxx configuration in system memory boot mode, Table 92: STM32F74xxx/75xxx configuration in system memory boot mode, Table 94: STM32F76xxx/77xxx configuration in system memory boot mode, Table 98: STM32G07xxx/8xxx configuration in system memory boot mode, Table 106: STM32G431xx/441xx configuration in system memory boot mode, Table 107: STM32G431xx/441xx bootloader version, Table 108: STM32G47xxx/48xxx configuration in system memory boot mode, Table 123: STM32H74xxx/75xxx configuration in system memory boot mode, Table 124: STM32H74xxx/75xxx bootloader version, Table 125: STM32H7A3xx/7B3xx/7B0xx configuration in system memory boot mode, Table 126: STM32H7A3xx/7B3xx/7B0xx bootloader version, Table 130: STM32L01xxx/02xxx configuration in system memory boot mode, Table 132: STM32L031xx/041xx configuration in system memory boot mode, Table 137: STM32L07xxx/08xxx bootloader versions, Table 138: STM32L07xxx/08xxx configuration in system memory boot mode, Table 150: STM32L412xx/422xx configuration in system memory boot mode, Table 162: STM32L4P5xx/4Q5xx configuration in system memory boot mode, Table 164: STM32L4Rxxx/4Sxxx configuration in system memory boot mode, Table 166: STM32L552xx/62xx configuration in system memory boot mode, Table 171: STM32WB30xx/35xx/50xx/55xx configuration in system memory boot mode, Table 187: STM32WLE5xx/55xx configuration in system memory boot mode, Table 188: STM32WLE5xx/55xx bootloader versions, Table 208: Bootloader device- dependent parameters, Table 209: Bootloader startup timings (ms), Table 210: USART bootloader minimum timings (ms) title of Table 77: STM32WB30xx/35xx/50xx/55xx devices, Table 171: STM32WB30xx/35xx/50xx/55xx configuration in system memory boot mode,</td></tr><tr><td>02-Dec-2020</td><td>Upadated: 46</td><td>Table 84: STM32WLE5xx/55xx devices, Table 187: STM32WLE5xx/55xx configuration in system memory boot mode, Table 113: Bootloader V12.x selection for STM32WLE5xx/55xx, Table 188: STM32WLE5xx/55xx bootloader versions Table 3: Embedded bootloaders, Table 96: STM32G03xxx/G04xxx configuration in system memory boot mode, Table 108: STM32G47xxx/48xxx configuration in system memory boot mode, Table 153: STM32L43xxx/44xxx bootloader versions, Table 155: STM32L45xxx/46xxx bootloader versions Added following notes: Note: on page 357, Note: on page 364, Note: on page 372, Note: on page 385, Note:</td></tr><tr><td colspan="1" rowspan="1">16-Feb-2021</td><td colspan="1" rowspan="1">47</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 3: Embedded bootloaders, Table 8:ExitSecureMemory entry address, Table 95: STM32F76xxx/77xxx bootloader V9.xversions, Table 108: STM32G47xxx/48xxx configuration in system memory bootmode, Table 150: STM32L412xx/422xx configuration in system memory boot mode,Table 152: STM32L43xxx/44xxx configuration in system memory boot mode,Table 154: STM32L45xxx/46xxx configuration in system memory boot mode,Table 158: STM32L47xxx/48xxx configuration in system memory boot mode,Table 160: STM32L496xx/4A6xx configuration in system memory boot mode,Table 162: STM32L4P5xx/4Q5xx configuration in system memory boot mode,Table 164: STM32L4Rxx/4Sxxx configuration in system memory boot mode,Table 166: STM32L552xx/62xx configuration in system memory boot mode,Table 171: STM32WB30xx/35xx/50xx/55xx configuration in system memory bootmode, Table 208: Bootloader device-dependent parameters, Table 209: Bootloaderstartup timings (ms), Table 210: USART bootloader minimum timings (ms),Table 211: USB bootloader minimum timings (ms), Table 212: I2C bootloaderminimum timings (ms)Section 3: GlossaryAdded Section 46: STM32G0BOxx device bootloader and Section 47:STM32G0B1xx/0C1xx device bootloader</td></tr><tr><td colspan="1" rowspan="1">01-Apr-2021</td><td colspan="1" rowspan="1">48</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 3: Embedded bootloaders, Table 8:ExitSecureMemory entry address, Table 208: Bootloader device-dependentparameters, Table 209: Bootloader startup timings (ms), Table 210: USARTbootloader minimum timings (ms), Table 212: I2C bootloader minimum timings (ms)Added Section 48: STM32G05xxx/061xx devices and Section 51:STM32G491xx/4A1xx devices</td></tr><tr><td colspan="1" rowspan="1">06-Jul-2021</td><td colspan="1" rowspan="1">49</td><td colspan="1" rowspan="1">Updated:Section 3: Glossary, Section 31.2.1: Bootloader configurationTable 3, Table 20,from Table 22 to Table 27, from Table 30 to Table 35, Table 36,Table 38, Table 40, Table 44, Table 46, Table 48, Table 50, Table 52, Table 54,Table 56, Table 58, Table 60, Table 62, Table 64, Table 66, Table 67, Table 68,Table 70, Table 72, Table 74, Table 76, Table 78, Table 80, Table 82, Table 84,Table 86, Table 88, Table 90, Table 92, Table 94, Table 96, Table 98, Table 100,Table 102, Table 104, Table 106, Table 108, Table 109, Table 110, Table 121,Table 123, Table 125, Table 125, Table 130, Table 132, Table 134, Table 135,Table 136, Table 138, Table 140, Table 142, Table 143, Table 144, Table 145,Table 146, Table 148, Table 149, Table 150, Table 152, Table 154, Table 156,Table 158, Table 160, Table 162, Table 164, Table 166, Table 171, Table 187,Table 208Added Table 167: STM32L552xx/62xx special commands and Section 76:STM32WB10xx/15xx devices</td></tr><tr><td colspan="1" rowspan="1">23-Sep-2021</td><td colspan="1" rowspan="1">50</td><td colspan="1" rowspan="1">Updated:Section 3: Glossary, Section 46.1: Bootloader configuration, Section 47.1:Bootloader configuration,Table 1, Table 2, Table 3, Table 99, Table 122, Table 124, Table 126, Table 153,Table 170, Table 172, Table 208, Table 209, Table 210, Table 211, Table 212Added Section 89: STM32U575xx/85xx devices</td></tr><tr><td colspan="1" rowspan="1">20-Oct-2021</td><td colspan="1" rowspan="1">51</td><td colspan="1" rowspan="1">Updated:Table 3, Table 67,Table 99, Table 122,Table 208Section 31.2.1: Bootloader configuration</td></tr><tr><td colspan="1" rowspan="1">04-Feb-2022</td><td colspan="1" rowspan="1">52</td><td colspan="1" rowspan="1">Updated:Section 3: Glossary, Section 4.1: Bootloader activation,Table 1, Table 2, Table 3, Table 7, Table 99, Table 124, Table 208Figure 62Added Section 5: STM32C011xx devices and Section 6: STM32C031xx devices</td></tr><tr><td colspan="1" rowspan="1">01-Mar-2022</td><td colspan="1" rowspan="1">53</td><td colspan="1" rowspan="1">Updated:Table 3, Table 121, Table 122, Table 208.Section 4.1: Bootloader activation, , Section 44.1: Bootloader configuration,Section 45.1: Bootloader configuration, Section 46.1: Bootloader configuration,Section 48.1: Bootloader configuration</td></tr><tr><td colspan="1" rowspan="1">20-Apr-2022</td><td colspan="1" rowspan="1">54</td><td colspan="1" rowspan="1">Updated:Table 3, Table 121, Table 125, Table 126, Table 208</td></tr><tr><td colspan="1" rowspan="1">22-Jun-2022</td><td colspan="1" rowspan="1">55</td><td colspan="1" rowspan="1">Updated:Table 3, Table 123, Table 122, Table 208</td></tr><tr><td colspan="1" rowspan="1">14-Dec-2022</td><td colspan="1" rowspan="1">56</td><td colspan="1" rowspan="1">Added Section 4.8: IWDG usage, Section 78: STM32WBA52xx devicesUpdated:Table 1, Table 2, Table 3, Table 7, Table 124, Table 125, Table 188, Table 208,Table 209, Table 210, Table 212Section 3: Glossary, Section 4.1: Bootloader activationadded note 1 in Table 98, Table 100, Table 102, Table 106, Table 108, Table 110,Table 150</td></tr><tr><td colspan="1" rowspan="1">21-Feb-2023</td><td colspan="1" rowspan="1">57</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 7: Flash memory alignment constraints, Table 208:Bootloader device-dependent parameters, Table 209: Bootloader startup timings(ms), Table 210: USART bootloader minimum timings (ms), Table 211: USBbootloader minimum timings (ms), Table 212: I2C bootloader minimum timings (ms)Section 3: Glossary, Section 4.2: Bootloader identificationAdded Section 52: STM32H503xx devices, Section 54: STM32H562xx/563xx/573xxdevices, Section 90: STM32U595xx/99xx/A5xx/A9xx devices</td></tr><tr><td colspan="1" rowspan="1">04-Apr-2023</td><td colspan="1" rowspan="1">58</td><td colspan="1" rowspan="1">Updated:Table 1: Applicable products, Table 3: Embedded bootloaders, Table 208: Bootloaderdevice-dependent parameters, Table 209: Bootloader startup timings (ms),Table 210: USART bootloader minimum timings (ms), Table 211: USB bootloaderminimum timings (ms), Table 212: I2C bootloader minimum timings (ms)Section 3: GlossaryAdded Section 88: STM32U535xx/545xx devices</td></tr><tr><td colspan="1" rowspan="1">21-Jun-2023</td><td colspan="1" rowspan="1">59</td><td colspan="1" rowspan="1">Updated Table 3: Embedded bootloaders, Table 99: STM32G07xxx/08xxx bootloaderversions, and Table 208: Bootloader device-dependent parameters.Minor text edits across the whole document.</td></tr><tr><td>25-Oct-2023</td><td>60</td><td>Updated Section 2: Related documents, note in Section 4.1: Bootloader activation, Section 54.3: Bootloader version, and Section 68.1: Bootloader configuration. Updated Table 2: Bootloader activation patterns, Table 3: Embedded bootloaders, Table 69: STM32F401xB(C) bootloader versions, Table 102: STM32G0B1xx/0C1xx configuration in system memory boot mode, Table 112: STM32H503xx configuration in system memory boot mode, Table 118: STM32H562xx/563xx/573xx configuration in system memory boot mode, Table 120: STM32H562xx/563xx/573xx bootloader version, Table 121: STM32H72xxx/73xxx configuration in system memory boot mode, Table 123: STM32H74xxx/75xxx configuration in system memory boot mode, Table 125: STM32H7A3xx/7B3xx/7B0xx configuration in system memory boot mode, Table 166: STM32L552xx/62xx configuration in system memory boot mode, Table 168: STM32L552xx/62xx bootloader versions, Table 196: STM32U535xx/545xx configuration in system memory boot mode, Table 196: STM32U535xx/545xx configuration in system memory boot mode, Table 198: STM32U535xx/545xx bootloader versions, Table 201: STM32U575xx/85xx bootloader versions, Table 202: STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode, Table 204: STM32U595xx/99xx/A5xx/A9xx bootloader versions, and Table 209: Bootloader startup timings (ms). Updated Figure 69: Bootloader V14 selection for STM32H503xx, Figure 71: Bootloader V14 selection for STM32H562xx/563xx/573xx, Figure 117: Bootloader V9.x selection for STM32U535xx/545xx, Figure 118: Bootloader V9.x selection for STM32U575xx/85xx, and Figure 119: Bootloader V9.x selection for</td></tr><tr><td>11-Jan-2024</td><td>61</td><td>Added STM32U5F7xx, STM32U5F9xx, STM32U5G7xx, and STM32U5G9xx devices. Updated Table 1: Applicable products, Table 3: Embedded bootloaders, and tables 208 to 212. Updated Section 3: Glossary. Added Section 91: STM32U5F7xx/F9xx/G7xx/G9xx devices and its subsections. Minor text edits across the whole document.</td></tr><tr><td colspan="1" rowspan="1">06-Mar-2024</td><td colspan="1" rowspan="1">62</td><td colspan="1" rowspan="1">Updated Table 1: Applicable products, Table 3: Embedded bootloaders, Table 7: Flashmemory alignment constraints, Table 8: ExitSecureMemory entry address, Table 36:STM32F10xxx configuration in system memory boot mode, Table 102:STM32G0B1xx/0C1xx configuration in system memory boot mode, Table 112:STM32H503xx configuration in system memory boot mode, Table 114: STM32H503xxbootloader version, Table 118: STM32H562xx/563xx/573xx configuration in systemmemory boot mode, Table 121: STM32H72xxx/73xxx configuration in system memoryboot mode, Table 123: STM32H74xxx/75xxx configuration in system memory bootmode, Table 124: STM32H74xxx/75xxx bootloader version, Table 125:STM32H7A3xx/7B3xx/7B0xx configuration in system memory boot mode, Table 158:STM32L47xxx/48xxx configuration in system memory boot mode, and Table 208:Bootloader device-dependent parameters.Updated Section 3: Glossary, Section 4.1: Bootloader activation, Section 69.1:Bootloader configuration, and Section 70.1: Bootloader configuration.Added Section 4.7.1: ExitSecureMemory v1.0, Section 4.7.2: ExitSecureMemory v1.1,Section 53: STM32H523xx/533xx devices, Section 58: STM32H7Rxxx/7Sxxx devices,Section 78: STM32WBA5xxx devices, Section 85: STM32U031xx devices, Section 86:STM32U073xx/83xx devices, and their subsections.Added Appendix B: Example of ExitSecureMemory v1.1 function.Updated Figure 6: ExitSecureMemory function usage, Figure 7: Access to securablememory area from the bootloader, Figure 69: Bootloader V14 selection forSTM32H503xx, and Figure 71: Bootloader V14 selection forSTM32H562xx/563xx/573xx.Minor text edits across the whole document.</td></tr><tr><td colspan="1" rowspan="1">13-May-2024</td><td colspan="1" rowspan="1">63</td><td colspan="1" rowspan="1">Added STM32H562xx devices and STM32WB0 series, hence updated Table 1:Applicable products, Table 3: Embedded bootloaders, Table 7: Flash memoryalignment constraints, and tables 209 to 213.Updated Section 3: Glossary and note in Section 69.1: Bootloader configuration.Added Section 80: STM32WB05xx devices, Section 81: STM32WB06xx/07xx devices,Section 82: STM32WB09xx devices, and their subsections.Updated Figure 52: Bootloader V9.x selection for STM32F446xx and Figure 107:Bootloader V11.x selection for STM32WBA5xxx.Updated Table 2: Bootloader activation patterns, Table 103: STM32G0B1xx/0C1xxbootloader versions, Table 121: STM32H72xxx/73xxx configuration in system memoryboot mode, Table 123: STM32H74xxx/75xxx configuration in system memory bootmode, Table 196: STM32U535xx/545xx configuration in system memory boot mode,and Table 199: STM32U575xx/85xx configuration in system memory boot mode.Minor text edits across the whole document.</td></tr><tr><td colspan="1" rowspan="1">18-Sep-2024</td><td colspan="1" rowspan="1">64</td><td colspan="1" rowspan="1">Added STM32C071xx and STM32H7B0xx devices, hence updated Table 1: Applicableproducts, Table 3: Embedded bootloaders, and tables 208 to 213.Updated Section 3: Glossary, Section 4.2: Bootloader identification, Section 52.1:Bootloader configuration, Section 53.1: Bootloader configuration, Section 54.1:Bootloader configuration, Section 57: STM32H7A3xx/7B3xx/7B0xx devices,Section 75.1: Bootloader configuration, Section 78.1: Bootloader configuration,Section 78.1: Bootloader configuration, Section 88.1: Bootloader configuration,Section 89.1: Bootloader configuration, and Section 90.1: Bootloader configuration.Added Section 4.9: Bootloader models, Section 4.10: Boot constraints on BL.Section 7: STM32C051xx devices, and Section 45.3.1: Compatibility break on bootsequence.Updated Table 8: ExitSecureMemory entry address, Table 99: STM32G07xxx/08xxxbootloader versions, Table 157: STM32L47xxx/48xxx bootloader V10.x versions, andTable 158: STM32L47xxx/48xxx configuration in system memory boot mode.</td></tr><tr><td colspan="1" rowspan="1">14-Feb-2025</td><td colspan="1" rowspan="1">65</td><td colspan="1" rowspan="1">Added STM32C051/91/92xx, STM32U375/385xx, and STM32WBA62/63/64/65xxdevices.Updated Table 1: Applicable products, Table 3: Embedded bootloaders, tables 6 to 10,Table 14: STM32C051xx configuration in system memory boot mode, Table 101:STM32G0B0xx bootloader versions, Table 103: STM32G0B1xx/0C1xx bootloaderversions, Table 105: STM32G05xxx/061xx bootloader versions, Table 107:STM32G431xx/441xx bootloader version, Table 115: STM32H523xx/533xxconfiguration in system memory boot mode, Table 118: STM32H562xx/563xx/573xxconfiguration in system memory boot mode, Table 124: STM32H74xxx/75xxxbootloader version, Table 127: STM32H7Rxxx/7Sxxx configuration in system memoryboot mode, Table 159: STM32L47xxx/48xxx bootloader V9.x versions, Table 173:STM32WBA5xxx configuration in system memory boot mode, tables 189 to 193,Table 202: STM32U595xx/99xx/A5xx/A9xx configuration in system memory boot mode,and tables 208 to 213.Added footnote to Table 100: STM32G0B0xx configuration in system memory bootmode.Updated Section 3: Glossary, Section 4.2: Bootloader identification, Section 4.3:Hardware connection requirements, Section 85.1: Bootloader configuration, andSection 86.1: Bootloader configuration.Replaced master/slave with controller target when referring to I2C.Added Section 7: STM32C051xx devices, Section 9: STM32C091xx/92xx devices,Section 58.4: Jump to bootloader, Section 79: STM32WBA62xx/63xx/64xx/65xxdevices, Section 87: STM32U375xx/85xx devices, and their subsections.Updated Figure 4: SPI connection, figures 13 to 15, 60 to 66, 68 to 71, 74 and 75,Figure 107: Bootloader V11.x selection for STM32WBA5xxx,and figures 113 to 115.Minor text edits across the whole document.</td></tr><tr><td colspan="1" rowspan="1">10-Apr-2025</td><td colspan="1" rowspan="1">66</td><td colspan="1" rowspan="1">Updated Table 3: Embedded bootloaders, Table 99: STM32G07xxx/08xxx bootloaderversions, Table 124: STM32H74xxx/75xxx bootloader version, and Table 208:Bootloader device-dependent parameters.</td></tr><tr><td colspan="1" rowspan="1">01-Jul-2025</td><td colspan="1" rowspan="1">67</td><td colspan="1" rowspan="1">Updated document title.Added STM32WBA50xx and STM32WL3xxx devices.Updated Table 1: Applicable products, Table 2: Bootloader activation patterns, Table 3:Embedded bootloaders, Table 7: Flash memory alignment constraints, Table 17:STM32C071xx bootloader versions, Table 97: STM32G03xxx/04xxx bootloaderversions, Table 107: STM32G431xx/441xx bootloader version, Table 173:STM32WBA5xxx configuration in system memory boot mode, Table 175:STM32WBA5xxx bootloader versions, Table 208: Bootloader device-dependentparameters, and Table 209: Bootloader startup timings (ms).Updated Section 3: Glossary, Section 4.1: Bootloader activation, Section 4.3:Hardware connection requirements, note in Section 13.1: Bootloader configuration,Section 78: STM32WBA5xxx devices, and Section 93.1: Bootloader startup timing.Removed former Section 78: STM32WBA52xx devices.Added Section 83: STM32WL3xxx devices and its subsections.</td></tr><tr><td colspan="1" rowspan="1">04-Aug-2025</td><td colspan="1" rowspan="1">68</td><td colspan="1" rowspan="1">Updated Table 12: STM32C031xx configuration in system memory boot mode,Table 16: STM32C071xx configuration in system memory boot mode, Table 27:STM32F04xxx bootloader versions, Table 29: STM32F070x6 bootloader versions,Table 31: STM32F070xB bootloader versions, Table 33: STM32F071xx/072xxbootloader versions, Table 47: STM32F301xx/302x4(6/8) bootloader versions,Table 49: STM32F302xB(C)/303xB(C) bootloader versions, Table 51:STM32F302xD(E)/303xD(E) bootloader versions, Table 59: STM32F373xx bootloaderversions, Table 137: STM32L07xxx/08xxx bootloader versions, Table 145:STM32L1xxxC bootloader versions, Table 147: STM32L1xxxD bootloader versions,and Table 149: STM32L1xxxE bootloader versions.</td></tr><tr><td colspan="1" rowspan="1">18-Nov-2025</td><td colspan="1" rowspan="1">69</td><td colspan="1" rowspan="1">Updated Table 3: Embedded bootloaders, Table 18: STM32C091xx/92xx configurationin system memory boot mode, Table 104: STM32G05xxx/061xx configuration in systemmemory boot mode, Table 129: STM32H7Rxxx/7Sxxx bootloader version, andTable 201: STM32U575xx/85xx bootloader versions.Updated Figure 15: Bootloader V11.0 selection for STM32C051xx devices.Minor text edits across the whole document.</td></tr></table>

# IMPORTANT NOTICE  READ CAREFULLY

improvements to ST products and/or to this document at any time without notice.

purchasers and ST, the provisions of such contractual arrangement shall prevail.

terms and conditions of sale in place at the time of order acknowledgment.

assistance or the design of the purchasers' products.

No license, express or implied, to any intellectual property right is granted by ST herein.

purchasers' market segment, the purchasers shall contact ST for more information.

or service names are the property of their respective owners.

I